(function(a){var b=new Blob([document.querySelector('#thRecordWorker').textContent]),c=function(c,d){var e=d||{},f=e.bufferLen||4096;this.context=c.context,_self=this,_self.closed=!1,this.node=this.context.createScriptProcessor?this.context.createScriptProcessor(f,2,2):this.context.createJavaScriptNode(f,2,2),this.worker=new Worker(a.URL.createObjectURL(b)),this.worker.postMessage({command:'init',config:{sampleRate:this.context.sampleRate}});var g,h=!1;this.node.onaudioprocess=function(a){_self.closed||!h||_self.worker.postMessage({command:'record',buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(e[b]=a[b])},this.record=function(){h=!0},this.stop=function(){h=!1},this.clear=function(){_self.worker.postMessage({command:'clear'})},this.getBuffers=function(a){_self.closed||(g=a||e.callback,_self.worker.postMessage({command:'getBuffers'}))},this.exportWAV=function(a,b){if(!_self.closed){if(g=a||e.callback,b=b||e.type||'audio/wav',!g)throw new Error('Callback not set');_self.worker.postMessage({command:'exportWAV',type:b})}},this.exportMonoWAV=function(a,b){if(!_self.closed){if(g=a||e.callback,b=b||e.type||'audio/wav',!g)throw new Error('Callback not set');_self.worker.postMessage({command:'exportMonoWAV',type:b})}},this.worker.onmessage=function(a){if(!_self.closed){var b=a.data;g(b)}},c.connect(this.node),this.node.connect(this.context.destination)};c.setupDownload=function(b,c){var d=(a.URL||a.webkitURL).createObjectURL(b),e=document.getElementById('saveWavFile');e.href=d,e.download=c||'output.wav'},a.Recorder=c})(window);