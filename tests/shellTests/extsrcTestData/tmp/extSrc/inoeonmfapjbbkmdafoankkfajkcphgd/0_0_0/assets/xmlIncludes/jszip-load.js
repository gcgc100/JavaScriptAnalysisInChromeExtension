(function(){function a(a){if(this.stream='',JSZip.support.uint8array&&a instanceof Uint8Array)this.stream=JSZip.utils.uint8Array2String(a);else if(JSZip.support.arraybuffer&&a instanceof ArrayBuffer){var b=new Uint8Array(a);this.stream=JSZip.utils.uint8Array2String(b)}else this.stream=JSZip.utils.string2binary(a);this.index=0}function b(a,b){this.options=a,this.loadOptions=b}function c(a,b){this.files=[],this.loadOptions=b,a&&this.load(a)}var d=65535,e=-1,f=function(a){var b,c,d='';for(c=0;c<(a||'').length;c++)b=a.charCodeAt(c),d+='\\x'+(16>b?'0':'')+b.toString(16).toUpperCase();return d},g=function(a){for(var b in JSZip.compressions)if(JSZip.compressions.hasOwnProperty(b)&&JSZip.compressions[b].magic===a)return JSZip.compressions[b];return null};a.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.stream.length<a||0>a)throw new Error('End of stream reached (stream length = '+this.stream.length+', asked index = '+a+'). Corrupted zip ?')},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){return this.stream.charCodeAt(a)},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){this.checkOffset(a);var b=this.stream.slice(this.index,this.index+a);return this.index+=a,b},readDate:function(){var a=this.readInt(4);return new Date((127&a>>25)+1980,(15&a>>21)-1,31&a>>16,31&a>>11,63&a>>5,(31&a)<<1)}},b.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readString(this.fileNameLength),a.skip(c),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error('Bug or corrupted zip : didn\'t get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)');if(this.compressedFileData=a.readString(this.compressedSize),b=g(this.compressionMethod),null===b)throw new Error('Corrupted zip : compression '+f(this.compressionMethod)+' unknown (inner file : '+this.fileName+')');if(this.uncompressedFileData=b.uncompress(this.compressedFileData),this.uncompressedFileData.length!==this.uncompressedSize)throw new Error('Bug : uncompressed data size mismatch');if(this.loadOptions.checkCRC32&&JSZip.prototype.crc32(this.uncompressedFileData)!==this.crc32)throw new Error('Corrupted zip : CRC32 mismatch')},readCentralPart:function(a){if(this.versionMadeBy=a.readString(2),this.versionNeeded=a.readInt(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4),this.fileNameLength=a.readInt(2),this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error('Encrypted zip are not supported');this.fileName=a.readString(this.fileNameLength),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=new a(this.extraFields[1].value);this.uncompressedSize===e&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===e&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===e&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===e&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index;for(this.extraFields=this.extraFields||{};a.index<e+this.extraFieldsLength;)b=a.readInt(2),c=a.readInt(2),d=a.readString(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){this.useUTF8()&&(this.fileName=JSZip.prototype.utf8decode(this.fileName),this.fileComment=JSZip.prototype.utf8decode(this.fileComment))}},c.prototype={checkSignature:function(a){var b=this.reader.readString(4);if(b!==a)throw new Error('Corrupted zip or bug : unexpected signature ('+f(b)+', expected '+f(a)+')')},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44;0<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readString(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error('Multi-volumes zip are not supported')},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(JSZip.signature.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===JSZip.signature.CENTRAL_FILE_HEADER;)a=new b({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a)},readEndOfCentral:function(){var a=this.reader.stream.lastIndexOf(JSZip.signature.CENTRAL_DIRECTORY_END);if(-1===a)throw new Error('Corrupted zip : can\'t find end of central directory');if(this.reader.setIndex(a),this.checkSignature(JSZip.signature.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d||this.diskWithCentralDirStart===d||this.centralDirRecordsOnThisDisk===d||this.centralDirRecords===d||this.centralDirSize===e||this.centralDirOffset===e){if(this.zip64=!0,a=this.reader.stream.lastIndexOf(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===a)throw new Error('Corrupted zip : can\'t find the ZIP64 end of central directory locator');this.reader.setIndex(a),this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},load:function(b){this.reader=new a(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},JSZip.prototype.load=function(a,b){var d,e,f,g;for(b=b||{},b.base64&&(a=JSZipBase64.decode(a)),e=new c(a,b),d=e.files,f=0;f<d.length;f++)g=d[f],this.file(g.fileName,g.uncompressedFileData,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir});return this}})();