var texthelpComponents=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=1)}([function(a){'use strict';a.exports=()=>{var a=new Set;return Object.freeze({pub:(b,c)=>a.forEach((a)=>a(b,c)),sub:(b)=>(a.add(b),()=>a.delete(b))})}},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0}),b.BackgroundComponents=void 0;var d=c(2);class e{constructor(){this._commms=null}initialise(){try{this._commms=new d.SpeechCommsBG,this._commms.initialise()}catch(a){throw a}}}b.BackgroundComponents=e;var f=new e;f.initialise()},function(a,b,c){'use strict';function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,'__esModule',{value:!0}),b.SpeechCommsBG=void 0;var e=c(0),f=d(e),g=c(3),h=d(g),i=c(4);class j extends i.ChromeCommsBG{constructor(){super(),this._commms=null,this._speechManager=null,this.speechEvents=null,console.log('SpeechCommsBG')}initialise(){console.log('SpeechComms: initialise');var a=(0,f.default)();super.initialise(a),this._speechManager=new h.default,this._speechManager.initialise(a)}getVoices(){}play(){}pause(){}stop(){}resume(){}onWord(){}}b.SpeechCommsBG=j},function(a,b){'use strict';!function(b,c){a.exports=c()}(window,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(a,'__esModule',{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&'object'==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,'default',{enumerable:!0,value:a}),2&c&&'string'!=typeof a)for(var f in a)b.d(d,f,function(b){return a[b]}.bind(null,f));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=1)}([function(a){a.exports={}},function(b,d,e){e.r(d);class f{constructor(){}initialise(){}play(){}stop(){}pause(){}getVoices(){}onWordSpoken(){}}class g extends f{constructor(a,b){super(),this._voices=[],this.configuration=b,this.speechSettings=a,this.charMap=this.configuration.getConfiguration().charMap,this.eventBus=null,this.m_stop=!1,this.m_paused=!1}initialise(a){void 0!=a&&(this.eventBus=a),this.getVoicesList()}play(b){try{this.m_stop=!0,this.m_paused=!1;var d=this,e=null;void 0==e&&(e=!0);for(var f,c='',g=[],h=0,i=b.words,j=0;j<i.length;j++)f=i[j],h=h+f.length+1,g.push(h),c+=' '===f||''===f?' ':e?i[j]+' ':i[j];chrome.tts.speak(c,{voiceName:b.voice,requiredEventTypes:['word'],rate:1,onEvent:function(a){if('end'==a.type){var c={method:'onStop',type:'SP_M_1342_BK'};c.request=b,c.origin=b.origin,c.word=-1,d.eventBus.pub('onthAPIWordonthAPIStop',c)}if('word'==a.type){var e=-1==b.voice.indexOf('Chrome')?d.getWordIndex(a.charIndex,g):d.getChromeWordIndex(a.charIndex,g);var f={method:'onWord',type:'SP_M_1342_BK'};f.word=e,f.tabid=b.tabid,f.request=b,f.origin=b.origin,d.eventBus.pub('onthAPIWord',f)}a.type,'error'==a.type&&console.log('Error: '+a.errorMessage)}})}catch(a){console.log('SpeechBrowser - play: ',a)}}stop(){this.m_stop=!0,this.m_paused=!1;try{return void chrome.tts.stop()}catch(a){textHelp.webreaderapi.HelpersSingleton.getInstance().logError(a)}}pause(){return this.m_paused?(chrome.tts.resume(),void(this.m_paused=!1)):void(chrome.tts.pause(),this.m_paused=!0)}resume(){chrome.tts.resume()}getVoices(){try{return this._voices}catch(a){console.log('error')}}getVoicesList(){try{chrome.tts.getVoices(this.setVoices.bind(this))}catch(a){console.log('error')}}setVoices(a){try{for(var b=a,c=0;c<b.length;c++)this._voices[b[c].voiceName]=b[c].voiceName}catch(a){console.log('error')}}onWordSpoken(){}getWordIndex(a,b){for(var c=0;c<b.length;++c)if(a<b[c])return c;return 0}getChromeWordIndex(a,b){for(var c=0;c<b.length;++c)if(a<=b[c])return c;return 0}}e(0);class h extends f{constructor(a,b){super();try{this.currentVoices=[],this.speechServer=null,this.speechServerUser=null,this.rootLocation=null,this.audioElem=null,this.audioPlaybackTimerID=null,this.currentHighlightWord=-1,this.playbackTimeArray=null,this.session=0,this.boundAudioPlayBackTimer=null,this.speechStop=!1,this.paused=!1,this.gotVoices=!1,this.configuration=b,this.speechSettings=a,this.voicePromise=null,this.voicesAvailable=null,this.eventBus=null,this.charMap=this.configuration.getConfiguration().charMap,this.timeout=null,this.m_voices=[]}catch(a){console.log('Request failed: SpeechServer - constructor: ',a)}}initialise(a){try{this.speechServer=this.configuration.getSpeechServer(),this.speechServerUser=this.configuration.getUser(),void 0!=a&&(this.eventBus=a)}catch(a){console.log('Request failed: SpeechServer - initialise: ',a),Promise.reject(a)}}refreshVoices(){return this.getVoices()}status(a){return 200<=a.status&&300>a.status?Promise.resolve(a):Promise.reject(new Error(a.statusText))}json(a){return a.json()}text(a){return a.text()}blob(a){return a.blob()}buffer(a){return a.arrayBuffer()}getVoices(){for(var a=[{voice:'Ava',oldVoice:'Vocalizer Expressive Ava Premium High 22kHz',description:'US Ava - Vocalizer'},{voice:'Samantha',oldVoice:'Vocalizer Expressive Samantha Premium High 22kHz',description:'US Samantha - Vocalizer'},{voice:'Tom',oldVoice:'Vocalizer Expressive Tom Premium High 22kHz',description:'US Tom - Vocalizer'},{voice:'Serena',oldVoice:'Vocalizer Expressive Serena Premium High 22kHz',description:'UK Serena - Vocalizer'},{voice:'Daniel',oldVoice:'Vocalizer Expressive Daniel Premium High 22kHz',description:'UK Daniel - Vocalizer'},{voice:'Fiona',oldVoice:'Vocalizer Expressive Fiona Premium High 22kHz',description:'UK Scottish Fiona - Vocalizer'},{voice:'Paulina',oldVoice:'Vocalizer Expressive Paulina Premium High 22kHz',description:'Mexican Spanish Paulina - Vocalizer'},{voice:'Monica',oldVoice:'Vocalizer Expressive Monica Premium High 22kHz',description:'Spanish Monica - Vocalizer'},{voice:'Carlos',oldVoice:'Vocalizer Expressive Carlos Premium High 22kHz',description:'Colombian Spanish Carlos - Vocalizer'},{voice:'Miren',oldVoice:'Vocalizer Expressive Miren Premium High 22kHz',description:'Basque Miren - Vocalizer'},{voice:'Montserrat',oldVoice:'Vocalizer Expressive Montserrat Premium High 22kHz',description:'Catalan Montserrat - Vocalizer'},{voice:'Amelie',oldVoice:'Vocalizer Expressive Amelie Premium High 22kHz',description:'French Canadian Amelie - Vocalizer'},{voice:'Audrey',oldVoice:'Vocalizer Expressive Audrey Premium High 22kHz',description:'French Audrey - Vocalizer'},{voice:'Karen',oldVoice:'Vocalizer Expressive Karen Premium High 22kHz',description:'Australian Karen - Vocalizer'},{voice:'Lee',oldVoice:'Vocalizer Expressive Lee Premium High 22kHz',description:'Australian Lee - Vocalizer'},{voice:'Luciana?',oldVoice:'Vocalizer Expressive Luciana Premium High 22kHz',description:'Brazilian Luciana - Vocalizer'},{voice:'Claire',oldVoice:'Vocalizer Expressive Claire Premium High 22kHz',description:'Dutch Claire - Vocalizer'},{voice:'Ellen',oldVoice:'Vocalizer Expressive Ellen Premium High 22kHz',description:'Flemish Ellen - Vocalizer'},{voice:'Petra',oldVoice:'Vocalizer Expressive Petra Premium High 22kHz',description:'German Petra - Vocalizer'},{voice:'Alice',oldVoice:'Vocalizer Expressive Alice Premium High 22kHz',description:'Italian Alice - Vocalizer'},{voice:'Luciana',oldVoice:'Vocalizer Expressive Luciana Premium High 22kHz',description:'Portuguese Luciana - Vocalizer'},{voice:'Felipe',oldVoice:'Vocalizer Expressive Felipe Premium High 22kHz',description:'Portuguese Felipe - Vocalizer'},{voice:'Alva',oldVoice:'Vocalizer Expressive Alva Premium High 22kHz',description:'Swedish Alva - Vocalizer'},{voice:'Henrik',oldVoice:'Vocalizer Expressive Henrik Premium High 22kHz',description:'Norwegian Henrik - Vocalizer'},{voice:'Nora',oldVoice:'Vocalizer Expressive Nora Premium High 22kHz',description:'Norwegian Nora - Vocalizer'},{voice:'Satu',oldVoice:'Vocalizer Expressive Satu Premium High 22kHz',description:'Finnish Satu - Vocalizer'},{voice:'Damayanti',oldVoice:'Vocalizer Expressive Damayanti Premium High 22kHz',description:'Indonesian Damayanti - Vocalizer'},{voice:'Ewa',oldVoice:'Vocalizer Expressive Ewa Premium High 22kHz',description:'Polish Ewa - Vocalizer'},{voice:'Tarik',oldVoice:'Vocalizer Expressive Tarik Premium High 22kHz',description:'Arabic Tarik - Vocalizer'},{voice:'Tian-Tian',oldVoice:'Vocalizer Expressive Tian-tian Premium High 22kHz',description:'Mandarin Tian-tian - Vocalizer'},{voice:'Milena',oldVoice:'Vocalizer Expressive Milena Premium High 22kHz',description:'Russian Milena - Vocalizer'},{voice:'Yuri',oldVoice:'Vocalizer Expressive Yuri Premium High 22kHz',description:'Russian Yuri - Vocalizer'},{voice:'Gwyneth',oldVoice:'Welsh female voice',description:'Welsh female voice'},{voice:'Geraint',oldVoice:'Welsh English male voice',description:'Welsh English male voice'},{voice:'Veena',oldVoice:'Vocalizer Expressive Veena Premium High 22kHz',description:'Indian English Veena - Vocalizer'}],b=0;b<a.length;b++)this.m_voices[a[b].voice]=a[b].description;return this.m_voices}play(b){try{var d=null,e=b.speed,f=b.voice,g=b.words;void 0==d&&(d=!0),this.speechStop=!1,this.paused=!1,null===this.audioElem&&(this.audioElem=new Audio,this.audioElem.type='audio/mpeg'),this.currentHighlightWord=0;for(var i,c='https://'+this.speechServer+'/Generator/voice/'+f,j='',k=0;k<g.length;k++)i=g[k],j+=' '===i||''===i?' ':d?'<bookmark mark=\''+k+'\'/>'+this.encodeChars(g[k])+' ':this.encodeChars(g[k]);j+='<bookmark mark=\''+k+'\'/>';var a='text='+encodeURIComponent(j)+'&username='+encodeURIComponent(this.speechServerUser)+'&speed='+encodeURIComponent(e),h=this,l=new XMLHttpRequest;l.onreadystatechange=function(){var a=String.fromCharCode;if(4==this.readyState&&200==this.status){var c=l.getResponseHeader('TH-TIME'),d=this.response.slice(0,c),e=JSON.parse(a.apply(null,new Uint8Array(d))),f=new Blob([new Uint8Array(this.response.slice(c))]);h.onResponse(e,f,b)}else 4==this.readyState&&400==this.status&&(e=JSON.parse(a.apply(null,new Uint8Array(this.response))))},l.open('POST',c),l.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF8'),l.responseType='arraybuffer',l.send(a)}catch(a){console.log('SpeechSever - play: ',a)}}stop(){try{if(clearTimeout(this.timeout),null===this.audioElem||null===this.playbackTimeArray)return;this.speechStop=!0,this.paused=!1,this.playbackTimeArray.length=0;try{this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src=''}catch(a){}}catch(a){console.log('Request failed: SpeechServer - stop: ',a)}}pause(){try{if(null===this.audioElem)return;if(0===this.audioElem.currentTime)return;if(this.paused)return this.audioElem.play(),void(this.paused=!1);this.audioElem.pause(),this.paused=!0}catch(a){console.log('Request failed: SpeechServer - pause: ',a)}}onWordSpoken(){}audioPlaybackTimer(a){try{if(null===this.playbackTimeArray)return;if(this.audioElem.ended)return this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src='',this.length=0,void this.onStop(!0,a);if(0<this.playbackTimeArray.length){if(this.playbackTimeArray[this.currentHighlightWord]<this.audioElem.currentTime){var b={method:'onWord',type:'SP_M_1342_BK'};b.word=this.currentHighlightWord,b.tabid=a.tabid,b.request=a,b.origin=a.origin,this.eventBus.pub('onthAPIWord',b),this.currentHighlightWord++}if(this.audioElem.currentTime>this.playbackTimeArray[this.playbackTimeArray.length-1]){clearTimeout(this.timeout),this.onStop(!0,a);try{this.audioElem.pause()}catch(a){console.log('Error! '+a)}return}}this.timeout=setTimeout(()=>{this.audioPlaybackTimer(a)},50)}catch(a){console.log('Request failed: SpeechServer - audioPlaybackTimer: ',a)}}onResponse(a,b,c){this.playbackTimeArray=[];for(var d=0,e=0;e<a.bookmarks.length;e++)this.playbackTimeArray[d]=a.bookmarks[e].time/1e3,0<d&&this.playbackTimeArray[d]<=this.playbackTimeArray[d-1]&&(this.playbackTimeArray[d]=this.playbackTimeArray[d-1]+.01),d+=1;.1>this.playbackTimeArray[this.playbackTimeArray.length-1]&&(this.playbackTimeArray.length=0),this.speechStop||(this.timeout=window.setTimeout(()=>{this.audioPlaybackTimer(c)},50),this.audioElem.src=window.URL.createObjectURL(b),this.audioElem.play())}encodeChars(a){try{for(var b='',c='',d=0;d<a.length;d++)c=a.charCodeAt(d).toString(),b+=void 0===this.charMap[c]?a.charAt(d):this.charMap[c];return b}catch(a){console.log('Request failed: SpeechServer - encodeChars: ',a)}}onStop(){var a=0<arguments.length&&void 0!==arguments[0]&&arguments[0],b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c={method:'onStop',type:'SP_M_1342_BK'};void 0!==b.origin&&(c.origin=b.origin),c.request=b,c.word=-1,a||(c.word=-2),this.eventBus.pub('onthAPIWordonthAPIStop',c)}}class i{constructor(a,b,c){this.speechserver=b,this.user=a,this.language=c||{"en-AU":'Karen',en:'Ava',"en-GB":'Serena',"en-US":'Ava',fr:'Audrey',"fr-CA":'Amelie',pt:'Luciana',"pt-BR":'Luciana',"pt-PT":'Luciana',es:'Monica',"es-419":'Paulina',nl:'Claire'},this.config={locale:'en-US',charMap:{96:'\'',8212:' ',8217:'\'',8482:' '},sentences:{wordEnds:['[.?!]$'],sentenceEndExclusions:['Dr.','Mr.','Mrs.','i.e.','e.g.','St.','N.B.','NB.','Ltd.','plc.','U.S.','a.m.','p.m.','ext.','vs.','Jan.','Feb.','Mar.','Apr.','Jun.','Jul.','Aug.','Sep.','Oct.','Nov.','Dec.','N.E.','S.E.','S.W.','N.W.']}}}setVoiceForLanguage(a,b){this.language[a]=b}getVoiceForLanguage(a){return this.language[a]}getUser(){return this.user}getSpeechServer(){return this.speechserver}getVoiceListServer(){return this.voiceListServer}getConfiguration(){return this.config}}class j{constructor(){this.currentVoice='Ava',this.configuration=new i,this.userSettings={speechoptions:{voice:this.currentVoice,continousreading:!0,speed:50},language:{language:'en_US',services:'en_US'}}}get_Voice(){try{return this.currentVoice}catch(a){console.log('SpeechSettings - get_Voice: ',a)}}set_Voice(a){try{this.currentVoice=a,this.userSettings.speechoptions.voice=a}catch(a){console.log('SpeechSettings - set_Voice: ',a)}}set_Speed(a){try{this.userSettings.speechoptions.speed=a}catch(a){console.log('SpeechSettings - set_Speed: ',a)}}getVoices(){try{return''}catch(a){console.log('SpeechSettings - getVoices: ',a)}}getLocale(){try{var a='en-US';null==a&&(a='en-US');var b=this.configuration.getConfiguration();return void 0!==b[a]&&(b.locale=a),b.locale}catch(a){console.log('SpeechSettings - getLocale: ',a)}}getUserSettings(){return this.userSettings}}e.d(d,'default',function(){return a});class a{constructor(){this._speechEngines={},this._voices=[],this.m_voices=[],this._commms=null,this.eventBus=null,this._unsub=null,this.m_controller=null,this.m_voiceToEngineMap=[],this.configuration=null,this.voiceToEngineMap=[],this.speechSettings=new j}initialise(a){this.configuration=new i('rwforgdocs4','texthelpspeech.speechstream.net'),this._speechEngines.SpeechEngineServer=new h(this.speechSettings,this.configuration),this._speechEngines.SpeechEngineServer.initialise(a),this._speechEngines.SpeechEngineBrowser=new g(this.speechSettings,this.configuration),this._speechEngines.SpeechEngineBrowser.initialise(a),void 0!=a&&(this.eventBus=a,this._unsub=this.eventBus.sub(this._onPubSubEvent.bind(this)))}_onPubSubEvent(a,b){try{void 0!==this[a]&&this[a](b)}catch(a){console.log(a)}}play(a){if(escape(a.words.join(' ')).includes('%uDB40%uDC2E')){var b={method:'onForceStop',type:'SP_M_1342_BK'};return b.tabid=a.tabid,void 0!==a.origin&&(b.origin=a.origin),b.request=a,void this.eventBus.pub('onthAPIWordonthAPIStop',b)}var c=this.speechSettings.get_Voice();try{0==Object.keys(this._voices).length&&this.getVoices();var d=this.voiceToEngineMap[a.voice];if(void 0!==d)return a.voice!==c&&this.speechSettings.set_Voice(a.voice),void(d=this.voiceToEngineMap[a.voice]).play(a);d=this.voiceToEngineMap[c];var e=this.configuration.getVoiceForLanguage(g_lang);void 0==e&&(e=c),this.speechSettings.set_Voice(e),a.voice=e,d.play(a)}catch(a){console.log('SpeechManager - speakSelection: ',a)}}stop(a){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var b=this.voiceToEngineMap[this.speechSettings.get_Voice()];if(void 0===b){var c=this.speechSettings.getLocale(),d=this.configuration.getConfiguration();this.speechSettings.set_Voice(d[c].speechoptions.voice),b=this.voiceToEngineMap[this.speechSettings.get_Voice()]}null!==b&&b.stop(a)}catch(a){console.log('SpeechManager - stop: ',a)}}pause(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var a=this.voiceToEngineMap[this.speechSettings.get_Voice()];if(void 0===a){var b=this.speechSettings.getLocale(),c=this.configuration.getConfiguration();this.speechSettings.set_Voice(c[b].voice),a=this.voiceToEngineMap[this.speechSettings.get_Voice()]}null!==a&&a.pause()}catch(a){console.log('SpeechManager - pause: ',a)}}getVoices(a){for(var b in void 0==a&&(a=!1),a&&(this._voices=[],this.voiceToEngineMap=[],this._voicesArray=[]),this._speechEngines)if(this._speechEngines.hasOwnProperty(b)){var c=this._speechEngines[b].getVoices();for(var d in c)if(c.hasOwnProperty(d)){this._voices[d]=c[d];var e={voice:d,description:c[d]};this._voicesArray.push(e),this.voiceToEngineMap[d]=this._speechEngines[b]}}var f={method:'onVoicesResponse',type:'SP_M_1342_BK',request:{origin:'ca753d9d-f8c8-47dd-bd00-8033cd620939'}};return f.data={voicelist:this._voicesArray},this.eventBus.pub('SpeechManagerBG',f),this._voices}onWordSpoken(a){console.log('SpeechManager onWordSpoken:  '+a.toString())}}}])})},function(a,b){'use strict';Object.defineProperty(b,'__esModule',{value:!0});b.ChromeCommsBG=class{constructor(){this.eventBus=null}initialise(a){this;if(a!=void 0){this.eventBus=a;this.eventBus.sub(this._onPubSubEvent.bind(this))}chrome.runtime.onMessage.addListener((a,b)=>{'SP_M_1342_CK'!=a.type&&'SP_IFD_1342_CK'!=a.type||(a.tabid=b.tab.id,this.eventBus.pub(a.method,a))})}_onPubSubEvent(a,b){try{('th-SpeechManagerEvent-38697BG'==a||'onthAPIWord'||'onthAPIWordonthAPIStop'||'onthAPIWordonthAPIStart'||'onVoicesResponse'||'SP_IFD_1342_CK')&&(b.type='th-SpeechManagerEvent-38697BG',null==b.tabid?chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,b)}):chrome.tabs.sendMessage(b.tabid,b))}catch(a){console.log(a)}}onPlayResponse(){console.log('play response')}send(a,b){var c=a.request,d=c===void 0?null:c;null==d||chrome.runtime.sendMessage(a,b)}}}]);