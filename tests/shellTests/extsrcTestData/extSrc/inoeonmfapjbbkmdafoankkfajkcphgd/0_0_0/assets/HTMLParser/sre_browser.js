var COMPILED=!0,goog=goog||{};goog.global=this,goog.DEBUG=!0,goog.LOCALE='en',goog.TRUSTED_SITE=!0,goog.provide=function(e){goog.exportPath_(e)},goog.setTestOnly=function(e){if(!goog.DEBUG)throw e=e||'',Error('Importing test-only code into non-debug environment'+e?': '+e:'.')},COMPILED,goog.exportPath_=function(e,t,a){e=e.split('.'),a=a||goog.global,e[0]in a||!a.execScript||a.execScript('var '+e[0]);for(var n;e.length&&(n=e.shift());)!e.length&&goog.isDef(t)?a[n]=t:a=a[n]?a[n]:a[n]={}},goog.getObjectByName=function(t,a){for(var n,e=t.split('.'),i=a||goog.global;n=e.shift();)if(goog.isDefAndNotNull(i[n]))i=i[n];else return null;return i},goog.globalize=function(e,t){var a,n=t||goog.global;for(a in e)n[a]=e[a]},goog.addDependency=function(){},goog.ENABLE_DEBUG_LOADER=!0,goog.require=function(){},goog.basePath='',goog.global.CLOSURE_IMPORT_SCRIPT=null,goog.nullFunction=function(){},goog.identityFunction=function(e){return e},goog.abstractMethod=function(){throw Error('unimplemented abstract method')},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],!COMPILED,goog.typeOf=function(e){var t=typeof e;if('object'==t){if(e){if(e instanceof Array)return'array';if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if('[object Window]'==n)return'object';if('[object Array]'==n||'number'==typeof e.length&&'undefined'!=typeof e.splice&&'undefined'!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable('splice'))return'array';if('[object Function]'==n||'undefined'!=typeof e.call&&'undefined'!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable('call'))return'function'}else return'null';}else if('function'==t&&'undefined'==typeof e.call)return'object';return t},goog.isDef=function(e){return void 0!==e},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return'array'==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return'array'==t||'object'==t&&'number'==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&'function'==typeof e.getFullYear},goog.isString=function(e){return'string'==typeof e},goog.isBoolean=function(e){return'boolean'==typeof e},goog.isNumber=function(e){return'number'==typeof e},goog.isFunction=function(e){return'function'==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return'object'==t&&null!=e||'function'==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.removeUid=function(e){'removeAttribute'in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}},goog.UID_PROPERTY_='closure_uid_'+(1E9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if('object'==t||'array'==t){if(e.clone)return e.clone();var a,t='array'==t?[]:{};for(a in e)t[a]=goog.cloneObject(e[a]);return t}return e},goog.bindNative_=function(e){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(e,t){if(!e)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var a=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(a,n),e.apply(t,a)}}return function(){return e.apply(t,arguments)}},goog.bind=function(){return goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf('native code')?goog.bindNative_:goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var a=Array.prototype.slice.call(arguments);return a.unshift.apply(a,t),e.apply(this,a)}},goog.mixin=function(e,t){for(var a in t)e[a]=t[a]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,'JavaScript');else if(!goog.global.eval)throw Error('goog.globalEval not available');else if(null==goog.evalWorksForGlobals_&&(goog.global.eval('var _et_ = 1;'),'undefined'==typeof goog.global._et_?goog.evalWorksForGlobals_=!1:(delete goog.global._et_,goog.evalWorksForGlobals_=!0)),goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,a=t.createElement('script');a.type='text/javascript',a.defer=!1,a.appendChild(t.createTextNode(e)),t.body.appendChild(a),t.body.removeChild(a)}},goog.evalWorksForGlobals_=null,goog.getCssName=function(e,t){var n=function(e){return goog.cssNameMapping_[e]||e},a=function(e){e=e.split('-');for(var t=[],a=0;a<e.length;a++)t.push(n(e[a]));return t.join('-')},a=goog.cssNameMapping_?'BY_WHOLE'==goog.cssNameMappingStyle_?n:a:function(e){return e};return t?e+'-'+a(t):a(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},!COMPILED,goog.getMsg=function(t,a){var n,i=a||{};for(n in i){var l=(''+i[n]).replace(/\$/g,'$$$$');t=t.replace(new RegExp('\\{\\$'+n+'\\}','gi'),l)}return t},goog.getMsgWithFallback=function(e){return e},goog.exportSymbol=function(e,t,a){goog.exportPath_(e,t,a)},goog.exportProperty=function(e,t,a){e[t]=a},goog.inherits=function(e,t){function a(){}a.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new a,e.prototype.constructor=e},goog.base=function(t,a){var n=arguments.callee.caller;if(n.superClass_)return n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));for(var i=Array.prototype.slice.call(arguments,2),e=!1,l=t.constructor;l;l=l.superClass_&&l.superClass_.constructor)if(l.prototype[a]===n)e=!0;else if(e)return l.prototype[a].apply(t,i);if(t[a]===n)return t.constructor.prototype[a].apply(t,i);throw Error('goog.base called from a method of one name to a method of a different name')},goog.scope=function(e){e.call(goog.global)};var sre={SystemExternal:function(){}};sre.SystemExternal.locationSupported=function(){return'undefined'!=typeof location},sre.SystemExternal.getLocation=function(){var e='chrome-extension://inoeonmfapjbbkmdafoankkfajkcphgd/assets/HTMLParser';-1<e.indexOf('tokens.fileLocation')&&(e='//speechstreamtoolbar.speechstream.net/MathSpeak/latest');for(var t=document.getElementsByTagName('script'),a=0;a<t.length;a++)if(-1!=t[a].src.indexOf('sre_mathjax.js')){e=t[a].src.replace('/sre_mathjax.js','');break}return e},sre.SystemExternal.url=(sre.SystemExternal.locationSupported(),sre.SystemExternal.getLocation()),sre.SystemExternal.jsonPath=function(){return('undefined'!=typeof process&&'undefined'!=typeof global?process.env.SRE_JSON_PATH||global.SRE_JSON_PATH||process.cwd():sre.SystemExternal.url+'/mathmaps')+'/'}(),sre.SystemExternal.require=function(e){return'undefined'==typeof require?null:require(e)},sre.SystemExternal.documentSupported=function(){return'undefined'!=typeof document},sre.SystemExternal.xmldom=sre.SystemExternal.documentSupported()?window:sre.SystemExternal.require('xmldom'),sre.SystemExternal.document=sre.SystemExternal.documentSupported()?document:new sre.SystemExternal.xmldom.DOMImplementation().createDocument('','',0),sre.SystemExternal.xpath=sre.SystemExternal.documentSupported()?document:sre.SystemExternal.require('xpath'),sre.SystemExternal.commander=sre.SystemExternal.documentSupported()?null:sre.SystemExternal.require('commander'),sre.SystemExternal.fs=sre.SystemExternal.documentSupported()?null:sre.SystemExternal.require('fs'),sre.BrowserUtil={},sre.BrowserUtil.detectIE=function(){return'undefined'!=typeof window&&'ActiveXObject'in window&&'clipboardData'in window&&(sre.BrowserUtil.loadMapsForIE_(),sre.BrowserUtil.loadWGXpath_(),!0)},sre.BrowserUtil.detectEdge=function(){return'undefined'!=typeof window&&'MSGestureEvent'in window&&'chrome'in window&&null==window.chrome.loadTimes&&(document.evaluate=null,sre.BrowserUtil.loadWGXpath_(),!0)},sre.BrowserUtil.mapsForIE=null,sre.BrowserUtil.loadWGXpath_=function(){sre.BrowserUtil.loadScript(sre.SystemExternal.url+'/wgxpath.install.js'),sre.BrowserUtil.installWGXpath_()},sre.BrowserUtil.installWGXpath_=function(e){var t=e||1;'undefined'==typeof wgxpath&&10>t?setTimeout(function(){sre.BrowserUtil.installWGXpath_(t++)},200):10<=t||(wgxpath.install(),sre.XpathUtil.xpathEvaluate=document.evaluate,sre.XpathUtil.xpathResult=XPathResult,sre.XpathUtil.createNSResolver=document.createNSResolver)},sre.BrowserUtil.loadMapsForIE_=function(){sre.BrowserUtil.loadScript(sre.SystemExternal.jsonPath+'mathmaps_ie.js')},sre.BrowserUtil.loadScript=function(e){var t=sre.SystemExternal.document.createElement('script');t.type='text/javascript',t.src=e,sre.SystemExternal.document.head?sre.SystemExternal.document.head.appendChild(t):sre.SystemExternal.document.body.appendChild(t)},sre.Engine=function(){this.alternativeHost=this.activeHost=null,this.allDomains=[],this.allStyles=[],this.domain='default',this.style='short',this.semantics=!1,this.mode=sre.Engine.Mode.SYNC,this.speech=!1,this.setupTests_=[],this.withCache=!0,this.isIE=sre.BrowserUtil.detectIE(),this.isEdge=sre.BrowserUtil.detectEdge()},goog.addSingletonGetter(sre.Engine),sre.Engine.personalityProps={PITCH:'pitch',RATE:'rate',VOLUME:'volume',PAUSE:'pause'},sre.Engine.Mode={SYNC:'sync',ASYNC:'async',HTTP:'http'},sre.Engine.registerTest=function(e){sre.Engine.getInstance().setupTests_.push(e)},sre.Engine.isReady=function(){return sre.Engine.getInstance().setupTests_.every(function(e){return e()})},sre.SpeechRule=function(e,t,a,n){this.name=e,this.dynamicCstr=t,this.precondition=a,this.action=n},sre.SpeechRule.prototype.toString=function(){return this.name+' | '+sre.SpeechRule.stringifyCstr(this.dynamicCstr)+' | '+this.precondition.toString()+' ==> '+this.action.toString()},sre.SpeechRule.Type={NODE:'NODE',MULTI:'MULTI',TEXT:'TEXT',PERSONALITY:'PERSONALITY'},sre.SpeechRule.Type.fromString=function(e){switch(e){case'[n]':return sre.SpeechRule.Type.NODE;case'[m]':return sre.SpeechRule.Type.MULTI;case'[t]':return sre.SpeechRule.Type.TEXT;case'[p]':return sre.SpeechRule.Type.PERSONALITY;default:throw'Parse error: '+e;}},sre.SpeechRule.Type.toString=function(e){switch(e){case sre.SpeechRule.Type.NODE:return'[n]';case sre.SpeechRule.Type.MULTI:return'[m]';case sre.SpeechRule.Type.TEXT:return'[t]';case sre.SpeechRule.Type.PERSONALITY:return'[p]';default:throw'Unknown type error: '+e;}},sre.SpeechRule.Component=function(e){this.type=e.type,this.content=e.content},sre.SpeechRule.Component.fromString=function(e){var t={};if(t.type=sre.SpeechRule.Type.fromString(e.substring(0,3)),e=e.slice(3).trim(),!e)throw new sre.SpeechRule.OutputError('Missing content.');switch(t.type){case sre.SpeechRule.Type.TEXT:if('"'==e[0]){var n=sre.SpeechRule.splitString_(e,'\\(')[0].trim();if('"'!=n.slice(-1))throw new sre.SpeechRule.OutputError('Invalid string syntax.');t.content=n,e=e.slice(n.length).trim(),-1==e.indexOf('(')&&(e='');break}case sre.SpeechRule.Type.NODE:case sre.SpeechRule.Type.MULTI:if(n=e.indexOf(' ('),-1==n){t.content=e.trim(),e='';break}t.content=e.substring(0,n).trim(),e=e.slice(n).trim();}return t=new sre.SpeechRule.Component(t),e&&t.addAttributes(e),t},sre.SpeechRule.Component.prototype.toString=function(){var e;e=''+sre.SpeechRule.Type.toString(this.type),e+=this.content?' '+this.content:'';var t=this.getAttributes();return 0<t.length&&(e+=' ('+t.join(', ')+')'),e},sre.SpeechRule.Component.prototype.addAttribute=function(e){var t=e.indexOf(':');-1==t?this[e.trim()]='true':this[e.substring(0,t).trim()]=e.slice(t+1).trim()},sre.SpeechRule.Component.prototype.addAttributes=function(e){if('('!=e[0]||')'!=e.slice(-1))throw new sre.SpeechRule.OutputError('Invalid attribute expression: '+e);e=sre.SpeechRule.splitString_(e.slice(1,-1),',');for(var t=0;t<e.length;t++)this.addAttribute(e[t])},sre.SpeechRule.Component.prototype.getAttributes=function(){var e,t=[];for(e in this)'content'!=e&&'type'!=e&&'function'!=typeof this[e]&&t.push(e+':'+this[e]);return t},sre.SpeechRule.Action=function(e){this.components=e},sre.SpeechRule.Action.fromString=function(e){e=sre.SpeechRule.splitString_(e,';').filter(function(e){return e.match(/\S/)}).map(function(e){return e.trim()});for(var t,a=[],n=0;n<e.length;n++)t=sre.SpeechRule.Component.fromString(e[n]),t&&a.push(t);return new sre.SpeechRule.Action(a)},sre.SpeechRule.Action.prototype.toString=function(){return this.components.map(function(e){return e.toString()}).join('; ')},sre.SpeechRule.Precondition=function(e,t){this.query=e,this.constraints=t||[]},sre.SpeechRule.Precondition.prototype.toString=function(){var e=this.constraints.join(', ');return this.query+', '+e},sre.SpeechRule.splitString_=function(t,a){for(var n,e=[],i='';''!=t;)if(n=t.search(a),-1==n){if(0!=(t.match(/"/g)||[]).length%2)throw new sre.SpeechRule.OutputError('Invalid string in expression: '+t);e.push(i+t),t=i=''}else if(0==(t.substring(0,n).match(/"/g)||[]).length%2)e.push(i+t.substring(0,n)),i='',t=t.substring(n+1);else{var l=t.substring(n).search('"');if(-1==l)throw new sre.SpeechRule.OutputError('Invalid string in expression: '+t);i+=t.substring(0,n+l+1),t=t.substring(n+l+1)}return i&&e.push(i),e},sre.SpeechRule.DynamicCstrAttrib={STYLE:'style'},sre.SpeechRule.stringifyCstr=function(e){var t,a=[];for(t in e)a.push(e[t]);return a.join('.')},sre.SpeechRule.OutputError=function(e){Error.call(this),this.message=e||'',this.name='RuleError'},goog.inherits(sre.SpeechRule.OutputError,Error),sre.BaseUtil={},sre.BaseUtil.removeEmpty=function(e){return e.filter(function(e){return e})},sre.BaseUtil.interleaveLists=function(e,t){for(var a=[];e.length||t.length;)e.length&&a.push(e.shift()),t.length&&a.push(t.shift());return a},sre.SpeechRuleFunctions=function(){},sre.SpeechRuleFunctions.Store_=function(e,t){this.prefix_=e,this.store_=t},sre.SpeechRuleFunctions.Store_.prototype.add=function(e,t){this.checkCustomFunctionSyntax_(e)&&(this.store_[e]=t)},sre.SpeechRuleFunctions.Store_.prototype.lookup=function(e){return this.store_[e]},sre.SpeechRuleFunctions.CustomQueries=function(){sre.SpeechRuleFunctions.Store_.call(this,'CQF',{})},goog.inherits(sre.SpeechRuleFunctions.CustomQueries,sre.SpeechRuleFunctions.Store_),sre.SpeechRuleFunctions.CustomStrings=function(){sre.SpeechRuleFunctions.Store_.call(this,'CSF',{})},goog.inherits(sre.SpeechRuleFunctions.CustomStrings,sre.SpeechRuleFunctions.Store_),sre.SpeechRuleFunctions.ContextFunctions=function(){sre.SpeechRuleFunctions.Store_.call(this,'CTXF',{})},goog.inherits(sre.SpeechRuleFunctions.ContextFunctions,sre.SpeechRuleFunctions.Store_),sre.SpeechRuleFunctions.Store_.prototype.checkCustomFunctionSyntax_=function(e){return!!e.match(new RegExp('^'+this.prefix_))||(console.log('FunctionError: Invalid function name. Expected prefix '+this.prefix_),!1)},sre.XpathUtil={},sre.XpathUtil.xpathSupported=function(){return'undefined'!=typeof XPathResult},sre.XpathUtil.currentDocument=null,sre.XpathUtil.xpathEvaluate=sre.XpathUtil.xpathSupported()?document.evaluate:sre.SystemExternal.xpath.evaluate,sre.XpathUtil.xpathResult=sre.XpathUtil.xpathSupported()?XPathResult:sre.SystemExternal.xpath.XPathResult,sre.XpathUtil.createNSResolver=sre.XpathUtil.xpathSupported()?document.createNSResolver:sre.SystemExternal.xpath.createNSResolver,sre.XpathUtil.nameSpaces_={xhtml:'http://www.w3.org/1999/xhtml',mathml:'http://www.w3.org/1998/Math/MathML',svg:'http://www.w3.org/2000/svg'},sre.XpathUtil.resolveNameSpace=function(e){return sre.XpathUtil.nameSpaces_[e]||null},sre.XpathUtil.evaluateXpath_=function(e,t,a){var n=sre.Engine.getInstance();return n.mode!==sre.Engine.Mode.HTTP||n.isIE||n.isEdge?sre.XpathUtil.xpathEvaluate(e,t,sre.XpathUtil.createNSResolver(t),a,null):sre.XpathUtil.currentDocument.evaluate(e,t,sre.XpathUtil.resolveNameSpace,a,null)},sre.XpathUtil.evalXPath=function(t,a){try{var n=sre.XpathUtil.evaluateXpath_(t,a,sre.XpathUtil.xpathResult.ORDERED_NODE_ITERATOR_TYPE)}catch(e){return[]}for(var i=[],l=n.iterateNext();l;l=n.iterateNext())i.push(l);return i},sre.XpathUtil.getLeafNodes=function(e){return sre.XpathUtil.evalXPath('.//*[count(*)=0]',e)},sre.XpathUtil.evaluateBoolean=function(e,t){try{var a=sre.XpathUtil.evaluateXpath_(e,t,sre.XpathUtil.xpathResult.BOOLEAN_TYPE)}catch(e){return!1}return a.booleanValue},sre.XpathUtil.evaluateString=function(e,t){try{var a=sre.XpathUtil.evaluateXpath_(e,t,sre.XpathUtil.xpathResult.STRING_TYPE)}catch(e){return''}return a.stringValue},sre.XpathUtil.prefixes_=function(){var e={};return Object.keys(sre.XpathUtil.nameSpaces_).map(function(t){e[sre.XpathUtil.nameSpaces_[t]]=t}),e}(),sre.XpathUtil.defaultNamespace_=function(e){if(e&&1===e.nodeType){!e.prefix&&e.namespaceURI&&(e.prefix=sre.XpathUtil.prefixes_[e.namespaceURI],e.nodeName=e.prefix+':'+e.nodeName),e=e.childNodes;for(var t,a=0;t=e[a];a++)sre.XpathUtil.defaultNamespace_(t)}},sre.XpathUtil.prefixNamespace=function(t){if(t&&t._nsMap){for(var a,n=t.attributes,i=0;a=n[i];i++)if('xmlns'==a.name&&!a.prefix){var l=sre.XpathUtil.prefixes_[t.namespaceURI];l&&(a.prefix=a.name,a.localName=l,a.nodeName=a.nodeName+':'+l)}t.namespaceURI&&(t._nsMap[l]=t.namespaceURI,delete t._nsMap[''],sre.XpathUtil.defaultNamespace_(t))}},sre.DomUtil={},sre.DomUtil.toArray=function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a]);return t},sre.DomUtil.trimInput_=function(e){return e=e.replace(/&nbsp;/g,' '),e.replace(/>\s+</g,'><').trim()},sre.DomUtil.parseInput=function(t,a){var n=a||Error,i=new sre.SystemExternal.xmldom.DOMParser,l=sre.DomUtil.trimInput_(t);if(!l)throw new n('Empty input!');try{var r=i.parseFromString(l,'text/xml');if(sre.Engine.getInstance().mode===sre.Engine.Mode.HTTP)return sre.XpathUtil.currentDocument=r,r.documentElement;var s=r.documentElement;return sre.XpathUtil.prefixNamespace(s),s}catch(e){throw new n('Illegal input: '+e.message)}},sre.DomUtil.NodeType={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},sre.DomUtil.replaceNode=function(e,t){e.parentNode&&(e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e))},sre.Debugger=function(){this.isActive_=!1,this.outputFunction_=console.log,this.stream_=null},goog.addSingletonGetter(sre.Debugger),sre.Debugger.prototype.init=function(e){e&&this.startDebugFile_(e),this.isActive_=!0},sre.Debugger.prototype.startDebugFile_=function(e){this.stream_=sre.SystemExternal.fs.createWriteStream(e),this.outputFunction_=goog.bind(function(){var e=Array.prototype.slice.call(arguments,0);this.stream_.write(e.join(' ')),this.stream_.write('\n')},this),this.stream_.on('error',goog.bind(function(){console.log('Invalid log file. Debug information sent to console.'),this.outputFunction_=console.log},this)),this.stream_.on('finish',function(){console.log('Finalizing debug file.')})},sre.Debugger.prototype.output_=function(e){this.outputFunction_.apply(console.log===this.outputFunction_?console:this.outputFunction_,['Speech Rule Engine Debugger:'].concat(e))},sre.Debugger.prototype.output=function(){this.isActive_&&this.output_(Array.prototype.slice.call(arguments,0))},sre.Debugger.prototype.generateOutput=function(e){this.isActive_&&this.output_(e.apply(e,[]))},sre.Debugger.prototype.exit=function(e){this.isActive_&&this.stream_&&this.stream_.end('','',e||function(){}),this.isActive_=!1},sre.MathUtil={},sre.MathUtil.isMathmlNodeOfClass_=function(e,t){return-1!=t.indexOf(e.tagName.toUpperCase())},sre.MathUtil.isMathjaxNodeOfClass_=function(e,t){return!('SPAN'!=e.tagName)&&e.className.split(' ').some(function(e){return-1!=t.indexOf(e.toUpperCase())})},sre.MathUtil.isMathNodeOfClass_=function(e,t){return e.nodeType==sre.DomUtil.NodeType.ELEMENT_NODE&&(sre.MathUtil.isMathmlNodeOfClass_(e,t)||sre.MathUtil.isMathjaxNodeOfClass_(e,t))},sre.MathUtil.TOKEN_LIST=['MI','MN','MO','MTEXT','MSPACE','MS'],sre.MathUtil.isToken=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.TOKEN_LIST)},sre.MathUtil.LAYOUT_LIST=['MROW','MFRAC','MSQRT','MROOT','MSTYLE','MERROR','MPADDED','MPHANTOM','MFENCED','MENCLOSE'],sre.MathUtil.isLayout=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.LAYOUT_LIST)},sre.MathUtil.SCRIPT_LIST=['MSUB','MSUP','MSUBSUP','MUNDER','MOVER','MUNDEROVER','MMULTISCRIPTS','MPRESCRIPTS'],sre.MathUtil.isScript=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.SCRIPT_LIST)},sre.MathUtil.TABLES_LIST=['MTABLE','MLABELEDTR','MTR','MTD','MALIGNGROUP','MALIGNMARK'],sre.MathUtil.isTables=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.TABLES_LIST)},sre.MathUtil.ELEMENTARY_LIST=['MSTACK','MLONGDIV','MSGROUP','MSROW','MSCARRIES','MSCARRY','MSLINE'],sre.MathUtil.isElementary=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.ELEMENTARY_LIST)},sre.MathUtil.MATHML_TAG_LIST=[sre.MathUtil.TOKEN_LIST,sre.MathUtil.LAYOUT_LIST,sre.MathUtil.SCRIPT_LIST,sre.MathUtil.TABLES_LIST,sre.MathUtil.ELEMENTARY_LIST].reduce(function(e,t){return e.concat(t)}),sre.MathUtil.isMathmlTag=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.MATHML_TAG_LIST)},sre.MathUtil.WHITESPACE_LIST=['MSROW','MROW','MSPACE','MPHANTOM','MPADDED'],sre.MathUtil.isWhitespace=function(e){return sre.MathUtil.isMathNodeOfClass_(e,sre.MathUtil.WHITESPACE_LIST)},sre.MathUtil.isNotWhitespace=function(e){return sre.MathUtil.isMathmlTag(e)&&!sre.MathUtil.isWhitespace(e)},sre.MathUtil.setdifference=function(e,t){return e.filter(function(e){return 0>t.indexOf(e)})},sre.MathUtil.union=function(e,t){return e.concat(sre.MathUtil.setdifference(t,e))},sre.MathUtil.nextSeparatorFunction=function(e){if(e){if(e.match(/^\s+$/))return null;var t=e.replace(/\s/g,'').split('').filter(function(e){return e})}else t=[','];return function(){return 1<t.length?t.shift():t[0]}},sre.BaseRuleStore=function(){this.customQueries=new sre.SpeechRuleFunctions.CustomQueries,this.customStrings=new sre.SpeechRuleFunctions.CustomStrings,this.contextFunctions=new sre.SpeechRuleFunctions.ContextFunctions,this.speechRules_=[],this.dynamicCstrAttribs=[sre.SpeechRule.DynamicCstrAttrib.STYLE],this.defaultTtsProps=[]},sre.BaseRuleStore.prototype.lookupRule=function(e,t){if(!e||e.nodeType!=sre.DomUtil.NodeType.ELEMENT_NODE&&e.nodeType!=sre.DomUtil.NodeType.TEXT_NODE)return null;var n=this.speechRules_.filter(goog.bind(function(a){return this.testDynamicConstraints(t,a)&&this.testPrecondition_(e,a)},this));return 0<n.length?this.pickMostConstraint_(t,n):null},sre.BaseRuleStore.prototype.defineRule=function(e,t,a,n){try{var i=sre.SpeechRule.Action.fromString(a),l=Array.prototype.slice.call(arguments,4),r=new sre.SpeechRule.Precondition(n,l),l={};l[sre.SpeechRule.DynamicCstrAttrib.STYLE]=t;var s=new sre.SpeechRule(e,l,r,i)}catch(e){if('RuleError'==e.name)return console.log('Rule Error ',n,'('+t+'):',e.message),null;throw e}return this.addRule(s),s},sre.BaseRuleStore.prototype.addRule=function(e){this.speechRules_.unshift(e)},sre.BaseRuleStore.prototype.deleteRule=function(e){e=this.speechRules_.indexOf(e),-1!=e&&this.speechRules_.splice(e,1)},sre.BaseRuleStore.prototype.findRule=function(e){for(var t,a=0;t=this.speechRules_[a];a++)if(e(t))return t;return null},sre.BaseRuleStore.prototype.findAllRules=function(e){return this.speechRules_.filter(e)},sre.BaseRuleStore.prototype.evaluateDefault=function(e){return[new sre.AuditoryDescription({text:e.textContent})]},sre.BaseRuleStore.prototype.debugSpeechRule=function(e,t){var a=e.precondition,n=this.applyQuery(t,a.query);sre.Debugger.getInstance().output(a.query,n?n.toString():n),a.constraints.forEach(goog.bind(function(e){sre.Debugger.getInstance().output(e,this.applyConstraint(t,e))},this))},sre.BaseRuleStore.prototype.removeDuplicates=function(e){for(var t,a=this.speechRules_.length-1;t=this.speechRules_[a];a--)t!=e&&sre.BaseRuleStore.compareDynamicConstraints_(t.dynamicCstr,e.dynamicCstr)&&sre.BaseRuleStore.comparePreconditions_(t,e)&&this.speechRules_.splice(a,1)},sre.BaseRuleStore.prototype.applyCustomQuery=function(e,t){var a=this.customQueries.lookup(t);return a?a(e):null},sre.BaseRuleStore.prototype.applySelector=function(e,t){return this.applyCustomQuery(e,t)||sre.XpathUtil.evalXPath(t,e)},sre.BaseRuleStore.prototype.applyQuery=function(e,t){var a=this.applySelector(e,t);return 0<a.length?a[0]:null},sre.BaseRuleStore.prototype.applyConstraint=function(e,t){return!!this.applyQuery(e,t)||sre.XpathUtil.evaluateBoolean(t,e)},sre.BaseRuleStore.prototype.testDynamicConstraints=function(e,t){return Object.keys(e).every(function(a){return e[a]==t.dynamicCstr[a]||'short'==t.dynamicCstr[a]||'default'==t.dynamicCstr[a]})},sre.BaseRuleStore.prototype.getDynamicConstraintValues=function(){for(var t,n={},a=0;t=this.speechRules_[a];a++)for(var i in t.dynamicCstr){var l=[t.dynamicCstr[i]];n[i]=n[i]?sre.MathUtil.union(n[i],l):l}return n},sre.BaseRuleStore.prototype.countMatchingDynamicConstraintValues_=function(t,a){for(var n,e=0,i=0;(n=this.dynamicCstrAttribs[i])&&t[n]===a.dynamicCstr[n];i++)e++;return e},sre.BaseRuleStore.prototype.pickMostConstraint_=function(t,e){return e.sort(goog.bind(function(a,n){var i=this.countMatchingDynamicConstraintValues_(t,a),e=this.countMatchingDynamicConstraintValues_(t,n);return i>e?-1:e>i?1:n.precondition.constraints.length-a.precondition.constraints.length},this)),sre.Debugger.getInstance().generateOutput(goog.bind(function(){return e.map(function(e){return e.name+'('+sre.SpeechRule.stringifyCstr(e.dynamicCstr)+')'})},this)),e[0]},sre.BaseRuleStore.prototype.testPrecondition_=function(e,t){var a=t.precondition;return this.applyQuery(e,a.query)===e&&a.constraints.every(goog.bind(function(t){return this.applyConstraint(e,t)},this))},sre.BaseRuleStore.compareDynamicConstraints_=function(e,t){if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var a in e)if(!t[a]||e[a]!==t[a])return!1;return!0},sre.BaseRuleStore.compareStaticConstraints_=function(e,t){if(e.length!=t.length)return!1;for(var a,n=0;a=e[n];n++)if(-1==t.indexOf(a))return!1;return!0},sre.BaseRuleStore.comparePreconditions_=function(e,t){var a=e.precondition,n=t.precondition;return!(a.query!=n.query)&&sre.BaseRuleStore.compareStaticConstraints_(a.constraints,n.constraints)},sre.MathStore=function(){sre.BaseRuleStore.call(this),this.dynamicCstrAttribs=[sre.SpeechRule.DynamicCstrAttrib.DOMAIN,sre.SpeechRule.DynamicCstrAttrib.STYLE],this.defaultTtsProps=[sre.Engine.personalityProps.PITCH,sre.Engine.personalityProps.RATE]},goog.inherits(sre.MathStore,sre.BaseRuleStore),sre.SpeechRule.DynamicCstrAttrib.DOMAIN='domain',sre.MathStore.prototype.defineRule=function(e,t,a,n){var i=this.parseDynamicConstraint(t),l=Array.prototype.slice.call(arguments,4),l=sre.MathStore.superClass_.defineRule.apply(this,[e,i[sre.SpeechRule.DynamicCstrAttrib.STYLE],a,n].concat(l));return l.dynamicCstr=i,this.removeDuplicates(l),l},sre.MathStore.prototype.parseDynamicConstraint=function(e){var t=e.split('.');if(!t[0]||!t[1])throw new sre.SpeechRule.OutputError('Invalid domain assignment:'+e);return sre.MathStore.createDynamicConstraint(t[0],t[1])},sre.MathStore.createDynamicConstraint=function(e,t){var a={};return a[sre.SpeechRule.DynamicCstrAttrib.DOMAIN]=e,a[sre.SpeechRule.DynamicCstrAttrib.STYLE]=t,a},sre.MathStore.prototype.defineUniqueRuleAlias=function(t,a,n){var i=this.parseDynamicConstraint(a),e=this.findRule(goog.bind(function(e){return e.name==t&&this.testDynamicConstraints(i,e)},this));if(!e)throw new sre.SpeechRule.OutputError('Rule named '+t+' with style '+a+' does not exist.');this.addAlias_(e,n,Array.prototype.slice.call(arguments,3))},sre.MathStore.prototype.defineRuleAlias=function(e,t){var a=this.findRule(function(t){return t.name==e});if(!a)throw new sre.SpeechRule.OutputError('Rule with named '+e+' does not exist.');this.addAlias_(a,t,Array.prototype.slice.call(arguments,2))},sre.MathStore.prototype.defineRulesAlias=function(t,n){var a=this.findAllRules(function(e){return e.name==t});if(0==a.length)throw new sre.SpeechRule.OutputError('Rule with name '+t+' does not exist.');var i=Array.prototype.slice.call(arguments,2);a.forEach(goog.bind(function(e){this.addAlias_(e,n,i)},this))},sre.MathStore.prototype.addAlias_=function(e,t,a){t=new sre.SpeechRule.Precondition(t,a),t=new sre.SpeechRule(e.name,e.dynamicCstr,t,e.action),t.name=e.name,this.addRule(t)},sre.MathStore.prototype.defineSpecialisedRule=function(t,a,n,i){var l=this.parseDynamicConstraint(a),e=this.findRule(goog.bind(function(e){return e.name==t&&this.testDynamicConstraints(l,e)},this));if(!e)throw new sre.SpeechRule.OutputError('Rule named '+t+' with style '+a+' does not exist.');a=this.parseDynamicConstraint(n),i=i?sre.SpeechRule.Action.fromString(i):e.action,e=new sre.SpeechRule(e.name,a,e.precondition,i),this.addRule(e)},sre.MathStore.prototype.evaluateDefault=function(e){return this.evaluateString_(e.textContent,e)},sre.MathStore.prototype.evaluateString_=function(t,a){var n=[],i={},r={value:0};if(t.match(/^\s+$/))return n;for(var e,s=sre.BaseUtil.removeEmpty(t.replace(/\s/g,' ').split(' ')),o=0;e=s[o];o++)if(1==e.length)n.push(this.evaluate_(e,this.getBookmark(e,a,0,r)));else if(e.match(/^[a-zA-Z]+$/)){var c=this.multipleCharaters(i,e,r);n.push(this.evaluate_(e,this.getBookmark(e,a,c,r)))}else for(;e;){var p=e.match(/^((\d{1,3})(?=,)(,\d{3})*(\.\d+)?)|^\d*\.\d+|^\d+/),l=e.match(/^[a-zA-Z]+/);p?(c=this.multipleCharaters(i,p[0],r),n.push(this.evaluate_(p[0],this.getBookmark(p[0],a,c,r))),e=e.substring(p[0].length)):l?(c=this.multipleCharaters(i,l[0],r),n.push(this.evaluate_(l[0],this.getBookmark(l[0],a,c,r))),e=e.substring(l[0].length)):(c=e[0].charCodeAt(0),55296<=c&&56319>=c&&1<e.length&&!isNaN(e.charCodeAt(1))?(c=this.multipleCharaters(i,e.slice(0,2),r),n.push(this.evaluate_(e.slice(0,2),this.getBookmark(e.slice(0,2),a,c,r))),e=e.substring(2)):(c=this.multipleCharaters(i,e[0],r),n.push(this.evaluate_(e[0],this.getBookmark(e[0],a,c,r))),e=e.substring(1)))}return n},sre.MathStore.prototype.multipleCharaters=function(e,t,a){return'undefined'==typeof e[t]?e[t]=0:e[t]++,a.value=0,e[t]},sre.MathStore.prototype.getBookmark=function(t,a,n,i){var l=0;if('undefined'!=typeof a.childNodes&&null!=a.childNodes&&'undefined'!=typeof a.childNodes.length&&null!=a.childNodes.length){for(var e=0;e<a.childNodes.length;e++)if(0==a.childNodes.length){if(-1<a.textContent.indexOf(t)){if(n==i.value)return a.parentNode.getAttribute('bookmark');i.value++}}else if(l=this.getBookmark(t,a.childNodes[e],n,i),0!=l)break;if(0==a.childNodes.length&&-1<a.textContent.indexOf(t)){if(n==i.value)return a.parentNode.getAttribute('bookmark');i.value++}}return l},sre.MathStore.prototype.evaluate_=function(e,t){return new sre.AuditoryDescription({text:e,preprocess:!0,correction:sre.SpeechRuleEngine.getInstance().getGlobalParameter('remove')||'',bookmark:t||'0'})},sre.StoreUtil={},sre.StoreUtil.nodeCounter=function(t,a){var n=t.length,i=0,l=a;return a||(l=''),function(){return i<n&&(i+=1),l+' '+i}},sre.MathmlStore=function(){sre.MathStore.call(this)},goog.inherits(sre.MathmlStore,sre.MathStore),goog.addSingletonGetter(sre.MathmlStore),sre.MathmlStore.prototype.defineMathmlRule=function(e,t,a){this.defineRule(e,t,a,'self::mathml:'+e)},sre.MathmlStore.prototype.defineDefaultMathmlRule=function(e,t){this.defineRule(e,'default.default',t,'self::mathml:'+e)},sre.MathmlStoreUtil={},sre.MathmlStoreUtil.matchMathjaxToMathml=function(e){return sre.Engine.getInstance().alternativeHost.querySelector('#'+e.id)},sre.MathmlStoreUtil.retrieveMathjaxExtender=function(e){return(e=sre.MathmlStoreUtil.matchMathjaxToMathml(e))?[e]:[]},sre.MathmlStoreUtil.retrieveMathjaxLeaf=function(e){return(e=sre.MathmlStoreUtil.matchMathjaxToMathml(e))?[e]:[]},sre.MathmlStoreUtil.checkMathjaxTag=function(e,t){var a=sre.MathmlStoreUtil.matchMathjaxToMathml(e);return a&&a.tagName.toUpperCase()==t?[a]:[]},sre.MathmlStoreUtil.checkMathjaxMunder=function(e){return sre.MathmlStoreUtil.checkMathjaxTag(e,'MUNDER')},sre.MathmlStoreUtil.checkMathjaxMover=function(e){return sre.MathmlStoreUtil.checkMathjaxTag(e,'MOVER')},sre.MathmlStoreUtil.checkMathjaxMsub=function(e){return sre.MathmlStoreUtil.checkMathjaxTag(e,'MSUB')},sre.MathmlStoreUtil.checkMathjaxMsup=function(e){return sre.MathmlStoreUtil.checkMathjaxTag(e,'MSUP')},sre.MathmlStoreUtil.mfencedSeparators=function(e,t){var a=sre.MathUtil.nextSeparatorFunction(t);return function(){return a?[new sre.AuditoryDescription({text:a(),preprocess:!0})]:[]}},sre.MathmlStoreUtil.contentIterator=function(e,t){var n=0<e.length?sre.XpathUtil.evalXPath('../../content/*',e[0]):[];return function(){var i=n.shift(),a=t?[new sre.AuditoryDescription({text:t,preprocess:!0})]:[];return i?(i=sre.SpeechRuleEngine.getInstance().evaluateNode(i),a.concat(i)):a}},sre.MathmlStoreUtil.hideFont=function(e){if(e.hasAttribute('font')){var t=e.getAttribute('font');e.removeAttribute('font'),sre.SpeechRuleEngine.getInstance().setGlobalParameter('remove',t),e.setAttribute('hiddenfont',t)}return[e]},sre.MathmlStoreUtil.showFont=function(e){if(e.hasAttribute('hiddenfont')){var t=e.getAttribute('hiddenfont');e.removeAttribute('hiddenfont'),sre.SpeechRuleEngine.getInstance().setGlobalParameter('remove',''),e.setAttribute('font',t)}return''},sre.MathmlStoreRules=function(){sre.MathmlStoreRules.initCustomFunctions_(),sre.MathmlStoreRules.initDefaultRules_(),sre.MathmlStoreRules.initMathjaxRules_(),sre.MathmlStoreRules.initAliases_(),sre.MathmlStoreRules.initSpecializationRules_()},goog.addSingletonGetter(sre.MathmlStoreRules),sre.MathmlStoreRules.mathStore=sre.MathmlStore.getInstance(),sre.MathmlStoreRules.defineDefaultMathmlRule_=goog.bind(sre.MathmlStoreRules.mathStore.defineDefaultMathmlRule,sre.MathmlStoreRules.mathStore),sre.MathmlStoreRules.defineRule_=goog.bind(sre.MathmlStoreRules.mathStore.defineRule,sre.MathmlStoreRules.mathStore),sre.MathmlStoreRules.defineRuleAlias_=goog.bind(sre.MathmlStoreRules.mathStore.defineRuleAlias,sre.MathmlStoreRules.mathStore),sre.MathmlStoreRules.addContextFunction_=goog.bind(sre.MathmlStoreRules.mathStore.contextFunctions.add,sre.MathmlStoreRules.mathStore.contextFunctions),sre.MathmlStoreRules.addCustomQuery_=goog.bind(sre.MathmlStoreRules.mathStore.customQueries.add,sre.MathmlStoreRules.mathStore.customQueries),sre.MathmlStoreRules.initCustomFunctions_=function(){(0,sre.MathmlStoreRules.addContextFunction_)('CTXFnodeCounter',sre.StoreUtil.nodeCounter),(0,sre.MathmlStoreRules.addContextFunction_)('CTXFmfSeparators',sre.MathmlStoreUtil.mfencedSeparators),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFextender',sre.MathmlStoreUtil.retrieveMathjaxExtender),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFmathmlmunder',sre.MathmlStoreUtil.checkMathjaxMunder),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFmathmlmover',sre.MathmlStoreUtil.checkMathjaxMover),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFmathmlmsub',sre.MathmlStoreUtil.checkMathjaxMsub),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFmathmlmsup',sre.MathmlStoreUtil.checkMathjaxMsup),(0,sre.MathmlStoreRules.addCustomQuery_)('CQFlookupleaf',sre.MathmlStoreUtil.retrieveMathjaxLeaf)},sre.MathmlStoreRules.initDefaultRules_=function(){(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('math','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('semantics','[n] ./*[1]'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mspace','[p] (pause:250)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mstyle','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mpadded','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('merror','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mphantom','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mtext','[t] text(); [p] (pause:200)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mi','[n] text()'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mo','[n] text() (rate:-0.1)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mn','[n] text()'),(0,sre.MathmlStoreRules.defineRule_)('mtext-variant','default.default','[t] "begin"; [t] @mathvariant (pause:150);[t] text() (pause:150); [t] "end"; [t] @mathvariant (pause:200)','self::mathml:mtext','@mathvariant','@mathvariant!="normal"'),(0,sre.MathmlStoreRules.defineRule_)('mi-variant','default.default','[t] @mathvariant; [n] text()','self::mathml:mi','@mathvariant','@mathvariant!="normal"'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mi-variant','self::mathml:mn','@mathvariant','@mathvariant!="normal"'),(0,sre.MathmlStoreRules.defineRule_)('mo-variant','default.default','[t] @mathvariant; [n] text() (rate:-0.1)','self::mathml:mo','@mathvariant','@mathvariant!="normal"'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('ms','[t] "string" (pitch:0.5, rate:0.5); [t] text()'),(0,sre.MathmlStoreRules.defineRule_)('unit','default.default','[t] text() (annotation:unit, preprocess)','self::mathml:mi','@class="MathML-Unit"'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('msup','[n] ./*[1]; [t] "super";[n] ./*[2] (pitch:0.35); [p] (pause:300)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('msubsup','[n] ./*[1]; [t] "sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:200);[t] "super"; [n] ./*[3] (pitch:0.35); [p] (pause:300)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('msub','[n] ./*[1]; [t] "sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:300)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mover','[n] ./*[2] (pitch:0.35); [p] (pause:200); [t] "over"; [n] ./*[1]; [p] (pause:400)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('munder','[n] ./*[2] (pitch:-0.35); [t] "under"; [n] ./*[1]; [p] (pause:400)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('munderover','[n] ./*[2] (pitch:-0.35); [t] "under and"; [n] ./*[3] (pitch:0.35); [t] "over"; [n] ./*[1]; [p] (pause:400)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mrow','[m] ./*'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('msqrt','[t] "Square root of"; [m] ./* (rate:0.2); [p] (pause:400)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mroot','[t] "root of order"; [n] ./*[2]; [t] "of";[n] ./*[1] (rate:0.2); [p] (pause:400)'),(0,sre.MathmlStoreRules.defineDefaultMathmlRule_)('mfrac',' [p] (pause:400); [n] ./*[1] (pitch:0.3); [t] "divided by"; [n] ./*[2] (pitch:-0.3); [p] (pause:400)'),(0,sre.MathmlStoreRules.defineRule_)('mfrac','default.short','[p] (pause:200); [t] "start fraction";[n] ./*[1] (pitch:0.3); [t] "over"; [n] ./*[2] (pitch:-0.3); [p] (pause:400); [t] "end fraction"','self::mathml:mfrac'),(0,sre.MathmlStoreRules.defineRule_)('mfenced-single','default.default','[t] concat(substring(@open, 0 div boolean(@open)), substring("(", 0 div not(boolean(@open)))) (context:"opening"); [m] ./* (separator:@separators); [t] concat(substring(@close, 0 div boolean(@close)), substring(")", 0 div not(boolean(@close)))) (context:"closing")','self::mathml:mfenced','string-length(string(@separators))=1'),(0,sre.MathmlStoreRules.defineRule_)('mfenced-omit','default.default','[t] concat(substring(@open, 0 div boolean(@open)), substring("(", 0 div not(boolean(@open)))) (context:"opening"); [m] ./*; [t] concat(substring(@close, 0 div boolean(@close)), substring(")", 0 div not(boolean(@close)))) (context:"closing")','self::mathml:mfenced','@separators','string-length(string(@separators))=0','string(@separators)=""'),(0,sre.MathmlStoreRules.defineRule_)('mfenced-empty','default.default','[t] concat(substring(@open, 0 div boolean(@open)), substring("(", 0 div not(boolean(@open)))) (context:"opening"); [m] ./*;[t] concat(substring(@close, 0 div boolean(@close)), substring(")", 0 div not(boolean(@close)))) (context:"closing")','self::mathml:mfenced','string-length(string(@separators))=1','string(@separators)=" "'),(0,sre.MathmlStoreRules.defineRule_)('mfenced-comma','default.default','[t] concat(substring(@open, 0 div boolean(@open)), substring("(", 0 div not(boolean(@open)))) (context:"opening"); [m] ./* (separator:"comma");[t] concat(substring(@close, 0 div boolean(@close)), substring(")", 0 div not(boolean(@close)))) (context:"closing")','self::mathml:mfenced'),(0,sre.MathmlStoreRules.defineRule_)('mfenced-multi','default.default','[t] concat(substring(@open, 0 div boolean(@open)), substring("(", 0 div not(boolean(@open)))) (context:"opening"); [m] ./* (sepFunc:CTXFmfSeparators, separator:@separators); [t] concat(substring(@close, 0 div boolean(@close)), substring(")", 0 div not(boolean(@close)))) (context:"closing")','self::mathml:mfenced','string-length(string(@separators))>1'),(0,sre.MathmlStoreRules.defineRule_)('mtable','default.default','[t] "matrix"; [m] ./* (ctxtFunc:CTXFnodeCounter,context:"row",pause:100)','self::mathml:mtable'),(0,sre.MathmlStoreRules.defineRule_)('mtr','default.default','[m] ./* (ctxtFunc:CTXFnodeCounter,context:"column",pause:100)','self::mathml:mtr'),(0,sre.MathmlStoreRules.defineRule_)('mlabeledtr','default.default','[m] ./* (ctxtFunc:CTXFnodeCounter,context:"column",pause:100)','self::mathml:mlabeledtr'),(0,sre.MathmlStoreRules.defineRule_)('mtd','default.default','[m] ./*','self::mathml:mtd'),(0,sre.MathmlStoreRules.defineRule_)('mtable','default.superbrief','[t] count(child::mathml:mtr);  [t] "by";[t] count(child::mathml:mtr[1]/mathml:mtd); [t] "matrix";','self::mathml:mtable'),(0,sre.MathmlStoreRules.defineRule_)('mtable','default.short','[t] "matrix"; [m] ./*','self::mathml:mtable'),(0,sre.MathmlStoreRules.defineRule_)('mtr','default.short','[m] ./*','self::mathml:mtr'),(0,sre.MathmlStoreRules.defineRule_)('mtd','default.short','[t] "Element"; [t] count(./preceding-sibling::mathml:mtd)+1;[t] count(./parent::mathml:mtr/preceding-sibling::mathml:mtr)+1;[p] (pause:500); [m] ./*','self::mathml:mtd'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-4','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:200);[t] "right sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:200);[t] "right super"; [n] ./*[3] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-3-1','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:200);[t] "right super"; [n] ./*[3] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts','./mathml:none=./*[2]','./mathml:mprescripts=./*[4]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-3-2','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:200);[t] "right sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:200);','self::mathml:mmultiscripts','./mathml:none=./*[3]','./mathml:mprescripts=./*[4]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-3-3','default.default','[n] ./*[1]; [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:200);[t] "right sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:200);[t] "right super"; [n] ./*[3] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts','./mathml:none=./*[5]','./mathml:mprescripts=./*[4]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-3-4','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);[t] "right sub"; [n] ./*[2] (pitch:-0.35); [p] (pause:200);[t] "right super"; [n] ./*[3] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts','./mathml:none=./*[6]','./mathml:mprescripts=./*[4]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-2-1','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts','./mathml:none=./*[2]','./mathml:none=./*[3]','./mathml:mprescripts=./*[4]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-1-1','default.default','[n] ./*[1]; [p] (pause:200);[t] "left super"; [n] ./*[6] (pitch:0.35); [p] (pause:300);','self::mathml:mmultiscripts','./mathml:none=./*[2]','./mathml:none=./*[3]','./mathml:mprescripts=./*[4]','./mathml:none=./*[5]'),(0,sre.MathmlStoreRules.defineRule_)('mmultiscripts-1-2','default.default','[n] ./*[1]; [p] (pause:200);[t] "left sub"; [n] ./*[5] (pitch:-0.35); [p] (pause:200);','self::mathml:mmultiscripts','./mathml:none=./*[2]','./mathml:none=./*[3]','./mathml:mprescripts=./*[4]','./mathml:none=./*[6]')},sre.MathmlStoreRules.initMathjaxRules_=function(){(0,sre.MathmlStoreRules.defineRule_)('mj-math','default.default','[n] ./*[1]/*[1]/*[1]','self::span[@class="math"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-leaf','default.default','[n] CQFlookupleaf','self::span[@class="mi"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-leaf','self::span[@class="mo"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-leaf','self::span[@class="mn"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-leaf','self::span[@class="mtext"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-mo-ext','default.default','[n] CQFextender','self::span[@class="mo"]','./*[1]/*[1]/text()','./*[1]/*[2]/text()'),(0,sre.MathmlStoreRules.defineRule_)('mj-texatom','default.default','[n] ./*[1]','self::span[@class="texatom"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-msubsup','default.default','[n] ./*[1]/*[1]/*[1]; [t] "sub"; [n] ./*[1]/*[3]/*[1] (pitch:-0.35);[p] (pause:200); [t] "super"; [n] ./*[1]/*[2]/*[1] (pitch:0.35);[p] (pause:300)','self::span[@class="msubsup"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-msub','default.default','[n] ./*[1]/*[1]/*[1]; [t] "sub";[n] ./*[1]/*[2]/*[1] (pitch:-0.35); [p] (pause:300)','self::span[@class="msub"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-msup','default.default','[n] ./*[1]/*[1]/*[1]; [t] "super";[n] ./*[1]/*[2]/*[1] (pitch:0.35); [p] (pause:300)','self::span[@class="msup"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-munderover','default.default','[n] ./*[1]/*[2]/*[1] (pitch:0.35); [t] "under and";[n] ./*[1]/*[3]/*[1] (pitch:-0.35); [t] "over";[n] ./*[1]/*[1]/*[1]; [p] (pause:400)','self::span[@class="munderover"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-munder','default.default','[n] ./*[1]/*[2]/*[1] (pitch:0.35); [t] "under";[n] ./*[1]/*[1]/*[1]; [p] (pause:400)','self::span[@class="munder"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-mover','default.default','[n] ./*[1]/*[2]/*[1] (pitch:0.35); [t] "over";[n] ./*[1]/*[1]/*[1]; [p] (pause:400)','self::span[@class="mover"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-mfrac','default.default','[p] (pause:250); [n] ./*[1]/*[1]/*[1] (pitch:0.3); [p] (pause:250); [t] "divided by"; [n] ./*[1]/*[2]/*[1] (pitch:-0.3);[p] (pause:400)','self::span[@class="mfrac"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-msqrt','default.default','[t] "Square root of";[n] ./*[1]/*[1]/*[1] (rate:0.2); [p] (pause:400)','self::span[@class="msqrt"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-mroot','default.default','[t] "root of order"; [n] ./*[1]/*[4]/*[1]; [t] "of";[n] ./*[1]/*[1]/*[1] (rate:0.2); [p] (pause:400)','self::span[@class="mroot"]'),(0,sre.MathmlStoreRules.defineRule_)('mj-mfenced','default.default','[t] "opening"; [n] ./*[1]; [m] ./*[position()>1 and position()<last()]; [t] "closing"; [n] ./*[last()]','self::span[@class="mfenced"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-leaf','self::span[@class="mtable"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-leaf','self::span[@class="mmultiscripts"]')},sre.MathmlStoreRules.initAliases_=function(){(0,sre.MathmlStoreRules.defineRuleAlias_)('mspace','self::span[@class="mspace"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mstyle','self::span[@class="mstyle"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mpadded','self::span[@class="mpadded"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('merror','self::span[@class="merror"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mphantom','self::span[@class="mphantom"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('ms','self::span[@class="ms"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mrow','self::span[@class="mrow"]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-msub','self::span[@class="msubsup"]','CQFmathmlmsub'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-msup','self::span[@class="msubsup"]','CQFmathmlmsup'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-munder','self::span[@class="munderover"]','CQFmathmlmunder'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-mover','self::span[@class="munderover"]','CQFmathmlmover')},sre.MathmlStoreRules.initSpecializationRules_=function(){(0,sre.MathmlStoreRules.defineRule_)('square','default.default','[n] ./*[1]; [t] "square" (pitch:0.35); [p] (pause:300)','self::mathml:msup','./*[2][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('square','self::mathml:msup','./mathml:mrow=./*[2]','count(./*[2]/*)=1','./*[2]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRule_)('cube','default.default','[n] ./*[1]; [t] "cube" (pitch:0.35); [p] (pause:300)','self::mathml:msup','./*[2][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('cube','self::mathml:msup','./mathml:mrow=./*[2]','count(./*[2]/*)=1','./*[2]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRule_)('square-sub','default.default','[n] ./*[1]; [t] "sub"; [n] ./*[2] (pitch:-0.35);[p] (pause:300); [t] "square" (pitch:0.35); [p] (pause:400)','self::mathml:msubsup','./*[3][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('square-sub','self::mathml:msubsup','./mathml:mrow=./*[3]','count(./*[3]/*)=1','./*[3]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRule_)('cube-sub','default.default','[n] ./*[1]; [t] "sub"; [n] ./*[2] (pitch:-0.35);[p] (pause:300); [t] "cube" (pitch:0.35); [p] (pause:400)','self::mathml:msubsup','./*[3][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('cube-sub','self::mathml:msubsup','./mathml:mrow=./*[3]','count(./*[3]/*)=1','./*[3]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRule_)('mj-square','default.default','[n] ./*[1]/*[1]/*[1]; [t] "square" (pitch:0.35); [p] (pause:300)','self::span[@class="msup"]','./*[1]/*[2]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-square','self::span[@class="msup"]','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-square','self::span[@class="msubsup"]','CQFmathmlmsup','./*[1]/*[2]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-square','self::span[@class="msubsup"]','CQFmathmlmsup','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRule_)('mj-cube','default.default','[n] ./*[1]/*[1]/*[1]; [t] "cube" (pitch:0.35); [p] (pause:300)','self::span[@class="msup"]','./*[1]/*[2]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-cube','self::span[@class="msup"]','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-cube','self::span[@class="msubsup"]','CQFmathmlmsup','./*[1]/*[2]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-cube','self::span[@class="msubsup"]','CQFmathmlmsup','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRule_)('mj-square-sub','default.default','[n] ./*[1]/*[1]/*[1]; [t] "sub"; [n] ./*[1]/*[3]/*[1] (pitch:-0.35); [p] (pause:300); [t] "square" (pitch:0.35); [p] (pause:400)','self::span[@class="msubsup"]','./*[1]/*[2]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-square-sub','self::span[@class="msubsup"]','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=2]'),(0,sre.MathmlStoreRules.defineRule_)('mj-cube-sub','default.default','[n] ./*[1]/*[1]/*[1]; [t] "sub"; [n] ./*[1]/*[3]/*[1] (pitch:-0.35); [p] (pause:300); [t] "cube" (pitch:0.35); [p] (pause:400)','self::span[@class="msubsup"]','./*[1]/*[2]/*[1][text()=3]'),(0,sre.MathmlStoreRules.defineRuleAlias_)('mj-cube-sub','self::span[@class="msubsup"]','./*[1]/*[2]/*[1]=./*[1]/*[2]/span[@class="mrow"]','count(./*[1]/*[2]/*[1]/*)=1','./*[1]/*[2]/*[1]/*[1][text()=3]')},sre.SemanticTreeRules=function(){sre.SemanticTreeRules.initCustomFunctions_(),sre.SemanticTreeRules.initSemanticRules_()},goog.addSingletonGetter(sre.SemanticTreeRules),sre.SemanticTreeRules.mathStore=sre.MathmlStore.getInstance(),sre.SemanticTreeRules.defineRule_=goog.bind(sre.SemanticTreeRules.mathStore.defineRule,sre.SemanticTreeRules.mathStore),sre.SemanticTreeRules.defineRuleAlias_=goog.bind(sre.SemanticTreeRules.mathStore.defineRuleAlias,sre.SemanticTreeRules.mathStore),sre.SemanticTreeRules.addContextFunction_=goog.bind(sre.SemanticTreeRules.mathStore.contextFunctions.add,sre.SemanticTreeRules.mathStore.contextFunctions),sre.SemanticTreeRules.addCustomQuery_=goog.bind(sre.SemanticTreeRules.mathStore.customQueries.add,sre.SemanticTreeRules.mathStore.customQueries),sre.SemanticTreeRules.addCustomString_=goog.bind(sre.SemanticTreeRules.mathStore.customStrings.add,sre.SemanticTreeRules.mathStore.customStrings),sre.SemanticTreeRules.initCustomFunctions_=function(){(0,sre.SemanticTreeRules.addContextFunction_)('CTXFnodeCounter',sre.StoreUtil.nodeCounter),(0,sre.SemanticTreeRules.addContextFunction_)('CTXFcontentIterator',sre.MathmlStoreUtil.contentIterator),(0,sre.SemanticTreeRules.addCustomQuery_)('CQFhideFont',sre.MathmlStoreUtil.hideFont),(0,sre.SemanticTreeRules.addCustomString_)('CSFshowFont',sre.MathmlStoreUtil.showFont)},sre.SemanticTreeRules.initSemanticRules_=function(){(0,sre.SemanticTreeRules.defineRule_)('stree','default.default','[n] ./*[1]','self::stree'),(0,sre.SemanticTreeRules.defineRule_)('multrel','default.default','[t] "multirelation"; [m] children/* (sepFunc:CTXFcontentIterator)','self::multirel'),(0,sre.SemanticTreeRules.defineRule_)('variable-equality','default.default','[t] "equation sequence"; [m] ./children/* (context:"part",ctxtFunc:CTXFnodeCounter,sepFunc:CTXFcontentIterator)','self::relseq[@role="equality"]','count(./children/*)>2','./children/punct[@role="ellipsis"]'),(0,sre.SemanticTreeRules.defineRule_)('multi-equality','default.default','[t] "equation sequence"; [m] ./children/* (context:"part",ctxtFunc:CTXFnodeCounter,sepFunc:CTXFcontentIterator)','self::relseq[@role="equality"]','count(./children/*)>2'),(0,sre.SemanticTreeRules.defineRule_)('multi-equality','default.short','[t] "equation sequence"; [m] ./children/* (sepFunc:CTXFcontentIterator)','self::relseq[@role="equality"]','count(./children/*)>2'),(0,sre.SemanticTreeRules.defineRule_)('equality','default.default','[t] "equation"; [t] "left hand side"; [n] children/*[1];[p] (pause:200); [n] content/*[1] (pause:200);[t] "right hand side"; [n] children/*[2]','self::relseq[@role="equality"]','count(./children/*)=2'),(0,sre.SemanticTreeRules.defineRule_)('simple-equality','default.default','[n] children/*[1]; [p] (pause:200); [n] content/*[1] (pause:200);[n] children/*[2]','self::relseq[@role="equality"]','count(./children/*)=2','./children/identifier or ./children/number'),(0,sre.SemanticTreeRules.defineRule_)('simple-equality2','default.default','[n] children/*[1]; [p] (pause:200); [n] content/*[1] (pause:200);[n] children/*[2]','self::relseq[@role="equality"]','count(./children/*)=2','./children/function or ./children/appl'),(0,sre.SemanticTreeRules.defineRule_)('relseq','default.default','[m] children/* (sepFunc:CTXFcontentIterator)','self::relseq'),(0,sre.SemanticTreeRules.defineRule_)('binary-operation','default.default','[m] children/* (sepFunc:CTXFcontentIterator);','self::infixop'),(0,sre.SemanticTreeRules.defineRule_)('variable-addition','default.default','[t] "sum with variable number of summands";[p] (pause:400); [m] children/* (sepFunc:CTXFcontentIterator)','self::infixop[@role="addition"]','count(children/*)>2','children/punct[@role="ellipsis"]'),(0,sre.SemanticTreeRules.defineRule_)('multi-addition','default.default','[t] "sum with,"; [t] count(./children/*); [t] ", summands";[p] (pause:400); [m] ./children/* (sepFunc:CTXFcontentIterator)','self::infixop[@role="addition"]','count(./children/*)>2'),(0,sre.SemanticTreeRules.defineRule_)('prefix','default.default','[t] "prefix"; [n] text(); [t] "of" (pause 150);[n] children/*[1]','self::prefixop'),(0,sre.SemanticTreeRules.defineRule_)('negative','default.default','[t] "negative"; [n] children/*[1]','self::prefixop','self::prefixop[@role="negative"]'),(0,sre.SemanticTreeRules.defineRule_)('postfix','default.default','[n] children/*[1]; [t] "postfix"; [n] text() (pause 300)','self::postfixop'),(0,sre.SemanticTreeRules.defineRule_)('identifier','default.default','[n] text()','self::identifier'),(0,sre.SemanticTreeRules.defineRule_)('number','default.default','[n] text()','self::number'),(0,sre.SemanticTreeRules.defineRule_)('font','default.default','[t] @font; [n] CQFhideFont; [t] CSFshowFont','self::*','@font','@font!="normal"'),(0,sre.SemanticTreeRules.defineRule_)('font-identifier-short','default.default','[t] @font; [n] CQFhideFont; [t] CSFshowFont','self::identifier','string-length(text())=1','@font','@font="normal"','""=translate(text(), "abcdefghijklmnopqrstuvwxyz\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C2\u03C3\u03C4\u03C5\u03C6\u03C7\u03C8\u03C9ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\u03A3\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9", "")','@role!="unit"'),(0,sre.SemanticTreeRules.defineRule_)('font-identifier','default.default','[t] @font; [n] CQFhideFont; [t] CSFshowFont','self::identifier','string-length(text())=1','@font','@font="normal"','@role!="unit"'),(0,sre.SemanticTreeRules.defineRule_)('omit-font','default.default','[n] CQFhideFont; [t] CSFshowFont','self::identifier','string-length(text())=1','@font','@font="italic"'),(0,sre.SemanticTreeRules.defineRule_)('fraction','default.default','[p] (pause:250); [n] children/*[1] (pitch:0.3); [p] (pause:250); [t] "divided by"; [n] children/*[2] (pitch:-0.3); [p] (pause:400)','self::fraction'),(0,sre.SemanticTreeRules.defineRule_)('superscript','default.default','[n] children/*[1]; [t] "super"; [n] children/*[2] (pitch:0.35);[p] (pause:300)','self::superscript'),(0,sre.SemanticTreeRules.defineRule_)('subscript','default.default','[n] children/*[1]; [t] "sub"; [n] children/*[2] (pitch:-0.35);[p] (pause:300)','self::subscript'),(0,sre.SemanticTreeRules.defineRule_)('ellipsis','default.default','[p] (pause:200); [t] "dot dot dot"; [p] (pause:300)','self::punct','self::punct[@role="ellipsis"]'),(0,sre.SemanticTreeRules.defineRule_)('fence-single','default.default','[n] text()','self::punct','self::punct[@role="openfence"]'),(0,sre.SemanticTreeRules.defineRuleAlias_)('fence-single','self::punct','self::punct[@role="closefence"]'),(0,sre.SemanticTreeRules.defineRuleAlias_)('fence-single','self::punct','self::punct[@role="vbar"]'),(0,sre.SemanticTreeRules.defineRuleAlias_)('fence-single','self::punct','self::punct[@role="application"]'),(0,sre.SemanticTreeRules.defineRule_)('omit-punct','default.default','[p] (pause:200);','self::punct'),(0,sre.SemanticTreeRules.defineRule_)('omit-empty','default.default','[p] (pause:100)','self::empty'),(0,sre.SemanticTreeRules.defineRule_)('fences-open-close','default.default','[p] (pause:100); [t] "open"; [n] children/*[1]; [p] (pause:200);[t] "close"','self::fenced','@role="leftright"'),(0,sre.SemanticTreeRules.defineRule_)('fences-open-close-in-appl','default.default','[p] (pause:100); [n] children/*[1]; [p] (pause:200);','self::fenced[@role="leftright"]','./parent::children/parent::appl'),(0,sre.SemanticTreeRules.defineRule_)('fences-neutral','default.default','[p] (pause:100); [t] "absolute value of"; [n] children/*[1];[p] (pause:350);','self::fenced','self::fenced[@role="neutral"]'),(0,sre.SemanticTreeRules.defineRule_)('omit-fences','default.default','[p] (pause:500); [n] children/*[1]; [p] (pause:200);','self::fenced'),(0,sre.SemanticTreeRules.defineRule_)('matrix','default.default','[t] "matrix"; [m] children/* (ctxtFunc:CTXFnodeCounter,context:"row",pause:100)','self::matrix'),(0,sre.SemanticTreeRules.defineRule_)('matrix-row','default.default','[m] children/* (ctxtFunc:CTXFnodeCounter,context:"column",pause:100)','self::row[@role="matrix"]'),(0,sre.SemanticTreeRules.defineRule_)('matrix-cell','default.default','[n] children/*[1]','self::cell[@role="matrix"]'),(0,sre.SemanticTreeRules.defineRule_)('vector','default.default','[t] "vector"; [m] children/* (ctxtFunc:CTXFnodeCounter,context:"element",pause:100)','self::vector'),(0,sre.SemanticTreeRules.defineRule_)('cases','default.default','[t] "case statement"; [m] children/* (ctxtFunc:CTXFnodeCounter,context:"case",pause:100)','self::cases'),(0,sre.SemanticTreeRules.defineRule_)('cases-row','default.default','[m] children/*','self::row[@role="cases"]'),(0,sre.SemanticTreeRules.defineRule_)('cases-cell','default.default','[n] children/*[1]','self::cell[@role="cases"]'),(0,sre.SemanticTreeRules.defineRule_)('row','default.default','[m] ./* (ctxtFunc:CTXFnodeCounter,context:"column",pause:100)','self::row'),(0,sre.SemanticTreeRules.defineRule_)('cases-end','default.default','[t] "case statement"; [m] children/* (ctxtFunc:CTXFnodeCounter,context:"case",pause:100);[t] "end cases"','self::cases','following-sibling::*'),(0,sre.SemanticTreeRules.defineRule_)('multiline','default.default','[t] "multiline equation";[m] children/* (ctxtFunc:CTXFnodeCounter,context:"line",pause:100)','self::multiline'),(0,sre.SemanticTreeRules.defineRule_)('line','default.default','[m] children/*','self::line'),(0,sre.SemanticTreeRules.defineRule_)('table','default.default','[t] "multiline equation";[m] children/* (ctxtFunc:CTXFnodeCounter,context:"row",pause:200)','self::table'),(0,sre.SemanticTreeRules.defineRule_)('table-row','default.default','[m] children/* (pause:100)','self::row[@role="table"]'),(0,sre.SemanticTreeRules.defineRuleAlias_)('cases-cell','self::cell[@role="table"]'),(0,sre.SemanticTreeRules.defineRule_)('end-punct','default.default','[m] children/*; [p] (pause:300)','self::punctuated','@role="endpunct"'),(0,sre.SemanticTreeRules.defineRule_)('start-punct','default.default','[n] content/*[1]; [p] (pause:200); [m] children/*[position()>1]','self::punctuated','@role="startpunct"'),(0,sre.SemanticTreeRules.defineRule_)('integral-punct','default.default','[n] children/*[1] (rate:0.2); [n] children/*[3] (rate:0.2)','self::punctuated','@role="integral"'),(0,sre.SemanticTreeRules.defineRule_)('punctuated','default.default','[m] children/* (pause:100)','self::punctuated'),(0,sre.SemanticTreeRules.defineRule_)('function','default.default','[n] text()','self::function'),(0,sre.SemanticTreeRules.defineRule_)('appl','default.default','[n] children/*[1]; [n] content/*[1]; [n] children/*[2]','self::appl'),(0,sre.SemanticTreeRules.defineRule_)('sum-only','default.default','[n] children/*[1]; [t] "from"; [n] children/*[2]; [t] "to";[n] children/*[3]','self::limboth','self::limboth[@role="sum"]'),(0,sre.SemanticTreeRules.defineRule_)('limboth','default.default','[n] children/*[1]; [p] (pause 100); [t] "over"; [n] children/*[2];[t] "under"; [n] children/*[3]; [p] (pause 250);','self::limboth'),(0,sre.SemanticTreeRules.defineRule_)('limlower','default.default','[n] children/*[1]; [t] "over"; [n] children/*[2];','self::limlower'),(0,sre.SemanticTreeRules.defineRule_)('limupper','default.default','[n] children/*[1]; [t] "under"; [n] children/*[2];','self::limupper'),(0,sre.SemanticTreeRules.defineRule_)('largeop','default.default','[n] text()','self::largeop'),(0,sre.SemanticTreeRules.defineRule_)('bigop','default.default','[n] children/*[1]; [p] (pause 100); [t] "over"; [n] children/*[2];[p] (pause 250);','self::bigop'),(0,sre.SemanticTreeRules.defineRule_)('integral','default.default','[n] children/*[1]; [p] (pause 100); [n] children/*[2];[p] (pause 200); [n] children/*[3] (rate:0.35);','self::integral'),(0,sre.SemanticTreeRules.defineRule_)('sqrt','default.default','[t] "Square root of"; [n] children/*[1] (rate:0.2); [p] (pause:400)','self::sqrt'),(0,sre.SemanticTreeRules.defineRule_)('square','default.default','[n] children/*[1]; [t] "squared" (pitch:0.35); [p] (pause:300)','self::superscript','children/*[2][text()=2]','name(./children/*[1])!="text"'),(0,sre.SemanticTreeRules.defineRule_)('cube','default.default','[n] children/*[1]; [t] "cubed" (pitch:0.35); [p] (pause:300)','self::superscript','children/*[2][text()=3]','name(./children/*[1])!="text"'),(0,sre.SemanticTreeRules.defineRule_)('root','default.default','[t] "root of order"; [n] children/*[1];[t] "over"; [n] children/*[1] (rate:0.2); [p] (pause:400)','self::root'),(0,sre.SemanticTreeRules.defineRule_)('text-no-mult','default.default','[n] children/*[1]; [p] (pause:200); [n] children/*[2]','self::infixop','children/text'),(0,sre.SemanticTreeRules.defineRule_)('text','default.default','[n] text(); [p] (pause:200)','self::text'),(0,sre.SemanticTreeRules.defineRule_)('unit','default.default','[t] text() (annotation:unit, preprocess)','self::identifier','@role="unit"'),(0,sre.SemanticTreeRules.defineRule_)('unit-square','default.default','[t] "square"; [n] children/*[1]','self::superscript','@role="unit"','children/*[2][text()=2]','name(children/*[1])="identifier"'),(0,sre.SemanticTreeRules.defineRule_)('unit-cubic','default.default','[t] "cubic"; [n] children/*[1]','self::superscript','@role="unit"','children/*[2][text()=3]','name(children/*[1])="identifier"'),(0,sre.SemanticTreeRules.defineRule_)('reciprocal','default.default','[t] "reciprocal"; [n] children/*[1]','self::superscript','@role="unit"','name(children/*[1])="identifier"','name(children/*[2])="prefixop"','children/*[2][@role="negative"]','children/*[2]/children/*[1][text()=1]','count(preceding-sibling::*)=0 or preceding-sibling::*[@role!="unit"]'),(0,sre.SemanticTreeRules.defineRule_)('reciprocal','default.default','[t] "per"; [n] children/*[1]','self::superscript','@role="unit"','name(children/*[1])="identifier"','name(children/*[2])="prefixop"','children/*[2][@role="negative"]','children/*[2]/children/*[1][text()=1]','preceding-sibling::*[@role="unit"]'),(0,sre.SemanticTreeRules.defineRule_)('unit-combine','default.default','[m] children/*','self::infixop','@role="unit"'),(0,sre.SemanticTreeRules.defineRule_)('unit-divide','default.default','[n] children/*[1] (pitch:0.3); [t] "per"; [n] children/*[2] (pitch:-0.3)','self::fraction','@role="unit"')},sre.MathSimpleStore=function(){sre.MathStore.call(this)},goog.inherits(sre.MathSimpleStore,sre.MathStore),sre.MathSimpleStore.prototype.defineRulesFromMappings=function(t,a,n){for(var i in n)for(var l in n[i])this.defineRule(t,i+'.'+l,'[t] "'+n[i][l]+'"','self::text()','"'===a?'self::text() = \''+a+'\'':'self::text() = "'+a+'"')},sre.MathCompoundStore=function(){this.subStores_={}},goog.addSingletonGetter(sre.MathCompoundStore),sre.MathCompoundStore.prototype.defineRules=function(e,t,a){var n=new sre.MathSimpleStore;n.defineRulesFromMappings(e,t,a),this.subStores_[t]=n},sre.MathCompoundStore.prototype.addSymbolRules=function(e){var t=sre.MathSimpleStore.parseUnicode_(e.key);this.defineRules(e.key,t,e.mappings)},sre.MathCompoundStore.prototype.addFunctionRules=function(e){var t=e.names;e=e.mappings;for(var a,n=0;a=t[n];n++)this.defineRules(a,a,e)},sre.MathCompoundStore.prototype.addUnitRules=function(e){var t=e.names;t&&(e.names=t.map(function(e){return e+':unit'})),this.addFunctionRules(e)},sre.MathCompoundStore.prototype.lookupRule=function(e,t){var a=this.subStores_[e.textContent];return a?a.lookupRule(e,t):null},sre.MathCompoundStore.prototype.lookupString=function(e,t){var a=sre.XpathUtil.currentDocument?sre.XpathUtil.currentDocument.createTextNode(e):sre.SystemExternal.document.createTextNode(e);return(a=this.lookupRule(a,t))?a.action.components.map(function(e){return e.content.slice(1,-1)}).join(' '):''},sre.MathCompoundStore.prototype.getDynamicConstraintValues=function(){var t,n={};for(t in this.subStores_){var a,i=this.subStores_[t].getDynamicConstraintValues();for(a in i){var l=n[a];n[a]=l?sre.MathUtil.union(l,i[a]):i[a]}}return n},sre.MathSimpleStore.parseUnicode_=function(e){var t=String.fromCharCode;return(e=parseInt(e,16),65536>e)?t(e):(e-=65536,t((e>>10)+55296,(1023&e)+56320))},sre.MathMap=function(){this.store=sre.MathCompoundStore.getInstance(),this.allDomains=[],this.allStyles=[],this.retrieveMaps(),this.getDynamicConstraintValues()},goog.addSingletonGetter(sre.MathMap),sre.MathMap.toFetch_=0,sre.Engine.registerTest(function(){return sre.MathMap.getInstance()&&!sre.MathMap.toFetch_}),sre.MathMap.prototype.stringify=function(){return JSON.stringify(this)},sre.MathMap.MATHMAP_PATH_=sre.SystemExternal.jsonPath,sre.MathMap.SYMBOLS_PATH_=sre.MathMap.MATHMAP_PATH_+'symbols/',sre.MathMap.FUNCTIONS_PATH_=sre.MathMap.MATHMAP_PATH_+'functions/',sre.MathMap.UNITS_PATH_=sre.MathMap.MATHMAP_PATH_+'units/',sre.MathMap.SYMBOLS_FILES_=['greek-capital.json','greek-small.json','greek-scripts.json','greek-mathfonts.json','greek-symbols.json','hebrew_letters.json','latin-lower-double-accent.json','latin-lower-normal.json','latin-lower-phonetic.json','latin-lower-single-accent.json','latin-rest.json','latin-upper-double-accent.json','latin-upper-normal.json','latin-upper-single-accent.json','latin-mathfonts.json','math_angles.json','math_arrows.json','math_characters.json','math_delimiters.json','math_digits.json','math_geometry.json','math_harpoons.json','math_non_characters.json','math_symbols.json','math_whitespace.json','other_stars.json'],sre.MathMap.FUNCTIONS_FILES_=['algebra.json','elementary.json','hyperbolic.json','trigonometry.json'],sre.MathMap.UNITS_FILES_=['energy.json','length.json','memory.json','other.json','speed.json','temperature.json','time.json','volume.json','weight.json'],sre.MathMap.retrieveFiles=function(t,n,i){switch(sre.Engine.getInstance().mode){case sre.Engine.Mode.ASYNC:sre.MathMap.toFetch_+=t.length;for(var a,e=0;a=t[e];e++)sre.MathMap.fromFile_(n+a,function(e,t){sre.MathMap.toFetch_--,e||JSON.parse(t).forEach(function(e){i(e)})});break;case sre.Engine.Mode.HTTP:var l=sre.Engine.getInstance().isIE;for(sre.MathMap.toFetch_+=t.length,e=0;a=t[e];e++)l?sre.MathMap.getJsonIE_(a,i):sre.MathMap.getJsonAjax_(n+a,i);break;default:sre.MathMap.parseFiles(t.map(function(e){return n+e})).forEach(function(e){i(e)});}},sre.MathMap.prototype.retrieveMaps=function(){sre.MathMap.retrieveFiles(sre.MathMap.FUNCTIONS_FILES_,sre.MathMap.FUNCTIONS_PATH_,goog.bind(this.store.addFunctionRules,this.store)),sre.MathMap.retrieveFiles(sre.MathMap.SYMBOLS_FILES_,sre.MathMap.SYMBOLS_PATH_,goog.bind(this.store.addSymbolRules,this.store)),sre.MathMap.retrieveFiles(sre.MathMap.UNITS_FILES_,sre.MathMap.UNITS_PATH_,goog.bind(this.store.addUnitRules,this.store))},sre.MathMap.getJsonIE_=function(e,t,a){var n=a||1;sre.BrowserUtil.mapsForIE?((a=sre.BrowserUtil.mapsForIE[e])&&a.forEach(function(e){t(e)}),sre.MathMap.toFetch_--):5>=n?setTimeout(function(){sre.MathMap.getJsonIE_(e,t,n++)},300):sre.MathMap.toFetch_--},sre.MathMap.fromFile_=function(e,t){return sre.SystemExternal.fs.readFile(e,'utf8',t)},sre.MathMap.loadFile=function(e){try{return sre.MathMap.readJSON_(e)}catch(t){console.log('Unable to load file: '+e+', error: '+t)}},sre.MathMap.loadFiles=function(e){return e.map(sre.MathMap.loadFile)},sre.MathMap.parseFiles=function(e){return e=sre.MathMap.loadFiles(e),[].concat.apply([],e.map(function(e){return JSON.parse(e)}))},sre.MathMap.readJSON_=function(e){return sre.SystemExternal.fs.readFileSync(e)},sre.MathMap.getJsonAjax_=function(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(sre.MathMap.toFetch_--,200===a.status&&JSON.parse(a.responseText).forEach(function(e){t(e)}))},a.open('GET',e,!0),a.send()},sre.MathMap.prototype.getDynamicConstraintValues=function(){if(sre.MathMap.toFetch_)setTimeout(goog.bind(this.getDynamicConstraintValues,this),300);else{var e=this.store.getDynamicConstraintValues();this.allDomains=e.domain,this.allStyles=e.style}},sre.SemanticUtil=function(){},sre.SemanticUtil.objectsToKeys=function(e){e=Array.prototype.slice.call(arguments,0);var t=[];return t.concat.apply(t,e.map(Object.keys))},sre.SemanticUtil.objectsToValues=function(e){e=Array.prototype.slice.call(arguments,0);var t=[];return e.forEach(function(e){for(var a in e)t.push(e[a])}),t},sre.SemanticUtil.unicodeToNumber=function(e){if(!e||2<e.length)return null;if(2==e.length){var t=e.charCodeAt(0);return e=e.charCodeAt(1),55296<=t&&56319>=t&&!isNaN(e)?1024*(t-55296)+(e-56320)+65536:null}return e.charCodeAt(0)},sre.SemanticUtil.numberToUnicode=function(e){var t=String.fromCharCode;return 65536<=e?t((e-65536)/1024+55296,(e-65536)%1024+56320):t(e)},sre.SemanticUtil.splitUnicode=function(e){e=e.split('');for(var t,a=[],n=0;t=e[n];n++)'\uD800'<=t&&'\uDBFF'>=t&&e[n+1]?a.push(t+e[++n]):a.push(t);return a},sre.SemanticUtil.tagName=function(e){return e.tagName.toUpperCase()},sre.SemanticUtil.LEAFTAGS=['MO','MI','MN','MTEXT','MS'],sre.SemanticUtil.IGNORETAGS=['MERROR','MPHANTOM','MSPACE','MACTION','MALIGNGROUP','MALIGNMARK','NONE','MPRESCRIPTS'],sre.SemanticUtil.EMPTYTAGS=['MATH','MROW','MPADDED','MSTYLE'],sre.SemanticUtil.hasMathTag=function(e){return!!e&&'MATH'===sre.SemanticUtil.tagName(e)},sre.SemanticUtil.hasIgnoreTag=function(e){return!!e&&-1!==sre.SemanticUtil.IGNORETAGS.indexOf(sre.SemanticUtil.tagName(e))},sre.SemanticUtil.hasEmptyTag=function(e){return!!e&&-1!==sre.SemanticUtil.EMPTYTAGS.indexOf(sre.SemanticUtil.tagName(e))},sre.SemanticUtil.purgeNodes=function(t){for(var a,n,e=[],i=0;a=t[i];i++)n=sre.SemanticUtil.tagName(a),-1==sre.SemanticUtil.IGNORETAGS.indexOf(n)&&(-1!=sre.SemanticUtil.EMPTYTAGS.indexOf(n)&&0==a.childNodes.length||e.push(a));return e},sre.SemanticUtil.isZeroLength=function(e){return!!e&&(-1!==['negativeveryverythinmathspace','negativeverythinmathspace','negativethinmathspace','negativemediummathspace','negativethickmathspace','negativeverythickmathspace','negativeveryverythickmathspace'].indexOf(e)||!!(e=e.match(/[0-9\.]+/))&&!(0!==parseFloat(e)))},sre.SemanticAttr=function(){this.generalPunctuations=['!','"','#','%','&',':',';','?','@','\\','\xA1','\xA7','\xB6','\xBF','\u2017','\u2020','\u2021','\u2022','\u2023','\u2024','\u2025','\u2027','\u2030','\u2031','\u2038','\u203B','\u203C','\u203D','\u203E','\u2041','\u2042','\u2043','\u2047','\u2048','\u2049','\u204B','\u204C','\u204D','\u204E','\u204F','\u2050','\u2051','\u2053','\u2055','\u2056','\u2058','\u2059','\u205A','\u205B','\u205C','\u205D','\u205E','\uFE10','\uFE13','\uFE14','\uFE15','\uFE16','\uFE30','\uFE45','\uFE46','\uFE49','\uFE4A','\uFE4B','\uFE4C','\uFE50','\uFE54','\uFE55','\uFE56','\uFE57','\uFE5F','\uFE60','\uFE61','\uFE68','\uFE6A','\uFE6B','\uFF01','\uFF02','\uFF03','\uFF05','\uFF06','\uFF07','\uFF0A','\uFF0C','\uFF0F','\uFF1A','\uFF1B','\uFF1F','\uFF20','\uFF3C'],this.invisibleComma_=sre.SemanticUtil.numberToUnicode(8291),this.commas=[',',this.invisibleComma_],this.ellipses=['\u2026','\u22EE','\u22EF','\u22F0','\u22F1','\uFE19'],this.fullStops=['.','\uFE52','\uFF0E'],this.dashes=['\u2012','\u2013','\u2014','\u2015','\u301C','\uFE31','\uFE32','\uFE58'],this.primes=['\'','\u2032','\u2033','\u2034','\u2035','\u2036','\u2037','\u2057'],this.openClosePairs={"(":')',"[":']',"{":'}',"⁅":'\u2046',"〈":'\u232A',"❨":'\u2769',"❪":'\u276B',"❬":'\u276D',"❮":'\u276F',"❰":'\u2771',"❲":'\u2773',"❴":'\u2775',"⟅":'\u27C6',"⟦":'\u27E7',"⟨":'\u27E9',"⟪":'\u27EB',"⟬":'\u27ED',"⟮":'\u27EF',"⦃":'\u2984',"⦅":'\u2986',"⦇":'\u2988',"⦉":'\u298A',"⦋":'\u298C',"⦍":'\u298E',"⦏":'\u2990',"⦑":'\u2992',"⦓":'\u2994',"⦕":'\u2996',"⦗":'\u2998',"⧘":'\u29D9',"⧚":'\u29DB',"⧼":'\u29FD',"⸢":'\u2E23',"⸤":'\u2E25',"⸦":'\u2E27',"⸨":'\u2E29',"〈":'\u3009',"《":'\u300B',"「":'\u300D',"『":'\u300F',"【":'\u3011',"〔":'\u3015',"〖":'\u3017',"〘":'\u3019',"〚":'\u301B',"〝":'\u301E',"﴾":'\uFD3F',"︗":'\uFE18',"﹙":'\uFE5A',"﹛":'\uFE5C',"﹝":'\uFE5E',"（":'\uFF09',"［":'\uFF3D',"｛":'\uFF5D',"｟":'\uFF60',"｢":'\uFF63',"⌈":'\u2309',"⌊":'\u230B',"⌌":'\u230D',"⌎":'\u230F',"⌜":'\u231D',"⌞":'\u231F',"⎛":'\u239E',"⎜":'\u239F',"⎝":'\u23A0',"⎡":'\u23A4',"⎢":'\u23A5',"⎣":'\u23A6',"⎧":'\u23AB',"⎨":'\u23AC',"⎩":'\u23AD',"⎰":'\u23B1',"⎸":'\u23B9'},this.topBottomPairs={"⎴":'\u23B5',"⏜":'\u23DD',"⏞":'\u23DF',"⏠":'\u23E1',"︵":'\uFE36',"︷":'\uFE38',"︹":'\uFE3A',"︻":'\uFE3C',"︽":'\uFE3E',"︿":'\uFE40',"﹁":'\uFE42',"﹃":'\uFE44',"﹇":'\uFE48'},this.leftFences=sre.SemanticUtil.objectsToKeys(this.openClosePairs),this.rightFences=sre.SemanticUtil.objectsToValues(this.openClosePairs),this.rightFences.push('\u301F'),this.topFences=sre.SemanticUtil.objectsToKeys(this.topBottomPairs),this.bottomFences=sre.SemanticUtil.objectsToValues(this.topBottomPairs),this.neutralFences=['|','\xA6','\u2016','\u2758','\u2980','\u2AF4','\uFFE4','\uFF5C'],this.fences=this.neutralFences.concat(this.leftFences,this.rightFences,this.topFences,this.bottomFences),this.capitalLatin=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'],this.smallLatin=['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','\u0131','\u0237'],this.capitalLatinFullWidth=['\uFF21','\uFF22','\uFF23','\uFF24','\uFF25','\uFF26','\uFF27','\uFF28','\uFF29','\uFF2A','\uFF2B','\uFF2C','\uFF2D','\uFF2E','\uFF2F','\uFF30','\uFF31','\uFF32','\uFF33','\uFF34','\uFF35','\uFF36','\uFF37','\uFF38','\uFF39','\uFF3A'],this.smallLatinFullWidth=['\uFF41','\uFF42','\uFF43','\uFF44','\uFF45','\uFF46','\uFF47','\uFF48','\uFF49','\uFF4A','\uFF4B','\uFF4C','\uFF4D','\uFF4E','\uFF4F','\uFF50','\uFF51','\uFF52','\uFF53','\uFF54','\uFF55','\uFF56','\uFF57','\uFF58','\uFF59','\uFF5A'],this.capitalLatinBold=['\uD835\uDC00','\uD835\uDC01','\uD835\uDC02','\uD835\uDC03','\uD835\uDC04','\uD835\uDC05','\uD835\uDC06','\uD835\uDC07','\uD835\uDC08','\uD835\uDC09','\uD835\uDC0A','\uD835\uDC0B','\uD835\uDC0C','\uD835\uDC0D','\uD835\uDC0E','\uD835\uDC0F','\uD835\uDC10','\uD835\uDC11','\uD835\uDC12','\uD835\uDC13','\uD835\uDC14','\uD835\uDC15','\uD835\uDC16','\uD835\uDC17','\uD835\uDC18','\uD835\uDC19'],this.smallLatinBold=['\uD835\uDC1A','\uD835\uDC1B','\uD835\uDC1C','\uD835\uDC1D','\uD835\uDC1E','\uD835\uDC1F','\uD835\uDC20','\uD835\uDC21','\uD835\uDC22','\uD835\uDC23','\uD835\uDC24','\uD835\uDC25','\uD835\uDC26','\uD835\uDC27','\uD835\uDC28','\uD835\uDC29','\uD835\uDC2A','\uD835\uDC2B','\uD835\uDC2C','\uD835\uDC2D','\uD835\uDC2E','\uD835\uDC2F','\uD835\uDC30','\uD835\uDC31','\uD835\uDC32','\uD835\uDC33'],this.capitalLatinItalic=['\uD835\uDC34','\uD835\uDC35','\uD835\uDC36','\uD835\uDC37','\uD835\uDC38','\uD835\uDC39','\uD835\uDC3A','\uD835\uDC3B','\uD835\uDC3C','\uD835\uDC3D','\uD835\uDC3E','\uD835\uDC3F','\uD835\uDC40','\uD835\uDC41','\uD835\uDC42','\uD835\uDC43','\uD835\uDC44','\uD835\uDC45','\uD835\uDC46','\uD835\uDC47','\uD835\uDC48','\uD835\uDC49','\uD835\uDC4A','\uD835\uDC4B','\uD835\uDC4C','\uD835\uDC4D'],this.smallLatinItalic=['\uD835\uDC4E','\uD835\uDC4F','\uD835\uDC50','\uD835\uDC51','\uD835\uDC52','\uD835\uDC53','\uD835\uDC54','\u210E','\uD835\uDC56','\uD835\uDC57','\uD835\uDC58','\uD835\uDC59','\uD835\uDC5A','\uD835\uDC5B','\uD835\uDC5C','\uD835\uDC5D','\uD835\uDC5E','\uD835\uDC5F','\uD835\uDC60','\uD835\uDC61','\uD835\uDC62','\uD835\uDC63','\uD835\uDC64','\uD835\uDC65','\uD835\uDC66','\uD835\uDC67','\uD835\uDEA4','\uD835\uDEA5'],this.capitalLatinScript=['\uD835\uDC9C','\u212C','\uD835\uDC9E','\uD835\uDC9F','\u2130','\u2131','\uD835\uDCA2','\u210B','\u2110','\uD835\uDCA5','\uD835\uDCA6','\u2112','\u2133','\uD835\uDCA9','\uD835\uDCAA','\uD835\uDCAB','\uD835\uDCAC','\u211B','\uD835\uDCAE','\uD835\uDCAF','\uD835\uDCB0','\uD835\uDCB1','\uD835\uDCB2','\uD835\uDCB3','\uD835\uDCB4','\uD835\uDCB5','\u2118'],this.smallLatinScript=['\uD835\uDCB6','\uD835\uDCB7','\uD835\uDCB8','\uD835\uDCB9','\u212F','\uD835\uDCBB','\u210A','\uD835\uDCBD','\uD835\uDCBE','\uD835\uDCBF','\uD835\uDCC0','\uD835\uDCC1','\uD835\uDCC2','\uD835\uDCC3','\u2134','\uD835\uDCC5','\uD835\uDCC6','\uD835\uDCC7','\uD835\uDCC8','\uD835\uDCC9','\uD835\uDCCA','\uD835\uDCCB','\uD835\uDCCC','\uD835\uDCCD','\uD835\uDCCE','\uD835\uDCCF','\u2113'],this.capitalLatinBoldScript=['\uD835\uDCD0','\uD835\uDCD1','\uD835\uDCD2','\uD835\uDCD3','\uD835\uDCD4','\uD835\uDCD5','\uD835\uDCD6','\uD835\uDCD7','\uD835\uDCD8','\uD835\uDCD9','\uD835\uDCDA','\uD835\uDCDB','\uD835\uDCDC','\uD835\uDCDD','\uD835\uDCDE','\uD835\uDCDF','\uD835\uDCE0','\uD835\uDCE1','\uD835\uDCE2','\uD835\uDCE3','\uD835\uDCE4','\uD835\uDCE5','\uD835\uDCE6','\uD835\uDCE7','\uD835\uDCE8','\uD835\uDCE9'],this.smallLatinBoldScript=['\uD835\uDCEA','\uD835\uDCEB','\uD835\uDCEC','\uD835\uDCED','\uD835\uDCEE','\uD835\uDCEF','\uD835\uDCF0','\uD835\uDCF1','\uD835\uDCF2','\uD835\uDCF3','\uD835\uDCF4','\uD835\uDCF5','\uD835\uDCF6','\uD835\uDCF7','\uD835\uDCF8','\uD835\uDCF9','\uD835\uDCFA','\uD835\uDCFB','\uD835\uDCFC','\uD835\uDCFD','\uD835\uDCFE','\uD835\uDCFF','\uD835\uDD00','\uD835\uDD01','\uD835\uDD02','\uD835\uDD03'],this.capitalLatinFraktur=['\uD835\uDD04','\uD835\uDD05','\u212D','\uD835\uDD07','\uD835\uDD08','\uD835\uDD09','\uD835\uDD0A','\u210C','\u2111','\uD835\uDD0D','\uD835\uDD0E','\uD835\uDD0F','\uD835\uDD10','\uD835\uDD11','\uD835\uDD12','\uD835\uDD13','\uD835\uDD14','\u211C','\uD835\uDD16','\uD835\uDD17','\uD835\uDD18','\uD835\uDD19','\uD835\uDD1A','\uD835\uDD1B','\uD835\uDD1C','\u2128'],this.smallLatinFraktur=['\uD835\uDD1E','\uD835\uDD1F','\uD835\uDD20','\uD835\uDD21','\uD835\uDD22','\uD835\uDD23','\uD835\uDD24','\uD835\uDD25','\uD835\uDD26','\uD835\uDD27','\uD835\uDD28','\uD835\uDD29','\uD835\uDD2A','\uD835\uDD2B','\uD835\uDD2C','\uD835\uDD2D','\uD835\uDD2E','\uD835\uDD2F','\uD835\uDD30','\uD835\uDD31','\uD835\uDD32','\uD835\uDD33','\uD835\uDD34','\uD835\uDD35','\uD835\uDD36','\uD835\uDD37'],this.capitalLatinDoubleStruck=['\uD835\uDD38','\uD835\uDD39','\u2102','\uD835\uDD3B','\uD835\uDD3C','\uD835\uDD3D','\uD835\uDD3E','\u210D','\uD835\uDD40','\uD835\uDD41','\uD835\uDD42','\uD835\uDD43','\uD835\uDD44','\u2115','\uD835\uDD46','\u2119','\u211A','\u211D','\uD835\uDD4A','\uD835\uDD4B','\uD835\uDD4C','\uD835\uDD4D','\uD835\uDD4E','\uD835\uDD4F','\uD835\uDD50','\u2124'],this.smallLatinDoubleStruck=['\uD835\uDD52','\uD835\uDD53','\uD835\uDD54','\uD835\uDD55','\uD835\uDD56','\uD835\uDD57','\uD835\uDD58','\uD835\uDD59','\uD835\uDD5A','\uD835\uDD5B','\uD835\uDD5C','\uD835\uDD5D','\uD835\uDD5E','\uD835\uDD5F','\uD835\uDD60','\uD835\uDD61','\uD835\uDD62','\uD835\uDD63','\uD835\uDD64','\uD835\uDD65','\uD835\uDD66','\uD835\uDD67','\uD835\uDD68','\uD835\uDD69','\uD835\uDD6A','\uD835\uDD6B'],this.capitalLatinBoldFraktur=['\uD835\uDD6C','\uD835\uDD6D','\uD835\uDD6E','\uD835\uDD6F','\uD835\uDD70','\uD835\uDD71','\uD835\uDD72','\uD835\uDD73','\uD835\uDD74','\uD835\uDD75','\uD835\uDD76','\uD835\uDD77','\uD835\uDD78','\uD835\uDD79','\uD835\uDD7A','\uD835\uDD7B','\uD835\uDD7C','\uD835\uDD7D','\uD835\uDD7E','\uD835\uDD7F','\uD835\uDD80','\uD835\uDD81','\uD835\uDD82','\uD835\uDD83','\uD835\uDD84','\uD835\uDD85'],this.smallLatinBoldFraktur=['\uD835\uDD86','\uD835\uDD87','\uD835\uDD88','\uD835\uDD89','\uD835\uDD8A','\uD835\uDD8B','\uD835\uDD8C','\uD835\uDD8D','\uD835\uDD8E','\uD835\uDD8F','\uD835\uDD90','\uD835\uDD91','\uD835\uDD92','\uD835\uDD93','\uD835\uDD94','\uD835\uDD95','\uD835\uDD96','\uD835\uDD97','\uD835\uDD98','\uD835\uDD99','\uD835\uDD9A','\uD835\uDD9B','\uD835\uDD9C','\uD835\uDD9D','\uD835\uDD9E','\uD835\uDD9F'],this.capitalLatinSansSerif=['\uD835\uDDA0','\uD835\uDDA1','\uD835\uDDA2','\uD835\uDDA3','\uD835\uDDA4','\uD835\uDDA5','\uD835\uDDA6','\uD835\uDDA7','\uD835\uDDA8','\uD835\uDDA9','\uD835\uDDAA','\uD835\uDDAB','\uD835\uDDAC','\uD835\uDDAD','\uD835\uDDAE','\uD835\uDDAF','\uD835\uDDB0','\uD835\uDDB1','\uD835\uDDB2','\uD835\uDDB3','\uD835\uDDB4','\uD835\uDDB5','\uD835\uDDB6','\uD835\uDDB7','\uD835\uDDB8','\uD835\uDDB9'],this.smallLatinSansSerif=['\uD835\uDDBA','\uD835\uDDBB','\uD835\uDDBC','\uD835\uDDBD','\uD835\uDDBE','\uD835\uDDBF','\uD835\uDDC0','\uD835\uDDC1','\uD835\uDDC2','\uD835\uDDC3','\uD835\uDDC4','\uD835\uDDC5','\uD835\uDDC6','\uD835\uDDC7','\uD835\uDDC8','\uD835\uDDC9','\uD835\uDDCA','\uD835\uDDCB','\uD835\uDDCC','\uD835\uDDCD','\uD835\uDDCE','\uD835\uDDCF','\uD835\uDDD0','\uD835\uDDD1','\uD835\uDDD2','\uD835\uDDD3'],this.capitalLatinSansSerifBold=['\uD835\uDDD4','\uD835\uDDD5','\uD835\uDDD6','\uD835\uDDD7','\uD835\uDDD8','\uD835\uDDD9','\uD835\uDDDA','\uD835\uDDDB','\uD835\uDDDC','\uD835\uDDDD','\uD835\uDDDE','\uD835\uDDDF','\uD835\uDDE0','\uD835\uDDE1','\uD835\uDDE2','\uD835\uDDE3','\uD835\uDDE4','\uD835\uDDE5','\uD835\uDDE6','\uD835\uDDE7','\uD835\uDDE8','\uD835\uDDE9','\uD835\uDDEA','\uD835\uDDEB','\uD835\uDDEC','\uD835\uDDED'],this.smallLatinSansSerifBold=['\uD835\uDDEE','\uD835\uDDEF','\uD835\uDDF0','\uD835\uDDF1','\uD835\uDDF2','\uD835\uDDF3','\uD835\uDDF4','\uD835\uDDF5','\uD835\uDDF6','\uD835\uDDF7','\uD835\uDDF8','\uD835\uDDF9','\uD835\uDDFA','\uD835\uDDFB','\uD835\uDDFC','\uD835\uDDFD','\uD835\uDDFE','\uD835\uDDFF','\uD835\uDE00','\uD835\uDE01','\uD835\uDE02','\uD835\uDE03','\uD835\uDE04','\uD835\uDE05','\uD835\uDE06','\uD835\uDE07'],this.capitalLatinSansSerifItalic=['\uD835\uDE08','\uD835\uDE09','\uD835\uDE0A','\uD835\uDE0B','\uD835\uDE0C','\uD835\uDE0D','\uD835\uDE0E','\uD835\uDE0F','\uD835\uDE10','\uD835\uDE11','\uD835\uDE12','\uD835\uDE13','\uD835\uDE14','\uD835\uDE15','\uD835\uDE16','\uD835\uDE17','\uD835\uDE18','\uD835\uDE19','\uD835\uDE1A','\uD835\uDE1B','\uD835\uDE1C','\uD835\uDE1D','\uD835\uDE1E','\uD835\uDE1F','\uD835\uDE20','\uD835\uDE21'],this.smallLatinSansSerifItalic=['\uD835\uDE22','\uD835\uDE23','\uD835\uDE24','\uD835\uDE25','\uD835\uDE26','\uD835\uDE27','\uD835\uDE28','\uD835\uDE29','\uD835\uDE2A','\uD835\uDE2B','\uD835\uDE2C','\uD835\uDE2D','\uD835\uDE2E','\uD835\uDE2F','\uD835\uDE30','\uD835\uDE31','\uD835\uDE32','\uD835\uDE33','\uD835\uDE34','\uD835\uDE35','\uD835\uDE36','\uD835\uDE37','\uD835\uDE38','\uD835\uDE39','\uD835\uDE3A','\uD835\uDE3B'],this.capitalLatinMonospace=['\uD835\uDE70','\uD835\uDE71','\uD835\uDE72','\uD835\uDE73','\uD835\uDE74','\uD835\uDE75','\uD835\uDE76','\uD835\uDE77','\uD835\uDE78','\uD835\uDE79','\uD835\uDE7A','\uD835\uDE7B','\uD835\uDE7C','\uD835\uDE7D','\uD835\uDE7E','\uD835\uDE7F','\uD835\uDE80','\uD835\uDE81','\uD835\uDE82','\uD835\uDE83','\uD835\uDE84','\uD835\uDE85','\uD835\uDE86','\uD835\uDE87','\uD835\uDE88','\uD835\uDE89'],this.smallLatinMonospace=['\uD835\uDE8A','\uD835\uDE8B','\uD835\uDE8C','\uD835\uDE8D','\uD835\uDE8E','\uD835\uDE8F','\uD835\uDE90','\uD835\uDE91','\uD835\uDE92','\uD835\uDE93','\uD835\uDE94','\uD835\uDE95','\uD835\uDE96','\uD835\uDE97','\uD835\uDE98','\uD835\uDE99','\uD835\uDE9A','\uD835\uDE9B','\uD835\uDE9C','\uD835\uDE9D','\uD835\uDE9E','\uD835\uDE9F','\uD835\uDEA0','\uD835\uDEA1','\uD835\uDEA2','\uD835\uDEA3'],this.latinDoubleStruckItalic=['\u2145','\u2146','\u2147','\u2148','\u2149'],this.capitalGreek=['\u0391','\u0392','\u0393','\u0394','\u0395','\u0396','\u0397','\u0398','\u0399','\u039A','\u039B','\u039C','\u039D','\u039E','\u039F','\u03A0','\u03A1','\u03A3','\u03A4','\u03A5','\u03A6','\u03A7','\u03A8','\u03A9'],this.smallGreek=['\u03B1','\u03B2','\u03B3','\u03B4','\u03B5','\u03B6','\u03B7','\u03B8','\u03B9','\u03BA','\u03BB','\u03BC','\u03BD','\u03BE','\u03BF','\u03C0','\u03C1','\u03C2','\u03C3','\u03C4','\u03C5','\u03C6','\u03C7','\u03C8','\u03C9'],this.capitalGreekBold=['\uD835\uDEA8','\uD835\uDEA9','\uD835\uDEAA','\uD835\uDEAB','\uD835\uDEAC','\uD835\uDEAD','\uD835\uDEAE','\uD835\uDEAF','\uD835\uDEB0','\uD835\uDEB1','\uD835\uDEB2','\uD835\uDEB3','\uD835\uDEB4','\uD835\uDEB5','\uD835\uDEB6','\uD835\uDEB7','\uD835\uDEB8','\uD835\uDEBA','\uD835\uDEBB','\uD835\uDEBC','\uD835\uDEBD','\uD835\uDEBE','\uD835\uDEBF','\uD835\uDEC0'],this.smallGreekBold=['\uD835\uDEC2','\uD835\uDEC3','\uD835\uDEC4','\uD835\uDEC5','\uD835\uDEC6','\uD835\uDEC7','\uD835\uDEC8','\uD835\uDEC9','\uD835\uDECA','\uD835\uDECB','\uD835\uDECC','\uD835\uDECD','\uD835\uDECE','\uD835\uDECF','\uD835\uDED0','\uD835\uDED1','\uD835\uDED2','\uD835\uDED3','\uD835\uDED4','\uD835\uDED5','\uD835\uDED6','\uD835\uDED7','\uD835\uDED8','\uD835\uDED9','\uD835\uDEDA'],this.capitalGreekItalic=['\uD835\uDEE2','\uD835\uDEE3','\uD835\uDEE4','\uD835\uDEE5','\uD835\uDEE6','\uD835\uDEE7','\uD835\uDEE8','\uD835\uDEE9','\uD835\uDEEA','\uD835\uDEEB','\uD835\uDEEC','\uD835\uDEED','\uD835\uDEEE','\uD835\uDEEF','\uD835\uDEF0','\uD835\uDEF1','\uD835\uDEF2','\uD835\uDEF4','\uD835\uDEF5','\uD835\uDEF6','\uD835\uDEF7','\uD835\uDEF8','\uD835\uDEF9','\uD835\uDEFA'],this.smallGreekItalic=['\uD835\uDEFC','\uD835\uDEFD','\uD835\uDEFE','\uD835\uDEFF','\uD835\uDF00','\uD835\uDF01','\uD835\uDF02','\uD835\uDF03','\uD835\uDF04','\uD835\uDF05','\uD835\uDF06','\uD835\uDF07','\uD835\uDF08','\uD835\uDF09','\uD835\uDF0A','\uD835\uDF0B','\uD835\uDF0C','\uD835\uDF0D','\uD835\uDF0E','\uD835\uDF0F','\uD835\uDF10','\uD835\uDF11','\uD835\uDF12','\uD835\uDF13','\uD835\uDF14'],this.capitalGreekSansSerifBold=['\uD835\uDF56','\uD835\uDF57','\uD835\uDF58','\uD835\uDF59','\uD835\uDF5A','\uD835\uDF5B','\uD835\uDF5C','\uD835\uDF5D','\uD835\uDF5E','\uD835\uDF5F','\uD835\uDF60','\uD835\uDF61','\uD835\uDF62','\uD835\uDF63','\uD835\uDF64','\uD835\uDF65','\uD835\uDF66','\uD835\uDF68','\uD835\uDF69','\uD835\uDF6A','\uD835\uDF6B','\uD835\uDF6C','\uD835\uDF6D','\uD835\uDF6E'],this.smallGreekSansSerifBold=['\uD835\uDF70','\uD835\uDF71','\uD835\uDF72','\uD835\uDF73','\uD835\uDF74','\uD835\uDF75','\uD835\uDF76','\uD835\uDF77','\uD835\uDF78','\uD835\uDF79','\uD835\uDF7A','\uD835\uDF7B','\uD835\uDF7C','\uD835\uDF7D','\uD835\uDF7E','\uD835\uDF7F','\uD835\uDF80','\uD835\uDF81','\uD835\uDF82','\uD835\uDF83','\uD835\uDF84','\uD835\uDF85','\uD835\uDF86','\uD835\uDF87','\uD835\uDF88'],this.greekDoubleStruck=['\u213C','\u213D','\u213E','\u213F'],this.hebrewLetters=['\u2135','\u2136','\u2137','\u2138'],this.allLetters=this.capitalLatin.concat(this.smallLatin,this.capitalLatinFullWidth,this.smallLatinFullWidth,this.capitalLatinBold,this.smallLatinBold,this.capitalLatinItalic,this.smallLatinItalic,this.capitalLatinScript,this.smallLatinScript,this.capitalLatinBoldScript,this.smallLatinBoldScript,this.capitalLatinFraktur,this.smallLatinFraktur,this.capitalLatinDoubleStruck,this.smallLatinDoubleStruck,this.capitalLatinBoldFraktur,this.smallLatinBoldFraktur,this.capitalLatinSansSerif,this.smallLatinSansSerif,this.capitalLatinSansSerifBold,this.smallLatinSansSerifBold,this.capitalLatinSansSerifItalic,this.smallLatinSansSerifItalic,this.capitalLatinMonospace,this.smallLatinMonospace,this.latinDoubleStruckItalic,this.capitalGreek,this.smallGreek,this.capitalGreekBold,this.smallGreekBold,this.capitalGreekItalic,this.smallGreekItalic,this.capitalGreekSansSerifBold,this.smallGreekSansSerifBold,this.greekDoubleStruck,this.hebrewLetters),this.additions=['+','\xB1','\u2213','\u2214','\u2227','\u2228','\u2229','\u222A','\u228C','\u2293','\u2294','\u229D','\u229E','\u22A4','\u22A5','\u22BA','\u22BB','\u22BC','\u22C4','\u22CE','\u22CF','\u22D2','\u22D3','\u25B3','\u25B7','\u25BD','\u25C1','\u2A5E','\u2295'],this.invisiblePlus_=sre.SemanticUtil.numberToUnicode(8292),this.additions.push(this.invisiblePlus_),this.multiplications=['\u2020','\u2021','\u2210','\u2217','\u2218','\u2219','\u2240','\u229A','\u229B','\u22A0','\u22A1','\u22C5','\u22C6','\u22C7','\u22C9','\u22CA','\u22CB','\u22CC','\u25CB','\xB7','*'],this.invisibleTimes_=sre.SemanticUtil.numberToUnicode(8290),this.multiplications.push(this.invisibleTimes_),this.subtractions=['-','\u2052','\u207B','\u208B','\u2212','\u2216','\u2238','\u2242','\u2296','\u229F','\u2796','\u2A29','\u2A2A','\u2A2B','\u2A2C','\u2A3A','\u2A41','\u2A6C','\uFE63','\uFF0D','\u2010','\u2011'],this.divisions=['/','\xF7','\u2044','\u2215','\u2298','\u27CC','\u29BC','\u2A38'],this.functionApplication_=sre.SemanticUtil.numberToUnicode(8289),this.equalities=['=','~','\u207C','\u208C','\u223C','\u223D','\u2243','\u2245','\u2248','\u224A','\u224B','\u224C','\u224D','\u224E','\u2251','\u2252','\u2253','\u2254','\u2255','\u2256','\u2257','\u2258','\u2259','\u225A','\u225B','\u225C','\u225D','\u225E','\u225F','\u2261','\u2263','\u29E4','\u2A66','\u2A6E','\u2A6F','\u2A70','\u2A71','\u2A72','\u2A73','\u2A74','\u2A75','\u2A76','\u2A77','\u2A78','\u22D5','\u2A6D','\u2A6A','\u2A6B','\u2A6C','\uFE66','\uFF1D'],this.inequalities=['<','>','\u2241','\u2242','\u2244','\u2246','\u2247','\u2249','\u224F','\u2250','\u2260','\u2262','\u2264','\u2265','\u2266','\u2267','\u2268','\u2269','\u226A','\u226B','\u226C','\u226D','\u226E','\u226F','\u2270','\u2271','\u2272','\u2273','\u2274','\u2275','\u2276','\u2277','\u2278','\u2279','\u227A','\u227B','\u227C','\u227D','\u227E','\u227F','\u2280','\u2281','\u22D6','\u22D7','\u22D8','\u22D9','\u22DA','\u22DB','\u22DC','\u22DD','\u22DE','\u22DF','\u22E0','\u22E1','\u22E2','\u22E3','\u22E4','\u22E5','\u22E6','\u22E7','\u22E8','\u22E9','\u2A79','\u2A7A','\u2A7B','\u2A7C','\u2A7D','\u2A7E','\u2A7F','\u2A80','\u2A81','\u2A82','\u2A83','\u2A84','\u2A85','\u2A86','\u2A87','\u2A88','\u2A89','\u2A8A','\u2A8B','\u2A8C','\u2A8D','\u2A8E','\u2A8F','\u2A90','\u2A91','\u2A92','\u2A93','\u2A94','\u2A95','\u2A96','\u2A97','\u2A98','\u2A99','\u2A9A','\u2A9B','\u2A9C','\u2A9D','\u2A9E','\u2A9F','\u2AA0','\u2AA1','\u2AA2','\u2AA3','\u2AA4','\u2AA5','\u2AA6','\u2AA7','\u2AA8','\u2AA9','\u2AAA','\u2AAB','\u2AAC','\u2AAD','\u2AAE','\u2AAF','\u2AB0','\u2AB1','\u2AB2','\u2AB3','\u2AB4','\u2AB5','\u2AB6','\u2AB7','\u2AB8','\u2AB9','\u2ABA','\u2ABB','\u2ABC','\u2AF7','\u2AF8','\u2AF9','\u2AFA','\u29C0','\u29C1','\uFE64','\uFE65','\uFF1C','\uFF1E'],this.relations=[],this.arrows=['\u2190','\u2191','\u2192','\u2193','\u2194','\u2195','\u2196','\u2197','\u2198','\u2199','\u219A','\u219B','\u219C','\u219D','\u219E','\u219F','\u21A0','\u21A1','\u21A2','\u21A3','\u21A4','\u21A5','\u21A6','\u21A7','\u21A8','\u21A9','\u21AA','\u21AB','\u21AC','\u21AD','\u21AE','\u21AF','\u21B0','\u21B1','\u21B2','\u21B3','\u21B4','\u21B5','\u21B6','\u21B7','\u21B8','\u21B9','\u21BA','\u21BB','\u21C4','\u21C5','\u21C6','\u21C7','\u21C8','\u21C9','\u21CA','\u21CD','\u21CE','\u21CF','\u21D0','\u21D1','\u21D2','\u21D3','\u21D4','\u21D5','\u21D6','\u21D7','\u21D8','\u21D9','\u21DA','\u21DB','\u21DC','\u21DD','\u21DE','\u21DF','\u21E0','\u21E1','\u21E2','\u21E3','\u21E4','\u21E5','\u21E6','\u21E7','\u21E8','\u21E9','\u21EA','\u21EB','\u21EC','\u21ED','\u21EE','\u21EF','\u21F0','\u21F1','\u21F2','\u21F3','\u21F4','\u21F5','\u21F6','\u21F7','\u21F8','\u21F9','\u21FA','\u21FB','\u21FC','\u21FD','\u21FE','\u21FF','\u2301','\u2303','\u2304','\u2324','\u238B','\u2794','\u2798','\u2799','\u279A','\u279B','\u279C','\u279D','\u279E','\u279F','\u27A0','\u27A1','\u27A2','\u27A3','\u27A4','\u27A5','\u27A6','\u27A7','\u27A8','\u27A9','\u27AA','\u27AB','\u27AC','\u27AD','\u27AE','\u27AF','\u27B1','\u27B2','\u27B3','\u27B4','\u27B5','\u27B6','\u27B7','\u27B8','\u27B9','\u27BA','\u27BB','\u27BC','\u27BD','\u27BE','\u27F0','\u27F1','\u27F2','\u27F3','\u27F4','\u27F5','\u27F6','\u27F7','\u27F8','\u27F9','\u27FA','\u27FB','\u27FC','\u27FD','\u27FE','\u27FF','\u2900','\u2901','\u2902','\u2903','\u2904','\u2905','\u2906','\u2907','\u2908','\u2909','\u290A','\u290B','\u290C','\u290D','\u290E','\u290F','\u2910','\u2911','\u2912','\u2913','\u2914','\u2915','\u2916','\u2917','\u2918','\u2919','\u291A','\u291B','\u291C','\u291D','\u291E','\u291F','\u2920','\u2921','\u2922','\u2923','\u2924','\u2925','\u2926','\u2927','\u2928','\u2929','\u292A','\u292D','\u292E','\u292F','\u2930','\u2931','\u2932','\u2933','\u2934','\u2935','\u2936','\u2937','\u2938','\u2939','\u293A','\u293B','\u293C','\u293D','\u293E','\u293F','\u2940','\u2941','\u2942','\u2943','\u2944','\u2945','\u2946','\u2947','\u2948','\u2949','\u2970','\u2971','\u2972','\u2973','\u2974','\u2975','\u2976','\u2977','\u2978','\u2979','\u297A','\u297B','\u29B3','\u29B4','\u29BD','\u29EA','\u29EC','\u29ED','\u2A17','\u2B00','\u2B01','\u2B02','\u2B03','\u2B04','\u2B05','\u2B06','\u2B07','\u2B08','\u2B09','\u2B0A','\u2B0B','\u2B0C','\u2B0D','\u2B0E','\u2B0F','\u2B10','\u2B11','\u2B30','\u2B31','\u2B32','\u2B33','\u2B34','\u2B35','\u2B36','\u2B37','\u2B38','\u2B39','\u2B3A','\u2B3B','\u2B3C','\u2B3D','\u2B3E','\u2B3F','\u2B40','\u2B41','\u2B42','\u2B43','\u2B44','\u2B45','\u2B46','\u2B47','\u2B48','\u2B49','\u2B4A','\u2B4B','\u2B4C','\uFFE9','\uFFEA','\uFFEB','\uFFEC','\u21BC','\u21BD','\u21BE','\u21BF','\u21C0','\u21C1','\u21C2','\u21C3','\u21CB','\u21CC','\u294A','\u294B','\u294C','\u294D','\u294E','\u294F','\u2950','\u2951','\u2952','\u2953','\u2954','\u2955','\u2956','\u2957','\u2958','\u2959','\u295A','\u295B','\u295C','\u295D','\u295E','\u295F','\u2960','\u2961','\u2962','\u2963','\u2964','\u2965','\u2966','\u2967','\u2968','\u2969','\u296A','\u296B','\u296C','\u296D','\u296E','\u296F','\u297C','\u297D','\u297E','\u297F'],this.sumOps=['\u2140','\u220F','\u2210','\u2211','\u22C0','\u22C1','\u22C2','\u22C3','\u2A00','\u2A01','\u2A02','\u2A03','\u2A04','\u2A05','\u2A06','\u2A07','\u2A08','\u2A09','\u2A0A','\u2A0B','\u2AFC','\u2AFF'],this.intOps=['\u222B','\u222C','\u222D','\u222E','\u222F','\u2230','\u2231','\u2232','\u2233','\u2A0C','\u2A0D','\u2A0E','\u2A0F','\u2A10','\u2A11','\u2A12','\u2A13','\u2A14','\u2A15','\u2A16','\u2A17','\u2A18','\u2A19','\u2A1A','\u2A1B','\u2A1C'],this.prefixOps=['\u2200','\u2203'],this.operatorBits=['\u2320','\u2321','\u23B6','\u23AA','\u23AE','\u23AF','\u23B2','\u23B3','\u23B7'],this.digitsNormal=['0','1','2','3','4','5','6','7','8','9'],this.digitsFullWidth=['\uFF10','\uFF11','\uFF12','\uFF13','\uFF14','\uFF15','\uFF16','\uFF17','\uFF18','\uFF19'],this.digitsBold=['\uD835\uDFCE','\uD835\uDFCF','\uD835\uDFD0','\uD835\uDFD1','\uD835\uDFD2','\uD835\uDFD3','\uD835\uDFD4','\uD835\uDFD5','\uD835\uDFD6','\uD835\uDFD7'],this.digitsDoubleStruck=['\uD835\uDFD8','\uD835\uDFD9','\uD835\uDFDA','\uD835\uDFDB','\uD835\uDFDC','\uD835\uDFDD','\uD835\uDFDE','\uD835\uDFDF','\uD835\uDFE0','\uD835\uDFE1'],this.digitsSansSerif=['\uD835\uDFE2','\uD835\uDFE3','\uD835\uDFE4','\uD835\uDFE5','\uD835\uDFE6','\uD835\uDFE7','\uD835\uDFE8','\uD835\uDFE9','\uD835\uDFEA','\uD835\uDFEB'],this.digitsSansSerifBold=['\uD835\uDFEC','\uD835\uDFED','\uD835\uDFEE','\uD835\uDFEF','\uD835\uDFF0','\uD835\uDFF1','\uD835\uDFF2','\uD835\uDFF3','\uD835\uDFF4','\uD835\uDFF5'],this.digitsMonospace=['\uD835\uDFF6','\uD835\uDFF7','\uD835\uDFF8','\uD835\uDFF9','\uD835\uDFFA','\uD835\uDFFB','\uD835\uDFFC','\uD835\uDFFD','\uD835\uDFFE','\uD835\uDFFF'],this.digitsSuperscript=['\xB2','\xB3','\xB9','\u2070','\u2074','\u2075','\u2076','\u2077','\u2078','\u2079'],this.digitsSubscript=['\u2080','\u2081','\u2082','\u2083','\u2084','\u2085','\u2086','\u2087','\u2088','\u2089'],this.fractions=['\xBC','\xBD','\xBE','\u2150','\u2151','\u2152','\u2153','\u2154','\u2155','\u2156','\u2157','\u2158','\u2159','\u215A','\u215B','\u215C','\u215D','\u215E','\u215F','\u2189'],this.enclosedNumbers=['\u2460','\u2461','\u2462','\u2463','\u2464','\u2465','\u2466','\u2467','\u2468','\u2469','\u246A','\u246B','\u246C','\u246D','\u246E','\u246F','\u2470','\u2471','\u2472','\u2473','\u24EA','\u24EB','\u24EC','\u24ED','\u24EE','\u24EF','\u24F0','\u24F1','\u24F2','\u24F3','\u24F4','\u24F5','\u24F6','\u24F7','\u24F8','\u24F9','\u24FA','\u24FB','\u24FC','\u24FD','\u24FE','\u24FF','\u2776','\u2777','\u2778','\u2779','\u277A','\u277B','\u277C','\u277D','\u277E','\u277F','\u2780','\u2781','\u2782','\u2783','\u2784','\u2785','\u2786','\u2787','\u2788','\u2789','\u278A','\u278B','\u278C','\u278D','\u278E','\u278F','\u2790','\u2791','\u2792','\u2793','\u3248','\u3249','\u324A','\u324B','\u324C','\u324D','\u324E','\u324F','\u3251','\u3252','\u3253','\u3254','\u3255','\u3256','\u3257','\u3258','\u3259','\u325A','\u325B','\u325C','\u325D','\u325E','\u325F','\u32B1','\u32B2','\u32B3','\u32B4','\u32B5','\u32B6','\u32B7','\u32B8','\u32B9','\u32BA','\u32BB','\u32BC','\u32BD','\u32BE','\u32BF'],this.fencedNumbers=['\u2474','\u2475','\u2476','\u2477','\u2478','\u2479','\u247A','\u247B','\u247C','\u247D','\u247E','\u247F','\u2480','\u2481','\u2482','\u2483','\u2484','\u2485','\u2486','\u2487'],this.punctuatedNumbers=['\u2488','\u2489','\u248A','\u248B','\u248C','\u248D','\u248E','\u248F','\u2490','\u2491','\u2492','\u2493','\u2494','\u2495','\u2496','\u2497','\u2498','\u2499','\u249A','\u249B','\uD83C\uDD00','\uD83C\uDD01','\uD83C\uDD02','\uD83C\uDD03','\uD83C\uDD04','\uD83C\uDD05','\uD83C\uDD06','\uD83C\uDD07','\uD83C\uDD08','\uD83C\uDD09','\uD83C\uDD0A'],this.digits=this.digitsNormal.concat(this.digitsFullWidth,this.digitsBold,this.digitsDoubleStruck,this.digitsSansSerif,this.digitsSansSerifBold,this.digitsMonospace),this.numbers=this.fractions.concat(this.digitsSuperscript,this.digitsSubscript,this.enclosedNumbers,this.fencedNumbers,this.punctuatedNumbers),this.allNumbers=this.digits.concat(this.numbers),this.trigonometricFunctions=['cos','cot','csc','sec','sin','tan','arccos','arccot','arccsc','arcsec','arcsin','arctan'],this.hyperbolicFunctions=['cosh','coth','csch','sech','sinh','tanh','arcosh','arcoth','arcsch','arsech','arsinh','artanh','arccosh','arccoth','arccsch','arcsech','arcsinh','arctanh'],this.algebraicFunctions=['deg','det','dim','hom','ker','Tr','tr'],this.elementaryFunctions=['log','ln','lg','exp','expt','gcd','gcd','arg','im','re','Pr'],this.prefixFunctions=this.trigonometricFunctions.concat(this.hyperbolicFunctions,this.algebraicFunctions,this.elementaryFunctions),this.limitFunctions=['inf','lim','liminf','limsup','max','min','sup','injlim','projlim'],this.infixFunctions=['mod','rem'],this.symbolSetToSemantic_=[{set:this.generalPunctuations,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.UNKNOWN},{set:this.commas,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.COMMA},{set:this.ellipses,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.ELLIPSIS},{set:this.fullStops,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.FULLSTOP},{set:this.dashes,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.DASH},{set:this.primes,type:sre.SemanticAttr.Type.PUNCTUATION,role:sre.SemanticAttr.Role.PRIME},{set:this.leftFences,type:sre.SemanticAttr.Type.FENCE,role:sre.SemanticAttr.Role.OPEN},{set:this.rightFences,type:sre.SemanticAttr.Type.FENCE,role:sre.SemanticAttr.Role.CLOSE},{set:this.topFences,type:sre.SemanticAttr.Type.FENCE,role:sre.SemanticAttr.Role.TOP},{set:this.bottomFences,type:sre.SemanticAttr.Type.FENCE,role:sre.SemanticAttr.Role.BOTTOM},{set:this.neutralFences,type:sre.SemanticAttr.Type.FENCE,role:sre.SemanticAttr.Role.NEUTRAL},{set:this.smallLatin,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.capitalLatin,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.smallLatinFullWidth,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.capitalLatinFullWidth,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.smallLatinBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLD},{set:this.capitalLatinBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLD},{set:this.smallLatinItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.ITALIC},{set:this.capitalLatinItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.ITALIC},{set:this.smallLatinScript,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SCRIPT},{set:this.capitalLatinScript,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SCRIPT},{set:this.smallLatinBoldScript,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLDSCRIPT},{set:this.capitalLatinBoldScript,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLDSCRIPT},{set:this.smallLatinFraktur,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.FRAKTUR},{set:this.capitalLatinFraktur,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.FRAKTUR},{set:this.smallLatinDoubleStruck,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.DOUBLESTRUCK},{set:this.capitalLatinDoubleStruck,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.DOUBLESTRUCK},{set:this.smallLatinBoldFraktur,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLDFRAKTUR},{set:this.capitalLatinBoldFraktur,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.BOLDFRAKTUR},{set:this.smallLatinSansSerif,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIF},{set:this.capitalLatinSansSerif,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIF},{set:this.smallLatinSansSerifBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIFBOLD},{set:this.capitalLatinSansSerifBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIFBOLD},{set:this.smallLatinSansSerifItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIFITALIC},{set:this.capitalLatinSansSerifItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.SANSSERIFITALIC},{set:this.smallLatinMonospace,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.MONOSPACE},{set:this.capitalLatinMonospace,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.MONOSPACE},{set:this.latinDoubleStruckItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.LATINLETTER,font:sre.SemanticAttr.Font.DOUBLESTRUCKITALIC},{set:this.smallGreek,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.capitalGreek,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.smallGreekBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.BOLD},{set:this.capitalGreekBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.BOLD},{set:this.smallGreekItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.ITALIC},{set:this.capitalGreekItalic,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.ITALIC},{set:this.smallGreekSansSerifBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.SANSSERIFBOLD},{set:this.capitalGreekSansSerifBold,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.SANSSERIFBOLD},{set:this.greekDoubleStruck,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.GREEKLETTER,font:sre.SemanticAttr.Font.DOUBLESTRUCK},{set:this.hebrewLetters,type:sre.SemanticAttr.Type.IDENTIFIER,role:sre.SemanticAttr.Role.OTHERLETTER,font:sre.SemanticAttr.Font.NORMAL},{set:this.digitsNormal,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.NORMAL},{set:this.digitsFullWidth,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.NORMAL},{set:this.digitsBold,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.BOLD},{set:this.digitsDoubleStruck,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.DOUBLESTRUCK},{set:this.digitsSansSerif,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.SANSSERIF},{set:this.digitsSansSerifBold,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.SANSSERIFBOLD},{set:this.digitsMonospace,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.INTEGER,font:sre.SemanticAttr.Font.MONOSPACE},{set:this.numbers,type:sre.SemanticAttr.Type.NUMBER,role:sre.SemanticAttr.Role.FLOAT},{set:this.additions,type:sre.SemanticAttr.Type.OPERATOR,role:sre.SemanticAttr.Role.ADDITION},{set:this.multiplications,type:sre.SemanticAttr.Type.OPERATOR,role:sre.SemanticAttr.Role.MULTIPLICATION},{set:this.subtractions,type:sre.SemanticAttr.Type.OPERATOR,role:sre.SemanticAttr.Role.SUBTRACTION},{set:this.divisions,type:sre.SemanticAttr.Type.OPERATOR,role:sre.SemanticAttr.Role.DIVISION},{set:this.prefixOps,type:sre.SemanticAttr.Type.PREFIXOP,role:sre.SemanticAttr.Role.PREFIXFUNC},{set:this.equalities,type:sre.SemanticAttr.Type.RELATION,role:sre.SemanticAttr.Role.EQUALITY},{set:this.inequalities,type:sre.SemanticAttr.Type.RELATION,role:sre.SemanticAttr.Role.INEQUALITY},{set:this.relations,type:sre.SemanticAttr.Type.RELATION,role:sre.SemanticAttr.Role.UNKNOWN},{set:this.arrows,type:sre.SemanticAttr.Type.RELATION,role:sre.SemanticAttr.Role.ARROW},{set:this.sumOps,type:sre.SemanticAttr.Type.LARGEOP,role:sre.SemanticAttr.Role.SUM},{set:this.intOps,type:sre.SemanticAttr.Type.LARGEOP,role:sre.SemanticAttr.Role.INTEGRAL},{set:this.limitFunctions,type:sre.SemanticAttr.Type.FUNCTION,role:sre.SemanticAttr.Role.LIMFUNC},{set:this.prefixFunctions,type:sre.SemanticAttr.Type.FUNCTION,role:sre.SemanticAttr.Role.PREFIXFUNC},{set:this.infixFunctions,type:sre.SemanticAttr.Type.OPERATOR,role:sre.SemanticAttr.Role.MULTIPLICATION}],this.meaning_=this.initMeaning_()},goog.addSingletonGetter(sre.SemanticAttr),sre.SemanticAttr.Type={PUNCTUATION:'punctuation',FENCE:'fence',NUMBER:'number',IDENTIFIER:'identifier',TEXT:'text',OPERATOR:'operator',RELATION:'relation',LARGEOP:'largeop',FUNCTION:'function',ACCENT:'accent',FENCED:'fenced',FRACTION:'fraction',PUNCTUATED:'punctuated',RELSEQ:'relseq',MULTIREL:'multirel',INFIXOP:'infixop',PREFIXOP:'prefixop',POSTFIXOP:'postfixop',APPL:'appl',INTEGRAL:'integral',BIGOP:'bigop',SQRT:'sqrt',ROOT:'root',LIMUPPER:'limupper',LIMLOWER:'limlower',LIMBOTH:'limboth',SUBSCRIPT:'subscript',SUPERSCRIPT:'superscript',UNDERSCORE:'underscore',OVERSCORE:'overscore',TENSOR:'tensor',TABLE:'table',MULTILINE:'multiline',MATRIX:'matrix',VECTOR:'vector',CASES:'cases',ROW:'row',LINE:'line',CELL:'cell',ENCLOSE:'enclose',UNKNOWN:'unknown',EMPTY:'empty'},sre.SemanticAttr.Role={COMMA:'comma',ELLIPSIS:'ellipsis',FULLSTOP:'fullstop',DASH:'dash',PRIME:'prime',VBAR:'vbar',OPENFENCE:'openfence',CLOSEFENCE:'closefence',APPLICATION:'application',DUMMY:'dummy',UNIT:'unit',OPEN:'open',CLOSE:'close',TOP:'top',BOTTOM:'bottom',NEUTRAL:'neutral',LATINLETTER:'latinletter',GREEKLETTER:'greekletter',OTHERLETTER:'otherletter',INTEGER:'integer',FLOAT:'float',OTHERNUMBER:'othernumber',MIXED:'mixed',MULTIACCENT:'multiaccent',OVERACCENT:'overaccent',UNDERACCENT:'underaccent',SUBSUP:'subsup',LEFTSUB:'leftsub',LEFTSUPER:'leftsuper',RIGHTSUB:'rightsub',RIGHTSUPER:'rightsuper',LEFTRIGHT:'leftright',ABOVEBELOW:'abovebelow',STRING:'string',SEQUENCE:'sequence',ENDPUNCT:'endpunct',STARTPUNCT:'startpunct',TEXT:'text',NEGATIVE:'negative',NEGATION:'negation',MULTIOP:'multiop',LIMFUNC:'limit function',INFIXFUNC:'infix function',PREFIXFUNC:'prefix function',POSTFIXFUNC:'postfix function',SIMPLEFUNC:'simple function',SUM:'sum',INTEGRAL:'integral',ADDITION:'addition',MULTIPLICATION:'multiplication',SUBTRACTION:'subtraction',IMPLICIT:'implicit',DIVISION:'division',VULGAR:'vulgar',EQUALITY:'equality',INEQUALITY:'inequality',ELEMENT:'element',BINREL:'binrel',ARROW:'arrow',DETERMINANT:'determinant',ROWVECTOR:'rowvector',BINOMIAL:'binomial',SQUAREMATRIX:'squarematrix',MULTILINE:'multiline',MATRIX:'matrix',VECTOR:'vector',CASES:'cases',TABLE:'table',UNKNOWN:'unknown',PROTECTED:'protected'},sre.SemanticAttr.Font={BOLD:'bold',BOLDFRAKTUR:'bold-fraktur',BOLDITALIC:'bold-italic',BOLDSCRIPT:'bold-script',DOUBLESTRUCK:'double-struck',DOUBLESTRUCKITALIC:'double-struck-italic',FRAKTUR:'fraktur',ITALIC:'italic',MONOSPACE:'monospace',NORMAL:'normal',SCRIPT:'script',SANSSERIF:'sans-serif',SANSSERIFITALIC:'sans-serif-italic',SANSSERIFBOLD:'sans-serif-bold',SANSSERIFBOLDITALIC:'sans-serif-bold-italic',UNKNOWN:'unknown'},sre.SemanticAttr.prototype.lookupType=function(){return sre.SemanticAttr.Type.UNKNOWN},sre.SemanticAttr.prototype.lookupRole=function(){return sre.SemanticAttr.Role.UNKNOWN},sre.SemanticAttr.lookupMeaning=function(e){return sre.SemanticAttr.getInstance().lookupMeaning_(e)},sre.SemanticAttr.invisibleTimes=function(){return sre.SemanticAttr.getInstance().invisibleTimes_},sre.SemanticAttr.invisibleComma=function(){return sre.SemanticAttr.getInstance().invisibleComma_},sre.SemanticAttr.functionApplication=function(){return sre.SemanticAttr.getInstance().functionApplication_},sre.SemanticAttr.isMatchingFenceRole=function(e,t){return e==sre.SemanticAttr.Role.OPEN&&t==sre.SemanticAttr.Role.CLOSE||e==sre.SemanticAttr.Role.NEUTRAL&&t==sre.SemanticAttr.Role.NEUTRAL||e==sre.SemanticAttr.Role.TOP&&t==sre.SemanticAttr.Role.BOTTOM},sre.SemanticAttr.isMatchingFence=function(e,t){return sre.SemanticAttr.getInstance().isMatchingFence_(e,t)},sre.SemanticAttr.isOpeningFence=function(e){return e==sre.SemanticAttr.Role.OPEN||e==sre.SemanticAttr.Role.NEUTRAL},sre.SemanticAttr.isClosingFence=function(e){return e==sre.SemanticAttr.Role.CLOSE||e==sre.SemanticAttr.Role.NEUTRAL},sre.SemanticAttr.isEmbellishedType=function(e){return e===sre.SemanticAttr.Type.OPERATOR||e===sre.SemanticAttr.Type.RELATION||e===sre.SemanticAttr.Type.FENCE||e===sre.SemanticAttr.Type.PUNCTUATION},sre.SemanticAttr.isCharacterD=function(e){return-1!=['d','\u2146','\uFF44','\uD835\uDC1D','\uD835\uDC51','\uD835\uDCB9','\uD835\uDCED','\uD835\uDD21','\uD835\uDD55','\uD835\uDD89','\uD835\uDDBD','\uD835\uDDF1','\uD835\uDE25','\uD835\uDE8D'].indexOf(e)},sre.SemanticAttr.prototype.isMatchingFence_=function(e,t){return-1==this.neutralFences.indexOf(e)?this.openClosePairs[e]==t||this.topBottomPairs[e]==t:e==t},sre.SemanticAttr.prototype.initMeaning_=function(){for(var e,t={},a=0;e=this.symbolSetToSemantic_[a];a++)e.set.forEach(function(a){t[a]={role:e.role||sre.SemanticAttr.Role.UNKNOWN,type:e.type||sre.SemanticAttr.Type.UNKNOWN,font:e.font||sre.SemanticAttr.Font.UNKNOWN}});return t},sre.SemanticAttr.prototype.lookupMeaning_=function(e){return this.meaning_[e]||{role:sre.SemanticAttr.Role.UNKNOWN,type:sre.SemanticAttr.Type.UNKNOWN,font:sre.SemanticAttr.Font.UNKNOWN}},sre.SemanticTree=function(e){this.idCounter_=0,this.mathml=e,this.root=this.parseMathml_(e)},sre.SemanticTree.Node=function(e){this.id=e,this.mathml=[],this.parent=null,this.type=sre.SemanticAttr.Type.UNKNOWN,this.role=sre.SemanticAttr.Role.UNKNOWN,this.font=sre.SemanticAttr.Font.UNKNOWN,this.embellished=null,this.fencePointer='',this.childNodes=[],this.textContent='',this.mathmlTree=null,this.contentNodes=[],this.bookmark=0},sre.SemanticTree.Node.prototype.querySelectorAll=function(e){for(var t,a=[],n=0;t=this.childNodes[n];n++)a=a.concat(t.querySelectorAll(e));return e(this)&&a.unshift(this),a},sre.SemanticTree.prototype.xml=function(e){var t=new sre.SystemExternal.xmldom.DOMParser().parseFromString('<stree></stree>','text/xml');return e=this.root.xml(t,e),t.childNodes[0].appendChild(e),t},sre.SemanticTree.Node.prototype.xml=function(e,t){var a=function(a,n){for(var i,l=n.map(function(a){return a.xml(e,t)}),r=e.createElement(a),s=0;i=l[s];s++)r.appendChild(i);return r},n=e.createElement(this.type);return t||this.xmlAttributes_(n),n.textContent=this.textContent,0<this.contentNodes.length&&n.appendChild(a('content',this.contentNodes)),0<this.childNodes.length&&n.appendChild(a('children',this.childNodes)),n},sre.SemanticTree.prototype.toString=function(e){return new sre.SystemExternal.xmldom.XMLSerializer().serializeToString(this.xml(e))},sre.SemanticTree.prototype.formatXml=function(e){return e=this.toString(e),sre.SemanticTree.formatXml(e)},sre.SemanticTree.formatXml=function(e){var t=/(>)(<)(\/*)/g;e=e.replace(t,'$1\r\n$2$3'),t=/(>)(.+)(<c)/g,e=e.replace(t,'$1\r\n$2\r\n$3');var n='',i='';return e.split('\r\n').forEach(function(e){e.match(/.+<\/\w[^>]*>$/)?n+=i+e+'\r\n':e.match(/^<\/\w/)?i&&(i=i.slice(2),n+=i+e+'\r\n'):e.match(/^<\w[^>]*[^\/]>.*$/)?(n+=i+e+'\r\n',i+='  '):n+=i+e+'\r\n'}),n},sre.SemanticTree.Node.prototype.toString=function(e){var t=new sre.SystemExternal.xmldom.XMLSerializer,a=new sre.SystemExternal.xmldom.DOMParser().parseFromString('','text/xml');return t.serializeToString(this.xml(a,e))},sre.SemanticTree.Node.prototype.xmlAttributes_=function(e){e.setAttribute('role',this.role),this.font!=sre.SemanticAttr.Font.UNKNOWN&&e.setAttribute('font',this.font),this.embellished&&e.setAttribute('embellished',this.embellished),this.fencePointer&&e.setAttribute('fencepointer',this.fencePointer),this.bookmark&&e.setAttribute('bookmark',this.bookmark),e.setAttribute('id',this.id)},sre.SemanticTree.prototype.createNode_=function(){return new sre.SemanticTree.Node(this.idCounter_++)},sre.SemanticTree.prototype.replaceNode_=function(e,t){var a=e.parent;a?a.replaceChild_(e,t):this.root=t},sre.SemanticTree.Node.prototype.updateContent_=function(e){if(e=e.trim(),this.textContent!=e){var t=sre.SemanticAttr.lookupMeaning(e);this.textContent=e,this.role=t.role,this.type=t.type,this.font=t.font}},sre.SemanticTree.Node.prototype.addMathmlNodes_=function(e){for(var t,a=0;t=e[a];a++)-1==this.mathml.indexOf(t)&&this.mathml.push(t)},sre.SemanticTree.Node.prototype.removeMathmlNodes_=function(e){for(var t,a=this.mathml,n=0;t=e[n];n++)t=a.indexOf(t),-1!=t&&a.splice(t,1);this.mathml=a},sre.SemanticTree.Node.prototype.appendChild_=function(e){this.childNodes.push(e),this.addMathmlNodes_(e.mathml),e.parent=this},sre.SemanticTree.Node.prototype.replaceChild_=function(e,t){var a=this.childNodes.indexOf(e);if(-1!=a){e.parent=null,t.parent=this,this.childNodes[a]=t;var a=e.mathml.filter(function(e){return-1==t.mathml.indexOf(e)}),n=t.mathml.filter(function(t){return-1==e.mathml.indexOf(t)});this.removeMathmlNodes_(a),this.addMathmlNodes_(n)}},sre.SemanticTree.Node.prototype.appendContentNode_=function(e){e&&(this.contentNodes.push(e),this.addMathmlNodes_(e.mathml),e.parent=this)},sre.SemanticTree.Node.prototype.removeContentNode_=function(e){e&&(e=this.contentNodes.indexOf(e),-1!=e&&this.contentNodes.slice(e,1))},sre.SemanticTree.Node.prototype.equals=function(e){if(!e||this.type!==e.type||this.role!==e.role||this.textContent!==e.textContent||this.childNodes.length!==e.childNodes.length||this.contentNodes.length!==e.contentNodes.length)return!1;for(var t,n,i=0;t=this.childNodes[i],n=e.childNodes[i];i++)if(!t.equals(n))return!1;for(i=0;t=this.contentNodes[i],n=e.contentNodes[i];i++)if(!t.equals(n))return!1;return!0},sre.SemanticTree.prototype.parseMathml_=function(e){var t,a=sre.DomUtil.toArray(e.childNodes);switch(sre.SemanticUtil.tagName(e)){case'SEMANTICS':if(0<a.length){t=this.parseMathml_(a[0]);break}case'MATH':case'MROW':case'MPADDED':case'MSTYLE':return a=sre.SemanticUtil.purgeNodes(a),t=1==a.length?this.parseMathml_(a[0]):this.processRow_(this.parseMathmlChildren_(a)),t.mathml.unshift(e),t;case'MFRAC':sre.SemanticUtil.isZeroLength(e.getAttribute('linethickness'))?(t=this.makeBranchNode_(sre.SemanticAttr.Type.LINE,[this.parseMathml_(a[0])],[]),a=this.makeBranchNode_(sre.SemanticAttr.Type.LINE,[this.parseMathml_(a[1])],[]),t=this.makeBranchNode_(sre.SemanticAttr.Type.MULTILINE,[t,a],[])):t=this.makeFractionNode_(this.parseMathml_(a[0]),this.parseMathml_(a[1]));break;case'MSUB':case'MSUP':case'MSUBSUP':case'MOVER':case'MUNDER':case'MUNDEROVER':t=this.makeLimitNode_(sre.SemanticUtil.tagName(e),this.parseMathmlChildren_(a));break;case'MROOT':t=this.makeBranchNode_(sre.SemanticAttr.Type.ROOT,[this.parseMathml_(a[1]),this.parseMathml_(a[0])],[]);break;case'MSQRT':a=this.parseMathmlChildren_(sre.SemanticUtil.purgeNodes(a)),t=this.makeBranchNode_(sre.SemanticAttr.Type.SQRT,[this.processRow_(a)],[]);break;case'MTABLE':t=this.makeBranchNode_(sre.SemanticAttr.Type.TABLE,this.parseMathmlChildren_(a),[]),sre.SemanticTree.tableIsMultiline_(t)&&this.tableToMultiline_(t);break;case'MTR':t=this.makeBranchNode_(sre.SemanticAttr.Type.ROW,this.parseMathmlChildren_(a),[]),t.role=sre.SemanticAttr.Role.TABLE;break;case'MTD':a=this.parseMathmlChildren_(sre.SemanticUtil.purgeNodes(a)),t=this.makeBranchNode_(sre.SemanticAttr.Type.CELL,[this.processRow_(a)],[]),t.role=sre.SemanticAttr.Role.TABLE;break;case'MS':case'MTEXT':t=this.makeLeafNode_(e),t.type=sre.SemanticAttr.Type.TEXT,'MS'===sre.SemanticUtil.tagName(e)&&(t.role=sre.SemanticAttr.Role.STRING),sre.SemanticTree.exprFont_(t);break;case'MI':t=this.makeIdentifierNode_(e);break;case'MN':t=this.makeLeafNode_(e),(t.type==sre.SemanticAttr.Type.UNKNOWN||t.type==sre.SemanticAttr.Type.IDENTIFIER)&&(t.type=sre.SemanticAttr.Type.NUMBER),sre.SemanticTree.numberRole_(t),sre.SemanticTree.exprFont_(t);break;case'MO':t=this.makeLeafNode_(e),t.type==sre.SemanticAttr.Type.UNKNOWN&&(t.type=sre.SemanticAttr.Type.OPERATOR);break;case'MFENCED':t=this.processMfenced_(e,this.parseMathmlChildren_(sre.SemanticUtil.purgeNodes(a))),t=this.processTablesInRow_([t])[0];break;case'MENCLOSE':a=this.parseMathmlChildren_(sre.SemanticUtil.purgeNodes(a)),t=this.makeBranchNode_(sre.SemanticAttr.Type.ENCLOSE,[this.processRow_(a)],[]),t.role=e.getAttribute('notation')||sre.SemanticAttr.Role.UNKNOWN;break;case'MMULTISCRIPTS':t=this.processMultiScript_(a);break;case'NONE':t=this.makeEmptyNode_();break;default:t=this.makeUnprocessed_(e);}return t.mathml.unshift(e),t.mathmlTree=e,t},sre.SemanticTree.prototype.parseMathmlChildren_=function(e){for(var t,a=[],n=0;t=e[n];n++)a.push(this.parseMathml_(t));return a},sre.SemanticTree.prototype.makeUnprocessed_=function(e){var t=this.createNode_();return t.mathml=[e],t},sre.SemanticTree.prototype.makeEmptyNode_=function(){var e=this.createNode_();return e.type=sre.SemanticAttr.Type.EMPTY,e},sre.SemanticTree.prototype.makeContentNode_=function(e){var t=this.createNode_();return t.updateContent_(e),t},sre.SemanticTree.prototype.makeMultipleContentNodes_=function(e,t){for(var a=[],n=0;n<e;n++)a.push(this.makeContentNode_(t));return a},sre.SemanticTree.prototype.makeLeafNode_=function(e){if(!e.textContent)return this.makeEmptyNode_();var t=this.makeContentNode_(e.textContent);return t.font=e.getAttribute('mathvariant')||t.font,t.bookmark=e.getAttribute('bookmark')||0,t},sre.SemanticTree.prototype.makeBranchNode_=function(t,a,n,i){var l=this.createNode_();return i&&l.updateContent_(i),l.type=t,l.childNodes=a,l.contentNodes=n,l.contentNodes=n,a.concat(n).forEach(function(e){e.parent=l,l.addMathmlNodes_(e.mathml)}),l},sre.SemanticTree.prototype.makeIdentifierNode_=function(e){var t=this.makeLeafNode_(e),a=e.getAttribute('mathvariant');if('MathML-Unit'===e.getAttribute('class'))t.type=sre.SemanticAttr.Type.IDENTIFIER,t.role=sre.SemanticAttr.Role.UNIT;else if(!a&&1==t.textContent.length&&(t.role==sre.SemanticAttr.Role.INTEGER||t.role==sre.SemanticAttr.Role.LATINLETTER||t.role==sre.SemanticAttr.Role.GREEKLETTER)&&t.font==sre.SemanticAttr.Font.NORMAL)return t.font=sre.SemanticAttr.Font.ITALIC,t;return t.type==sre.SemanticAttr.Type.UNKNOWN&&(t.type=sre.SemanticAttr.Type.IDENTIFIER),sre.SemanticTree.exprFont_(t),t},sre.SemanticTree.prototype.makeImplicitNode_=function(e){if(e=this.getMixedNumbers_(e),e=this.combineUnits_(e),1==e.length)return e[0];var t=this.makeMultipleContentNodes_(e.length-1,sre.SemanticAttr.invisibleTimes()),n=this.makeInfixNode_(e,t[0]);return n.role=sre.SemanticAttr.Role.IMPLICIT,t.forEach(function(e){e.parent=n}),n.contentNodes=t,n},sre.SemanticTree.prototype.makeInfixNode_=function(e,t){var a=this.makeBranchNode_(sre.SemanticAttr.Type.INFIXOP,e,[t],sre.SemanticTree.getEmbellishedInner_(t).textContent);return a.bookmark=t.bookmark,a.role=t.role,a},sre.SemanticTree.prototype.makeConcatNode_=function(e,t,a){if(0==t.length)return e;var n=t.map(function(e){return sre.SemanticTree.getEmbellishedInner_(e).textContent}).join(' ');for(e=this.makeBranchNode_(a,[e],t,n),1<t.length&&(e.role=sre.SemanticAttr.Role.MULTIOP),n=a=0;n<t.length;n++)if(0!=t[n].bookmark){a=t[n].bookmark;break}return e.bookmark=a,e},sre.SemanticTree.prototype.makePrefixNode_=function(e,t){for(var a=sre.SemanticTree.partitionNodes_(t,sre.SemanticTree.attrPred_('role','SUBTRACTION')),n=this.makeConcatNode_(e,a.comp.pop(),sre.SemanticAttr.Type.PREFIXOP);0<a.rel.length;)n=this.makeConcatNode_(n,[a.rel.pop()],sre.SemanticAttr.Type.PREFIXOP),n.role=sre.SemanticAttr.Role.NEGATIVE,n=this.makeConcatNode_(n,a.comp.pop(),sre.SemanticAttr.Type.PREFIXOP);return n},sre.SemanticTree.prototype.makePostfixNode_=function(e,t){return t.length?this.makeConcatNode_(e,t,sre.SemanticAttr.Type.POSTFIXOP):e},sre.SemanticTree.prototype.processRow_=function(e){return(e=e.filter(function(e){return!sre.SemanticTree.attrPred_('type','EMPTY')(e)}),0==e.length)?this.makeEmptyNode_():(e=this.getFencesInRow_(e),e=this.processTablesInRow_(e),e=this.getPunctuationInRow_(e),e=this.getTextInRow_(e),e=this.getFunctionsInRow_(e),this.processRelationsInRow_(e))},sre.SemanticTree.prototype.combineUnits_=function(t){var a=sre.SemanticTree.partitionNodes_(t,function(e){return!sre.SemanticTree.attrPred_('role','UNIT')(e)});if(t.length===a.rel.length)return a.rel;t=[];do{var n=a.comp.shift(),i=a.rel.shift();if(1==n.length&&(t=t.concat(n)),1<n.length){var l=this.makeContentNode_(sre.SemanticAttr.invisibleTimes()),n=this.makeInfixNode_(n,l);n.role=sre.SemanticAttr.Role.UNIT,t.push(n)}i&&t.push(i)}while(i);return t},sre.SemanticTree.prototype.getMixedNumbers_=function(t){var a=sre.SemanticTree.partitionNodes_(t,function(e){return sre.SemanticTree.attrPred_('type','FRACTION')(e)&&sre.SemanticTree.attrPred_('role','VULGAR')(e)});if(!a.rel.length)return t;t=[];for(var n,i=0;n=a.rel[i];i++){var l=a.comp[i],e=l.length-1;l[e]&&sre.SemanticTree.attrPred_('type','NUMBER')(l[e])&&sre.SemanticTree.attrPred_('role','INTEGER')(l[e])?(n=this.makeBranchNode_(sre.SemanticAttr.Type.NUMBER,[l[e],n],[]),n.role=sre.SemanticAttr.Role.MIXED,t=t.concat(l.slice(0,e))):t=t.concat(l),t.push(n)}return t.concat(a.comp[a.comp.length-1])},sre.SemanticTree.prototype.getTextInRow_=function(e){if(1>=e.length)return e;var t=sre.SemanticTree.partitionNodes_(e,sre.SemanticTree.attrPred_('type','TEXT'));if(0==t.rel.length)return e;e=[];var a=t.comp[0];0<a.length&&e.push(this.processRow_(a));for(var n=0;a=t.rel[n];n++)e.push(a),a=t.comp[n+1],0<a.length&&e.push(this.processRow_(a));return[this.makeDummyNode_(e)]},sre.SemanticTree.prototype.processRelationsInRow_=function(e){var t=sre.SemanticTree.partitionNodes_(e,sre.SemanticTree.isRelation_),n=t.rel[0];return n?1==e.length?e[0]:(e=t.comp.map(goog.bind(this.processOperationsInRow_,this)),t.rel.some(function(e){return!e.equals(n)}))?this.makeBranchNode_(sre.SemanticAttr.Type.MULTIREL,e,t.rel):(t=this.makeBranchNode_(sre.SemanticAttr.Type.RELSEQ,e,t.rel,sre.SemanticTree.getEmbellishedInner_(n).textContent),t.role=n.role,t):this.processOperationsInRow_(e)},sre.SemanticTree.prototype.processOperationsInRow_=function(e){if(0==e.length)return this.makeEmptyNode_();if(1==e.length)return e[0];for(var t=[];0<e.length&&sre.SemanticTree.isOperator_(e[0]);)t.push(e.shift());return 0==e.length?this.makePrefixNode_(t.pop(),t):1==e.length?this.makePrefixNode_(e[0],t):(e=sre.SemanticTree.sliceNodes_(e,sre.SemanticTree.isOperator_),t=this.makePrefixNode_(this.makeImplicitNode_(e.head),t),e.div?this.makeOperationsTree_(e.tail,t,e.div):t)},sre.SemanticTree.prototype.makeOperationsTree_=function(e,t,a,n){return(n=n||[],0==e.length)?(n.unshift(a),t.type==sre.SemanticAttr.Type.INFIXOP?(n=this.makePostfixNode_(t.childNodes.pop(),n),t.appendChild_(n),t):this.makePostfixNode_(t,n)):(e=sre.SemanticTree.sliceNodes_(e,sre.SemanticTree.isOperator_),0==e.head.length)?(n.push(e.div),this.makeOperationsTree_(e.tail,t,a,n)):(n=this.makePrefixNode_(this.makeImplicitNode_(e.head),n),t=this.appendOperand_(t,a,n),e.div?this.makeOperationsTree_(e.tail,t,e.div,[]):t)},sre.SemanticTree.prototype.appendOperand_=function(e,t,a){return e.type==sre.SemanticAttr.Type.INFIXOP?this.appendExistingOperator_(e,t,a)?e:t.role==sre.SemanticAttr.Role.MULTIPLICATION?this.appendMultiplicativeOp_(e,t,a):this.appendAdditiveOp_(e,t,a):this.makeInfixNode_([e,a],t)},sre.SemanticTree.prototype.appendMultiplicativeOp_=function(t,a,n){if(t.role==sre.SemanticAttr.Role.IMPLICIT)return this.makeInfixNode_([t,n],a);for(var i=t,l=t.childNodes[t.childNodes.length-1];l&&l.type==sre.SemanticAttr.Type.INFIXOP;)i=l,l=i.childNodes[t.childNodes.length-1];return a=this.makeInfixNode_([i.childNodes.pop(),n],a),i.appendChild_(a),t},sre.SemanticTree.prototype.appendAdditiveOp_=function(e,t,a){return this.makeInfixNode_([e,a],t)},sre.SemanticTree.prototype.appendExistingOperator_=function(e,t,a){return e&&e.type==sre.SemanticAttr.Type.INFIXOP&&e.role!==sre.SemanticAttr.Role.IMPLICIT&&(e.contentNodes[0].equals(t)?(e.appendContentNode_(t),e.appendChild_(a),!0):this.appendExistingOperator_(e.childNodes[e.childNodes.length-1],t,a))},sre.SemanticTree.prototype.getFencesInRow_=function(e){e=sre.SemanticTree.partitionNodes_(e,sre.SemanticTree.isFence_),e=sre.SemanticTree.purgeFences_(e);var t=e.comp.shift();return this.processFences_(e.rel,e.comp,[],[t])},sre.SemanticTree.prototype.processFences_=function(t,a,n,i){if(0==t.length&&0==n.length)return i[0];var l=sre.SemanticTree.attrPred_('role','OPEN');if(0==t.length){for(t=i.shift();0<n.length;){if(l(n[0]))a=n.shift(),sre.SemanticTree.fenceToPunct_(a),t.push(a);else{n=sre.SemanticTree.sliceNodes_(n,l);var e=n.head.length-1,r=this.processNeutralFences_(n.head,i.slice(0,e));i=i.slice(e),t.push.apply(t,r),n.div&&n.tail.unshift(n.div),n=n.tail}t.push.apply(t,i.shift())}return t}return(e=n[n.length-1],r=t[0].role,r==sre.SemanticAttr.Role.OPEN||r==sre.SemanticAttr.Role.NEUTRAL&&(!e||t[0].textContent!=e.textContent))?(n.push(t.shift()),(l=a.shift())&&i.push(l),this.processFences_(t,a,n,i)):e&&(r==sre.SemanticAttr.Role.CLOSE&&e.role==sre.SemanticAttr.Role.OPEN||r==sre.SemanticAttr.Role.NEUTRAL&&t[0].textContent==e.textContent)?(l=this.makeHorizontalFencedNode_(n.pop(),t.shift(),i.pop()),i.push(i.pop().concat([l],a.shift())),this.processFences_(t,a,n,i)):e&&r==sre.SemanticAttr.Role.CLOSE&&e.role==sre.SemanticAttr.Role.NEUTRAL&&n.some(l)?(n=sre.SemanticTree.sliceNodes_(n,l,!0),l=i.pop(),e=i.length-n.tail.length+1,r=this.processNeutralFences_(n.tail,i.slice(e)),i=i.slice(0,e),l=this.makeHorizontalFencedNode_(n.div,t.shift(),i.pop().concat(r,l)),i.push(i.pop().concat([l],a.shift())),this.processFences_(t,a,n.head,i)):(l=t.shift(),sre.SemanticTree.fenceToPunct_(l),i.push(i.pop().concat([l],a.shift())),this.processFences_(t,a,n,i))},sre.SemanticTree.prototype.processNeutralFences_=function(t,a){if(0==t.length)return t;if(1==t.length)return sre.SemanticTree.fenceToPunct_(t[0]),t;var n=t.shift(),i=sre.SemanticTree.sliceNodes_(t,function(e){return e.textContent==n.textContent});if(!i.div){sre.SemanticTree.fenceToPunct_(n);var l=a.shift();return l.unshift(n),l.concat(this.processNeutralFences_(t,a))}var e=this.combineFencedContent_(n,i.div,i.head,a);return 0<i.tail.length?(l=e.shift(),i=this.processNeutralFences_(i.tail,e),l.concat(i)):e[0]},sre.SemanticTree.prototype.combineFencedContent_=function(t,a,n,i){if(0==n.length)return t=this.makeHorizontalFencedNode_(t,a,i.shift()),i.unshift(t),i;var l=i.shift(),e=n.length-1,r=i.slice(0,e);return i=i.slice(e),e=i.shift(),n=this.processNeutralFences_(n,r),l.push.apply(l,n),l.push.apply(l,e),t=this.makeHorizontalFencedNode_(t,a,l),0<i.length?i[0].unshift(t):i=[[t]],i},sre.SemanticTree.fenceToPunct_=function(e){var t;switch(e.role){case sre.SemanticAttr.Role.NEUTRAL:t=sre.SemanticAttr.Role.VBAR;break;case sre.SemanticAttr.Role.OPEN:t=sre.SemanticAttr.Role.OPENFENCE;break;case sre.SemanticAttr.Role.CLOSE:t=sre.SemanticAttr.Role.CLOSEFENCE;break;default:return;}for(;e.embellished;)e.embellished=sre.SemanticAttr.Type.PUNCTUATION,e.role=t,e=e.childNodes[0];e.type=sre.SemanticAttr.Type.PUNCTUATION,e.role=t},sre.SemanticTree.prototype.makeHorizontalFencedNode_=function(e,t,a){return a=this.processRow_(a),t=this.makeBranchNode_(sre.SemanticAttr.Type.FENCED,[a],[e,t]),t.role=e.role==sre.SemanticAttr.Role.OPEN?sre.SemanticAttr.Role.LEFTRIGHT:e.role,sre.SemanticTree.rewriteFencedNode_(t)},sre.SemanticTree.prototype.getPunctuationInRow_=function(e){var t=sre.SemanticTree.partitionNodes_(e,function(e){return sre.SemanticTree.isPunctuation_(e)&&!sre.SemanticTree.attrPred_('role','ELLIPSIS')(e)});if(0==t.rel.length)return e;e=[];var a=t.comp.shift();0<a.length&&e.push(this.processRow_(a));for(var n=0;0<t.comp.length;)e.push(t.rel[n++]),a=t.comp.shift(),0<a.length&&e.push(this.processRow_(a));return[this.makePunctuatedNode_(e,t.rel)]},sre.SemanticTree.prototype.makePunctuatedNode_=function(e,t){var a=this.makeBranchNode_(sre.SemanticAttr.Type.PUNCTUATED,e,t);if(t.length==e.length){var n=t[0].role;if(n!=sre.SemanticAttr.Role.UNKNOWN&&t.every(function(e){return e.role==n}))return a.role=n,a}return a.role=1==t.length&&e[0].type==sre.SemanticAttr.Type.PUNCTUATION?sre.SemanticAttr.Role.STARTPUNCT:1==t.length&&e[e.length-1].type==sre.SemanticAttr.Type.PUNCTUATION?sre.SemanticAttr.Role.ENDPUNCT:t.every(sre.SemanticTree.attrPred_('role','DUMMY'))?sre.SemanticAttr.Role.TEXT:sre.SemanticAttr.Role.SEQUENCE,a},sre.SemanticTree.prototype.makeDummyNode_=function(e){var t=this.makeMultipleContentNodes_(e.length-1,sre.SemanticAttr.invisibleComma());return t.forEach(function(e){e.role=sre.SemanticAttr.Role.DUMMY}),this.makePunctuatedNode_(e,t)},sre.SemanticTree.prototype.makeLimitNode_=function(t,a){var n=a[0],i=sre.SemanticTree.attrPred_('type','FUNCTION')(n),i=sre.SemanticTree.attrPred_('type','LARGEOP')(n)||sre.SemanticTree.attrPred_('type','LIMBOTH')(n)||sre.SemanticTree.attrPred_('type','LIMLOWER')(n)||sre.SemanticTree.attrPred_('type','LIMUPPER')(n)||i&&sre.SemanticTree.attrPred_('role','LIMFUNC')(n),l=sre.SemanticAttr.Type.UNKNOWN;if(i)'MSUB'===t||'MUNDER'===t?l=sre.SemanticAttr.Type.LIMLOWER:'MSUP'===t||'MOVER'===t?l=sre.SemanticAttr.Type.LIMUPPER:'MSUBSUP'===t||'MUNDEROVER'===t?l=sre.SemanticAttr.Type.LIMBOTH:void 0;else switch(t){case'MSUB':l=sre.SemanticAttr.Type.SUBSCRIPT;break;case'MSUP':l=sre.SemanticAttr.Type.SUPERSCRIPT;break;case'MSUBSUP':var e=this.makeBranchNode_(sre.SemanticAttr.Type.SUBSCRIPT,[n,a[1]],[]);e.role=sre.SemanticAttr.Role.SUBSUP,a=[e,a[2]],l=sre.SemanticAttr.Type.SUPERSCRIPT;break;case'MOVER':l=sre.SemanticAttr.Type.OVERSCORE,sre.SemanticTree.isAccent_(a[1])&&(a[1].role=sre.SemanticAttr.Role.OVERACCENT);break;case'MUNDER':l=sre.SemanticAttr.Type.UNDERSCORE,sre.SemanticTree.isAccent_(a[1])&&(a[1].role=sre.SemanticAttr.Role.UNDERACCENT);break;default:e=sre.SemanticTree.isAccent_(a[1]),i=sre.SemanticTree.isAccent_(a[2]),e&&(a[1].role=sre.SemanticAttr.Role.UNDERACCENT),i&&(a[2].role=sre.SemanticAttr.Role.OVERACCENT),i&&!e?(e=this.makeBranchNode_(sre.SemanticAttr.Type.OVERSCORE,[n,a[2]],[]),e.role=n.role,a=[e,a[1]],l=sre.SemanticAttr.Type.UNDERSCORE):(e=this.makeBranchNode_(sre.SemanticAttr.Type.UNDERSCORE,[n,a[1]],[]),e.role=n.role,a=[e,a[2]],l=sre.SemanticAttr.Type.OVERSCORE);}return i=this.makeBranchNode_(l,a,[]),l=sre.SemanticTree.isEmbellished_(n),e&&(e.embellished=l),i.embellished=l,i.role=n.role,i},sre.SemanticTree.isAccent_=function(e){return sre.SemanticTree.attrPred_('type','FENCE')(e)||sre.SemanticTree.attrPred_('type','PUNCTUATION')(e)||sre.SemanticTree.attrPred_('type','OPERATOR')(e)||sre.SemanticTree.attrPred_('type','RELATION')(e)||sre.SemanticTree.attrPred_('type','IDENTIFIER')(e)&&sre.SemanticTree.attrPred_('role','UNKNOWN')(e)&&!e.textContent.match(new RegExp(sre.SemanticAttr.getInstance().allLetters.join('|')))},sre.SemanticTree.prototype.getFunctionsInRow_=function(t,a){var n=a||[];if(0==t.length)return n;var i=t.shift(),l=sre.SemanticTree.classifyFunction_(i,t);if(!l)return n.push(i),this.getFunctionsInRow_(t,n);var r=this.getFunctionsInRow_(t,[]),i=this.getFunctionArgs_(i,r,l);return n.concat(i)},sre.SemanticTree.classifyFunction_=function(e,t){if(e.type==sre.SemanticAttr.Type.APPL||e.type==sre.SemanticAttr.Type.BIGOP||e.type==sre.SemanticAttr.Type.INTEGRAL)return'';if(t[0]&&t[0].textContent==sre.SemanticAttr.functionApplication()){t.shift();var a=sre.SemanticAttr.Role.SIMPLEFUNC;return(e.role===sre.SemanticAttr.Role.PREFIXFUNC||e.role===sre.SemanticAttr.Role.LIMFUNC)&&(a=e.role),sre.SemanticTree.propagateFunctionRole_(e,a),'prefix'}switch(e.role){case sre.SemanticAttr.Role.INTEGRAL:return'integral';case sre.SemanticAttr.Role.SUM:return'bigop';case sre.SemanticAttr.Role.PREFIXFUNC:case sre.SemanticAttr.Role.LIMFUNC:return'prefix';default:if(e.type==sre.SemanticAttr.Type.IDENTIFIER||e.role==sre.SemanticAttr.Role.LATINLETTER||e.role==sre.SemanticAttr.Role.GREEKLETTER||e.role==sre.SemanticAttr.Role.OTHERLETTER)return'simple';}return''},sre.SemanticTree.propagateFunctionRole_=function(e,t){e&&(sre.SemanticTree.attrPred_('role','SUBSUP')(e)||(e.role=t),sre.SemanticTree.propagateFunctionRole_(e.childNodes[0],t))},sre.SemanticTree.prototype.getFunctionArgs_=function(e,t,a){switch(a){case'integral':t=this.getIntegralArgs_(t);var n=this.processRow_(t.integrand);return e=this.makeIntegralNode_(e,n,t.intvar),t.rest.unshift(e),t.rest;case'prefix':if(t[0]&&t[0].type==sre.SemanticAttr.Type.FENCED)return e=this.makeFunctionNode_(e,t.shift()),t.unshift(e),t;case'bigop':return(n=sre.SemanticTree.sliceNodes_(t,sre.SemanticTree.prefixFunctionBoundary_),!n.head.length)?(t.unshift(e),t):(t=this.processRow_(n.head),e='prefix'==a?this.makeFunctionNode_(e,t):this.makeBigOpNode_(e,t),n.div&&n.tail.unshift(n.div),n.tail.unshift(e),n.tail);default:return 0==t.length?[e]:(n=t[0],n.type==sre.SemanticAttr.Type.FENCED&&n.role!=sre.SemanticAttr.Role.NEUTRAL&&this.simpleFunctionHeuristic_(n))?(sre.SemanticTree.propagateFunctionRole_(e,sre.SemanticAttr.Role.SIMPLEFUNC),e=this.makeFunctionNode_(e,t.shift()),t.unshift(e),t):(t.unshift(e),t);}},sre.SemanticTree.prototype.getIntegralArgs_=function(t,n){var i=n||[];if(0==t.length)return{integrand:i,intvar:null,rest:t};var l=t[0];if(sre.SemanticTree.generalFunctionBoundary_(l))return{integrand:i,intvar:null,rest:t};if(sre.SemanticTree.integralDxBoundarySingle_(l))return{integrand:i,intvar:l,rest:t.slice(1)};if(t[1]&&sre.SemanticTree.integralDxBoundary_(l,t[1])){var r=this.makeContentNode_(sre.SemanticAttr.invisibleComma()),l=this.makePunctuatedNode_([l,r,t[1]],[r]);return l.role=sre.SemanticAttr.Role.INTEGRAL,{integrand:i,intvar:l,rest:t.slice(2)}}return i.push(t.shift()),this.getIntegralArgs_(t,i)},sre.SemanticTree.prototype.makeFunctionNode_=function(e,t){var a=this.makeContentNode_(sre.SemanticAttr.functionApplication());a.type=sre.SemanticAttr.Type.PUNCTUATION,a.role=sre.SemanticAttr.Role.APPLICATION;var n=sre.SemanticTree.getFunctionOp_(e,function(e){return sre.SemanticTree.attrPred_('type','FUNCTION')(e)||sre.SemanticTree.attrPred_('type','IDENTIFIER')(e)&&sre.SemanticTree.attrPred_('role','SIMPLEFUNC')(e)});return this.makeFunctionalNode_(sre.SemanticAttr.Type.APPL,[e,t],n,[a])},sre.SemanticTree.prototype.makeBigOpNode_=function(e,t){var a=sre.SemanticTree.getFunctionOp_(e,sre.SemanticTree.attrPred_('type','LARGEOP'));return this.makeFunctionalNode_(sre.SemanticAttr.Type.BIGOP,[e,t],a,[])},sre.SemanticTree.prototype.makeIntegralNode_=function(e,t,a){t=t||this.makeEmptyNode_(),a=a||this.makeEmptyNode_();var n=sre.SemanticTree.getFunctionOp_(e,sre.SemanticTree.attrPred_('type','LARGEOP'));return this.makeFunctionalNode_(sre.SemanticAttr.Type.INTEGRAL,[e,t,a],n,[])},sre.SemanticTree.prototype.makeFunctionalNode_=function(t,a,n,i){var l=a[0];if(n){var e=n.parent;i.push(n)}return t=this.makeBranchNode_(t,a,i),t.role=l.role,e&&(n.parent=e),t},sre.SemanticTree.getFunctionOp_=function(e,t){if(t(e))return e;for(var a,n=0;a=e.childNodes[n];n++)if(a=sre.SemanticTree.getFunctionOp_(a,t))return a;return null},sre.SemanticTree.prototype.simpleFunctionHeuristic_=function(e){return!(e=e.childNodes,0!=e.length)||!(1<e.length)&&(e=e[0],e.type==sre.SemanticAttr.Type.INFIXOP&&(e.role!=sre.SemanticAttr.Role.IMPLICIT||e.childNodes.some(sre.SemanticTree.attrPred_('type','INFIXOP')))?!1:!0)},sre.SemanticTree.prefixFunctionBoundary_=function(e){return sre.SemanticTree.isOperator_(e)||sre.SemanticTree.generalFunctionBoundary_(e)},sre.SemanticTree.integralDxBoundary_=function(e,t){return!!t&&sre.SemanticTree.attrPred_('type','IDENTIFIER')(t)&&sre.SemanticAttr.isCharacterD(e.textContent)},sre.SemanticTree.integralDxBoundarySingle_=function(e){if(sre.SemanticTree.attrPred_('type','IDENTIFIER')(e)){var t=e.textContent[0];return t&&e.textContent[1]&&sre.SemanticAttr.isCharacterD(t)}return!1},sre.SemanticTree.generalFunctionBoundary_=function(e){return sre.SemanticTree.isRelation_(e)||sre.SemanticTree.isPunctuation_(e)},sre.SemanticTree.prototype.processTablesInRow_=function(t){t=sre.SemanticTree.partitionNodes_(t,sre.SemanticTree.tableIsMatrixOrVector_);for(var a,n=[],i=0;a=t.rel[i];i++)n=n.concat(t.comp.shift()),n.push(this.tableToMatrixOrVector_(a));for(n=n.concat(t.comp.shift()),t=sre.SemanticTree.partitionNodes_(n,sre.SemanticTree.isTableOrMultiline_),n=[],i=0;a=t.rel[i];i++){var l=t.comp.shift();sre.SemanticTree.tableIsCases_(a,l)&&this.tableToCases_(a,l.pop()),n=n.concat(l),n.push(a)}return n.concat(t.comp.shift())},sre.SemanticTree.isTableOrMultiline_=function(e){return!!e&&(sre.SemanticTree.attrPred_('type','TABLE')(e)||sre.SemanticTree.attrPred_('type','MULTILINE')(e))},sre.SemanticTree.tableIsMatrixOrVector_=function(e){return!!e&&sre.SemanticTree.attrPred_('type','FENCED')(e)&&(sre.SemanticTree.attrPred_('role','LEFTRIGHT')(e)||sre.SemanticTree.attrPred_('role','NEUTRAL')(e))&&1==e.childNodes.length&&sre.SemanticTree.isTableOrMultiline_(e.childNodes[0])},sre.SemanticTree.prototype.tableToMatrixOrVector_=function(e){var t=e.childNodes[0];sre.SemanticTree.attrPred_('type','MULTILINE')(t)?this.tableToVector_(e):this.tableToMatrix_(e),e.contentNodes.forEach(goog.bind(t.appendContentNode_,t)),e=0;for(var a;a=t.childNodes[e];e++)sre.SemanticTree.assignRoleToRow_(a,sre.SemanticTree.getComponentRoles_(t));return t.parent=null,t},sre.SemanticTree.prototype.tableToVector_=function(e){var t=e.childNodes[0];t.type=sre.SemanticAttr.Type.VECTOR,1===t.childNodes.length?this.tableToSquare_(e):2===t.childNodes.length&&(t.role=sre.SemanticAttr.Role.BINOMIAL)},sre.SemanticTree.prototype.tableToMatrix_=function(e){var t=e.childNodes[0];t.type=sre.SemanticAttr.Type.MATRIX,t.childNodes&&0<t.childNodes.length&&t.childNodes[0].childNodes&&t.childNodes.length===t.childNodes[0].childNodes.length?this.tableToSquare_(e):t.childNodes&&1===t.childNodes.length&&(t.role=sre.SemanticAttr.Role.ROWVECTOR)},sre.SemanticTree.prototype.tableToSquare_=function(e){var t=e.childNodes[0];t.role=sre.SemanticTree.attrPred_('role','NEUTRAL')(e)?sre.SemanticAttr.Role.DETERMINANT:sre.SemanticAttr.Role.SQUAREMATRIX},sre.SemanticTree.getComponentRoles_=function(e){var t=e.role;return t&&t!==sre.SemanticAttr.Role.UNKNOWN?t:sre.SemanticAttr.Role[e.type.toUpperCase()]||sre.SemanticAttr.Role.UNKNOWN},sre.SemanticTree.tableIsCases_=function(e,t){return 0<t.length&&sre.SemanticTree.attrPred_('role','OPENFENCE')(t[t.length-1])},sre.SemanticTree.prototype.tableToCases_=function(e,t){for(var a,n=0;a=e.childNodes[n];n++)sre.SemanticTree.assignRoleToRow_(a,sre.SemanticAttr.Role.CASES);return e.type=sre.SemanticAttr.Type.CASES,e.appendContentNode_(t),e},sre.SemanticTree.tableIsMultiline_=function(e){return e.childNodes.every(function(e){return 1>=e.childNodes.length})},sre.SemanticTree.prototype.tableToMultiline_=function(e){e.type=sre.SemanticAttr.Type.MULTILINE;for(var t,a=0;t=e.childNodes[a];a++)sre.SemanticTree.rowToLine_(t,sre.SemanticAttr.Role.MULTILINE)},sre.SemanticTree.rowToLine_=function(e,t){var a=t||sre.SemanticAttr.Role.UNKNOWN;sre.SemanticTree.attrPred_('type','ROW')(e)&&1==e.childNodes.length&&sre.SemanticTree.attrPred_('type','CELL')(e.childNodes[0])&&(e.type=sre.SemanticAttr.Type.LINE,e.role=a,e.childNodes=e.childNodes[0].childNodes)},sre.SemanticTree.assignRoleToRow_=function(e,t){if(sre.SemanticTree.attrPred_('type','LINE')(e))e.role=t;else if(sre.SemanticTree.attrPred_('type','ROW')(e)){e.role=t;var n=sre.SemanticTree.attrPred_('type','CELL');e.childNodes.forEach(function(e){n(e)&&(e.role=t)})}},sre.SemanticTree.sliceNodes_=function(t,a,n){n&&t.reverse();for(var i,l=[],r=0;i=t[r];r++){if(a(i))return n?{head:t.slice(r+1).reverse(),div:i,tail:l.reverse()}:{head:l,div:i,tail:t.slice(r+1)};l.push(i)}return n?{head:[],div:null,tail:l.reverse()}:{head:l,div:null,tail:[]}},sre.SemanticTree.partitionNodes_=function(t,a){var n=t,i=[],l=[];do{var r=sre.SemanticTree.sliceNodes_(n,a);l.push(r.head),i.push(r.div),n=r.tail}while(r.div);return i.pop(),{rel:i,comp:l}},sre.SemanticTree.attrPred_=function(e,t){return function(a){a=a[e];var n;a:n='role'===e?sre.SemanticAttr.Role[t]:'font'===e?sre.SemanticAttr.Font[t]:sre.SemanticAttr.Type[t];return a==n}},sre.SemanticTree.prototype.processMfenced_=function(t,a){var n=sre.SemanticTree.getAttribute_(t,'separators',','),i=sre.SemanticTree.getAttribute_(t,'open','('),l=sre.SemanticTree.getAttribute_(t,'close',')');if(n&&0<a.length){var e=sre.MathUtil.nextSeparatorFunction(n),r=[a.shift()];a.forEach(goog.bind(function(t){r.push(this.makeContentNode_(e())),r.push(t)},this)),a=r}return i&&l?this.makeHorizontalFencedNode_(this.makeContentNode_(i),this.makeContentNode_(l),a):(i&&a.unshift(this.makeContentNode_(i)),l&&a.push(this.makeContentNode_(l)),this.processRow_(a))},sre.SemanticTree.getAttribute_=function(e,t,a){return e.hasAttribute(t)?(e=e.getAttribute(t),e.match(/^\s*$/)?null:e):a},sre.SemanticTree.numberRole_=function(e){if(e.role===sre.SemanticAttr.Role.UNKNOWN){var t=sre.SemanticUtil.splitUnicode(e.textContent).map(sre.SemanticAttr.lookupMeaning);e.role=t.every(function(e){return e.type==sre.SemanticAttr.Type.NUMBER&&e.role==sre.SemanticAttr.Role.INTEGER||e.type==sre.SemanticAttr.Type.PUNCTUATION&&e.role==sre.SemanticAttr.Role.COMMA})?sre.SemanticAttr.Role.INTEGER:t.every(function(e){return e.type==sre.SemanticAttr.Type.NUMBER&&e.role==sre.SemanticAttr.Role.INTEGER||e.type==sre.SemanticAttr.Type.PUNCTUATION})?sre.SemanticAttr.Role.FLOAT:sre.SemanticAttr.Role.OTHERNUMBER}},sre.SemanticTree.exprFont_=function(e){if(e.font===sre.SemanticAttr.Font.UNKNOWN){var t=sre.SemanticUtil.splitUnicode(e.textContent).map(sre.SemanticAttr.lookupMeaning).reduce(function(e,t){return e&&t.font&&t.font!=sre.SemanticAttr.Font.UNKNOWN&&t.font!=e?e==sre.SemanticAttr.Font.UNKNOWN?t.font:null:e},sre.SemanticAttr.Font.UNKNOWN);t&&(e.font=t)}},sre.SemanticTree.prototype.makeFractionNode_=function(e,t){var a=this.makeBranchNode_(sre.SemanticAttr.Type.FRACTION,[e,t],[]);return a.role=a.childNodes.every(function(e){return sre.SemanticTree.attrPred_('role','INTEGER')(e)})?sre.SemanticAttr.Role.VULGAR:a.childNodes.every(function(e){return sre.SemanticTree.attrPred_('role','UNIT')(e)})?sre.SemanticAttr.Role.UNIT:sre.SemanticAttr.Role.DIVISION,a},sre.SemanticTree.prototype.processMultiScript_=function(t){if(!t.length)return this.makeEmptyNode_();var a=this.parseMathml_(t.shift());if(!t.length)return a;for(var n,i=[],l=[],r=[],e=[],s=!1,o=0,c=0;n=t[c];c++)'MPRESCRIPTS'===sre.SemanticUtil.tagName(n)?(s=!0,o=0):(s?1&o?i.push(n):l.push(n):1&o?r.push(n):e.push(n),o++);return sre.SemanticUtil.purgeNodes(i).length||sre.SemanticUtil.purgeNodes(l).length?(r=this.makeBranchNode_(sre.SemanticAttr.Type.TENSOR,[a,this.makeScriptNode_(l,sre.SemanticAttr.Role.LEFTSUB),this.makeScriptNode_(i,sre.SemanticAttr.Role.LEFTSUPER),this.makeScriptNode_(e,sre.SemanticAttr.Role.RIGHTSUB),this.makeScriptNode_(r,sre.SemanticAttr.Role.RIGHTSUPER)],[]),r.role=a.role,r.embellished=sre.SemanticTree.isEmbellished_(a),r):(t=sre.SemanticUtil.purgeNodes(r),i=sre.SemanticUtil.purgeNodes(e),!t.length&&!i.length)?a:(l=i.length?t.length?'MSUBSUP':'MSUB':'MSUP',a=[a],i.length&&a.push(this.makeScriptNode_(e,sre.SemanticAttr.Role.RIGHTSUB,!0)),t.length&&a.push(this.makeScriptNode_(r,sre.SemanticAttr.Role.RIGHTSUPER,!0)),this.makeLimitNode_(l,a))},sre.SemanticTree.prototype.makeScriptNode_=function(e,t,a){switch(e.length){case 0:e=this.makeEmptyNode_();break;case 1:if(e=this.parseMathml_(e[0]),a)return e;break;default:e=this.makeDummyNode_(this.parseMathmlChildren_(e));}return e.role=t,e},sre.SemanticTree.isEmbellished_=function(e){return e.embellished?e.embellished:sre.SemanticAttr.isEmbellishedType(e.type)?e.type:null},sre.SemanticTree.isOperator_=function(e){return sre.SemanticTree.attrPred_('type','OPERATOR')(e)||sre.SemanticTree.attrPred_('embellished','OPERATOR')(e)},sre.SemanticTree.isRelation_=function(e){return sre.SemanticTree.attrPred_('type','RELATION')(e)||sre.SemanticTree.attrPred_('embellished','RELATION')(e)},sre.SemanticTree.isPunctuation_=function(e){return sre.SemanticTree.attrPred_('type','PUNCTUATION')(e)||sre.SemanticTree.attrPred_('embellished','PUNCTUATION')(e)},sre.SemanticTree.isFence_=function(e){return sre.SemanticTree.attrPred_('type','FENCE')(e)||sre.SemanticTree.attrPred_('embellished','FENCE')(e)},sre.SemanticTree.getEmbellishedInner_=function(e){return e&&e.embellished&&0<e.childNodes.length?sre.SemanticTree.getEmbellishedInner_(e.childNodes[0]):e},sre.SemanticTree.purgeFences_=function(t){var a=t.rel;t=t.comp;for(var n=[],i=[];0<a.length;){var l=a.shift(),e=t.shift();sre.SemanticTree.isElligibleFence_(l)?(n.push(l),i.push(e)):(sre.SemanticTree.fenceToPunct_(l),e.push(l),e=e.concat(t.shift()),t.unshift(e))}return i.push(t.shift()),{rel:n,comp:i}},sre.SemanticTree.isElligibleFence_=function(e){if(!e||!sre.SemanticTree.isFence_(e))return!1;if(!e.embellished)return!0;var t=function(e){return!e.embellished||(!(!sre.SemanticTree.attrPred_('type','TENSOR')(e)||sre.SemanticTree.attrPred_('type','EMPTY')(e.childNodes[1])&&sre.SemanticTree.attrPred_('type','EMPTY')(e.childNodes[2])||sre.SemanticTree.attrPred_('type','EMPTY')(e.childNodes[3])&&sre.SemanticTree.attrPred_('type','EMPTY')(e.childNodes[4]))||sre.SemanticTree.attrPred_('role','CLOSE')(e)&&sre.SemanticTree.attrPred_('type','TENSOR')(e)||sre.SemanticTree.attrPred_('role','OPEN')(e)&&(sre.SemanticTree.attrPred_('type','SUBSCRIPT')(e)||sre.SemanticTree.attrPred_('type','SUPERSCRIPT')(e))?!1:t(e.childNodes[0]))};return t(e)},sre.SemanticTree.rewriteFencedNode_=function(e){var t=e.contentNodes[1],a=sre.SemanticTree.rewriteFence_(e,e.contentNodes[0]);return e.contentNodes[0]=a.fence,a=sre.SemanticTree.rewriteFence_(a.node,t),e.contentNodes[1]=a.fence,e.contentNodes[0].parent=e,e.contentNodes[1].parent=e,a.node.parent=null,a.node},sre.SemanticTree.rewriteFence_=function(e,t){if(!t.embellished)return{node:e,fence:t};var n=t.childNodes[0],i=sre.SemanticTree.rewriteFence_(e,n);return sre.SemanticTree.attrPred_('type','SUPERSCRIPT')(t)||sre.SemanticTree.attrPred_('type','SUBSCRIPT')(t)||sre.SemanticTree.attrPred_('type','TENSOR')(t)?(sre.SemanticTree.attrPred_('role','SUBSUP')(t)||(t.role=e.role),n!==i.node&&(t.replaceChild_(n,i.node),n.parent=e),sre.SemanticTree.propagateFencePointer_(t,n),{node:t,fence:i.fence}):(t.replaceChild_(n,i.fence),t.mathmlTree&&-1===t.mathml.indexOf(t.mathmlTree)&&t.mathml.push(t.mathmlTree),{node:i.node,fence:t})},sre.SemanticTree.propagateFencePointer_=function(e,t){e.fencePointer=t.fencePointer||t.id.toString(),e.embellished=null},sre.SemanticTree.prototype.displayTree=function(){this.root.displayTree(0)},sre.SemanticTree.Node.prototype.displayTree=function(e){e++;var t=Array(e).join('  ');console.log(t+this.toString()),console.log(t+'MathmlTree:'),console.log(t+this.mathmlTreeString_()),console.log(t+'MathML:');for(var a,n=0;a=this.mathml[n];n++)console.log(t+a.toString());console.log(t+'Begin Content'),this.contentNodes.forEach(function(t){t.displayTree(e)}),console.log(t+'End Content'),console.log(t+'Begin Children'),this.childNodes.forEach(function(t){t.displayTree(e)}),console.log(t+'End Children')},sre.SemanticTree.Node.prototype.mathmlTreeString_=function(){return this.mathmlTree?this.mathmlTree.toString():'EMPTY'},sre.Semantic={},sre.Semantic.Font=sre.SemanticAttr.Font,sre.Semantic.Role=sre.SemanticAttr.Role,sre.Semantic.Type=sre.SemanticAttr.Type,sre.Semantic.getTree=function(e){return new sre.SemanticTree(e).xml()},sre.Semantic.getTreeFromString=function(e){return e=sre.DomUtil.parseInput(e),new sre.SemanticTree(e)},sre.MathspeakUtil={},sre.MathspeakUtil.spaceoutText=function(e){return e.textContent.split('').join(' ')},sre.MathspeakUtil.spaceoutNumber=function(t){t=t.textContent.split('');for(var a,e=[],n=new sre.SystemExternal.xmldom.DOMParser,i=0;a=t[i];i++){var l=sre.Semantic.Type.NUMBER,r=a.match(/\W/)?sre.Semantic.Role.UNKNOWN:sre.Semantic.Role.PROTECTED;a=n.parseFromString('<'+l+' role="'+r+'">'+a+'</'+l+'>','text/xml'),e.push(a.documentElement)}return e},sre.MathspeakUtil.spaceoutIdentifier=function(t){var a=t.textContent;if(!a.match(/[a-zA-Z]+/))return t.setAttribute('role',sre.SemanticAttr.Role.PROTECTED),[t];t=a.split('');for(var n,e,a=[],i=new sre.SystemExternal.xmldom.DOMParser,l=0;n=t[l];l++)e=sre.Semantic.Type.IDENTIFIER,n=i.parseFromString('<'+e+' role="'+sre.Semantic.Role.UNKNOWN+'">'+n+'</'+e+'>','text/xml'),a.push(n.documentElement);return a},sre.MathspeakUtil.nestingBarriers=[sre.Semantic.Type.CASES,sre.Semantic.Type.CELL,sre.Semantic.Type.INTEGRAL,sre.Semantic.Type.LINE,sre.Semantic.Type.MATRIX,sre.Semantic.Type.MULTILINE,sre.Semantic.Type.OVERSCORE,sre.Semantic.Type.ROOT,sre.Semantic.Type.ROW,sre.Semantic.Type.SQRT,sre.Semantic.Type.SUBSCRIPT,sre.Semantic.Type.SUPERSCRIPT,sre.Semantic.Type.TABLE,sre.Semantic.Type.UNDERSCORE,sre.Semantic.Type.VECTOR],sre.MathspeakUtil.nestingDepth={},sre.MathspeakUtil.getNestingDepth=function(t,a,n,i,l,e){return(i=i||sre.MathspeakUtil.nestingBarriers,l=l||{},e=e||function(){return!1},sre.MathspeakUtil.nestingDepth[t]||(sre.MathspeakUtil.nestingDepth[t]={}),sre.MathspeakUtil.nestingDepth[t][a.toString()])?sre.MathspeakUtil.nestingDepth[t][a.toString()]:e(a)||0>n.indexOf(a.tagName)?0:(n=sre.MathspeakUtil.computeNestingDepth_(a,n,sre.MathUtil.setdifference(i,n),l,e,0),sre.MathspeakUtil.nestingDepth[t][a.toString()]=n)},sre.MathspeakUtil.containsAttr=function(t,a){if(!t.attributes)return!1;for(var n,e=sre.DomUtil.toArray(t.attributes),i=0;n=e[i];i++)if(a[n.nodeName]===n.nodeValue)return!0;return!1},sre.MathspeakUtil.computeNestingDepth_=function(t,n,i,l,r,e){return r(t)||-1<i.indexOf(t.tagName)||sre.MathspeakUtil.containsAttr(t,l)?e:(-1<n.indexOf(t.tagName)&&e++,!t.childNodes||0===t.childNodes.length)?e:(t=sre.DomUtil.toArray(t.childNodes),Math.max.apply(null,t.map(function(t){return sre.MathspeakUtil.computeNestingDepth_(t,n,i,l,r,e)})))},sre.MathspeakUtil.fractionNestingDepth=function(e){return sre.MathspeakUtil.getNestingDepth('fraction',e,['fraction'],sre.MathspeakUtil.nestingBarriers,{},function(e){return sre.MathspeakUtil.vulgarFractionSmall(e)})},sre.MathspeakUtil.openingFractionVerbose=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),Array(e+1).join('Start')+'Fraction'},sre.MathspeakUtil.closingFractionVerbose=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),Array(e+1).join('End')+'Fraction'},sre.MathspeakUtil.overFractionVerbose=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),Array(e+1).join('Over')},sre.MathspeakUtil.openingFractionBrief=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),Array(e+1).join('Start')+'Frac'},sre.MathspeakUtil.closingFractionBrief=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),Array(e+1).join('End')+'Frac'},sre.MathspeakUtil.nestingToString=function(e){return 1===e?'':2===e?'Twice':e.toString()},sre.MathspeakUtil.openingFractionSbrief=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),1===e?'Frac':'Nest'+sre.MathspeakUtil.nestingToString(e-1)+'Frac'},sre.MathspeakUtil.closingFractionSbrief=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),1===e?'EndFrac':'Nest'+sre.MathspeakUtil.nestingToString(e-1)+'EndFrac'},sre.MathspeakUtil.overFractionSbrief=function(e){return e=sre.MathspeakUtil.fractionNestingDepth(e),1===e?'Over':'Nest'+sre.MathspeakUtil.nestingToString(e-1)+'Over'},sre.MathspeakUtil.onesNumbers=['','one','two','three','four','five','six','seven','eight','nine','ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen'],sre.MathspeakUtil.tensNumbers=['','','twenty','thirty','forty','fifty','sixty','seventy','eighty','ninety'],sre.MathspeakUtil.largeNumbers=['','thousand','million','billion','trillion','quadrillion','quintillion','sextillion','septillion','octillion','nonillion','decillion'],sre.MathspeakUtil.hundredsToWords=function(e){var t=Math.floor;e%=1E3;var a;return a=''+(sre.MathspeakUtil.onesNumbers[t(e/100)]?sre.MathspeakUtil.onesNumbers[t(e/100)]+'-hundred':''),(e%=100)&&(a=a+(a?'-':'')+(sre.MathspeakUtil.onesNumbers[e]||sre.MathspeakUtil.tensNumbers[t(e/10)]+'-'+sre.MathspeakUtil.onesNumbers[e%10])),a},sre.MathspeakUtil.numberToWords=function(e){if(1e+36<=e)return e.toString();for(var t=0,a='';0<e;)e%1E3&&(a=sre.MathspeakUtil.hundredsToWords(e%1E3)+(t?'-'+sre.MathspeakUtil.largeNumbers[t]+'-':'')+a),e=Math.floor(e/1E3),t++;return a},sre.MathspeakUtil.numberToOrdinal=function(e,t){if(2===e)return t?'halves':'half';var a=sre.MathspeakUtil.numberToWords(e),a=a.match(/one$/)?a.slice(0,-3)+'first':a.match(/two$/)?a.slice(0,-3)+'second':a.match(/three$/)?a.slice(0,-5)+'third':a.match(/five$/)?a.slice(0,-4)+'fifth':a.match(/eight$/)?a.slice(0,-5)+'eighth':a.match(/nine$/)?a.slice(0,-4)+'ninth':a.match(/twelve$/)?a.slice(0,-5)+'twelfth':a.match(/ty$/)?a.slice(0,-2)+'tieth':a+'th';return t?a+'s':a},sre.MathspeakUtil.simpleOrdinal_=function(e){var t=e%100,a=e.toString();if(10<t&&20>t)return a+'th';switch(e%10){case 1:return a+'st';case 2:return a+'nd';case 3:return a+'rd';default:return a+'th';}},sre.MathspeakUtil.ordinalCounter=function(e,t){var a=0;return function(){return sre.MathspeakUtil.simpleOrdinal_(++a)+' '+t}},sre.MathspeakUtil.convertVulgarFraction_=function(e){if(!e.childNodes||!e.childNodes[0]||!e.childNodes[0].childNodes||2>e.childNodes[0].childNodes.length||e.childNodes[0].childNodes[0].tagName!==sre.SemanticAttr.Type.NUMBER||e.childNodes[0].childNodes[0].getAttribute('role')!==sre.SemanticAttr.Role.INTEGER||e.childNodes[0].childNodes[1].tagName!==sre.SemanticAttr.Type.NUMBER||e.childNodes[0].childNodes[1].getAttribute('role')!==sre.SemanticAttr.Role.INTEGER)return{convertible:!1,content:e.textContent};var t=e.childNodes[0].childNodes[1].textContent;e=e.childNodes[0].childNodes[0].textContent;var n=+t,i=+e;return isNaN(n)||isNaN(i)?{convertible:!1,content:e+' Over '+t}:{convertible:!0,enumerator:i,denominator:n}},sre.MathspeakUtil.vulgarFraction=function(e){return e=sre.MathspeakUtil.convertVulgarFraction_(e),e.convertible&&e.enumerator&&e.denominator?sre.MathspeakUtil.numberToWords(e.enumerator)+'-'+sre.MathspeakUtil.numberToOrdinal(e.denominator,1!==e.enumerator):e.content||''},sre.MathspeakUtil.vulgarFractionSmall=function(e){var t=sre.MathspeakUtil.convertVulgarFraction_(e);return!!t.convertible&&(e=t.enumerator,t=t.denominator,0<e&&10>e&&0<t&&100>t)},sre.MathspeakUtil.isSmallVulgarFraction=function(e){return sre.MathspeakUtil.vulgarFractionSmall(e)?[e]:[]},sre.MathspeakUtil.nestedSubSuper=function(t,a,n){for(;t.parentNode;){var i=t.parentNode,l=i.parentNode,e=t.getAttribute&&t.getAttribute('role');(l.tagName===sre.Semantic.Type.SUBSCRIPT&&t===i.childNodes[1]||l.tagName===sre.Semantic.Type.TENSOR&&e&&(e===sre.Semantic.Role.LEFTSUB||e===sre.Semantic.Role.RIGHTSUB))&&(a=n.sub+' '+a),(l.tagName===sre.Semantic.Type.SUPERSCRIPT&&t===i.childNodes[1]||l.tagName===sre.Semantic.Type.TENSOR&&e&&(e===sre.Semantic.Role.LEFTSUPER||e===sre.Semantic.Role.RIGHTSUPER))&&(a=n.sup+' '+a),t=l}return a.trim()},sre.MathspeakUtil.subscriptVerbose=function(e){return sre.MathspeakUtil.nestedSubSuper(e,'Subscript',{sup:'Super',sub:'Sub'})},sre.MathspeakUtil.subscriptBrief=function(e){return sre.MathspeakUtil.nestedSubSuper(e,'Sub',{sup:'Sup',sub:'Sub'})},sre.MathspeakUtil.superscriptVerbose=function(e){return sre.MathspeakUtil.nestedSubSuper(e,'Superscript',{sup:'Super',sub:'Sub'})},sre.MathspeakUtil.superscriptBrief=function(e){return sre.MathspeakUtil.nestedSubSuper(e,'Sup',{sup:'Sup',sub:'Sub'})},sre.MathspeakUtil.baselineVerbose=function(e){return(e=sre.MathspeakUtil.nestedSubSuper(e,'',{sup:'Super',sub:'Sub'}))?e.replace(/Sub$/,'Subscript').replace(/Super$/,'Superscript'):'Baseline'},sre.MathspeakUtil.baselineBrief=function(e){return sre.MathspeakUtil.nestedSubSuper(e,'',{sup:'Sup',sub:'Sub'})||'Base'},sre.MathspeakUtil.radicalNestingDepth=function(e){return sre.MathspeakUtil.getNestingDepth('radical',e,['sqrt','root'],sre.MathspeakUtil.nestingBarriers,{})},sre.MathspeakUtil.nestedRadical=function(e,t,a){return e=sre.MathspeakUtil.radicalNestingDepth(e),1===e?a:t+sre.MathspeakUtil.nestingToString(e-1)+a},sre.MathspeakUtil.openingRadicalVerbose=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nested','StartRoot')},sre.MathspeakUtil.closingRadicalVerbose=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nested','EndRoot')},sre.MathspeakUtil.indexRadicalVerbose=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nested','RootIndex')},sre.MathspeakUtil.openingRadicalBrief=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nest','StartRoot')},sre.MathspeakUtil.closingRadicalBrief=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nest','EndRoot')},sre.MathspeakUtil.indexRadicalBrief=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nest','RootIndex')},sre.MathspeakUtil.openingRadicalSbrief=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nest','Root')},sre.MathspeakUtil.indexRadicalSbrief=function(e){return sre.MathspeakUtil.nestedRadical(e,'Nest','Index')},sre.MathspeakUtil.underscoreNestingDepth=function(e){return sre.MathspeakUtil.getNestingDepth('underscore',e,['underscore'],sre.MathspeakUtil.nestingBarriers,{},function(e){return e.tagName&&e.tagName===sre.Semantic.Type.UNDERSCORE&&e.childNodes[0].childNodes[1].getAttribute('role')===sre.Semantic.Role.UNDERACCENT})},sre.MathspeakUtil.nestedUnderscore=function(e){return e=sre.MathspeakUtil.underscoreNestingDepth(e),Array(e).join('Under')+'Underscript'},sre.MathspeakUtil.overscoreNestingDepth=function(e){return sre.MathspeakUtil.getNestingDepth('overscore',e,['overscore'],sre.MathspeakUtil.nestingBarriers,{},function(e){return e.tagName&&e.tagName===sre.Semantic.Type.OVERSCORE&&e.childNodes[0].childNodes[1].getAttribute('role')===sre.Semantic.Role.OVERACCENT})},sre.MathspeakUtil.nestedOverscore=function(e){return e=sre.MathspeakUtil.overscoreNestingDepth(e),Array(e).join('Over')+'Overscript'},sre.MathspeakUtil.determinantIsSimple=function(e){if(e.tagName!==sre.Semantic.Type.MATRIX||e.getAttribute('role')!==sre.Semantic.Role.DETERMINANT)return[];for(var t,a=sre.XpathUtil.evalXPath('children/row/children/cell/children/*',e),n=0;t=a[n];n++)if(t.tagName!==sre.Semantic.Type.NUMBER){if(t.tagName===sre.Semantic.Type.IDENTIFIER&&(t=t.getAttribute('role'),t===sre.Semantic.Role.LATINLETTER||t===sre.Semantic.Role.GREEKLETTER||t===sre.Semantic.Role.OTHERLETTER))continue;return[]}return[e]},sre.MathspeakUtil.determinantMarkSimple=function(e){return sre.XpathUtil.evalXPath('children/row',e).forEach(function(e){e.setAttribute('sre_flag','simple')}),''},sre.MathspeakUtil.determinantUnMarkSimple=function(e){return sre.XpathUtil.evalXPath('children/row',e).forEach(function(e){e.removeAttribute('sre_flag')}),''},sre.MathspeakUtil.generateBaselineConstraint=function(){for(var t,n=function(e){return e.map(function(e){return'ancestor::'+e})},a=function(e){return'not('+e+')'},i=a(n(['subscript','superscript','tensor']).join(' or ')),l=n(['relseq','multrel']),n=n(['fraction','punctuation','fenced','sqrt','root']),r=[],e=0;t=n[e];e++)r=r.concat(l.map(function(e){return t+'/'+e}));return a=a(r.join(' | ')),['ancestor::*/following-sibling::*',i,a].join(' and ')},sre.MathspeakRules=function(){sre.MathspeakRules.initCustomFunctions_(),sre.MathspeakRules.initMathspeakRules_(),sre.MathspeakRules.generateMathspeakTensorRules_()},goog.addSingletonGetter(sre.MathspeakRules),sre.MathspeakRules.mathStore=sre.MathmlStore.getInstance(),sre.MathspeakRules.defineRule_=goog.bind(sre.MathspeakRules.mathStore.defineRule,sre.MathspeakRules.mathStore),sre.MathspeakRules.defineRuleAlias_=goog.bind(sre.MathspeakRules.mathStore.defineRulesAlias,sre.MathspeakRules.mathStore),sre.MathspeakRules.defineSpecialisedRule_=goog.bind(sre.MathspeakRules.mathStore.defineSpecialisedRule,sre.MathspeakRules.mathStore),sre.MathspeakRules.addContextFunction_=goog.bind(sre.MathspeakRules.mathStore.contextFunctions.add,sre.MathspeakRules.mathStore.contextFunctions),sre.MathspeakRules.addCustomQuery_=goog.bind(sre.MathspeakRules.mathStore.customQueries.add,sre.MathspeakRules.mathStore.customQueries),sre.MathspeakRules.addCustomString_=goog.bind(sre.MathspeakRules.mathStore.customStrings.add,sre.MathspeakRules.mathStore.customStrings),sre.MathspeakRules.initCustomFunctions_=function(){(0,sre.MathspeakRules.addCustomQuery_)('CQFspaceoutNumber',sre.MathspeakUtil.spaceoutNumber),(0,sre.MathspeakRules.addCustomQuery_)('CQFspaceoutIdentifier',sre.MathspeakUtil.spaceoutIdentifier),(0,sre.MathspeakRules.addCustomString_)('CSFspaceoutText',sre.MathspeakUtil.spaceoutText),(0,sre.MathspeakRules.addCustomString_)('CSFopenFracVerbose',sre.MathspeakUtil.openingFractionVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFcloseFracVerbose',sre.MathspeakUtil.closingFractionVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFoverFracVerbose',sre.MathspeakUtil.overFractionVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFopenFracBrief',sre.MathspeakUtil.openingFractionBrief),(0,sre.MathspeakRules.addCustomString_)('CSFcloseFracBrief',sre.MathspeakUtil.closingFractionBrief),(0,sre.MathspeakRules.addCustomString_)('CSFopenFracSbrief',sre.MathspeakUtil.openingFractionSbrief),(0,sre.MathspeakRules.addCustomString_)('CSFcloseFracSbrief',sre.MathspeakUtil.closingFractionSbrief),(0,sre.MathspeakRules.addCustomString_)('CSFoverFracSbrief',sre.MathspeakUtil.overFractionSbrief),(0,sre.MathspeakRules.addCustomString_)('CSFvulgarFraction',sre.MathspeakUtil.vulgarFraction),(0,sre.MathspeakRules.addCustomQuery_)('CQFvulgarFractionSmall',sre.MathspeakUtil.isSmallVulgarFraction),(0,sre.MathspeakRules.addCustomString_)('CSFopenRadicalVerbose',sre.MathspeakUtil.openingRadicalVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFcloseRadicalVerbose',sre.MathspeakUtil.closingRadicalVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFindexRadicalVerbose',sre.MathspeakUtil.indexRadicalVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFopenRadicalBrief',sre.MathspeakUtil.openingRadicalBrief),(0,sre.MathspeakRules.addCustomString_)('CSFcloseRadicalBrief',sre.MathspeakUtil.closingRadicalBrief),(0,sre.MathspeakRules.addCustomString_)('CSFindexRadicalBrief',sre.MathspeakUtil.indexRadicalBrief),(0,sre.MathspeakRules.addCustomString_)('CSFopenRadicalSbrief',sre.MathspeakUtil.openingRadicalSbrief),(0,sre.MathspeakRules.addCustomString_)('CSFindexRadicalSbrief',sre.MathspeakUtil.indexRadicalSbrief),(0,sre.MathspeakRules.addCustomString_)('CSFsuperscriptVerbose',sre.MathspeakUtil.superscriptVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFsuperscriptBrief',sre.MathspeakUtil.superscriptBrief),(0,sre.MathspeakRules.addCustomString_)('CSFsubscriptVerbose',sre.MathspeakUtil.subscriptVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFsubscriptBrief',sre.MathspeakUtil.subscriptBrief),(0,sre.MathspeakRules.addCustomString_)('CSFbaselineVerbose',sre.MathspeakUtil.baselineVerbose),(0,sre.MathspeakRules.addCustomString_)('CSFbaselineBrief',sre.MathspeakUtil.baselineBrief),(0,sre.MathspeakRules.addCustomString_)('CSFunderscript',sre.MathspeakUtil.nestedUnderscore),(0,sre.MathspeakRules.addCustomString_)('CSFoverscript',sre.MathspeakUtil.nestedOverscore),(0,sre.MathspeakRules.addCustomQuery_)('CQFhideFont',sre.MathmlStoreUtil.hideFont),(0,sre.MathspeakRules.addCustomString_)('CSFshowFont',sre.MathmlStoreUtil.showFont),(0,sre.MathspeakRules.addContextFunction_)('CTXFordinalCounter',sre.MathspeakUtil.ordinalCounter),(0,sre.MathspeakRules.addCustomQuery_)('CQFdetIsSimple',sre.MathspeakUtil.determinantIsSimple),(0,sre.MathspeakRules.addCustomString_)('CSFdetMarkSimple',sre.MathspeakUtil.determinantMarkSimple),(0,sre.MathspeakRules.addCustomString_)('CSFdetUnMarkSimple',sre.MathspeakUtil.determinantUnMarkSimple)},sre.MathspeakRules.initMathspeakRules_=function(){(0,sre.MathspeakRules.defineRule_)('unknown','mathspeak.default','[n] text()','self::unknown'),(0,sre.MathspeakRules.defineRule_)('protected','mathspeak.default','[t] text()','self::*','@role="protected"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('font','default.default','mathspeak.default'),(0,sre.MathspeakRules.defineSpecialisedRule_)('font-identifier','default.default','mathspeak.default'),(0,sre.MathspeakRules.defineSpecialisedRule_)('font-identifier-short','default.default','mathspeak.default'),(0,sre.MathspeakRules.defineSpecialisedRule_)('omit-font','default.default','mathspeak.default'),(0,sre.MathspeakRules.defineRule_)('german-font','mathspeak.default','[t] "German"; [n] CQFhideFont; [t] CSFshowFont','self::*','@font','@font="fraktur"'),(0,sre.MathspeakRules.defineRule_)('german-font','mathspeak.default','[t] "bold German"; [n] CQFhideFont; [t] CSFshowFont','self::*','@font','@font="bold-fraktur"'),(0,sre.MathspeakRules.defineRule_)('number','mathspeak.default','[n] text()','self::number'),(0,sre.MathspeakRules.defineRule_)('mixed-number','mathspeak.default','[n] children/*[1]; [t] "and"; [n] children/*[2]; ','self::number','@role="mixed"'),(0,sre.MathspeakRules.defineRule_)('number-with-chars','mathspeak.default','[t] "Number"; [m] CQFspaceoutNumber','self::number','"" != translate(text(), "0123456789.,", "")','text() != translate(text(), "0123456789.,", "")'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-with-chars','mathspeak.default','mathspeak.brief','[t] "Num"; [m] CQFspaceoutNumber'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-with-chars','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('number-as-upper-word','mathspeak.default','[t] "UpperWord"; [t] CSFspaceoutText','self::number','string-length(text())>1','text()=translate(text(), "abcdefghijklmnopqrstuvwxyz\u03B1\u03B2\u03B3\u03B4\u03B5\u03B6\u03B7\u03B8\u03B9\u03BA\u03BB\u03BC\u03BD\u03BE\u03BF\u03C0\u03C1\u03C2\u03C3\u03C4\u03C5\u03C6\u03C7\u03C8\u03C9", "ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\u03A3\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9")','""=translate(text(), "ABCDEFGHIJKLMNOPQRSTUVWXYZ\u0391\u0392\u0393\u0394\u0395\u0396\u0397\u0398\u0399\u039A\u039B\u039C\u039D\u039E\u039F\u03A0\u03A1\u03A3\u03A3\u03A4\u03A5\u03A6\u03A7\u03A8\u03A9","")'),(0,sre.MathspeakRules.defineRule_)('number-baseline','mathspeak.default','[t] "Baseline"; [n] text()','self::number','not(@hiddenfont)','preceding-sibling::identifier','preceding-sibling::*[1][@role="latinletter" or @role="greekletter" or @role="otherletter"]','parent::*/parent::infixop[@role="implicit"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-baseline','mathspeak.default','mathspeak.brief','[t] "Base"; [n] text()'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-baseline','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('number-baseline-font','mathspeak.default','[t] "Baseline"; [t] @font; [n] CQFhideFont; [t] CSFshowFont','self::number','@font','@font!="normal"','preceding-sibling::identifier','preceding-sibling::*[@role="latinletter" or @role="greekletter" or @role="otherletter"]','parent::*/parent::infixop[@role="implicit"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-baseline-font','mathspeak.default','mathspeak.brief','[t] "Base"; [n] text()'),(0,sre.MathspeakRules.defineSpecialisedRule_)('number-baseline-font','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('identifier','mathspeak.default','[m] CQFspaceoutIdentifier','self::identifier','string-length(text())>1','@role!="unit"','@role!="protected"','not(@font) or @font="normal" or @hiddenfont'),(0,sre.MathspeakRules.defineRule_)('identifier','mathspeak.default','[n] text()','self::identifier','@role="protected"'),(0,sre.MathspeakRules.defineRule_)('negative','mathspeak.default','[t] "negative"; [n] children/*[1]','self::prefixop','@role="negative"','children/identifier'),(0,sre.MathspeakRules.defineRuleAlias_)('negative','self::prefixop','@role="negative"','children/number'),(0,sre.MathspeakRules.defineRuleAlias_)('negative','self::prefixop','@role="negative"','children/fraction[@role="vulgar"]'),(0,sre.MathspeakRules.defineRule_)('negative','mathspeak.default','[t] "minus"; [n] children/*[1]','self::prefixop','@role="negative"'),(0,sre.MathspeakRules.defineRule_)('prefix','mathspeak.default','[n] text(); [n] children/*[1]','self::prefixop'),(0,sre.MathspeakRules.defineRule_)('postfix','mathspeak.default','[n] children/*[1]; [n] text()','self::postfixop'),(0,sre.MathspeakRules.defineRule_)('binary-operation','mathspeak.default','[m] children/* (sepFunc:CTXFcontentIterator);','self::infixop'),(0,sre.MathspeakRules.defineRule_)('implicit','mathspeak.default','[m] children/*','self::infixop','@role="implicit"'),(0,sre.MathspeakRules.defineRuleAlias_)('implicit','self::infixop','@role="leftsuper" or @role="leftsub" or @role="rightsuper" or @role="rightsub"'),(0,sre.MathspeakRules.defineRule_)('subtraction','mathspeak.default','[m] children/* (separator:"minus");','self::infixop','@role="subtraction"'),(0,sre.MathspeakRules.defineRule_)('function-unknown','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::appl'),(0,sre.MathspeakRules.defineRule_)('function-prefix','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::appl','children/*[1][@role="prefix function"]'),(0,sre.MathspeakRules.defineRule_)('fences-open-close','mathspeak.default','[n] content/*[1]; [n] children/*[1]; [n] content/*[2]','self::fenced','@role="leftright"'),(0,sre.MathspeakRules.defineRule_)('fences-neutral','mathspeak.default','[t] "StartAbsoluteValue"; [n] children/*[1]; [t] "EndAbsoluteValue"','self::fenced','self::fenced[@role="neutral"]','content/*[1][text()]="|" or content/*[1][text()]="\u2758" or content/*[1][text()]="\uFF5C"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('fences-neutral','mathspeak.default','mathspeak.sbrief','[t] "AbsoluteValue"; [n] children/*[1]; [t] "EndAbsoluteValue"'),(0,sre.MathspeakRules.defineRule_)('fences-neutral','mathspeak.default','[n] content/*[1]; [n] children/*[1]; [n] content/*[2]','self::fenced','self::fenced[@role="neutral"]'),(0,sre.MathspeakRules.defineRule_)('fences-set','mathspeak.default','[t] "StartSet"; [n] children/*[1]; [t] "EndSet"','self::fenced[@role="leftright"]','content/*[1][text()]="{"','content/*[2][text()]="}"','count(children/*)=1','not(name(../..)="appl")'),(0,sre.MathspeakRules.defineSpecialisedRule_)('fences-set','mathspeak.default','mathspeak.sbrief','[t] "Set"; [n] children/*[1]; [t] "EndSet"'),(0,sre.MathspeakRules.defineRule_)('text','mathspeak.default','[n] text()','self::text'),(0,sre.MathspeakRules.defineRule_)('factorial','mathspeak.default','[t] "factorial"','self::punctuation','text()="!"','name(preceding-sibling::*[1])!="text"'),(0,sre.MathspeakRules.defineRule_)('minus','mathspeak.default','[t] "minus"','self::operator','text()="-"'),(0,sre.MathspeakRules.defineRule_)('single-prime','mathspeak.default','[t] "prime"','self::punctuated[@role="prime"]','count(children/*)=1'),(0,sre.MathspeakRules.defineRule_)('double-prime','mathspeak.default','[t] "double-prime"','self::punctuated[@role="prime"]','count(children/*)=2'),(0,sre.MathspeakRules.defineRule_)('triple-prime','mathspeak.default','[t] "triple-prime"','self::punctuated[@role="prime"]','count(children/*)=3'),(0,sre.MathspeakRules.defineRule_)('quadruple-prime','mathspeak.default','[t] "quadruple-prime"','self::punctuated[@role="prime"]','count(children/*)=4'),(0,sre.MathspeakRules.defineRule_)('counted-prime','mathspeak.default','[t] count(children/*); [t] "prime"','self::punctuated[@role="prime"]'),(0,sre.MathspeakRules.defineRule_)('fraction','mathspeak.default','[t] CSFopenFracVerbose; [n] children/*[1]; [t] CSFoverFracVerbose; [n] children/*[2]; [t] CSFcloseFracVerbose','self::fraction'),(0,sre.MathspeakRules.defineRule_)('fraction','mathspeak.brief','[t] CSFopenFracBrief; [n] children/*[1]; [t] CSFoverFracVerbose; [n] children/*[2]; [t] CSFcloseFracBrief','self::fraction'),(0,sre.MathspeakRules.defineRule_)('fraction','mathspeak.sbrief','[t] CSFopenFracSbrief; [n] children/*[1]; [t] CSFoverFracSbrief; [n] children/*[2]; [t] CSFcloseFracSbrief','self::fraction'),(0,sre.MathspeakRules.defineRule_)('vulgar-fraction','mathspeak.default','[t] CSFvulgarFraction','self::fraction','@role="vulgar"','CQFvulgarFractionSmall'),(0,sre.MathspeakRules.defineSpecialisedRule_)('vulgar-fraction','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('vulgar-fraction','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('continued-fraction-outer','mathspeak.default','[t] "ContinuedFraction"; [n] children/*[1];[t] "Over"; [n] children/*[2]','self::fraction','not(ancestor::fraction)','children/*[2]/descendant-or-self::*[@role="ellipsis" and not(following-sibling::*)]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('continued-fraction-outer','mathspeak.default','mathspeak.brief','[t] "ContinuedFrac"; [n] children/*[1];[t] "Over"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('continued-fraction-outer','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('continued-fraction-inner','mathspeak.default','[t] "StartFraction"; [n] children/*[1];[t] "Over"; [n] children/*[2]','self::fraction','ancestor::fraction','children/*[2]/descendant-or-self::*[@role="ellipsis" and not(following-sibling::*)]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('continued-fraction-inner','mathspeak.default','mathspeak.brief','[t] "StartFrac"; [n] children/*[1];[t] "Over"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('continued-fraction-inner','mathspeak.brief','mathspeak.sbrief','[t] "Frac"; [n] children/*[1];[t] "Over"; [n] children/*[2]'),(0,sre.MathspeakRules.defineRule_)('sqrt','mathspeak.default','[t] CSFopenRadicalVerbose; [n] children/*[1]; [t] CSFcloseRadicalVerbose','self::sqrt'),(0,sre.MathspeakRules.defineRule_)('sqrt','mathspeak.brief','[t] CSFopenRadicalBrief; [n] children/*[1]; [t] CSFcloseRadicalBrief','self::sqrt'),(0,sre.MathspeakRules.defineRule_)('sqrt','mathspeak.sbrief','[t] CSFopenRadicalSbrief; [n] children/*[1]; [t] CSFcloseRadicalBrief','self::sqrt'),(0,sre.MathspeakRules.defineRule_)('root','mathspeak.default','[t] CSFindexRadicalVerbose; [n] children/*[1];[t] CSFopenRadicalVerbose; [n] children/*[2]; [t] CSFcloseRadicalVerbose','self::root'),(0,sre.MathspeakRules.defineRule_)('root','mathspeak.brief','[t] CSFindexRadicalBrief; [n] children/*[1];[t] CSFopenRadicalBrief; [n] children/*[2]; [t] CSFcloseRadicalBrief','self::root'),(0,sre.MathspeakRules.defineRule_)('root','mathspeak.sbrief','[t] CSFindexRadicalSbrief; [n] children/*[1];[t] CSFopenRadicalSbrief; [n] children/*[2]; [t] CSFcloseRadicalBrief','self::root'),(0,sre.MathspeakRules.defineRule_)('limboth','mathspeak.default','[n] children/*[1]; [t] CSFunderscript; [n] children/*[2];[t] CSFoverscript; [n] children/*[3]','self::limboth','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRule_)('limlower','mathspeak.default','[n] children/*[1]; [t] CSFunderscript; [n] children/*[2];','self::limlower','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRule_)('limupper','mathspeak.default','[n] children/*[1]; [t] CSFoverscript; [n] children/*[2];','self::limupper','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRuleAlias_)('limlower','self::underscore','@role="limit function"','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRuleAlias_)('limlower','self::underscore','children/*[2][@role!="underaccent"]','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRuleAlias_)('limupper','self::overscore','children/*[2][@role!="overaccent"]','name(../..)="underscore" or name(../..)="overscore"','following-sibling::*[@role!="underaccent" and @role!="overaccent"]'),(0,sre.MathspeakRules.defineRule_)('limboth-end','mathspeak.default','[n] children/*[1]; [t] CSFunderscript; [n] children/*[2];[t] CSFoverscript; [n] children/*[3]; [t] "Endscripts"','self::limboth'),(0,sre.MathspeakRules.defineRule_)('limlower-end','mathspeak.default','[n] children/*[1]; [t] CSFunderscript; [n] children/*[2]; [t] "Endscripts"','self::limlower'),(0,sre.MathspeakRules.defineRule_)('limupper-end','mathspeak.default','[n] children/*[1]; [t] CSFoverscript; [n] children/*[2]; [t] "Endscripts"','self::limupper'),(0,sre.MathspeakRules.defineRuleAlias_)('limlower-end','self::underscore','@role="limit function"'),(0,sre.MathspeakRules.defineRuleAlias_)('limlower-end','self::underscore'),(0,sre.MathspeakRules.defineRuleAlias_)('limupper-end','self::overscore'),(0,sre.MathspeakRules.defineRule_)('integral','mathspeak.default','[n] children/*[1]; [t] "Subscript"; [n] children/*[2];[t] "Superscript"; [n] children/*[3]; [t] "Baseline";','self::limboth','@role="integral"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('integral','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] "Sub"; [n] children/*[2];[t] "Sup"; [n] children/*[3]; [t] "Base";'),(0,sre.MathspeakRules.defineSpecialisedRule_)('integral','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('bigop','mathspeak.default','[n] children/*[1]; [n] children/*[2];','self::bigop'),(0,sre.MathspeakRules.defineRule_)('equality','mathspeak.default','[n] children/*[1]; [n] content/*[1]; [n] children/*[2]','self::relseq[@role="equality"]','count(./children/*)=2'),(0,sre.MathspeakRules.defineRule_)('multi-equality','mathspeak.default','[m] ./children/* (sepFunc:CTXFcontentIterator)','self::relseq[@role="equality"]','count(./children/*)>2'),(0,sre.MathspeakRules.defineRule_)('multrel','mathspeak.default','[m] children/* (sepFunc:CTXFcontentIterator)','self::multirel'),(0,sre.MathspeakRules.defineRule_)('subscript','mathspeak.default','[n] children/*[1]; [t] CSFsubscriptVerbose; [n] children/*[2]','self::subscript'),(0,sre.MathspeakRules.defineRule_)('subscript','mathspeak.brief','[n] children/*[1]; [t] CSFsubscriptBrief; [n] children/*[2]','self::subscript'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('subscript-simple','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::subscript','name(./children/*[1])="identifier"','name(./children/*[2])="number"','./children/*[2][@role!="mixed"]','./children/*[2][@role!="othernumber"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-simple','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-simple','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('subscript-baseline','mathspeak.default','[n] children/*[1]; [t] CSFsubscriptVerbose; [n] children/*[2]; [t] CSFbaselineVerbose','self::subscript','following-sibling::*','not(name(following-sibling::subscript/children/*[1])="empty" or (name(following-sibling::infixop[@role="implicit"]/children/*[1])="subscript" and name(following-sibling::*/children/*[1]/children/*[1])="empty")) and @role!="subsup"','not(following-sibling::*[@role="rightsuper" or @role="rightsub" or @role="leftsub" or @role="leftsub"])'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-baseline','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] CSFsubscriptBrief; [n] children/*[2]; [t] CSFbaselineBrief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-baseline','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('subscript-baseline','self::subscript','not(following-sibling::*)','ancestor::fenced|ancestor::root|ancestor::sqrt|ancestor::punctuated|ancestor::fraction','not(ancestor::punctuated[@role="leftsuper" or @role="rightsub" or @role="rightsuper" or @role="rightsub"])'),(0,sre.MathspeakRules.defineRuleAlias_)('subscript-baseline','self::subscript','not(following-sibling::*)','ancestor::relseq|ancestor::multirel',sre.MathspeakUtil.generateBaselineConstraint()),(0,sre.MathspeakRules.defineRuleAlias_)('subscript-baseline','self::subscript','not(following-sibling::*)','self::subscript[@embellished]'),(0,sre.MathspeakRules.defineRule_)('subscript-empty-sup','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::subscript','name(children/*[2])="infixop"','name(children/*[2][@role="implicit"]/children/*[1])="superscript"','name(children/*[2]/children/*[1]/children/*[1])="empty"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-empty-sup','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('subscript-empty-sup','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('subscript-empty-sup','self::subscript','name(children/*[2])="superscript"','name(children/*[2]/children/*[1])="empty"'),(0,sre.MathspeakRules.defineRule_)('superscript','mathspeak.default','[n] children/*[1]; [t] CSFsuperscriptVerbose; [n] children/*[2]','self::superscript'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] CSFsuperscriptBrief; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('superscript-baseline','mathspeak.default','[n] children/*[1]; [t] CSFsuperscriptVerbose; [n] children/*[2];[t] CSFbaselineVerbose','self::superscript','following-sibling::*','not(name(following-sibling::superscript/children/*[1])="empty" or (name(following-sibling::infixop[@role="implicit"]/children/*[1])="superscript" and name(following-sibling::*/children/*[1]/children/*[1])="empty")) and not(following-sibling::*[@role="rightsuper" or @role="rightsub" or @role="leftsub" or @role="leftsub"])'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript-baseline','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] CSFsuperscriptBrief; [n] children/*[2];[t] CSFbaselineBrief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript-baseline','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('superscript-baseline','self::superscript','not(following-sibling::*)','ancestor::punctuated','ancestor::*/following-sibling::* and not(ancestor::punctuated[@role="leftsuper" or @role="rightsub" or @role="rightsuper" or @role="rightsub"])'),(0,sre.MathspeakRules.defineRuleAlias_)('superscript-baseline','self::superscript','not(following-sibling::*)','ancestor::fraction|ancestor::fenced|ancestor::root|ancestor::sqrt'),(0,sre.MathspeakRules.defineRuleAlias_)('superscript-baseline','self::superscript','not(following-sibling::*)','ancestor::relseq|ancestor::multirel','not(self::superscript[@embellished])',sre.MathspeakUtil.generateBaselineConstraint()),(0,sre.MathspeakRules.defineRuleAlias_)('superscript-baseline','self::superscript','not(following-sibling::*)','self::superscript[@embellished]','not(children/*[2][@role="prime"])'),(0,sre.MathspeakRules.defineRule_)('superscript-empty-sub','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::superscript','name(children/*[2])="infixop"','name(children/*[2][@role="implicit"]/children/*[1])="subscript"','name(children/*[2]/children/*[1]/children/*[1])="empty"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript-empty-sub','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('superscript-empty-sub','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('superscript-empty-sub','self::superscript','name(children/*[2])="subscript"','name(children/*[2]/children/*[1])="empty"'),(0,sre.MathspeakRules.defineRule_)('square','mathspeak.default','[n] children/*[1]; [t] "squared"','self::superscript','children/*[2]','children/*[2][text()=2]','name(children/*[1])!="text" or not(name(children/*[1])="text" and (name(../../../punctuated[@role="text"]/..)="stree" or name(..)="stree"))','name(children/*[1])!="subscript" or (name(children/*[1])="subscript" and name(children/*[1]/children/*[1])="identifier" and name(children/*[1]/children/*[2])="number" and children/*[1]/children/*[2][@role!="mixed"] and children/*[1]/children/*[2][@role!="othernumber"])','not(self::superscript[@embellished])'),(0,sre.MathspeakRules.defineSpecialisedRule_)('square','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('square','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('cube','mathspeak.default','[n] children/*[1]; [t] "cubed"','self::superscript','children/*[2]','children/*[2][text()=3]','name(children/*[1])!="text" or not(name(children/*[1])="text" and (name(../../../punctuated[@role="text"]/..)="stree" or name(..)="stree"))','name(children/*[1])!="subscript" or (name(children/*[1])="subscript" and name(children/*[1]/children/*[1])="identifier" and name(children/*[1]/children/*[2])="number" and children/*[1]/children/*[2][@role!="mixed"] and children/*[1]/children/*[2][@role!="othernumber"])','not(self::superscript[@embellished])'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cube','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cube','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('prime','mathspeak.default','[n] children/*[1]; [n] children/*[2]','self::superscript','children/*[2]','children/*[2][@role="prime"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('prime-subscript','mathspeak.default','[n] children/*[1]/children/*[1]; [n] children/*[2]; [t] CSFsubscriptVerbose; [n] children/*[1]/children/*[2]','self::superscript','children/*[2][@role="prime"]','name(children/*[1])="subscript"','not(following-sibling::*)'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript','mathspeak.default','mathspeak.brief','[n] children/*[1]/children/*[1]; [n] children/*[2]; [t] CSFsubscriptBrief; [n] children/*[1]/children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('prime-subscript-baseline','mathspeak.default','[n] children/*[1]/children/*[1]; [n] children/*[2]; [t] CSFsubscriptVerbose; [n] children/*[1]/children/*[2]; [t] CSFbaselineVerbose','self::superscript','children/*[2][@role="prime"]','name(children/*[1])="subscript"','following-sibling::*'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript-baseline','mathspeak.default','mathspeak.brief','[n] children/*[1]/children/*[1]; [n] children/*[2]; [t] CSFsubscriptBrief; [n] children/*[1]/children/*[2]; [t] CSFbaselineBrief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript-baseline','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('prime-subscript-baseline','self::superscript','children/*[2][@role="prime"]','name(children/*[1])="subscript"','not(following-sibling::*)','self::superscript[@embellished]'),(0,sre.MathspeakRules.defineRule_)('prime-subscript-simple','mathspeak.default','[n] children/*[1]/children/*[1]; [n] children/*[2];[n] children/*[1]/children/*[2]','self::superscript','children/*[2][@role="prime"]','name(children/*[1])="subscript"','name(children/*[1]/children/*[1])="identifier"','name(children/*[1]/children/*[2])="number"','children/*[1]/children/*[2][@role!="mixed"]','children/*[1]/children/*[2][@role!="othernumber"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript-simple','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('prime-subscript-simple','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('overscore','mathspeak.default','[t] "ModifyingAbove"; [n] children/*[1]; [t] "With"; [n] children/*[2]','self::overscore','children/*[2][@role="overaccent"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overscore','mathspeak.default','mathspeak.brief','[t] "ModAbove"; [n] children/*[1]; [t] "With"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overscore','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('double-overscore','mathspeak.default','[t] "ModifyingAbove Above"; [n] children/*[1]; [t] "With"; [n] children/*[2]','self::overscore','children/*[2][@role="overaccent"]','name(children/*[1])="overscore"','children/*[1]/children/*[2][@role="overaccent"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('double-overscore','mathspeak.default','mathspeak.brief','[t] "ModAbove Above"; [n] children/*[1]; [t] "With"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('double-overscore','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('underscore','mathspeak.default','[t] "ModifyingBelow"; [n] children/*[1]; [t] "With"; [n] children/*[2]','self::underscore','children/*[2][@role="underaccent"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('underscore','mathspeak.default','mathspeak.brief','[t] "ModBelow"; [n] children/*[1]; [t] "With"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('underscore','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('double-underscore','mathspeak.default','[t] "ModifyingBelow Below"; [n] children/*[1]; [t] "With"; [n] children/*[2]','self::underscore','children/*[2][@role="underaccent"]','name(children/*[1])="underscore"','children/*[1]/children/*[2][@role="underaccent"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('double-underscore','mathspeak.default','mathspeak.brief','[t] "ModBelow Below"; [n] children/*[1]; [t] "With"; [n] children/*[2]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('double-underscore','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('overbar','mathspeak.default','[n] children/*[1]; [t] "overbar"','self::overscore','@role="latinletter" or @role="greekletter" or @role="otherletter"','children/*[2][@role="overaccent"]','children/*[2][text()="\xAF" or text()="\uFFE3" or text()="\uFF3F" or text()="_" or text()="\u203E"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overbar','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] "overBar"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overbar','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('underbar','mathspeak.default','[n] children/*[1]; [t] "underbar"','self::underscore','@role="latinletter" or @role="greekletter" or @role="otherletter"','children/*[2][@role="underaccent"]','children/*[2][text()="\xAF" or text()="\uFFE3" or text()="\uFF3F" or text()="_" or text()="\u203E"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('underbar','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] "underBar"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('underbar','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('overtilde','mathspeak.default','[n] children/*[1]; [t] "overTilde"','self::overscore','children/*[2][@role="overaccent"]','@role="latinletter" or @role="greekletter" or @role="otherletter"','children/*[2][text()="~" or text()="\u02DC" or text()="\u223C" or text()="\uFF5E"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overtilde','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] "overtilde"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('overtilde','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('undertilde','mathspeak.default','[n] children/*[1]; [t] "underTilde"','self::underscore','@role="latinletter" or @role="greekletter" or @role="otherletter"','children/*[2][@role="underaccent"]','children/*[2][text()="~" or text()="\u02DC" or text()="\u223C" or text()="\uFF5E"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('undertilde','mathspeak.default','mathspeak.brief','[n] children/*[1]; [t] "undertilde"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('undertilde','mathspeak.brief','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRule_)('matrix-fence','mathspeak.default','[n] children/*[1];','self::fenced','count(children/*)=1','name(children/*[1])="matrix"'),(0,sre.MathspeakRules.defineRule_)('matrix','mathspeak.default','[t] "Start"; [t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Matrix"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndMatrix"','self::matrix'),(0,sre.MathspeakRules.defineRule_)('matrix','mathspeak.sbrief','[t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Matrix"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndMatrix"','self::matrix'),(0,sre.MathspeakRules.defineRuleAlias_)('matrix','self::vector'),(0,sre.MathspeakRules.defineRule_)('matrix-row','mathspeak.default','[m] children/* (ctxtFunc:CTXFordinalCounter,context:"Column")','self::row'),(0,sre.MathspeakRules.defineRule_)('matrix-cell','mathspeak.default','[n] children/*[1]','self::cell'),(0,sre.MathspeakRules.defineRule_)('empty-cell','mathspeak.default','[t] "Blank"','self::cell','count(children/*)=1','children/empty'),(0,sre.MathspeakRules.defineRule_)('determinant','mathspeak.default','[t] "Start"; [t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Determinant"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndDeterminant"','self::matrix','@role="determinant"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('determinant','mathspeak.default','mathspeak.sbrief','[t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Determinant"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndDeterminant"'),(0,sre.MathspeakRules.defineRule_)('determinant-simple','mathspeak.default','[t] CSFdetMarkSimple;[t] "Start"; [t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Determinant"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row"); [t] "EndDeterminant"; [t] CSFdetUnMarkSimple','self::matrix','@role="determinant"','CQFdetIsSimple'),(0,sre.MathspeakRules.defineSpecialisedRule_)('determinant-simple','mathspeak.default','mathspeak.sbrief','[t] CSFdetMarkSimple;[t] count(children/*);  [t] "By";[t] count(children/*[1]/children/*); [t] "Determinant"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row"); [t] "EndDeterminant"; [t] CSFdetUnMarkSimple'),(0,sre.MathspeakRules.defineRule_)('row-simple','mathspeak.default','[m] children/*;','self::row','@role="determinant"','@sre_flag="simple"'),(0,sre.MathspeakRules.defineRule_)('layout','mathspeak.default','[t] "StartLayout"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndLayout"','self::table'),(0,sre.MathspeakRules.defineRule_)('layout','mathspeak.sbrief','[t] "Layout"; [m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndLayout"','self::table'),(0,sre.MathspeakRules.defineRule_)('binomial','mathspeak.default','[t] "StartBinomialOrMatrix"; [n] children/*[1]/children/*[1]; [t] "Choose"; [n] children/*[2]/children/*[1];  [t] "EndBinomialOrMatrix"','self::vector','@role="binomial"'),(0,sre.MathspeakRules.defineRule_)('binomial','mathspeak.sbrief','[t] "BinomialOrMatrix"; [n] children/*[1]/children/*[1]; [t] "Choose"; [n] children/*[2]/children/*[1];  [t] "EndBinomialOrMatrix"','self::vector','@role="binomial"'),(0,sre.MathspeakRules.defineRule_)('cases','mathspeak.default','[t] "StartLayout"; [t] "Enlarged"; [n] content/*[1];[m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndLayout"','self::cases'),(0,sre.MathspeakRules.defineRule_)('cases','mathspeak.sbrief','[t] "Layout"; [t] "Enlarged"; [n] content/*[1];[m] children/* (ctxtFunc:CTXFordinalCounter,context:"Row "); [t] "EndLayout"','self::cases'),(0,sre.MathspeakRules.defineRule_)('enclose','mathspeak.default','[t] "StartEnclose"; [t] @role; [n] children/*[1]; [t] "EndEnclose"','self::enclose'),(0,sre.MathspeakRules.defineRuleAlias_)('overbar','self::enclose','@role="top"'),(0,sre.MathspeakRules.defineRuleAlias_)('underbar','self::enclose','@role="bottom"'),(0,sre.MathspeakRules.defineRule_)('leftbar','mathspeak.default','[t] "vertical-bar"; [n] children/*[1]','self::enclose','@role="left"'),(0,sre.MathspeakRules.defineRule_)('rightbar','mathspeak.default','[t] "vertical-bar"; [n] children/*[1]','self::enclose','@role="right"'),(0,sre.MathspeakRules.defineRule_)('crossout','mathspeak.default','[t] "CrossOut"; [n] children/*[1]; [t] "EndCrossOut"','self::enclose','@role="updiagonalstrike" or @role="downdiagonalstrike" or @role="horizontalstrike"'),(0,sre.MathspeakRules.defineRule_)('cancel','mathspeak.default','[t] "CrossOut"; [n] children/*[1]/children/*[1]; [t] "With"; [n] children/*[2]; [t] "EndCrossOut"','self::overscore','@role="updiagonalstrike" or @role="downdiagonalstrike" or @role="horizontalstrike"'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cancel','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cancel','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('cancel','self::underscore','@role="updiagonalstrike" or @role="downdiagonalstrike" or @role="horizontalstrike"'),(0,sre.MathspeakRules.defineRule_)('cancel-reverse','mathspeak.default','[t] "CrossOut"; [n] children/*[2]/children/*[1]; [t] "With"; [n] children/*[1]; [t] "EndCrossOut"','self::overscore','name(children/*[2])="enclose"','children/*[2][@role="updiagonalstrike" or @role="downdiagonalstrike" or @role="horizontalstrike"]'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cancel-reverse','mathspeak.default','mathspeak.brief'),(0,sre.MathspeakRules.defineSpecialisedRule_)('cancel-reverse','mathspeak.default','mathspeak.sbrief'),(0,sre.MathspeakRules.defineRuleAlias_)('cancel-reverse','self::underscore','name(children/*[2])="enclose"','children/*[2][@role="updiagonalstrike" or @role="downdiagonalstrike" or @role="horizontalstrike"]')},sre.MathspeakRules.componentString_={0:'CSFsuperscript',1:'CSFsubscript',2:'CSFbaseline'},sre.MathspeakRules.childNumber_={0:5,1:4,2:1,3:3,4:2},sre.MathspeakRules.generateTensorRuleStrings_=function(t){var a=[],n='',i='';t=parseInt(t,2);for(var l,r=0;5>r;r++){if(l='children/*['+sre.MathspeakRules.childNumber_[r]+']',1&t)var e=sre.MathspeakRules.componentString_[r%3],n='[t] '+e+'Verbose; [n] '+l+';'+n,i='[t] '+e+'Brief; [n] '+l+';'+i;else a.unshift('name('+l+')="empty"');t>>=1}return a.push(n),a.push(i),a},sre.MathspeakRules.generateMathspeakTensorRules_=function(){for(var t,n,i=['11111','11110','11101','11100','10111','10110','10101','10100','01111','01110','01101','01100'],a=0;t=i[a];a++){n='tensor'+t,t=sre.MathspeakRules.generateTensorRuleStrings_(t);var l=t.pop(),e=t.pop(),r=[n,'mathspeak.default',e,'self::tensor'].concat(t),s=[n,'mathspeak.brief',l,'self::tensor'].concat(t);sre.MathspeakRules.defineRule_.apply(null,r),sre.MathspeakRules.defineRule_.apply(null,s),(0,sre.MathspeakRules.defineSpecialisedRule_)(n,'mathspeak.brief','mathspeak.sbrief'),r=sre.MathspeakRules.componentString_[2],e+='; [t]'+r+'Verbose',l+='; [t]'+r+'Brief',n+='-baseline',r=[n,'mathspeak.default',e,'self::tensor','following-sibling::*'].concat(t),s=[n,'mathspeak.brief',l,'self::tensor','following-sibling::*'].concat(t),sre.MathspeakRules.defineRule_.apply(null,r),sre.MathspeakRules.defineRule_.apply(null,s),(0,sre.MathspeakRules.defineSpecialisedRule_)(n,'mathspeak.brief','mathspeak.sbrief'),n=[n,'self::tensor','not(following-sibling::*)','ancestor::fraction|ancestor::punctuated|ancestor::fenced|ancestor::root|ancestor::sqrt|ancestor::relseq|ancestor::multirel|self::tensor[@embellished]'].concat(t),sre.MathspeakRules.defineRuleAlias_.apply(null,n)}},sre.CombinedStore=function(){},goog.addSingletonGetter(sre.CombinedStore),sre.CombinedStore.mathStore=sre.MathmlStore.getInstance(),sre.CombinedStore.mathStore.initialize=function(){sre.MathmlStoreRules.getInstance(),sre.SemanticTreeRules.getInstance(),sre.MathspeakRules.getInstance(),sre.CombinedStore.getInstance().updateEngine()},sre.CombinedStore.prototype.updateEngine=function(){var e=sre.MathMap.getInstance();if(sre.Engine.isReady()){var t=sre.Engine.getInstance(),a=sre.CombinedStore.mathStore.getDynamicConstraintValues();t.allDomains=sre.MathUtil.union(a.domain,e.allDomains),t.allStyles=sre.MathUtil.union(a.style,e.allStyles)}else setTimeout(sre.CombinedStore.getInstance().updateEngine,500)},sre.EnrichCase=function(){},sre.EnrichCase.prototype.getMathml=function(){},sre.AbstractEnrichCase=function(e){this.semantic=e},sre.EnrichCaseFactory=function(){},sre.EnrichCaseFactory.getEmbellishedCase=function(e){return new sre.EnrichCaseFactory.embellishedCase(e)},sre.EnrichCaseFactory.cases=[],sre.EnrichCaseFactory.getCase=function(e){for(var t,a=0;t=sre.EnrichCaseFactory.cases[a];a++)if(t.test(e))return new t.constr(e);return null},sre.AuditoryDescription=function(e){this.context=e.context?e.context:'',this.text=e.text?e.text:'',this.userValue=e.userValue?e.userValue:'',this.annotation=e.annotation?e.annotation:'',this.correction=e.correction?e.correction:'',this.personality=e.personality,this.preprocess=!!e.preprocess,this.bookmark=e.bookmark?e.bookmark:'0',this.nobookmark=!1},sre.AuditoryDescription.prototype.isEmpty=function(){return 0==this.context.length&&0==this.text.length&&0==this.userValue.length&&0==this.annotation.length},sre.AuditoryDescription.prototype.toString=function(){return'AuditoryDescription(context="'+this.context+'"  text="'+this.text+'"  userValue="'+this.userValue+'"  annotation="'+this.annotation+'")'},sre.AuditoryDescription.prototype.descriptionString=function(){return this.context&&''!=this.context?'<bookmark mark="0"/>'+this.context+' '+this.text:this.text},sre.AuditoryDescription.prototype.equals=function(e){return this.context==e.context&&this.text==e.text&&this.userValue==e.userValue&&this.annotation==e.annotation},sre.AuditoryDescription.toSimpleString=function(e,t){var a=''===t?'':t||' ';return sre.AuditoryDescription.preprocessDescriptionList_(e),sre.AuditoryDescription.addBookmarks(e),sre.BaseUtil.removeEmpty(e.map(function(e){return e.descriptionString()})).join(a)},sre.AuditoryDescription.addBookmarks=function(e){if(null!=e&&void 0!=e&&0<e.length){for(var t=!0,a=0;a<e.length;a++)if(e[a].nobookmark){t=!1;break}if(t){for(a=0;a<e.length;a++)''!=e[a].text&&null!=e[a].text&&(e[a].text=''==e[a].bookmark?'<bookmark mark="0"/>'+e[a].text.toUpperCase():'a'==e[a].text?'<bookmark mark="'+e[a].bookmark+'"/>'+e[a].text+'.':'<bookmark mark="'+e[a].bookmark+'"/>'+e[a].text);e[e.length-1].text=e[e.length-1].text.toUpperCase()+'<bookmark mark="0"/>'}}},sre.AuditoryDescription.preprocessString_=function(e){if('mathspeak'==sre.Engine.getInstance().domain&&e.match(/^\d{1}$/))return e;var t=sre.MathStore.createDynamicConstraint(sre.Engine.getInstance().domain,sre.Engine.getInstance().style);return sre.MathMap.getInstance().store.lookupString(e,t)||e},sre.AuditoryDescription.processCorrections_=function(e,t){if(!t||!e)return e;var n=t.split(/ |-/),n=new RegExp('^'+n.join('( |-)')+'( |-)');return e.replace(n,'')},sre.AuditoryDescription.preprocessDescription_=function(e){e.annotation&&(e.text+=':'+e.annotation),e.preprocess&&(e.text=sre.AuditoryDescription.processCorrections_(sre.AuditoryDescription.preprocessString_(e.text),e.correction),e.preprocess=!1)},sre.AuditoryDescription.preprocessDescriptionList_=function(e){for(var t,a=0;t=e[a];a++)sre.AuditoryDescription.preprocessDescription_(t)},sre.SpeechRuleEngine=function(){this.activeStore_=null,this.dynamicCstr={},this.dynamicCstr[sre.SpeechRule.DynamicCstrAttrib.STYLE]='short',this.globalParameters_={},this.cache_={}},goog.addSingletonGetter(sre.SpeechRuleEngine),sre.SpeechRuleEngine.prototype.setGlobalParameter=function(e,t){this.globalParameters_[e]=t},sre.SpeechRuleEngine.prototype.getGlobalParameter=function(e){return this.globalParameters_[e]},sre.SpeechRuleEngine.prototype.parameterize=function(e){try{e.initialize()}catch(e){if('StoreError'==e.name)console.log('Store Error:',e.message);else throw e}this.activeStore_=e},sre.SpeechRuleEngine.prototype.setDynamicConstraint=function(e){e&&(this.dynamicCstr=e)},sre.SpeechRuleEngine.prototype.constructString=function(e,t){if(!t)return'';if('"'==t.charAt(0))return t.slice(1,-1);var a=this.activeStore_.customStrings.lookup(t);return a?a(e):sre.XpathUtil.evaluateString(t,e)},sre.SpeechRuleEngine.prototype.clearCache=function(){this.cache_={}},sre.SpeechRuleEngine.prototype.getCacheForNode_=function(e){return e&&e.getAttribute?(e=e.getAttribute('id'),'undefined'===e||''===e?null:this.getCache_(e)):null},sre.SpeechRuleEngine.prototype.getCache_=function(e){return this.cache_[e]},sre.SpeechRuleEngine.prototype.pushCache_=function(e,t){if(e.getAttribute){var a=e.getAttribute('id');a&&(this.cache_[a]=t)}},sre.SpeechRuleEngine.prototype.evaluateNode=function(e){return e?this.evaluateTree_(e):[]},sre.SpeechRuleEngine.prototype.evaluateTree_=function(t){if(sre.Engine.getInstance().withCache){var a=this.getCacheForNode_(t);if(a)return a}var n=this.activeStore_.lookupRule(t,this.dynamicCstr);if(!n)return a=this.activeStore_.evaluateDefault(t),this.pushCache_(t,a),a;sre.Debugger.getInstance().generateOutput(goog.bind(function(){return[n.name,sre.SpeechRule.stringifyCstr(n.dynamicCstr),t.toString()]},this));for(var i,l=n.action.components,a=[],r=0;i=l[r];r++){var e=[],s=i.content||'';switch(i.type){case sre.SpeechRule.Type.NODE:(s=this.activeStore_.applyQuery(t,s))&&(e=this.evaluateTree_(s));break;case sre.SpeechRule.Type.MULTI:s=this.activeStore_.applySelector(t,s),0<s.length&&(e=this.evaluateNodeList_(s,i.sepFunc,this.constructString(t,i.separator),i.ctxtFunc,this.constructString(t,i.context),t.getAttribute('bookmark')));break;case sre.SpeechRule.Type.TEXT:if(s=this.constructString(t,s)){if(e=0,'Subscript'!=s&&'Baseline'!=s){for(var o=0;o<n.precondition.constraints.length;o++){try{e=sre.XpathUtil.evaluateXpath_(n.precondition.constraints[o],t,XPathResult.ANY_UNORDERED_NODE_TYPE).singleNodeValue.getAttribute('bookmark')}catch(e){}if(0!=e)break}1==t.childNodes.length&&void 0!=t.getAttribute('bookmark')&&null!=t.getAttribute('bookmark')&&(e=t.getAttribute('bookmark'))}e=[new sre.AuditoryDescription({text:s,bookmark:e})]}break;default:e=void 0!=i.pause&&0<i.pause?[new sre.AuditoryDescription({text:'<silence msec="'+i.pause+'"/>'})]:[new sre.AuditoryDescription({text:s})];}e[0]&&i.type!=sre.SpeechRule.Type.MULTI&&(i.context&&(e[0].context=this.constructString(t,i.context)+(e[0].context||'')),i.annotation&&(e[0].annotation=i.annotation),i.preprocess&&(e[0].preprocess=!0),null!=t.getAttribute('nobookmark')&&(e[0].nobookmark=!0)),a=a.concat(this.addPersonality_(e,i))}return this.pushCache_(t,a),a},sre.SpeechRuleEngine.prototype.evaluateNodeList_=function(t,a,n,i,l,e){if([]==t)return[];var r=n||'',s=l||'';n=(n=this.activeStore_.contextFunctions.lookup(i))?n(t,s):function(){return s},a=(a=this.activeStore_.contextFunctions.lookup(a))?a(t,r):function(){return new sre.AuditoryDescription({text:r,preprocess:!0})},i=[],l=0;for(var o;o=t[l];l++)o=this.evaluateTree_(o),0<o.length&&(o[0].context=n()+(o[0].context||''),i=i.concat(o),l<t.length-1&&(o=a(),o.bookmark=e||0,i=i.concat(o)));return i},sre.SpeechRuleEngine.prototype.addPersonality_=function(t,a){var n,i={};for(n in sre.Engine.personalityProps){var l=parseFloat(a[sre.Engine.personalityProps[n]]);isNaN(l)||(i[n]=l)}return t.forEach(goog.bind(function(e){this.addRelativePersonality_(e,i)},this)),t},sre.SpeechRuleEngine.prototype.addRelativePersonality_=function(e,t){if(!e.personality)return e.personality=t,e;var a,n=e.personality;for(a in t)n[a]=n[a]&&'number'==typeof n[a]?n[a]+t[a]:t[a];return e},sre.SpeechRuleEngine.prototype.toString=function(){return this.activeStore_.findAllRules(function(){return!0}).map(function(e){return e.toString()}).join('\n')},sre.SpeechRuleEngine.debugSpeechRule=function(e,t){var a=sre.SpeechRuleEngine.getInstance().activeStore_;a&&a.debugSpeechRule(e,t)},sre.SpeechRuleEngine.debugNamedSpeechRule=function(t,a){var n=sre.SpeechRuleEngine.getInstance().activeStore_;if(n)for(var i,l=n.findAllRules(function(e){return e.name==t}),r=0;i=l[r];r++)sre.Debugger.getInstance().output('Rule',t,'DynamicCstr:',sre.SpeechRule.stringifyCstr(i.dynamicCstr),'number',r),n.debugSpeechRule(i,a)},sre.EnrichMathml=function(){},sre.EnrichMathml.Error=function(e){Error.call(this),this.message=e||'',this.name='MathML Enrichment Error'},goog.inherits(sre.EnrichMathml.Error,Error),sre.EnrichMathml.SETTINGS={collapsed:!0,implicit:!0},sre.EnrichMathml.ATTRIBUTE_PREFIX_='data-semantic-',sre.EnrichMathml.Attribute={ADDED:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'added',CHILDREN:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'children',COLLAPSED:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'collapsed',CONTENT:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'content',FONT:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'font',ID:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'id',OPERATOR:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'operator',PARENT:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'parent',ROLE:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'role',SPEECH:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'speech',TYPE:sre.EnrichMathml.ATTRIBUTE_PREFIX_+'type'},sre.EnrichMathml.enrich=function(e,t){var a=sre.Engine.getInstance();a.style='default',a.domain='mathspeak',a.semantics=!0,sre.SpeechRuleEngine.getInstance().clearCache(),sre.SpeechRuleEngine.getInstance().parameterize(sre.MathmlStore.getInstance()),sre.SpeechRuleEngine.getInstance().dynamicCstr=sre.MathStore.createDynamicConstraint(a.domain,a.style);var n=e.cloneNode(!0);return sre.EnrichMathml.walkTree(t.root),sre.Debugger.getInstance().generateOutput(function(){return sre.EnrichMathml.formattedOutput(n,e,t,!0),[]}),e},sre.EnrichMathml.walkTree=function(e){var t=sre.EnrichCaseFactory.getCase(e);if(t)return t=t.getMathml(),sre.EnrichMathml.ascendNewNode(t);if(1===e.mathml.length)return sre.Debugger.getInstance().output('Walktree Case 0'),t=e.mathml[0],sre.EnrichMathml.setAttributes(t,e),sre.EnrichMathml.ascendNewNode(t);var t=e.contentNodes.map(sre.EnrichMathml.cloneContentNode),a=e.childNodes.map(sre.EnrichMathml.walkTree),a=sre.EnrichMathml.combineContentChildren_(e,t,a),t=e.mathmlTree;if(null===t)sre.Debugger.getInstance().output('Walktree Case 1'),t=sre.EnrichMathml.introduceNewLayer(a);else{var n=sre.EnrichMathml.attachedElement_(a);sre.Debugger.getInstance().output('Walktree Case 2'),n?(sre.Debugger.getInstance().output('Walktree Case 2.1'),t=n.parentNode):(sre.Debugger.getInstance().output('Walktree Case 2.2'),t=sre.EnrichMathml.getInnerNode(t))}return t=sre.EnrichMathml.rewriteMfenced(t),sre.EnrichMathml.mergeChildren_(t,a),sre.EnrichMathml.setAttributes(t,e),sre.EnrichMathml.ascendNewNode(t)},sre.EnrichMathml.introduceNewLayer=function(e){var t=sre.EnrichMathml.mathmlLca_(e),n=t.node;return t.valid&&sre.SemanticUtil.hasEmptyTag(n)||(sre.Debugger.getInstance().output('Walktree Case 1.1'),n=sre.SystemExternal.document.createElement('mrow'),e[0]&&(sre.Debugger.getInstance().output('Walktree Case 1.1.1'),t=sre.EnrichMathml.attachedElement_(e),e=sre.EnrichMathml.childrenSubset_(t.parentNode,e),sre.DomUtil.replaceNode(t,n),e.forEach(function(e){n.appendChild(e)}))),n},sre.EnrichMathml.childrenSubset_=function(t,a){var n=sre.DomUtil.toArray(t.childNodes),i=Infinity,l=-Infinity;return a.forEach(function(e){e=n.indexOf(e),-1!==e&&(i=Math.min(i,e),l=Math.max(l,e))}),n.slice(i,l+1)},sre.EnrichMathml.mergeChildren_=function(e,t){var a=e.childNodes;if(a.length)for(var n=0;t.length;)a[n]===t[0]||sre.EnrichMathml.functionApplication_(a[n],t[0])?(t.shift(),n++):a[n]&&-1===t.indexOf(a[n])?n++:(e.insertBefore(t[0],a[n]),t.shift());else t.forEach(function(t){e.appendChild(t)})},sre.EnrichMathml.functionApplication_=function(e,t){var a=sre.SemanticAttr.functionApplication();return e&&t&&e.textContent&&t.textContent&&e.textContent===a&&t.textContent===a&&'true'===t.getAttribute(sre.EnrichMathml.Attribute.ADDED)&&(sre.DomUtil.replaceNode(e,t),!0)},sre.EnrichMathml.mathmlLca_=function(e){var t=sre.EnrichMathml.attachedElement_(e);if(!t)return{valid:!1,node:null};if(e=sre.EnrichMathml.attachedElement_(e.slice().reverse()),t===e)return{valid:!0,node:t};var n=sre.EnrichMathml.pathToRoot_(t),t=sre.EnrichMathml.pathToRoot_(e,function(e){return-1!==n.indexOf(e)});e=t[0];var i=n.indexOf(e);return-1===i?{valid:!1,node:null}:{valid:sre.EnrichMathml.validLca_(n[i+1],t[1]),node:e}},sre.EnrichMathml.attachedElement_=function(e){for(var t=0,a=null;!a&&t<e.length;)e[t].parentNode&&(a=e[t]),t++;return a},sre.EnrichMathml.pathToRoot_=function(e,t){for(var a=t||function(){return!1},n=[e];!a(e)&&!sre.SemanticUtil.hasMathTag(e)&&e.parentNode;)e=sre.EnrichMathml.parentNode_(e),n.unshift(e);return n},sre.EnrichMathml.validLca_=function(e,t){return e&&t&&!e.previousSibling&&!t.nextSibling},sre.EnrichMathml.ascendNewNode=function(e){for(;!sre.SemanticUtil.hasMathTag(e)&&sre.EnrichMathml.unitChild_(e);)e=sre.EnrichMathml.parentNode_(e);return e},sre.EnrichMathml.unitChild_=function(e){var t=sre.EnrichMathml.parentNode_(e);return t&&sre.SemanticUtil.hasEmptyTag(t)&&sre.DomUtil.toArray(t.childNodes).every(function(t){return t===e||sre.SemanticUtil.hasIgnoreTag(t)})},sre.EnrichMathml.parentNode_=function(e){return e.parentNode},sre.EnrichMathml.simpleCollapseStructure=function(e){return'number'==typeof e},sre.EnrichMathml.interleaveIds=function(e,t){return sre.BaseUtil.interleaveLists(sre.EnrichMathml.collapsedLeafs(e),sre.EnrichMathml.collapsedLeafs(t))},sre.EnrichMathml.collapsedLeafs=function(){var e=function(e){return sre.EnrichMathml.simpleCollapseStructure(e)?[e]:e.slice(1)};return Array.prototype.slice.call(arguments,0).reduce(function(t,a){return t.concat(e(a))},[])},sre.EnrichMathml.addCollapsedAttribute=function(e,t){var n=function(e){return sre.EnrichMathml.simpleCollapseStructure(e)?e.toString():'('+e.map(n).join(' ')+')'};e.setAttribute(sre.EnrichMathml.Attribute.COLLAPSED,n(t))},sre.EnrichMathml.cloneContentNode=function(e){if(e.mathml.length)return sre.EnrichMathml.walkTree(e);var t=sre.EnrichMathml.SETTINGS.implicit?sre.EnrichMathml.createInvisibleOperator_(e):sre.SystemExternal.document.createElement('mrow');return e.mathml=[t],t},sre.EnrichMathml.makeIdList=function(e){return e.map(function(e){return e.id}).join(',')},sre.EnrichMathml.setAttributes=function(e,t){e.setAttribute(sre.EnrichMathml.Attribute.TYPE,t.type),e.setAttribute(sre.EnrichMathml.Attribute.ROLE,t.role),e.setAttribute(sre.EnrichMathml.Attribute.ID,t.id),t.childNodes.length&&e.setAttribute(sre.EnrichMathml.Attribute.CHILDREN,sre.EnrichMathml.makeIdList(t.childNodes)),t.contentNodes.length&&e.setAttribute(sre.EnrichMathml.Attribute.CONTENT,sre.EnrichMathml.makeIdList(t.contentNodes)),t.parent&&e.setAttribute(sre.EnrichMathml.Attribute.PARENT,t.parent.id),sre.Engine.getInstance().speech&&sre.EnrichMathml.addSpeech(e,t)},sre.EnrichMathml.addSpeech=function(e,t){var a=sre.DomUtil.parseInput('<stree>'+t.toString()+'</stree>',sre.EnrichMathml.Error),a=sre.SpeechRuleEngine.getInstance().evaluateNode(a),a=sre.AuditoryDescription.toSimpleString(a);e.setAttribute(sre.EnrichMathml.Attribute.SPEECH,a)},sre.EnrichMathml.combineContentChildren_=function(t,a,n){switch(sre.EnrichMathml.setOperatorAttribute_(t,a),t.type){case sre.SemanticAttr.Type.RELSEQ:case sre.SemanticAttr.Type.INFIXOP:case sre.SemanticAttr.Type.MULTIREL:return sre.BaseUtil.interleaveLists(n,a);case sre.SemanticAttr.Type.PREFIXOP:return a.concat(n);case sre.SemanticAttr.Type.POSTFIXOP:return n.concat(a);case sre.SemanticAttr.Type.FENCED:return n.unshift(a[0]),n.push(a[1]),n;case sre.SemanticAttr.Type.PUNCTUATED:if(t.role===sre.SemanticAttr.Role.TEXT)return sre.BaseUtil.interleaveLists(n,a);for(var i,l,r=[],s=0,e=0;i=n[s],l=a[e];s++)i.getAttribute(sre.EnrichMathml.Attribute.ID)==l.getAttribute(sre.EnrichMathml.Attribute.ID)&&(e++,r.push(i));return sre.EnrichMathml.setOperatorAttribute_(t,r),n;case sre.SemanticAttr.Type.APPL:return[n[0],a[0],n[1]];case sre.SemanticAttr.Type.ROOT:return[n[1],n[0]];default:return n;}},sre.EnrichMathml.rewriteMfenced=function(e){if('MFENCED'!==sre.SemanticUtil.tagName(e))return e;for(var t,n=sre.SystemExternal.document.createElement('mrow'),a=0;t=e.attributes[a];a++)-1===['open','close','separators'].indexOf(t.name)&&n.setAttribute(t.name,t.value);return sre.DomUtil.toArray(e.childNodes).forEach(function(e){n.appendChild(e)}),sre.DomUtil.replaceNode(e,n),n},sre.EnrichMathml.createInvisibleOperator_=function(e){var t=sre.SystemExternal.document.createElement('mo'),a=sre.SystemExternal.document.createTextNode(e.textContent);return t.appendChild(a),sre.EnrichMathml.setAttributes(t,e),t.setAttribute(sre.EnrichMathml.Attribute.ADDED,'true'),t},sre.EnrichMathml.setOperatorAttribute_=function(e,t){var n=e.type+(e.textContent?','+e.textContent:'');t.forEach(function(e){sre.EnrichMathml.getInnerNode(e).setAttribute(sre.EnrichMathml.Attribute.OPERATOR,n)})},sre.EnrichMathml.getInnerNode=function(t){var a=sre.DomUtil.toArray(t.childNodes);if(!a)return t;for(var n,a=a.filter(function(e){return e.nodeType===sre.DomUtil.NodeType.ELEMENT_NODE&&!sre.SemanticUtil.hasIgnoreTag(e)}),e=[],i=0;n=a[i];i++)if(sre.SemanticUtil.hasEmptyTag(n)){var l=sre.EnrichMathml.getInnerNode(n);l&&l!==n&&e.push(l)}else e.push(n);return 1===e.length?e[0]:t},sre.EnrichMathml.formattedOutput=function(e,t,a,n){n=n||!1,sre.EnrichMathml.formattedOutput_(e,'Original MathML',n),sre.EnrichMathml.formattedOutput_(a,'Semantic Tree',n),sre.EnrichMathml.formattedOutput_(t,'Semantically enriched MathML',n)},sre.EnrichMathml.formattedOutput_=function(e,t,a){e=sre.SemanticTree.formatXml(e.toString()),a?console.log(t+':\n```html\n'+sre.EnrichMathml.removeAttributePrefix(e)+'\n```\n'):console.log(e)},sre.EnrichMathml.removeAttributePrefix=function(e){return e.toString().replace(new RegExp(sre.EnrichMathml.ATTRIBUTE_PREFIX_,'g'),'')},sre.EnrichMathml.printNodeList__=function(e,t){console.log(e),sre.DomUtil.toArray(t).forEach(function(e){console.log(e.toString())}),console.log('<<<<<<<<<<<<<<<<<')},sre.CaseDoubleScript=function(e){sre.AbstractEnrichCase.call(this,e),this.mml=e.mathmlTree},goog.inherits(sre.CaseDoubleScript,sre.AbstractEnrichCase),sre.CaseDoubleScript.test=function(e){if(!e.mathmlTree)return!1;var t=sre.SemanticUtil.tagName(e.mathmlTree);return'MSUBSUP'===t&&e.type===sre.SemanticAttr.Type.SUPERSCRIPT||'MUNDEROVER'===t&&e.type===sre.SemanticAttr.Type.OVERSCORE},sre.CaseDoubleScript.prototype.getMathml=function(){var t=this.semantic.childNodes[1],a=this.semantic.childNodes[0],n=a.childNodes[0],i=a.childNodes[1],l=sre.EnrichMathml.walkTree(t),e=sre.EnrichMathml.walkTree(n),r=sre.EnrichMathml.walkTree(i);return sre.EnrichMathml.setAttributes(this.mml,this.semantic),this.mml.setAttribute(sre.EnrichMathml.Attribute.CHILDREN,sre.EnrichMathml.makeIdList([n,i,t])),[e,r,l].forEach(goog.bind(function(e){sre.EnrichMathml.getInnerNode(e).setAttribute(sre.EnrichMathml.Attribute.PARENT,this.mml.getAttribute(sre.EnrichMathml.Attribute.ID))},this)),this.mml.setAttribute(sre.EnrichMathml.Attribute.TYPE,a.role),sre.EnrichMathml.addCollapsedAttribute(this.mml,[this.semantic.id,[a.id,n.id,i.id],t.id]),this.mml},sre.CaseMultiindex=function(e){sre.AbstractEnrichCase.call(this,e),this.mml=e.mathmlTree},goog.inherits(sre.CaseMultiindex,sre.AbstractEnrichCase),sre.CaseMultiindex.prototype.completeMultiscript=function(t,a){var n=sre.DomUtil.toArray(this.mml.childNodes).slice(1),i=0,l=goog.bind(function(t){for(var r,e,a=0;r=t[a];a++)if(e=n[i],e&&r==sre.EnrichMathml.getInnerNode(e).getAttribute(sre.EnrichMathml.Attribute.ID))sre.EnrichMathml.getInnerNode(e).setAttribute(sre.EnrichMathml.Attribute.PARENT,this.semantic.id),i++;else{var s=this.semantic.querySelectorAll(function(e){return e.id===r});this.mml.insertBefore(sre.CaseMultiindex.createNone_(s[0]),e)}},this);l(t),n[i]&&'MPRESCRIPTS'!==sre.SemanticUtil.tagName(n[i])?this.mml.insertBefore(n[i],sre.SystemExternal.document.createElement('mprescripts')):i++,l(a)},sre.CaseMultiindex.createNone_=function(e){var t=sre.SystemExternal.document.createElement('none');return e&&sre.EnrichMathml.setAttributes(t,e),t.setAttribute(sre.EnrichMathml.Attribute.ADDED,'true'),t},sre.CaseMultiindex.multiscriptIndex=function(t){if(t.type===sre.SemanticAttr.Type.PUNCTUATED&&t.contentNodes[0].role===sre.SemanticAttr.Role.DUMMY){for(var a,n=t.role,i=t.parent.id,l=[t.id],r=0;a=t.childNodes[r];r++){var e=sre.EnrichMathml.walkTree(a),e=sre.EnrichMathml.getInnerNode(e);e.setAttribute(sre.EnrichMathml.Attribute.PARENT,i),e.setAttribute(sre.EnrichMathml.Attribute.ROLE,n),l.push(a.id)}return l}return sre.EnrichMathml.walkTree(t),t.id},sre.CaseTensor=function(e){sre.CaseMultiindex.call(this,e)},goog.inherits(sre.CaseTensor,sre.CaseMultiindex),sre.CaseTensor.test=function(e){return e.mathmlTree&&e.type===sre.SemanticAttr.Type.TENSOR},sre.CaseTensor.prototype.getMathml=function(){sre.EnrichMathml.walkTree(this.semantic.childNodes[0]);var t=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[1]),a=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[2]),n=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[3]),i=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[4]);sre.EnrichMathml.setAttributes(this.mml,this.semantic);var l=[this.semantic.id,t,a,n,i];return l.every(sre.EnrichMathml.simpleCollapseStructure)||sre.EnrichMathml.addCollapsedAttribute(this.mml,l),l=sre.EnrichMathml.collapsedLeafs(t,a,n,i),l.unshift(this.semantic.childNodes[0].id),this.mml.setAttribute(sre.EnrichMathml.Attribute.CHILDREN,l.join(',')),this.completeMultiscript(sre.EnrichMathml.interleaveIds(n,i),sre.EnrichMathml.interleaveIds(t,a)),this.mml},sre.CaseLine=function(e){sre.AbstractEnrichCase.call(this,e),this.mml=e.mathmlTree},goog.inherits(sre.CaseLine,sre.AbstractEnrichCase),sre.CaseLine.test=function(e){return e.mathmlTree&&e.type===sre.SemanticAttr.Type.LINE},sre.CaseLine.prototype.getMathml=function(){return this.semantic.childNodes.length&&sre.EnrichMathml.walkTree(this.semantic.childNodes[0]),sre.EnrichMathml.setAttributes(this.mml,this.semantic),this.mml},sre.CaseMultiscripts=function(e){sre.CaseMultiindex.call(this,e)},goog.inherits(sre.CaseMultiscripts,sre.CaseMultiindex),sre.CaseMultiscripts.test=function(e){return!!e.mathmlTree&&'MMULTISCRIPTS'===sre.SemanticUtil.tagName(e.mathmlTree)&&(e.type===sre.SemanticAttr.Type.SUPERSCRIPT||e.type===sre.SemanticAttr.Type.SUBSCRIPT)},sre.CaseMultiscripts.prototype.getMathml=function(){if(sre.EnrichMathml.setAttributes(this.mml,this.semantic),this.semantic.childNodes[0]&&this.semantic.childNodes[0].role===sre.SemanticAttr.Role.SUBSUP){var t=this.semantic.childNodes[0],a=t.childNodes[0],n=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[1]),i=sre.CaseMultiindex.multiscriptIndex(t.childNodes[1]),l=[this.semantic.id,[t.id,a.id,i],n];sre.EnrichMathml.addCollapsedAttribute(this.mml,l),this.mml.setAttribute(sre.EnrichMathml.Attribute.TYPE,t.role),this.completeMultiscript(sre.EnrichMathml.interleaveIds(i,n),[])}else a=this.semantic.childNodes[0],n=sre.CaseMultiindex.multiscriptIndex(this.semantic.childNodes[1]),sre.EnrichMathml.simpleCollapseStructure(n)||(l=[this.semantic.id,a.id,n],sre.EnrichMathml.addCollapsedAttribute(this.mml,l));return t=sre.EnrichMathml.collapsedLeafs(i||[],n),n=sre.EnrichMathml.walkTree(a),sre.EnrichMathml.getInnerNode(n).setAttribute(sre.EnrichMathml.Attribute.PARENT,this.semantic.id),t.unshift(a.id),this.mml.setAttribute(sre.EnrichMathml.Attribute.CHILDREN,t.join(',')),this.mml},sre.CaseEmbellished=function(e){sre.AbstractEnrichCase.call(this,e),this.ofenceMml=this.ofence=this.fencedMml=this.fenced=null,this.ofenceMap={},this.cfenceMml=this.cfence=null,this.cfenceMap={},this.parentCleanup=[]},goog.inherits(sre.CaseEmbellished,sre.AbstractEnrichCase),sre.CaseEmbellished.test=function(e){return e.mathmlTree&&e.fencePointer},sre.CaseEmbellished.prototype.getMathml=function(){return this.getFenced_(),this.fencedMml=sre.EnrichMathml.walkTree(this.fenced),this.getFencesMml_(),this.rewrite_()},sre.CaseEmbellished.prototype.getFenced_=function(){for(var e=this.semantic;e.type!==sre.SemanticAttr.Type.FENCED;)e=e.childNodes[0];this.fenced=e.childNodes[0],this.ofence=e.contentNodes[0],this.cfence=e.contentNodes[1],sre.CaseEmbellished.fencedMap_(this.ofence,this.ofenceMap),sre.CaseEmbellished.fencedMap_(this.cfence,this.cfenceMap)},sre.CaseEmbellished.fencedMap_=function(e,t){t[e.id]=e.mathmlTree,e.embellished&&sre.CaseEmbellished.fencedMap_(e.childNodes[0],t)},sre.CaseEmbellished.prototype.getFencesMml_=function(){for(var e=this.semantic,t=Object.keys(this.ofenceMap),a=Object.keys(this.cfenceMap);!(this.ofenceMml&&this.cfenceMml||e===this.fenced);)-1===t.indexOf(e.fencePointer)||this.ofenceMml||(this.ofenceMml=e.mathmlTree),-1===a.indexOf(e.fencePointer)||this.cfenceMml||(this.cfenceMml=e.mathmlTree),e=e.childNodes[0];this.ofenceMml||(this.ofenceMml=this.ofence.mathmlTree),this.cfenceMml||(this.cfenceMml=this.cfence.mathmlTree),this.ofenceMml&&(this.ofenceMml=sre.EnrichMathml.ascendNewNode(this.ofenceMml)),this.cfenceMml&&(this.cfenceMml=sre.EnrichMathml.ascendNewNode(this.cfenceMml))},sre.CaseEmbellished.prototype.rewrite_=function(){var t=this.semantic,a=null,n=this.introduceNewLayer_();for(sre.EnrichMathml.setAttributes(n,this.fenced.parent);t.type!==sre.SemanticAttr.Type.FENCED;){var i=t.mathmlTree,l=this.specialCase_(t,i);if(l)t=l;else{sre.EnrichMathml.setAttributes(i,t);for(var e,l=[],r=1;e=t.childNodes[r];r++)l.push(sre.EnrichMathml.walkTree(e));t=t.childNodes[0]}l=sre.SystemExternal.document.createElement('dummy'),r=n.parentNode,e=i.childNodes[0],sre.DomUtil.replaceNode(i,l),sre.DomUtil.replaceNode(n,i),sre.DomUtil.replaceNode(i.childNodes[0],n),sre.DomUtil.replaceNode(l,e),i.parentNode=r,n=i.childNodes[0],a||(a=i)}return sre.EnrichMathml.walkTree(this.ofence),sre.EnrichMathml.walkTree(this.cfence),this.cleanupParents_(),a||n},sre.CaseEmbellished.prototype.specialCase_=function(t,a){var n=sre.SemanticUtil.tagName(a),i=null;if('MSUBSUP'===n)var i=t.childNodes[0],l=sre.CaseDoubleScript;else'MMULTISCRIPTS'!==n||t.type!==sre.SemanticAttr.Type.SUPERSCRIPT&&t.type!==sre.SemanticAttr.Type.SUBSCRIPT||(l=sre.CaseMultiscripts,i=t.childNodes[0]&&t.childNodes[0].role===sre.SemanticAttr.Role.SUBSUP?t.childNodes[0]:t);if(!i)return null;var n=i.childNodes[0],e=sre.CaseEmbellished.makeEmptyNode_(n.id);return i.childNodes[0]=e,a=new l(t).getMathml(),i.childNodes[0]=n,this.parentCleanup.push(a),i.childNodes[0]},sre.CaseEmbellished.makeEmptyNode_=function(e){var t=sre.SystemExternal.document.createElement('mrow');return e=new sre.SemanticTree.Node(e),e.type=sre.SemanticAttr.Type.EMPTY,e.mathmlTree=t,e},sre.CaseEmbellished.prototype.introduceNewLayer_=function(){var e=this.fullFence(this.ofenceMml),t=this.fullFence(this.cfenceMml),a=sre.SystemExternal.document.createElement('mrow');if(sre.DomUtil.replaceNode(this.fencedMml,a),a.appendChild(this.fencedMml),a.insertBefore(e,this.fencedMml),a.appendChild(t),!a.parentNode){for(e=sre.SystemExternal.document.createElement('mrow');0<a.childNodes.length;)e.appendChild(a.childNodes[0]);a.appendChild(e),a=e}return a},sre.CaseEmbellished.prototype.fullFence=function(e){for(var t=this.fencedMml.parentNode;e.parentNode&&e.parentNode!==t;)e=e.parentNode;return e},sre.CaseEmbellished.prototype.cleanupParents_=function(){this.parentCleanup.forEach(function(e){var t=e.childNodes[1].getAttribute(sre.EnrichMathml.Attribute.PARENT);e.childNodes[0].setAttribute(sre.EnrichMathml.Attribute.PARENT,t)})},sre.CaseTable=function(e){sre.AbstractEnrichCase.call(this,e),this.mml=e.mathmlTree},goog.inherits(sre.CaseTable,sre.AbstractEnrichCase),sre.CaseTable.test=function(e){return e.mathmlTree&&(e.type===sre.SemanticAttr.Type.MATRIX||e.type===sre.SemanticAttr.Type.VECTOR||e.type===sre.SemanticAttr.Type.CASES)},sre.CaseTable.prototype.getMathml=function(){var e=sre.EnrichMathml.cloneContentNode(this.semantic.contentNodes[0]),t=this.semantic.contentNodes[1]?sre.EnrichMathml.cloneContentNode(this.semantic.contentNodes[1]):null;return this.semantic.childNodes.map(sre.EnrichMathml.walkTree),'MFENCED'===sre.SemanticUtil.tagName(this.mml)?(this.mml.insertBefore(e,this.mml.childNodes[0]),t&&this.mml.appendChild(t),this.mml=sre.EnrichMathml.rewriteMfenced(this.mml)):(e=[e,this.mml],t&&e.push(t),this.mml=sre.EnrichMathml.introduceNewLayer(e)),sre.EnrichMathml.setAttributes(this.mml,this.semantic),this.mml},sre.EnrichCases=function(){},sre.EnrichCaseFactory.cases.push({test:sre.CaseEmbellished.test,constr:sre.CaseEmbellished},{test:sre.CaseDoubleScript.test,constr:sre.CaseDoubleScript},{test:sre.CaseTensor.test,constr:sre.CaseTensor},{test:sre.CaseMultiscripts.test,constr:sre.CaseMultiscripts},{test:sre.CaseLine.test,constr:sre.CaseLine},{test:sre.CaseTable.test,constr:sre.CaseTable}),sre.Enrich={},sre.Enrich.semanticMathmlNode=function(e){e=e.cloneNode(!0);var t=new sre.SemanticTree(e);return sre.EnrichMathml.enrich(e,t)},sre.Enrich.semanticMathmlSync=function(e){return e=sre.DomUtil.parseInput(e),sre.Enrich.semanticMathmlNode(e)},sre.Enrich.semanticMathml=function(e,t){if(sre.Engine.isReady()){var a=sre.DomUtil.parseInput(e);t(sre.Enrich.semanticMathmlNode(a))}else setTimeout(function(){sre.Enrich.semanticMathml(e,t)},500)},sre.Enrich.testTranslation__=function(e){return sre.Debugger.getInstance().init(),e=sre.Enrich.semanticMathmlSync(sre.Enrich.prepareMmlString(e)).toString(),sre.EnrichMathml.removeAttributePrefix(e),sre.Debugger.getInstance().exit(),e},sre.Enrich.prepareMmlString=function(e){return e.match(/^<math/)||(e='<math>'+e),e.match(/\/math>$/)||(e+='</math>'),e},sre.System=function(){this.version='0.8'},goog.addSingletonGetter(sre.System),sre.System.Error=function(e){Error.call(this),this.message=e||'',this.name='System Error'},goog.inherits(sre.System.Error,Error),sre.System.prototype.setupEngine=function(e){var t=sre.Engine.getInstance();t.style=e.style||t.style,t.domain=e.domain||t.domain,t.semantics=!!e.semantics,void 0!==e.cache&&(t.withCache=!!e.cache),t.mode=e.mode||t.mode,t.speech=!!e.speech,sre.SpeechRuleEngine.getInstance().parameterize(sre.MathmlStore.getInstance()),sre.SpeechRuleEngine.getInstance().dynamicCstr=sre.MathStore.createDynamicConstraint(t.domain,t.style)},sre.System.prototype.processExpression=function(e){try{var t=sre.DomUtil.parseInput(e,sre.System.Error);sre.Engine.getInstance().semantics&&(t=this.getSemanticTree_(t)),sre.Debugger.getInstance().generateOutput(goog.bind(function(){return t.toString()},this))}catch(e){return console.log('Parse Error: '+e.message),''}return sre.SpeechRuleEngine.getInstance().clearCache(),e=sre.SpeechRuleEngine.getInstance().evaluateNode(t),sre.AuditoryDescription.toSimpleString(e)},sre.System.prototype.getSemanticTree_=function(e){return e=sre.Semantic.getTree(e),sre.Engine.getInstance().mode===sre.Engine.Mode.HTTP?e.childNodes[0]:sre.DomUtil.parseInput(e.toString(),sre.System.Error)},sre.System.prototype.processFile_=function(e){try{var t=sre.SystemExternal.fs.readFileSync(e,{encoding:'utf8'})}catch(t){throw new sre.System.Error('Can not open file: '+e)}return this.processExpression(t)},sre.System.prototype.processFile=function(e,t){var a=this.processFile_(e);if(t)try{sre.SystemExternal.fs.writeFileSync(t,a)}catch(e){throw new sre.System.Error('Can not write to file: '+t)}else console.log(a)},sre.Browser={},sre.System.getInstance().setupEngine({mode:sre.Engine.Mode.HTTP});