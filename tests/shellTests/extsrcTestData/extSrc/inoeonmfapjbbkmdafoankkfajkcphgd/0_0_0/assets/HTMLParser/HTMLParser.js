!function d(g,e,t){function r(o,a){if(!e[o]){if(!g[o]){var i="function"==typeof require&&require;if(!a&&i)return i(o,!0);if(n)return n(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var u=e[o]={exports:{}};g[o][0].call(u.exports,function(t){var e=g[o][1][t];return r(e?e:t)},u,u.exports,d,g,e,t)}return e[o].exports}for(var n="function"==typeof require&&require,o=0;o<t.length;o++)r(t[o]);return r}({1:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HIGHLIGHT_TAG="texthelp-highlight-span",t.WRAPPER_TAG="texthelp-wrapper-span",t.THDomRange_ERROR=-1,t.THDomRange_TARGET_SAME=0,t.THDomRange_AFTER_TARGET=1,t.THDomRange_BEFORE_TARGET=2,t.THDomRange_TARGET_INSIDE=3,t.THDomRange_TARGET_INCLUDES_THIS=4,t.THDomRange_OVERLAPS_END_OF_TARGET=5,t.THDomRange_OVERLAPS_START_OF_TARGET=6,t.THDomRange_TARGET_INCLUDES_THIS_AT_START=7,t.THDomRange_TARGET_INCLUDES_THIS_AT_END=8,t.SPEECH_RANGE_COLOUR="colour:#rrggbb; background:#FFFF00",t.SPEECH_WORD_COLOUR="color:#FFFFFF; background:#0000FF; padding: 2px; margin: -2px; border-radius: 4px; text-shadow: 0 3px 8px #2A2A2A;position:relative"},{}],2:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.Attribute=function(){function t(){n(this,t)}return o(t,[{key:"rw_getAttribute",value:function(a,e){if(null!=a&&1==a.nodeType&&"string"==typeof e){var o=null;return 0!=e.indexOf("data-texthelp-")&&(o=a.getAttribute("data-texthelp-"+e)),null==o&&0!=e.indexOf("data-")&&(o=a.getAttribute("data-"+e)),null==o&&(o=a.getAttribute(e)),o}return null}},{key:"rw_setAttribute",value:function(a,e,o){null!=a&&1==a.nodeType&&"string"==typeof e&&"string"==typeof o&&(0!=e.indexOf("data-")&&"style"!=e&&(e="data-"+e),a.setAttribute(e,o))}},{key:"rw_removeAttribute",value:function(n,e){if(null!=n&&1==n.nodeType&&"string"==typeof e){if(0!=e.indexOf("data-")&&null!=n.getAttribute("data-"+e))return void n.removeAttribute("data-"+e);null!=n.getAttribute(e)&&n.removeAttribute(e)}}}]),t}()},{}],3:[function(r,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.DomNavigation=void 0;var i=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),d=r("../Utilities/Utilities"),g=r("./SSDOM"),p=r("./Attribute"),l=r("../MathJax/MathSpeak"),a=(r("../THCaret"),r("../THCaretRange"),r("../../Constants/Constants")),o=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(a);t.DomNavigation=function(){function t(){n(this,t)}return i(t,[{key:"getActualNextNodeIgnoreChildren",value:function(a,e){if(null==a||a==e)return null;if(null!=a.nextSibling)return a.nextSibling;for(var t=a;null!=t;){if(t=t.parentNode,e==t)return null;if(null!=t.nextSibling)return t.nextSibling}return null}},{key:"getActualNextNode",value:function(a,e){if(null==a)return null;if(null!=a.firstChild)return a.firstChild;if(a==e)return null;if(null!=a.nextSibling)return a.nextSibling;for(var t=a;null!=t;){if(t=t.parentNode,e==t)return null;if(null!=t.nextSibling)return t.nextSibling}return null}},{key:"getNodeFromPosition",value:function(d,e){var t=new p.Attribute,n=d;if(-1<e.lastIndexOf("*")){var r=e.lastIndexOf("*");e=e.substring(r+1)}var i,s=e.split("~"),a=s.length;for(i=a-2;-1<i;i--){if(n=n.firstChild,null==n)return null;var l=0==s[i].length?0:parseInt(s[i],10);for(var g=!1,u=3==n.nodeType||1==n.nodeType&&n.tagName.toLowerCase()==o.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(n,"rwstate");0<l;){if(n=n.nextSibling,null==n)return null;g=3==n.nodeType||1==n.nodeType&&n.tagName.toLowerCase()==o.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(n,"rwstate"),g&&u||(--l,u=g)}}return n}},{key:"getTextFromNode",value:function(a){var e=new g.SSDOM,t=new p.Attribute,n="";if(e.isInvalidNode(a)||e.isIgnored(a))return n;if(3==a.nodeType)"textarea"!=a.parentNode.tagName.toLowerCase()&&(n=a.nodeValue);else if(1==a.nodeType){var r=a.tagName.toLowerCase();if("img"==r){var i=t.rw_getAttribute(a,"alt");null!=i&&0<i.trimTH().length&&(n=" "+i.trimTH()+" ")}else if("span"==r){var i=t.rw_getAttribute(a,"pron");if(null!=i&&0<i.trimTH().length&&(n=i.trimTH()),i=t.rw_getAttribute(a,"chunk"),null!=i&&"1"==i&&(n=a.innerHTML),i=a.isMathJax){var o=new l.MathSpeak;n=o.getTextFromMathJax(a)}}else if("acronym"==r||"abbr"==r){var i=t.rw_getAttribute(a,"pron"),s=new d.Utilities;null!=i&&0<s.trim(i).length?n=s.trim(i):(i=a.getAttribute("title"),null!=i&&0<s.trim(i).length&&(n=s.trim(i)))}else"math"==r&&(n=this.getTextFromMathMl(a))}return n}},{key:"getNextNodeAllowMoveToChild",value:function(a,e,t){return this.getNextNodeImpl(a,e,t,!0,!1)}},{key:"getNextNodeIgnoreChildren",value:function(a,e,t){return this.getNextNodeImpl(a,e,t,!1,!0)}},{key:"getLastChildTextNode",value:function(d,e){var t=new p.Attribute,n=new g.SSDOM;if(null==d||null==d.lastChild||n.isInvalidNode(d))return d;if(n.isSpecialCaseWithIgnoredContent(d))return d;for(var r,l=d.lastChild;null!=l;){if(r=n.isIgnored(d),!r&&3==l.nodeType)return l;if(!r&&1==l.nodeType&&e&&"img"==l.tagName.toLowerCase()&&null!=t.rw_getAttribute(l,"alt")&&0<t.rw_getAttribute(l,"alt").length)return l;if(n.isInvalidNode(l)||null==l.lastChild||n.isSpecialCaseWithIgnoredContent(d)){var i;return i=e?this.getPreviousTextNode(l,!1,d):this.getPreviousTextNodeNoImg(l,!1,d,!0)}l=l.lastChild}return d}},{key:"getPreviousTextNodeNoImg",value:function(a,e,t,n){for(var o=n?this.getPreviousTextNode(a,e,t):this.getPreviousTextNodeNoBlank(a,e,t);null!=o&&3!=o.nodeType&&o!=t&&"math"!=o.tagName.toLowerCase()&&!o.isMathJax;)o=n?this.getPreviousTextNode(o,e,t):this.getPreviousTextNodeNoBlank(o,e,t);return o}},{key:"getPreviousTextNodeNoBlank",value:function(d,e,t){for(var n=new p.Attribute,r=new g.SSDOM,i=d;null!=i&&i!=t;)if(i=this.getPreviousTextNode(i,e,t),null!=i){var o;if(3==i.nodeType)o=i.nodeValue.trimTH();else if("img"==i.tagName.toLowerCase()&&null!=n.rw_getAttribute(i,"alt"))o=n.rw_getAttribute(i,"alt").trimTH();else if("math"==i.tagName.toLowerCase())o=this.getTextFromMathMl(i);else if(i.isMathJax){var a=new l.MathSpeak;o=a.getTextFromMathJax(i)}if(r.rw_isWordSpeakable(o))return i}return null}},{key:"getPreviousTextNode",value:function(d,e,t){for(var n=new p.Attribute,r=d,i=!1;null!=r&&r!=t;)if(r=this.getPreviousNode(r,e,t),null!=r){if(3==r.nodeType&&"textarea"!=r.parentNode.tagName.toLowerCase()&&0<r.nodeValue.length&&(i=!0),1==r.nodeType&&"math"==r.tagName.toLowerCase())i=!0;else if(1==r.nodeType&&r.isMathJax)i=!0;else if(1==r.nodeType&&"img"==r.tagName.toLowerCase()){var o=n.rw_getAttribute(r,"alt");null!=o&&0<o.length&&(i=!0)}if(i)return r}return null}},{key:"getPreviousNode",value:function(a,e,t){var n=new g.SSDOM;if(null==a||a==t)return null;var o=a;if(null!=o.previousSibling){if(o=o.previousSibling,e&&!n.isStyleNode(o))return null;if(null!=o&&n.isInvalidNode(o)){if(t==o)return null;o=this.getPreviousNode(o,e,t)}else{for(;null!=o&&null!=o.lastChild&&!n.isSpecialCaseWithIgnoredContent(o);)if(o=o.lastChild,e&&(n.isStyleNode(o)||(o=null)),null!=o&&n.isInvalidNode(o)){if(t==o)return null;o=this.getPreviousNode(o,e,t);break}if(null!=o&&n.isIgnored(o)){if(o==t)return null;o=this.getPreviousNode(o,e,t)}}}else if(o=o.parentNode,e&&null!=o&&(n.isStyleNode(o)||(o=null)),null!=o&&n.isIgnored(o)){if(o==t)return null;o=this.getPreviousNode(o,e,t)}return o}},{key:"getFirstChildTextNode",value:function(a,e){var t=new g.SSDOM,n=new p.Attribute;if(null==a||null==a.firstChild||t.isInvalidNode(a))return a;if(t.isSpecialCaseWithIgnoredContent(a))return a;var o=a.firstChild;return 3==o.nodeType?o:1==o.nodeType&&e&&"img"==o.tagName.toLowerCase()&&null!=n.rw_getAttribute(o,"alt")&&0<n.rw_getAttribute(o,"alt").length?o:e?this.getNextTextNode(o,!1,a):this.getNextTextNodeNoImg(o,!1,a,!0)}},{key:"getNextTextNodeNoImg",value:function(a,e,t,n){for(var o=n?this.getNextTextNode(a,e,t):this.getNextTextNodeNoBlank(a,e,t);null!=o&&3!=o.nodeType&&o!=t&&"math"!=o.tagName.toLowerCase()&&!o.isMathJax;)o=n?this.getNextTextNode(o,e,t):this.getNextTextNodeNoBlank(o,e,t);return o}},{key:"getNextTextNodeNoBlank",value:function(d,e,t){for(var n=new p.Attribute,r=new g.SSDOM,i=d;null!=i&&i!=t;)if(i=this.getNextTextNode(i,e,t),null!=i){var o;if(3==i.nodeType)o=i.nodeValue.trimTH();else if("img"==i.tagName.toLowerCase()&&null!=n.rw_getAttribute(i,"alt"))o=n.rw_getAttribute(i,"alt").trimTH();else if("math"==i.tagName.toLowerCase())o=this.getTextFromMathMl(i);else if(i.isMathJax){var a=new l.MathSpeak;o=a.getTextFromMathJax(i)}if(r.rw_isWordSpeakable(o))return i}return null}},{key:"getTextFromMathMl",value:function(a){var e=new g.SSDOM;if(null!=a.previousSibling||null!=a.nextSibling){var t=e.createWrapperElement();a.parentNode.replaceChild(t,a),t.appendChild(a)}var n,n=a.parentNode.innerHTML;return null!=n&&0<n.length?n:""}},{key:"getNextTextNode",value:function(d,e,t){for(var n=new p.Attribute,r=d,i=!1;null!=r&&r!=t;)if(r=this.getNextNode(r,e,t),null!=r){if(3==r.nodeType&&"textarea"!=r.parentNode.tagName.toLowerCase()&&0<r.nodeValue.length&&(i=!0),1==r.nodeType&&"math"==r.tagName.toLowerCase())i=!0;else if(1==r.nodeType&&r.isMathJax)i=!0;else if(1==r.nodeType&&"img"==r.tagName.toLowerCase()){var o=n.rw_getAttribute(r,"alt");null!=o&&0<o.length&&(i=!0)}if(i)return r}return null}},{key:"getNextNode",value:function(a,e,t){return this.getNextNodeImpl(a,e,t,!1,!1)}},{key:"getNextNodeImpl",value:function(d,e,t,n,l){var i=new g.SSDOM;if(null==d||d==t&&(l||!n))return null;var o=i.isInvalidNode(d);i.isSpecialCaseWithIgnoredContent(d)&&(o=!0);var a=null;if(d==t&&n){if(o||null==d.firstChild)return null;a=d.firstChild}else if(a=d,null==a.firstChild||o||l){if(null!=a.firstChild&&l&&null!=t&&i.checkIfElementInsideElement(t,a))return null;if(null!=a.nextSibling)a=a.nextSibling;else{for(;null!=a&&null==a.nextSibling&&(a=a.parentNode,e&&(i.isStyleNode(a)||(a=null)),t!=a););null!=a&&t!=a&&(a=a.nextSibling)}}else a=a.firstChild;return null!=a&&e&&(i.isStyleNode(a)||(a=null)),null!=a&&(i.isInvalidNode(a)?a=this.getNextNodeImpl(a,e,t,!1,!0):i.isIgnored(a)&&(a=this.getNextNodeImpl(a,e,t,!1,!1)),n&&a==t&&d==t&&(a=null)),a}}]),t}()},{"../../Constants/Constants":1,"../MathJax/MathSpeak":16,"../THCaret":31,"../THCaretRange":32,"../Utilities/Utilities":38,"./Attribute":2,"./SSDOM":5}],4:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.DomSentences=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),S=d("../Utilities/Utilities"),T=d("./SSDOM"),a=d("./Attribute"),C=d("./DomNavigation"),s=d("../THCaret"),u=d("../THCaretRange");t.DomSentences=function(){function t(){n(this,t)}return r(t,[{key:"getSentenceFromPoint",value:function(a){if(null!=a.node.tagName&&"img"==a.node.tagName.toLowerCase()){var e=new u.THCaretRange;e.setCaretRange(a,a)}else{var t=this.getSentenceBreakToRight(a),n=this.getSentenceBreakToLeft(t);if(null==n||null==t)return null;var e=new u.THCaretRange;e.setCaretRange(n,t)}return e}},{key:"getNextSentence",value:function(a,e){var c=new C.DomNavigation,n=new T.SSDOM;if(null==a)return null;"undefined"==typeof e&&(e=null);var r=a.rightCaret.node,i=a.rightCaret.offset;if(n.rw_checkForHiddenParent(a.rightCaret.node))return null;a.rightCaret.isSpecialCase()&&(r=c.getNextNodeIgnoreChildren(r,!1,e),i=0);for(var o,l;null!=r;){if(3==r.nodeType&&i<r.nodeValue.length){if(o=this.getSentenceBreakToRight(new s.THCaret(r,i,!1),e),null==o)return null;if(o.node==r&&o.offset==i){var h=c.getNextTextNodeNoBlank(r,!1,e);if(null==h)return null;o=this.getSentenceBreakToRight(new s.THCaret(h,0,!1),e)}}else{var h=c.getNextTextNodeNoBlank(r,!1,e);if(null==h)return null;o=this.getSentenceBreakToRight(new s.THCaret(h,0,!1),e)}if(l=this.getSentenceBreakToLeft(o,null),null==l)return null;if(a.leftCaret.node!=l.node||a.leftCaret.offset!=l.offset){var f=new u.THCaretRange;if(f.setCaretRange(l,o),this.checkSentence(f)&&n.rw_caretRangeIsSpeakable(f))return f}if(r=o.node,3==r.nodeType){var d=r.nodeValue.replace(/[\x21\x3f\x3a]/g,"."),g=d.indexOf(".",o.offset+1);i=-1==g?d.length:g}}return null}},{key:"checkSentence",value:function(d){for(var e=new a.Attribute,t="rwTHcomp",n=d.leftCaret.node,r=n.ownerDocument.body;null!=n&&n!=r;){if(1==n.nodeType){if("rwDictDefin"==n.className||"rwPopupContent"==n.className||"rwToolbarBarCollect"==n.className)break;if(null!=e.rw_getAttribute(n,t))return!1}n=n.parentNode}var i=d.rightCaret.node;if(i!=n)for(;null!=i&&i!=r&&"rwDictDefin"!=i.className&&"rwPopupContent"!=i.className&&"rwToolbarBarCollect"!=i.className;){if(1==i.nodeType&&null!=e.rw_getAttribute(i,t))return!1;i=i.parentNode}return!0}},{key:"getPreviousSentence",value:function(a,e){var c=new C.DomNavigation,n=new T.SSDOM;"undefined"==typeof e&&(e=null);for(var r,i,o=a.leftCaret.node,l=a.leftCaret.offset;null!=o;){if(3==o.nodeType){var h,f=o.nodeValue.replace(/[\x21\x3f\x3a]/g,".");for(h=0<l?f.lastIndexOf(".",l):0==l?-1:f.lastIndexOf(".");-1<h;){if(l=h,i=this.getSentenceBreakToRight(new s.THCaret(o,l,!0),e),null==i)return null;if(i.node!=a.rightCaret.node||i.offset!=a.rightCaret.offset){if(r=this.getSentenceBreakToLeft(i,e),null==r)return null;var d=new u.THCaretRange;if(d.setCaretRange(r,i),this.checkSentence(d)&&n.rw_caretRangeIsSpeakable(d))return d}h=0==h?-1:f.lastIndexOf(".",h-1)}}if(l=-1,tmpNode=c.getPreviousTextNodeNoImg(o,!0,e,!1),null!=tmpNode)o=tmpNode;else if(o=c.getPreviousTextNodeNoBlank(o,!1,e),null!=o){if(i=3==o.nodeType?this.getSentenceBreakToRight(new s.THCaret(o,o.nodeValue.length,!1),e):this.getSentenceBreakToRight(new s.THCaret(o,0,!1),e),null==i)return null;if(i.node!=a.rightCaret.node||i.offset!=a.rightCaret.offset)return r=this.getSentenceBreakToLeft(i,e),null==r?null:new u.THCaretRange(r,i)}}return null}},{key:"getSentenceBreakToLeft",value:function(a,e){var o=new C.DomNavigation,n=new T.SSDOM;if("undefined"==typeof e&&(e=null),null==a||null==a.node)return null;var r=a.node,i=a.offset;if(1==a.node.nodeType&&"math"==a.node.tagName.toLowerCase())return a;if(1==a.node.nodeType&&a.node.isMathJax)return a;if(a.forwardBias)3==r.nodeType&&i==r.nodeValue.length&&(r=o.getNextTextNode(r,!0,e),i=0,null==r&&(r=a.node,i=a.offset));else if(0<i)--i;else{if(r=o.getPreviousTextNode(r,!0,e),null==r)return a;if(3==r.nodeType)i=r.nodeValue.length-1;else{if(i=0,"math"==r.tagName.toLowerCase())return a;if(r.isMathJax)return a}}if(3==r.nodeType){var l=r.nodeValue.charAt(i);if("."==l||"!"==l||"?"==l||":"==l)if(0<i)--i;else{if(r=o.getPreviousTextNode(r,!0,e),null==r)return a;if(3==r.nodeType)i=r.nodeValue.length-1;else{if(i=0,"math"==r.tagName.toLowerCase())return a;if(r.isMathJax)return a}}}for(var u=r,c=i,f=r,d=i,g=!1,h=" ";!g;){if(n.isSpecialCaseNested(f)){if(f=n.checkForSpecialParent(f),"math"==f.tagName.toLowerCase()){g=!0;break}if(f.isMathJax){g=!0;break}u=f,c=0}else if(3==f.nodeType){var b=f.nodeValue;if(0<b.length){-1==d&&(d=b.length),b=b.replace(/[\x21\x3f\x3a]/g,".");for(var m=b.lastIndexOf(".",d);-1<m;){if(n.rw_isFullStop(b,m,f)){if(m<b.length-1){u=f,c=m+1,g=!0;break}if(!n.rw_isTextChar(h)){g=!0;break}}m=0==m?-1:b.lastIndexOf(".",m-1)}if(g)break;var y=new S.Utilities;0<y.trim(b).length&&(u=f,c=0),h=b.charAt(0)}}if(f=o.getPreviousNode(f,!0,e),d=-1,null==f){g=!0;break}if(3==f.nodeType&&n.isSpecialCaseNested(f)&&(f=n.checkForSpecialParent(f),null==f)){g=!0;break}}if(3==u.nodeType){var b=u.nodeValue;if(c<b.length)for(;c<b.length&&n.rw_isWhiteSpace(b.charAt(c));)++c}return new s.THCaret(u,c,!0)}},{key:"getSentenceBreakToRight",value:function(a,e){var o=new C.DomNavigation,n=new T.SSDOM;if("undefined"==typeof e&&(e=null),null==a||null==a.node)return null;for(var r=a.node,i=a.offset,l=r,u=i,c=!1,h=" ";!c;){if(n.isSpecialCaseNested(r)){if(r=n.checkForSpecialParent(r),"math"==r.tagName.toLowerCase()){c=!0;break}if(r.isMathJax){c=!0;break}l=r,u=0,r=o.getNextNodeIgnoreChildren(r,!0,e)}else if(3==r.nodeType){var d=r.nodeValue;if(0<d.length){if("."==h){var g=d.charAt(i);if(!n.rw_isTextChar(g)){c=!0;break}}d=d.replace(/[\x21\x3f\x3a]/g,".");for(var p=d.indexOf(".",i);-1<p;){if(n.rw_isFullStop(d,p,r)){p<d.length-1&&(l=r,u=p+1,c=!0);break}i=p+1,p=d.indexOf(".",i)}if(c)break;var y=new S.Utilities;0<y.trim(d).length&&(l=r,u=d.length),h=d.charAt(d.length-1),"."==h&&(n.rw_isFullStop(d,d.length-1,r)||(h=" "))}r=o.getNextNode(r,!0,e)}else r=o.getNextNode(r,!0,e);if(i=0,null==r){c=!0;break}}if(3==l.nodeType){var d=l.nodeValue;if(0<u&&u<=d.length)for(;0<u&&n.rw_isWhiteSpace(d.charAt(u-1));)--u}return new s.THCaret(l,u,!1)}}]),t}()},{"../THCaret":31,"../THCaretRange":32,"../Utilities/Utilities":38,"./Attribute":2,"./DomNavigation":3,"./SSDOM":5}],5:[function(r,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SSDOM=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),y=r("../Utilities/Utilities"),S=r("../THCaret"),T=r("../THCaretRange"),a=r("../THRange"),u=r("../THDomRefPt"),l=r("../MathJax/MathSpeak"),C=r("./DomNavigation"),d=r("./Attribute"),s=r("./DomSentences"),g=r("../../Constants/Constants"),f=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(g);t.SSDOM=function(){function t(){n(this,t)}return o(t,[{key:"checkForSpecialParent",value:function(a){if(null!=a)for(var e=this.getBody(a),t=a;null!=t&&t!=e;){if(this.isSpecialCase(t))return t;t=t.parentNode}return null}},{key:"getBody",value:function(t){return t.document?t.document.body:t.ownerDocument.body}},{key:"isSpecialCase",value:function(a){var e=new d.Attribute;if(null==a)return!1;if(1==a.nodeType){var t=a.tagName.toLowerCase();if(t==f.HIGHLIGHT_TAG||"span"==t){var n=e.rw_getAttribute(a,"pron");if(null!=n)return!0;if(n=e.rw_getAttribute(a,"chunk"),null!=n)return!0;if(n=a.isMathJax,null!=n&&n)return!0}else if("acronym"==t||"abbr"==t){var n=a.getAttribute("title");if(null!=n)return!0}else{if("chunk"==t)return!0;if("img"==t){var n=e.rw_getAttribute(a,"alt");if(null!=n)return!0}else if("math"==t)return!0}}return!1}},{key:"isSpecialCaseHighlightable",value:function(a){var e=new d.Attribute;if(1==a.nodeType){var t=a.tagName.toLowerCase();if("span"==t){var n=e.rw_getAttribute(a,"pron");if(null!=n)return!0;if(n=e.rw_getAttribute(a,"chunk"),null!=n&&"1"==n)return!0;if(n=a.isMathJax,null!=n&&n){var r=new l.MathSpeak,i=r.getTextFromMathJax(a);if(0<i.length)return!0}}else if("acronym"==t||"abbr"==t){var n=a.getAttribute("title");if(null!=n)return!0}else if("math"==t)return!1}return!1}},{key:"checkIfElementInsideElement",value:function(a,e){if(null==a||null==e)return!1;for(var t=a.parentNode;null!=t;){if(t==e)return!0;t=t.parentNode}return!1}},{key:"isSpecialCaseWithIgnoredContent",value:function(a){var e=new d.Attribute;if(null==a)return!1;if(1==a.nodeType){var t=a.tagName.toLowerCase();if("span"==t){var n=a.isMathJax;if(null!=n&&n)return!0}else{if("textarea"==t)return!0;if("img"==t){var n=e.rw_getAttribute(a,"alt");if(null!=n)return!0}else if("math"==t)return!0}}return!1}},{key:"rw_isWordSpeakable",value:function(d){if(null==d||0==d.length)return!1;var e=new y.Utilities,t=e.trim(d);if(1==t.length){var n=t.charCodeAt(0);if(96==n||180==n||8216==n||8217==n||8220==n||8221==n)return!1}var r,i=t.length,o=0;for(o=0;o<i;o++){if(r=t.charCodeAt(o),63<r&&91>r||96<r&&123>r||127<r&&160!=r)return!0;if(46<r&&58>r)return!0;if(35<r&&39>r||43==r||61==r)return!0}return!1}},{key:"createWrapperElement",value:function(){return this.createObject(f.WRAPPER_TAG,null,null,g_bOverrideSpan?"thspan":null)}},{key:"createObject",value:function(a,e,t,n){return this.createObjectForDoc(a,e,t,n,document)}},{key:"createObjectForDoc",value:function(d,e,t,n,r){var i=r.createElement(d);if(null!=t&&(i.id=t),null!=n&&(i.className=n),null!=e)for(var o=e.length,a=0;a<o;a+=2)i.setAttribute(e[a],e[a+1]);return i}},{key:"isStyleNode",value:function(a){var e=new d.Attribute;if(null==a)return!1;if(1!=a.nodeType)return 3==a.nodeType||8==a.nodeType;var t=a.tagName.toLowerCase().trimTH();if(t==f.HIGHLIGHT_TAG){var n=e.rw_getAttribute(a,"started");if(null!=n&&"1"==n)return!1}return this.isInStyleList(t)}},{key:"isInStyleList",value:function(n){var e="~em~strong~b~i~u~tt~font~kbd~dfn~cite~sup~sub~a~embed~span~small~nobr~wbr~acronym~abbr~code~s~chunk~th:pron~img~/th:pron~w~/w~lic/lic~break~silence~thspan~beelinereader~beelinespan~"+f.HIGHLIGHT_TAG+"~"+f.WRAPPER_TAG+"~";return-1<e.indexOf("~"+n+"~")}},{key:"isInvalidNode",value:function(a){if(null==a)return!0;if(1!=a.nodeType)return 3!=a.nodeType||this.isInvalidNode(a.parentNode);var e=this.getComputedStyle(a);if(null!=e&&("hidden"==e.visibility||"none"==e.display))return!0;var t=a.tagName.toLowerCase();return"link"==t||"area"==t||"script"==t||"noscript"==t||"annotation"==t||"style"==t||"!--"==t||"title"==t||"html:script"==t}},{key:"getComputedStyle",value:function(t){return null==t?null:3==t.nodeType&&(t=t.parentNode,null==t)?null:window.getComputedStyle(t,null)}},{key:"isIgnored",value:function(n){var e=new d.Attribute;if(null!=n&&3==n.nodeType&&(n=n.parentNode),null==n)return!0;for(var t=n.ownerDocument.body,o=n;null!=o&&1==o.nodeType;){if(null!=e.rw_getAttribute(o,"ignore"))return!0;if(null!=e.rw_getAttribute(o,"allow"))return!1;if("button"==o.tagName.toLowerCase())return!1;if(o==t)break;o=o.parentNode}return!1}},{key:"allTextFromNodeTH",value:function(a){var e="";if(3==a.nodeType)e=a.nodeValue;else if(1==a.nodeType)for(var t=a.firstChild;null!=t;)3==t.nodeType?e+=t.nodeValue:1==t.nodeType&&(e+=this.allTextFromNodeTH(t)),t=t.nextSibling;return e}},{key:"mergeTextNodes",value:function(a){if(null==a)return a;var e=a.parentNode;if(null!=e&&3==a.nodeType){for(var t=a.ownerDocument;null!=a.previousSibling&&3==a.previousSibling.nodeType;){var n=a.previousSibling.nodeValue+a.nodeValue,o=t.createTextNode(n);e.removeChild(a.previousSibling),e.replaceChild(o,a),a=o}for(;null!=a.nextSibling&&3==a.nextSibling.nodeType;){var n=a.nodeValue+a.nextSibling.nodeValue,o=t.createTextNode(n);e.removeChild(a.nextSibling),e.replaceChild(o,a),a=o}}return a}},{key:"rw_reduceSelectionForNonSpeechChar",value:function(d){var e=new C.DomNavigation,t=!1,n=d.rightCaret.node,r=d.rightCaret.offset,i=d.leftCaret.node,o=d.leftCaret.offset;try{var a,l;if(!d.rightCaret.isSpecialCase())for(var s=n.nodeValue;;){if(0==r){if(a=e.getPreviousTextNode(n,!1,i),null==a)break;if(1==a.nodeType){n=a,r=0,t=!0;break}n=a,s=n.nodeValue,r=s.length,t=!0}if(n==i&&r==o)break;if(!(0<r))break;if(l=s.charAt(r-1),!this.rw_isWhiteSpace(l))break;--r,t=!0}if(!d.leftCaret.isSpecialCase())for(var u=i.nodeValue,f=u.length;;){if(o==f){if(a=e.getNextTextNode(i,!1,n),null==a)break;if(1==a.nodeType){i=a,o=0,f=0,t=!0;break}i=a,u=i.nodeValue,o=0,f=u.length,t=!0}if(n==i&&r==o)break;if(!(o<f))break;if(l=u.charAt(o),!this.rw_isWhiteSpace(l))break;++o,t=!0}}catch(e){console.log(e)}return t?new T.THCaretRange(new S.THCaret(i,o,!0),new S.THCaret(n,r,!1)):d}},{key:"rw_isWhiteSpace",value:function(t){return-1<t.search(/[\s\xa0]/)}},{key:"getSentenceFromPointByLang",value:function(a){var e=new s.DomSentences,t=e.getSentenceBreakToRight(a),n=e.getSentenceBreakToLeft(t),o=new T.THCaretRange;return o.setCaretRange(n,t),o}},{key:"isSpecialCaseNested",value:function(a){if(null!=a)for(var e=this.getBody(a),t=a;null!=t&&t!=e;){if(this.isSpecialCase(t))return!0;t=t.parentNode}return!1}},{key:"rw_isTextChar",value:function(t){return 47<t&&58>t||63<t&&91>t||94<t&&123>t}},{key:"rw_isFullStop",value:function(o,e,t){var n=new C.DomNavigation,r=!0,i=o.length;if(i>e+1){var a=o.charCodeAt(e+1);this.rw_isTextChar(a)&&(r=!1)}if(r&&null!=t&&"."!=t.nodeValue.charAt(e))return!0;if(r)if(1<e){var d=o.substring(e-2,e);if((" "==d.charAt(0)||"\n"==d.charAt(0)||"\r"==d.charAt(0)||"\t"==d.charAt(0))&&63<d.charCodeAt(1)&&91>d.charCodeAt(1))r=!1;else if("."==d.charAt(0)&&this.rw_isTextChar(d.charCodeAt(1)))r=!1;else if("Dr"==d||"Mr"==d||"Ms"==d||"Av"==d||"St"==d||"eg"==d)r=!1;else if(2<e){var l=o.substring(e-3,e);if("Mrs"==l||"etc"==l||"i.e"==l||"P.O"==l||"PhD"==l)r=!1;else if(3<e){var s=o.substring(e-4,e);"Ph.D"==s&&(r=!1)}}}else try{if(null!=t&&0==e){var g=n.getPreviousTextNode(t,!0,null);if(null!=g&&3==g.nodeType&&g!=t)return!!this.rw_isFullStop(g.nodeValue+o,g.nodeValue.length,null)}}catch(e){}return r}},{key:"rw_caretRangeIsSpeakable",value:function(d){var e=new C.DomNavigation;try{if(null==d||null==d.leftCaret||null==d.rightCaret)return!1;if(this.rw_checkForHiddenParent(d.leftCaret.node))return!1;for(var t=d.leftCaret,n=d.rightCaret,r=t.node,i=n.node,o=!0,a=!1,l=r;null!=l;){if(a=this.isSpecialCase(l),a||3==l.nodeType){var s=e.getTextFromNode(l);if(null!=s&&""!=s&&(a||(l==i&&-1<n.offset&&(s=s.substring(0,n.offset)),l==r&&0<t.offset&&(s=s.substring(t.offset))),this.rw_isWordSpeakable(s)))return!0}l=a?e.getNextNodeIgnoreChildren(l,!1,i):o?e.getNextNodeAllowMoveToChild(l,!0,i):e.getNextNode(l,!1,i),o=!1}}catch(e){}return!1}},{key:"rw_checkForHiddenParent",value:function(a){try{var e=this.getComputedStyle(a);if(null!=e&&("none"==e.display||"hidden"==e.visibility))return!0;for(var t=a,n=t.ownerDocument.body;t!=n;)if(t=t.parentNode,"none"==this.getComputedStyle(t).display)return!0}catch(e){}return!1}},{key:"rw_getRefPt",value:function(g,e){var t=new d.Attribute,n="rwTHgen";try{if(null==g)return null;if(1==g.nodeType||3==g.nodeType){var r=this.checkForSpecialParent(g);if(null!=r)return new u.THDomRefPt(this.getPositionInDom(r),e);var i,o;1==g.nodeType?(i=0,o=g):(i=this.rw_getNodeOffset(g),o=g.parentNode);for(var a=t.rw_getAttribute(o,"rwstate"),l=t.rw_getAttribute(o,n);null!=a&&0<a.length||null!=l;)i+=this.rw_getNodeOffset(o),o=o.parentNode,a=t.rw_getAttribute(o,"rwstate"),l=t.rw_getAttribute(o,n);return-1==e&&(i=-1),new u.THDomRefPt(this.getPositionInDom(o),i+e)}return null}catch(e){return null}}},{key:"rw_getNodeOffset",value:function(a){if(null==a)return 0;var e=0,t=a.previousSibling;return null!=t&&(e=this.rw_getNodeOffsetImpl(t)),e}},{key:"getPositionInDom",value:function(g){var e=new d.Attribute,t="",n=0,r="";if(null!=g&&null!=g.ownerDocument)for(var i=!1,o=!1,a=g.ownerDocument.body;null!=g&&g!=a;){this.isSpecialCase(g)&&(t=""),i=3==g.nodeType||1==g.nodeType&&g.tagName.toLowerCase()==f.HIGHLIGHT_TAG&&null!=e.rw_getAttribute(g,"rwstate");for(var l=g.previousSibling;null!=l;)o=3==l.nodeType||1==l.nodeType&&l.tagName.toLowerCase()==f.HIGHLIGHT_TAG&&null!=e.rw_getAttribute(l,"rwstate"),i&&o||++n,l=l.previousSibling,i=o;if(t=t+n+"~",n=0,g=g.parentNode,null!=g&&null!=g.getAttribute&&null!=g.tagName){var s=e.rw_getAttribute(g,"chunk");if("span"==g.tagName.toLowerCase()&&"1"==s){var u=this.getPositionInDom(g);r="#^th*"+u+"#^th*"}}}return r+t}},{key:"rw_getBreakInCurrentWord",value:function(t){return null==t||0==t.length?-1:t.search("[\u2014\\s\"]")}},{key:"rw_isLetter",value:function(t){return 64<t&&91>t||96<t&&123>t}},{key:"rw_getNodeOffsetImpl",value:function(a){for(var e,t=0,n=a;null!=n;)3!=n.nodeType||this.isIgnored(n)?1==n.nodeType&&(this.isInvalidNode(n)||(t+=this.isSpecialCase(n)?1:"textarea"==n.tagName.toLowerCase()?1:this.rw_getNodeOffsetImpl(n.lastChild))):(e=n.nodeValue,t+=e.length),n=n.previousSibling;return t}},{key:"rw_getCaretFromRefPt",value:function(n,e){return this.getCaretFromDomPosition(n,e.path,e.offset,!0)}},{key:"getCaretFromDomPosition",value:function(d,e,t,n,r){var s=new C.DomNavigation;"undefined"==typeof r&&(r=!1);try{if(null==d)return null;var o=s.getNodeFromPosition(d,e);if(r){var a=new S.THCaret(o,0,n);return a.setSpecialCase(!0),a}var l=this.checkForSpecialParent(o);if(null!=l){if(o=l,this.isSpecialCaseHighlightable(l)){if(n){var u=s.getFirstChildTextNode(o,!1);return null==u?new S.THCaret(o,0,n):new S.THCaret(u,0,n)}var c=s.getLastChildTextNode(o,!1);return null==c?new S.THCaret(o,0,n):3==c.nodeType?new S.THCaret(c,c.length,n):new S.THCaret(c,0,n)}return new S.THCaret(l,0,n)}var h=0;if(n||++h,-1<t){if(null==o)return null;for(var f,g=!1,c=o.parentNode,y=o;!g;){if(3==o.nodeType){if(f=o.nodeValue,t<h+f.length){g=!0;break}y=o,h+=o.nodeValue.length,o=s.getNextNode(o,!1,c)}else if(1==o.nodeType)if(l=this.checkForSpecialParent(o),null!=l){o=l;var T=t-h;if(!(0<T)){g=!0;break}h+=1,o=s.getNextNodeIgnoreChildren(o,!1,c)}else o=s.getNextNode(o,!1,c);if(null==o||o==c){if(null!=y){o=y,h=3==o.nodeType?t-o.nodeValue.length:0,n||++h;break}return null}}return n?new S.THCaret(o,t-h,n):new S.THCaret(o,t-(h-1),n)}return new S.THCaret(o,t,n)}catch(e){return null}}},{key:"getNodesOverRange",value:function(a,e){var t=new C.DomNavigation,n=[];if(null==a||null==e)return n;for(var o=a;o;)this.isInvalidNode(o)?o=t.getActualNextNodeIgnoreChildren(o,e):(this.isIgnored(o)||n.push(o),o=t.getActualNextNode(o,e));return n}},{key:"getWindow",value:function(a){try{if(null==a)return window;if(0===top.frames.length)return window;var e=a.ownerDocument.body,t=window.document.body;if(e===t)return window;var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.body;if(i===e)return top.frames[n]}catch(e){}}catch(e){}return window}},{key:"rw_getTextRangeAsTHRange",value:function(o,e){var t=e.duplicate();t.collapse(!0);var n=rw_getTextRangeAsRefPtIE(o,t);t=e.duplicate(),t.collapse(!1);var r=rw_getTextRangeAsRefPtIE(o,t);return new a.THRange(o,n,r)}},{key:"rw_getAsTextRange",value:function(g,e,t,n,r){var i=this.getRangeObject(g),o=new T.THCaretRange(g,e,-1,n,-1),a=o.leftCaret,l=o.rightCaret;if(null!=a&&null!=a.node&&null!=l&&null!=l.node){var s=a.node;if(3==s.nodeType){var u=this.rw_getNodeOffset(s);s=s.parentNode,t+=u}var c=l.node;if(3==c.nodeType){var u=this.rw_getNodeOffset(c);c=c.parentNode,r+=u}i.moveToElementText(s),i.collapse(),rw_moveEnd(i,t),i.collapse(!1),i.select();var f=this.getRangeObject(g);f.moveToElementText(c),f.collapse(),rw_moveEnd(f,r),f.collapse(!1),i.setEndPoint("EndToEnd",f)}else i=null;return i}},{key:"rw_collapseSelection",value:function(){var t=this.getSelectionObject();null!=t&&(t.collapseToStart?t.collapseToStart():t.execCommand&&t.execCommand("UnSelect",!1,null))}},{key:"getSelectionObject",value:function(){var t=null;if(window.getSelection){return null;var e=window.getSelection(),n=null}else if(document.selection){var a=document.selection.createRange();if(0<a.text.length)theWindow=window,t=a;else{var r=this.getFrameSelectionOldIE(window);r.theRange&&(t=r.theRange)}}return t}},{key:"getFrameSelectionOldIE",value:function(r){var e,t={};if(r.frames&&0<r.length){var n,i=r.length;for(n=0;n<i;n++)try{var o=r[n];if(e=o.document.selection.createRange(),null!=e&&null!=e.text&&0<e.text.length){t.theWindow=o,t.theRange=e;break}if(0<o.length){var a=this.getFrameSelectionOldIE(o);if(a.theRange){t=a;break}}}catch(e){}}return t}},{key:"getFrameSelectionSFF",value:function(a){var e={},t=this.getFrameSelection(a);return null!=t&&(e.theWindow=t,e.foundSel=t.getSelection()),e}},{key:"getFrameSelection",value:function(a){if(a.frames&&0<a.length){var e,t=a.length;for(e=0;e<t;e++)try{var n=a[e].getSelection();if(null!=n&&!n.isCollapsed)return a[e];if(0<a[e].length){var o=this.getFrameSelection(a[e]);if(o)return o}}catch(e){}}return null}}]),t}()},{"../../Constants/Constants":1,"../MathJax/MathSpeak":16,"../THCaret":31,"../THCaretRange":32,"../THDomRefPt":34,"../THRange":35,"../Utilities/Utilities":38,"./Attribute":2,"./DomNavigation":3,"./DomSentences":4}],6:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=null;t.EventBus=function(){function t(){return n(this,t),i||(i=this),this.events=[],i}return r(t,[{key:"unSubscribe",value:function(a,e){for(var t=0;t<this.events.length;t++)this.events[t].event==a&&this.events[t].callback==e&&this.events.splice(t,1)}},{key:"subscribe",value:function(n,a){this.events.push({event:n,callback:a})}},{key:"publish",value:function(a,e){for(var t=0;t<this.events.length;t++)this.events[t].event==a&&this.events[t].callback(e)}}]),t}()},{}],7:[function(r,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightBaseController=void 0;var i=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),k=r("../DOM/SSDOM"),a=r("../THReturnObject"),o=r("../Utilities/Utilities"),C=r("../DOM/DomNavigation"),l=r("../DOM/Attribute"),d=r("../../Constants/Constants"),c=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(d);t.HighlightBaseController=function(){function t(){n(this,t)}return i(t,[{key:"highlightRange",value:function(){}},{key:"unHighlightRange",value:function(){}},{key:"rw_setNodeBackground",value:function(s,e,t,n,r){var i=new k.SSDOM,u=new l.Attribute,f=new C.DomNavigation,d=new a.THReturnObject;if(d.node=s,d.offset=e,3!=s.nodeType){if(1==s.nodeType&&i.isSpecialCaseHighlightable(s)){if("math"==s.tagName.toLowerCase()){var g=s.parentNode;d=rw_setNodeBackgroundImpl(g,s,e,t,n,"")}else if(s.isMathJax){var g=s.parentNode;d=rw_setNodeBackgroundImpl(g,s,e,t,n,"")}else{var h=f.getFirstChildTextNode(s,!1),p=f.getLastChildTextNode(s,!1);null!=h&&3==h.nodeType&&null!=p&&3==p.nodeType&&(this.rw_setSpeechRangeImpl(h,0,p,p.nodeValue.length,n),d.node=h,d.offset=0)}return d}return d}if(3==s.nodeType){var m=s.nodeValue,y=new o.Utilities;if(m=y.trim(m),0==m.length){var v=s.parentNode;if(null!=v){var T=y.trim(v.tagName).toLowerCase();if("tr"==T||"table"==T)return d}}}var g=s.parentNode,b=null;if(g.tagName.toLowerCase()==c.HIGHLIGHT_TAG&&(b=u.rw_getAttribute(g,"rwstate")),"spell"==n){if(null!=b&&""!=b)return d;d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,r)}else if("hom"==n){if(null!=b&&""!=b)return d;d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,r)}else if("grammar"==n){if(null!=b&&""!=b)return d;d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,r)}else if("ss"==n){if(null!=b&&""!=b)return"ss"==b?d:d;d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,r)}else if("sp"==n){if("csp"==b)return d;if("sp"==b)return d;d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,"")}else if("csp"==n){if("csp"==b)return d;"sp"==b&&(d=this.rw_setNodeBackgroundImpl(g,s,e,t,n,""))}return d}},{key:"rw_setNodeBackgroundImpl",value:function(f,e,t,n,r,i){var o=(new k.SSDOM,new l.Attribute),s="sp"===r||"csp"===r,u="";if(1==e.nodeType&&(u=e.tagName.toLowerCase()),3==e.nodeType&&(-1==n||n>t)||"math"==u||e.isMathJax){var h;if(h="ss"==r?"strikethrough"==i?"text-decoration:line-through":"background:"+i:"sp"==r?c.SPEECH_RANGE_COLOUR:"csp"==r?c.SPEECH_WORD_COLOUR:"spell"==r?"":"hom"==r?"":"grammar"==r?"":"color:#ff000; background:#00ff00","math"==u||e.isMathJax)s&&this.rw_highlightMathElement(e,r,h,!0);else{var d=e.nodeValue.length;if(1==d&&("\n"==e.nodeValue||"\r"==e.nodeValue)||2==d&&"\r\n"==e.nodeValue){var g=new a.THReturnObject;return g.node=e,g.offset=0>t?0:t,g}var p=f.ownerDocument,v=!1;-1==t&&-1==n?v=!0:-1==n&&(n=d),0==t&&n>=d&&(v=!0);var m=p.createElement(c.HIGHLIGHT_TAG);if("spell"==r&&(rw_setAttribute(m,"spellnum",i),m.className="thspell"),"grammar"==r){rw_setAttribute(m,"grammarnum",i),m.className="thgrammar"}if(v)m.setAttribute("style",h),o.rw_setAttribute(m,"rwstate",r),s&&o.rw_setAttribute(m,"started","1"),f.replaceChild(m,e),m.appendChild(e);else{var y,T,b,S=e.nodeValue;"span"==f.tagName.toLowerCase()&&null!=o.rw_getAttribute(f,"pron")?(y="",T=S,b=""):(y=S.substring(0,t),T=S.substring(t,n),b=S.substring(n)),m.setAttribute("style",h),o.rw_setAttribute(m,"rwstate",r),s&&o.rw_setAttribute(m,"started","1");var C,_=null,x=null;0<y.length&&(_=p.createTextNode(y)),C=p.createTextNode(T),0<b.length&&(x=p.createTextNode(b)),m.appendChild(C),f.replaceChild(m,e),null!=_&&f.insertBefore(_,m),null!=x&&(null==m.nextSibling?f.insertBefore(x,null):f.insertBefore(x,m.nextSibling)),e=C}}}var g=new a.THReturnObject;return g.node=e,g.offset=0>t?0:t,g}},{key:"rw_highlightMathElement",value:function(a,e,t,n){var r=(new k.SSDOM,new l.Attribute);if(null!=a){var i=c.HIGHLIGHT_TAG;for(var o=a.firstChild;null!=o;)1==o.nodeType&&(n?null==r.rw_getAttribute(o,"started")?null==r.rw_getAttribute(o,"style")&&(o.setAttribute("style",t),r.rw_setAttribute(o,"rwstate",e),r.rw_setAttribute(o,"started","1")):(o.setAttribute("style",t),r.rw_setAttribute(o,"rwstate",e)):null!=r.rw_getAttribute(o,"started")&&(o.removeAttribute("style"),r.rw_removeAttribute(o,"started"),r.rw_removeAttribute(o,"rwstate"))),o=o.nextSibling}}},{key:"getListOfHighlightableNodes",value:function(a,e){var t=(new k.SSDOM,new C.DomNavigation),n=[];try{var r=a.node,i=e.node;if(3!=r.nodeType)if(1==r.nodeType&&"math"==r.tagName.toLowerCase()){if(n.push(r),r==i)return n;r=t.getNextTextNode(r,!1,i)}else if(g_bIE&&1==r.nodeType&&null!=r.firstChild&&1==r.firstChild.nodeType&&"math"==r.firstChild.tagName.toLowerCase()){if(n.push(r.firstChild),r==i)return n;r=r.firstChild,r=t.getNextTextNode(r,!1,i)}else if(1==r.nodeType&&r.isMathJax){if(n.push(r),r==i)return n;r=t.getNextTextNode(r,!1,i)}else if(g_bIE&&1==r.nodeType&&null!=r.firstChild&&r.firstChild.isMathJax){if(n.push(r.firstChild),r==i)return n;r=r.firstChild,r=t.getNextTextNode(r,!1,i)}else if(r=t.getFirstChildTextNode(r,!1),null==r)return n;if(r!=i){if(3==r.nodeType){var o=r.nodeValue;0<o.length&&a.offset<o.length&&n.push(r)}else 1==r.nodeType&&"math"==r.tagName.toLowerCase()?n.push(r):1==r.nodeType&&r.isMathJax&&n.push(r);for(var d=t.getNextTextNodeNoImg(r,!1,i,!0);null!=d;){if(d==i){if(3==i.nodeType){var o=i.nodeValue;0<o.length&&0<e.offset&&n.push(i)}else 1==d.nodeType&&"math"==d.tagName.toLowerCase()?n.push(d):1==d.nodeType&&d.isMathJax&&n.push(d);break}n.push(d),d=t.getNextTextNodeNoImg(d,!1,i,!0)}}else if(3==r.nodeType){var o=r.nodeValue;0<o.length&&a.offset<o.length&&0<e.offset&&e.offset>a.offset&&n.push(r)}}catch(e){}return n}}]),t}()},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THReturnObject":36,"../Utilities/Utilities":38}],8:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MathJaxHighlightController=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=a("../MathJax/MathJaxHighlighter");t.MathJaxHighlightController=function(){function a(e){n(this,a),this.m_setupHash={},this.m_defaultContextBg={r:255,g:255,b:0},this.m_defaultContextFg={r:0,g:0,b:0},this.m_defaultWordBg={r:0,g:0,b:255},this.m_defaultWordFg={r:255,g:255,b:255},this.m_contextBg={r:255,g:255,b:0},this.m_contextFg={r:0,g:0,b:0},this.m_wordBg={r:0,g:0,b:255},this.m_wordFg={r:255,g:255,b:255},this.m_strContextStyle="highlight",this.m_strWordStyle="highlight",this.sentence=e,this.lastMathId=null}return r(a,[{key:"highlight",value:function(a){try{var e=this.sentence.m_range.body.ownerDocument.getElementById(a),t=this.getJaxFor(e);this.h=new i.MathJaxHighlighter(t),"highlight"===this.m_strContextStyle?(this.h.setHighlightStyle("context","bg",this.m_contextBg.r,this.m_contextBg.g,this.m_contextBg.b),this.h.setHighlightStyle("context","fg",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b)):"outline"===this.m_strContextStyle?this.h.setHighlightStyle("context","outline",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b):"underline"===this.m_strContextStyle&&this.h.setHighlightStyle("context","underline",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b),"highlight"===this.m_strWordStyle?(this.h.setHighlightStyle("word","bg",this.m_wordBg.r,this.m_wordBg.g,this.m_wordBg.b),this.h.setHighlightStyle("word","fg",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b)):"outline"===this.m_strWordStyle?this.h.setHighlightStyle("word","outline",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b):"underline"===this.m_strWordStyle&&this.h.setHighlightStyle("word","underline",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b)}catch(e){}}},{key:"highlightRange",value:function(){var a=this.sentence.getSpanId();try{this.lastMathId&&this.clearHighlights(),this.lastMathId=a,this.m_setupHash[a]||(this.highlight(a),this.m_setupHash[a]=!0);var e=this.sentence.m_range.body.ownerDocument.getElementById(a),t=this.getJaxFor(e),n=t.root.spanID?t.root.spanID:t.root.CHTMLnodeID;n=null!=n&&void 0!=n?n:t.root.PHTMLspanID,this.h.highlightNodes("context",n)}catch(e){}}},{key:"unHighlightRange",value:function(){try{var n=this.sentence.getSpanId(),e=this.sentence.m_range.body.ownerDocument.getElementById(n);this.getJaxFor(e),this.h.clearHighlights()}catch(e){}}},{key:"highlightWord",value:function(a){var e=this.sentence.getSpanId(a),t=this.sentence.getWordRange(a);try{this.m_setupHash[e]||(this.highlight(e),this.m_setupHash[e]=!0);var n=this.sentence.m_range.body.ownerDocument.getElementById(e);this.getJaxFor(n),this.h.highlightNodes("word",t)}catch(e){}}},{key:"setHighlightStyle",value:function(a,o,d,n){if(this.m_setupHash=[],"string"==typeof a){"undefined"==typeof o&&(o="word");var r="undefined"==typeof p_rgb;"context"===o?(this.m_strContextStyle=a,"highlight"===a?(this.m_contextBg=r?this.m_defaultContextBg:n,this.m_contextFg=r?this.m_defaultContextFg:d):"outline"!=a&&"underline"!=a||(this.m_contextFg=r?this.m_defaultContextBg:d)):"word"==o&&(this.m_strWordStyle=a,"highlight"===this.m_strWordStyle?(this.m_wordBg=r?this.m_defaultWordBg:n,this.m_wordFg=r?this.m_defaultWordFg:d):"outline"!==a&&"underline"!==a||(this.m_wordFg=r?this.m_defaultWordBg:d))}}},{key:"getJaxFor",value:function(n){var e=null;e=n.ownerDocument.defaultView.MathJax.Hub.getJaxFor(n);return e}},{key:"checkText",value:function(a){for(var e,t,n=a.indexOf("<mtext>");-1<n&&(e=a.indexOf("</mtext>",n),e>n);)t=a.substring(n+7,e),t=t.trimTH(),0==t.length?(a=a.substr(0,n)+a.substr(e+8),n=a.indexOf("<mtext>",n)):n=a.indexOf("<mtext>",e+8);for(n=a.indexOf("<mn>");-1<n&&(e=a.indexOf("</mn>",n),e>n);)t=a.substring(n+4,e),t=t.trimTH(),0==t.length?(a=a.substr(0,n)+a.substr(e+5),n=a.indexOf("<mn>",n)):n=a.indexOf("<mn>",e+5);for(var e,t,n=a.indexOf("<mover>");-1<n&&(e=a.indexOf("</mover>",n),e>n);)t=a.substring(n+7,e),t=t.trimTH(),0==t.length?(a=a.substr(0,n)+a.substr(e+8),n=a.indexOf("<mover>",n)):n=a.indexOf("<mover>",e+8);return a}}]),a}()},{"../MathJax/MathJaxHighlighter":15}],9:[function(r,e,t){"use strict";function m(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function i(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function n(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechHighlightController=void 0;var a=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),y=r("../THCaretRange"),S=(r("../THReturnObject"),r("../DOM/SSDOM")),s=(r("../Utilities/Utilities"),r("../Sentence/SentenceObject"),r("../SpeechObject"),r("../ScrollInToView")),o=r("./HighlightBaseController"),u=r("../DOM/DomNavigation"),l=r("../DOM/Attribute"),d=r("../../Constants/Constants"),g=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(d);t.SpeechHighlightController=function(o){function r(t){m(this,r);var e=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e.sentence=t,e}return n(r,o),a(r,[{key:"highlightRange",value:function(){var a=this.sentence.getRange();new S.SSDOM;try{if(null!=a){var e=new y.THCaretRange(a.body,a.startRef.path,a.startRef.offset,a.endRef.path,a.endRef.offset),t=e.leftCaret,n=e.rightCaret;null!=t&&null!=n&&this.rw_setSpeechRangeImpl(t.node,t.offset,n.node,n.offset,"sp")}}catch(e){}}},{key:"unHighlightRange",value:function(){var a=this.sentence.getRange();new S.SSDOM;try{if(null!=a){var e=new y.THCaretRange(a.body,a.startRef.path,a.startRef.offset,a.endRef.path,a.endRef.offset),t=e.leftCaret,n=e.rightCaret;null!=t&&null!=n&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(t,n),!1)}}catch(e){}}},{key:"highlightWord",value:function(d){if(d<this.sentence.getWords().length){if(new S.SSDOM,0<d){var e=this.sentence.getWordRange(d-1);if(null!=e){var t=new y.THCaretRange(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(n,r),!0)}}var i=this.sentence.getWordRange(d);if(null!=i){var t=new y.THCaretRange(i.body,i.startRef.path,i.startRef.offset,i.endRef.path,i.endRef.offset),n=t.leftCaret,r=t.rightCaret,o=new s.ScrollInToView;if(null!=n&&null!=r){var a=this.rw_setSpeechRangeImpl(n.node,n.offset,r.node,r.offset,"csp");null!=a&&null!=a.node?o.rw_scrollToObject(a.node):o.rw_scrollToObject(n.node)}}}}},{key:"rw_removeSpeechHighlight",value:function(d,e){var g=new S.SSDOM;try{if("undefined"==typeof e&&(e=!1),null==d||!(d instanceof Array)||0==d.length)return;for(var n,i=0;i<d.length;i++)if(n=d[i],this.rw_checkNodeIsSpeechText(n,e)){var r=n.parentNode;if(null!=n.nextSibling||null!=n.previousSibling){var o=g.allTextFromNodeTH(r),a=r.ownerDocument;n=a.createTextNode(o)}var l=r.parentNode;l.replaceChild(n,r),n=g.mergeTextNodes(n),d[i]=n,this.rw_checkNodeIsSpeechText(n,e)&&--i}else{var s="";1==n.nodeType&&(s=n.tagName.toLowerCase()),"math"==s&&this.rw_highlightMathElement(n,null,null,!1),n.isMathJax&&this.rw_highlightMathElement(n,null,null,!1)}}catch(e){}}},{key:"rw_checkNodeIsSpeechText",value:function(a,e){var o=(new S.SSDOM,new l.Attribute);if(3!=a.nodeType||null==a.parentNode||null==a.parentNode.parentNode)return!1;var n=a.parentNode,r=o.rw_getAttribute(n,"rwstate");return n.tagName.toLowerCase()==g.HIGHLIGHT_TAG&&null!=r&&(!e&&"sp"==r||"csp"==r)}},{key:"rw_setSpeechRangeImpl",value:function(d,e,t,n,r){var i=(new S.SSDOM,new u.DomNavigation),o=null;try{if(t==d)return o=this.rw_setNodeBackground(d,e,n,r,"");o=0<e?this.rw_setNodeBackground(d,e,d.nodeValue.length,r,""):this.rw_setNodeBackground(d,-1,-1,r,"");for(var a=i.getNextTextNodeNoImg(o.node,!1,t,!0);null!=a;){if(a==t){o=this.rw_setNodeBackground(a,0,n,r,""),a=o.node;break}o=this.rw_setNodeBackground(a,-1,-1,r,""),a=o.node,a=i.getNextTextNodeNoImg(a,!1,t,!0)}}catch(e){}return o}}]),r}(o.HighlightBaseController)},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../ScrollInToView":22,"../Sentence/SentenceObject":28,"../SpeechObject":30,"../THCaretRange":32,"../THReturnObject":36,"../Utilities/Utilities":38,"./HighlightBaseController":7}],10:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechHighlightManager=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=d("./SpeechHighlightController"),o=d("./MathJaxHighlightController");t.SpeechHighlightManager=function(){function a(e){n(this,a),this.highlightController=e.isMathML()?new o.MathJaxHighlightController(e):new i.SpeechHighlightController(e)}return r(a,[{key:"highlightRange",value:function(){this.highlightController.highlightRange()}},{key:"unHighlightRange",value:function(){this.highlightController.unHighlightRange()}},{key:"highlightWord",value:function(t){this.highlightController.highlightWord(t)}}]),a}()},{"./MathJaxHighlightController":8,"./SpeechHighlightController":9}],11:[function(r,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function i(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function o(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.StudySkillsHighlighting=void 0;var a=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),y=r("../DOM/SSDOM"),s=r("../THDomRange"),u=r("../THCaretRange"),m=(r("../THReturnObject"),r("../Utilities/Utilities")),l=r("./HighlightBaseController"),f=r("../DOM/DomNavigation"),d=r("../DOM/Attribute"),g=r("../../Constants/Constants"),T=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(g);t.StudySkillsHighlighting=function(r){function l(){n(this,l);var t=i(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return t.g_aTextRange=[],t.g_aHighlightColour=[],t}return o(l,r),a(l,[{key:"fetchWords",value:function(){for(var d=!1,e=[],t=[],n=this.g_aTextRange.length,r=0;r<n;r++){var i;i=this.g_aTextRange[r].toString(),-1==i.trimTH().indexOf(" ")?t.push(this.g_aTextRange.slice(r,r+1).pop()):this.m_bSentenceSelection=!0}t.sort(this.sortBySFF);for(var o,a,g=t.length,l=0;l<g;l++){a=function(t){return t.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")},o=t[l].toString(),o=o.trim();var s=".,?!";s=a(s),o=o.replace(new RegExp("^["+s+"]+|["+s+"]+$","g"),""),e.push(o)}return e}},{key:"studySkillsCollateForColour",value:function(o){for(var i,s=new y.SSDOM,t=[],n=this.g_aTextRange.length,r=0,a=0;a<n;a++)i=this.g_aHighlightColour[a],i==o&&t.push(this.g_aTextRange.slice(a,a+1).pop());h?t.sort(this.sortBy):t.sort(this.sortBySFF);for(var l,u=t.length,f=new m.Utilities,d=[],a=0;a<u;a++){var g,h=!1;g=t[a].rw_getTHCaretRangeFromTHDomRange();l=g.getTextOverCaretRange(),0<l.length&&(l=f.rw_filterForHtml(l),d.push({color:o,text:l}))}return 0<r,d}},{key:"studySkillsCollateForColour",value:function(s){for(var e,l=new y.SSDOM,t=[],n=([],[]),r=this.g_aTextRange.length,i=0,o=0;o<r;o++)if(e=this.g_aHighlightColour[o],-1!=s.indexOf(e)){var a=this.g_aTextRange.slice(o,o+1).pop();a.color=e,t.push(a)}t.sort(this.sortBySFF);for(var u,c=t.length,d=new m.Utilities,o=0;o<c;o++){var g,h=t[o].color;g=t[o].rw_getTHCaretRangeFromTHDomRange();u=g.getTextOverCaretRange(),0<u.length&&(u=d.rw_filterForHtml(u),i++,n.push({text:u,color:h}))}return n}},{key:"sortBy",value:function(n,e){try{return n.compareEndPoints("EndToEnd",e)}catch(e){return 0}}},{key:"sortBySFF",value:function(a,e){try{if(a.equals(e))return 0;a.refresh(),e.refresh();var t=a.getEndAsRange(),n=e.getEndAsRange();return t.compareBoundaryPoints("END_TO_END",n)}catch(e){return 0}}},{key:"studySkillsHTMLHighlightRange",value:function(a,e){var t=new y.SSDOM;try{if(null==e||null==e.range||e.range instanceof String)return!1;var n=e.range;n=this.rw_checkTHRangeForValidHighlight(n);if(null==n)return!1;t.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(n,a);var o=SpeechStream.analytics;return o.report(o.categories.HIGHLIGHT,a),!0}catch(e){return!1}}},{key:"studySkillsHTMLHighlightRangeImpl",value:function(a,e){try{var t=new y.SSDOM,n=!0;if(null==a||a instanceof String)return;var o=0,r=!1;if(!a.toString)return;if(null==a||null==a.toString()||""==a.toString())return;for(var i,d=0;d<this.g_aTextRange.length;d++){if(i=this.g_aTextRange[d],a.body.ownerDocument==i.body.ownerDocument){var l=a.compareRange(i);switch(l){case T.THDomRange_ERROR:window.status="Error occurred when trying to add a highlight.";break;case T.THDomRange_TARGET_SAME:case T.THDomRange_TARGET_INSIDE:i.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret)),this.g_aTextRange.splice(d,1),this.g_aHighlightColour.splice(d,1),--d,a.refresh(),r=!0;break;case T.THDomRange_TARGET_INCLUDES_THIS:case T.THDomRange_TARGET_INCLUDES_THIS_AT_START:case T.THDomRange_TARGET_INCLUDES_THIS_AT_END:this.g_aHighlightColour[d]==e?n=!1:(this.case1SFF(d,a,l),++d,r=!0);break;case T.THDomRange_OVERLAPS_START_OF_TARGET:this.case2SFF(d,a),r=!0;break;case T.THDomRange_OVERLAPS_END_OF_TARGET:this.case3SFF(d,a),r=!0;break;case T.THDomRange_AFTER_TARGET:break;case T.THDomRange_BEFORE_TARGET:}}r&&(++o,100>o&&(d=-1))}var d;if(!1,n){if(a.execCommand)this.studySkillsClearRangeIE(a),this.rw_ieSpecificCallToSetHighlight(a,e);else{var s=a.startCaret,g=a.endCaret;this.rw_setHighlight(s.node,s.offset,g.node,g.offset,e)}this.g_aTextRange.push(a),this.g_aHighlightColour.push(e)}return t.rw_collapseSelection(),!1&&(null.style.display=null),!0}catch(e){return!1}}},{key:"rw_setHighlight",value:function(d,e,t,n,r){var i=d,s=t,g=(new y.SSDOM,new f.DomNavigation);try{var l=null;if(t==d)l=this.rw_setNodeBackground(d,e,n,"ss",r),i=l.node,s=l.node;else{l=0<e?this.rw_setNodeBackground(d,e,d.nodeValue.length,"ss",r):this.rw_setNodeBackground(d,-1,-1,"ss",r),i=l.node;for(var u=g.getNextTextNodeNoImg(l.node,!1,t,!0);null!=u;){if(u==t){l=this.rw_setNodeBackground(u,0,n,"ss",r),u=l.node,s=u;break}l=this.rw_setNodeBackground(u,-1,-1,"ss",r),u=l.node,s=u,u=g.getNextTextNodeNoImg(u,!1,t,!0)}}}catch(e){}return{start:i,end:s}}},{key:"rw_ieSpecificCallToSetHighlight",value:function(n,e){"strikethrough"==e?n.execCommand("strikethrough",!1,null):n.execCommand("backcolor",!1,e)}},{key:"studySkillsClearRangeIE",value:function(t){t.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&t.execCommand("RemoveFormat",!1,null)}},{key:"rw_removeHighlight",value:function(s){var e=new y.SSDOM,t=new d.Attribute;try{if(null==s||!(s instanceof Array)||0==s.length)return;for(var n,i=0;i<s.length;i++)if(n=s[i],this.rw_checkNodeIsHighlightedText(n)){var r=n.parentNode;if(null!=n.nextSibling||null!=n.previousSibling){var o=e.allTextFromNodeTH(r),a=r.ownerDocument;n=a.createTextNode(o)}var l=r.parentNode;l.replaceChild(n,r),n=e.mergeTextNodes(n),s[i]=n}else{var g=this.rw_getNestedNodeForHighlightedText(n);null!=g&&(t.rw_removeAttribute(g,"rwstate"),g.removeAttribute("style"))}}catch(e){}}},{key:"rw_getNestedNodeForHighlightedText",value:function(a){var e=(new y.SSDOM,new d.Attribute);if(3!=a.nodeType||null==a.parentNode||null==a.parentNode.parentNode)return null;var t=T.HIGHLIGHT_TAG,n=a.parentNode,r=e.rw_getAttribute(n,"rwstate");if(n.tagName.toLowerCase()!=t||null==r||"ss"!=r){if(null!=e.rw_getAttribute(n,"rwthgen")){var i=n;for(r="1";null!=r;){if(i=i.parentNode,"ss"==e.rw_getAttribute(i,"rwState")&&i.tagName.toLowerCase()==t)return i;r=e.rw_getAttribute(i,"rwthgen")}}return null}return n}},{key:"rw_checkNodeIsHighlightedText",value:function(a){var e=(new y.SSDOM,new d.Attribute);if(null==a.parentNode||null==a.parentNode.parentNode)return!1;var t=a.parentNode,n=e.rw_getAttribute(t,"rwstate");return t.tagName.toLowerCase()==T.HIGHLIGHT_TAG&&null!=n&&"csp"!=n&&"sp"!=n||"thspell"==t.className||"thhom"==t.className||"thgrammar"==t.className}},{key:"rw_checkTHRangeForValidHighlight",value:function(d){var e=new y.SSDOM,t=new f.DomNavigation,n=d.startCaret,r=d.endCaret,i=!1;if(e.isInvalidNode(n.node)){if(n.node==r.node)return;var o=t.getNextTextNodeNoImg(n.node,!1,r.node,!1);if(null==o||e.isInvalidNode(o))return;n.node=o,n.offset=0,i=!0}var a=3!=n.node.nodeType||3==n.node.nodeType&&0==n.node.nodeValue.trimTH().length;if(a){for(i=!0;a;){if(n.node==r.node)return null;if(n.node=t.getNextTextNodeNoBlank(n.node,!1,r.node),null==n.node)return null;a=3!=n.node.nodeType||3==n.node.nodeType&&0==n.node.nodeValue.trimTH().length}n.offset=0}if(e.isInvalidNode(r.node)){if(n.node==r.node)return;var o=t.getPreviousTextNodeNoImg(r.node,!1,n.node,!1);if(null==o||e.isInvalidNode(o))return;r.node=o,r.offset=o.nodeValue.length,i=!0}if(a=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length){for(i=!0;a;){if(n.node==r.node)return null;if(r.node=t.getPreviousTextNodeNoImg(r.node,!1,n.node,!1),null==r.node)return null;a=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length}3==r.node.nodeType&&(r.offset=r.node.nodeValue.length)}return null==n.node||null==r.node?null:(i&&(d=new s.THDomRange(n.node,n.offset,r.node,r.offset)),d)}},{key:"studySkillsClearHighlights",value:function(o,d){try{var t=null,n=null;if(null!=d&&null!=d.range&&(t=d.range,n=d.frame),null!=t&&t instanceof String){var r=!1;if(null!=r&&(r.selectionStart=0,r.selectionEnd=0),r=null,!o)return;t=null}if(null==t||o){if(!o){var i=!1;if(!i)return}var s=this.g_aTextRange;this.g_aTextRange=[],this.g_aHighlightColour=[];for(var g,c=new y.SSDOM,h=0;h<s.length;h++)g=s[h],g.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(g.startCaret,g.endCaret))}else{t.refresh();for(var f,p=0;p<this.g_aTextRange.length;p++)if(f=this.g_aTextRange[p],t.body==f.body){var u=t.compareRange(f);switch(u){case T.THDomRange_ERROR:window.status="Error occurred when trying to remove a highlight.";break;case T.THDomRange_TARGET_SAME:case T.THDomRange_TARGET_INSIDE:f.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(f.startCaret,f.endCaret)),this.g_aTextRange.splice(p,1),this.g_aHighlightColour.splice(p,1),--p,t.refresh();break;case T.THDomRange_TARGET_INCLUDES_THIS:case T.THDomRange_TARGET_INCLUDES_THIS_AT_START:case T.THDomRange_TARGET_INCLUDES_THIS_AT_END:this.case1SFF(p,t,u),++p;break;case T.THDomRange_OVERLAPS_START_OF_TARGET:this.case2SFF(p,t);break;case T.THDomRange_OVERLAPS_END_OF_TARGET:this.case3SFF(p,t);break;case T.THDomRange_AFTER_TARGET:break;case T.THDomRange_BEFORE_TARGET:}}}c.rw_collapseSelection();var i,m,p,h,m,p,g,l,S,S,l}catch(e){}}},{key:"studySkillsHTMLRefreshRanges",value:function(){try{var a=null,e=!1,t=0;for(t=0;t<this.g_aTextRange.length;t++){a=this.g_aTextRange[t];try{null!=a.text&&""!=a.text||(a=null)}catch(e){a=null}null==a&&(this.g_aTextRange.splice(t,1),this.g_aHighlightColour.splice(t,1),e=!0,t--)}return e}catch(e){return!1}}},{key:"case1SFF",value:function(c,e,t){var n=(new y.SSDOM,this.g_aHighlightColour[c]),r=this.g_aTextRange[c];r.refresh();var i=r.startRef,o=e.startRef,a=e.endRef,l=r.endRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(r.startCaret,r.endCaret)),this.g_aTextRange.splice(c,1),this.g_aHighlightColour.splice(c,1);var h,f,d,g;if(t!=T.THDomRange_TARGET_INCLUDES_THIS_AT_START){var p=new u.THCaretRange(e.body,i.path,i.offset,o.path,o.offset);h=p.leftCaret,f=p.rightCaret,d=this.rw_setHighlight(h.node,h.offset,f.node,f.offset,n),g=new s.THDomRange(d.start,0,d.end,d.end.nodeValue.length),this.g_aTextRange.push(g),this.g_aHighlightColour.push(n)}t!=T.THDomRange_TARGET_INCLUDES_THIS_AT_END&&(p=new u.THCaretRange(e.body,a.path,a.offset,l.path,l.offset),h=p.leftCaret,f=p.rightCaret,d=this.rw_setHighlight(h.node,h.offset,f.node,f.offset,n),g=new s.THDomRange(d.start,0,d.end,d.end.nodeValue.length),this.g_aTextRange.push(g),this.g_aHighlightColour.push(n)),e.refresh()}},{key:"case2SFF",value:function(g,e){var t=(new y.SSDOM,this.g_aHighlightColour[g]),n=this.g_aTextRange[g];n.refresh();var r=e.endRef,i=n.endRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(n.startCaret,n.endCaret)),this.g_aTextRange.splice(g,1),this.g_aHighlightColour.splice(g,1);var o=new u.THCaretRange(e.body,r.path,r.offset,i.path,i.offset),a=o.leftCaret,l=o.rightCaret,c=this.rw_setHighlight(a.node,a.offset,l.node,l.offset,t),f=new s.THDomRange(c.start,0,c.end,c.end.nodeValue.length);this.g_aTextRange.push(f),this.g_aHighlightColour.push(t),e.refresh()}},{key:"case3SFF",value:function(g,e){var t=(new y.SSDOM,this.g_aHighlightColour[g]),n=this.g_aTextRange[g];n.refresh();var r=n.startRef,i=e.startRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(n.startCaret,n.endCaret)),this.g_aTextRange.splice(g,1),this.g_aHighlightColour.splice(g,1);var o=new u.THCaretRange(e.body,r.path,r.offset,i.path,i.offset),a=o.leftCaret,l=o.rightCaret,c=this.rw_setHighlight(a.node,a.offset,l.node,l.offset,t),f=new s.THDomRange(c.start,0,c.end,c.end.nodeValue.length);this.g_aTextRange.push(f),this.g_aHighlightColour.push(t),e.refresh()}}]),l}(l.HighlightBaseController)},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THCaretRange":32,"../THDomRange":33,"../THReturnObject":36,"../Utilities/Utilities":38,"./HighlightBaseController":7}],12:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ElementHelper=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=a("./LoopState");t.ElementHelper=function(){function t(){n(this,t)}return r(t,[{key:"isTokenType",value:function(t){return"entity"==t||"char"==t||"entities"==t||"chars"==t}},{key:"looper",value:function(a,e,t){if(null!=a){var n=a.spanID?a.spanID:a.CHTMLnodeID;if(n=null!=n&&void 0!=n?n:a.PHTMLspanID,null!=n&&n==e)return t.pushToList(a),++t.count,!0;if(null!=a.data)for(var r,o=0;o<a.data.length;o++)if(r=this.looper(a.data[o],e,t),r)return r}return!1}},{key:"getList",value:function(a,e){var t=new i.LoopState;return this.looper(a,e,t),t.getList()}}]),t}()},{"./LoopState":14}],13:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightData=function e(){n(this,e),this.style=null,this.fg=null,this.bg=null,this.lastSpanId=0}},{}],14:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.LoopState=function(){function t(){n(this,t),this.count=1,this.list=[]}return o(t,[{key:"pushToList",value:function(t){this.list.push(t)}},{key:"getList",value:function(){return this.list}}]),t}()},{}],15:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.MathJaxHighlighter=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),g=d("./HighlightData"),o=d("./ElementHelper"),a=d("../DOM/SSDOM");t.MathJaxHighlighter=function(){function i(e){n(this,i),this.highlightDataStore={},this.highlightJaxRoot=e.root,this.highlightClearLast=!0,this.elementHelper=new o.ElementHelper}return r(i,[{key:"setClearLastHighlight",value:function(t){this.highlightClearLast=t}},{key:"setHighlightStyle",value:function(o,d,f,n,r){if("string"!=typeof o)return!1;if(this.highlightDataStore[o]&&this.highlightDataStore.hasOwnProperty(o)){var i=this.highlightDataStore[o];i&&0<i.lastSpanId&&this.clearHighlightNodesImpl(o,i.style,i.lastSpanId)}if(null===d)return delete this.highlightDataStore[o],!0;if("string"!=typeof d)return!1;if(d=d.toLowerCase(),""===d||"none"===d)return delete this.highlightDataStore[o],!0;var a,l,s;try{a=this.parseColor(f),l=this.parseColor(n),s=this.parseColor(r)}catch(e){return!1}var u;return this.highlightDataStore[o]&&this.highlightDataStore.hasOwnProperty(o)?(u=this.highlightDataStore[o],"highlight"!==u.style&&(u.fg=null,u.bg=null)):u=new g.HighlightData,"fg"===d?(u.style="highlight",u.fg="rgb("+a+","+l+","+s+")"):"bg"===d?(u.style="highlight",u.bg="rgb("+a+","+l+","+s+")"):"outline"===d?(u.style=d,u.fg="rgb("+a+","+l+","+s+")",u.bg=null):"underline"==d&&(u.style=d,u.fg="rgb("+a+","+l+","+s+")",u.bg=null),this.highlightDataStore[o]=u,!0}},{key:"highlightNodes",value:function(a,e){var t;if(this.highlightDataStore[a]&&this.highlightDataStore.hasOwnProperty(a)&&(t=this.highlightDataStore[a],null!==t.style)){0<t.lastSpanId&&this.highlightClearLast&&this.clearHighlightNodesImpl(a,t.style,t.lastSpanId),t.lastSpanId=e;var n=this.elementHelper.getList(this.highlightJaxRoot,e);this.highlightImpl(n,a,t.style,t.fg,t.bg)}}},{key:"clearHighlights",value:function(){for(var n in this.highlightDataStore)if(this.highlightDataStore.hasOwnProperty(n)){var e=this.highlightDataStore[n];this.clearHighlightNodesImpl(n,"",e.lastSpanId),e.lastSpanId=0}}},{key:"clearHighlightNodes",value:function(n,e){this.clearHighlightNodesImpl(n,"",e)}},{key:"parseColor",value:function(n){var a;if("string"==typeof n)a=parseInt(n,10);else{if("number"!=typeof n)throw"invalid";a=n}if(0>a||255<a)throw"invalid";return a}},{key:"clearHighlightNodesImpl",value:function(d,e,t){for(var n,a=this.elementHelper.getList(this.highlightJaxRoot,t),r=0,i=a.length;r<i;r++){if(n=a[r],""!==e&&"outline"!==e||delete n.mathoutline,""===e||"underline"===e)if(n.previousline){this.removeFromPrevious(n.previousline,d);var o=n.previousline.length;n.mathunderline=0<o?n.previousline[o-1].val:""}else n.mathunderline="";if(""===e||"highlight"===e){if(n.previouscolor){this.removeFromPrevious(n.previouscolor,d);var o=n.previouscolor.length;n.mathcolor=0<o?n.previouscolor[o-1].val:""}else n.mathcolor=" ";delete n.mathbackground}var l=null;try{l=n.HTMLspanElement()}catch(e){}if(null==l)try{l=n.CHTMLnodeElement()}catch(e){}if(null==l)return;var s=!0;if(void 0!=n.HTMLremoveColor&&(s=this.setupPostFix(l,d,!0)),s)try{n.HTMLhandleColor(l)}catch(e){n.PHTMLhandleColor(l)}this.setdownPostFix(l);var s=!0;if(void 0!=n.HTMLremoveColor&&(s=this.setupPostFix(l,d,!1)),s)if(void 0!=n.HTMLremoveColor)n.HTMLremoveColor();else{var g;try{g=n.HTMLspanElement()}catch(e){g=n.CHTMLnodeElement()}null!=g&&(g.style.background="",g.style.color="")}if(this.setdownPostFix(l),void 0!=n.HTMLremoveColor){var g;try{g=n.HTMLspanElement()}catch(e){g=n.CHTMLnodeElement()}null!=g&&(g.style.background="",g.style.color="")}}}},{key:"highlightImpl",value:function(l,e,h,n,p){for(var i=0,o=l.length;i<o;i++){var m=l[i],s=m.HTMLhandleColor?m.HTMLhandleColor:m.CHTMLhandleColor;if("function"==typeof s){var y=null;try{y=m.CHTMLnodeElement()}catch(e){}if(null==y)try{y=m.HTMLspanElement()}catch(e){}if(null==y)return;if("highlight"!==h)"outline"===h?m.mathoutline=n+"thin solid":"underline"==h&&(m.previousline?this.removeFromPrevious(m.previousline,e):(m.previousline=[],m.textDecoration&&m.previousline.push({key:"",val:m.textDecoration})),m.previousline.push({key:e,val:"underline"}),m.mathunderline="underline");else if(null!=p&&(m.mathbackground=p),null!=n){if(m.previouscolor)this.removeFromPrevious(m.previouscolor,e);else if(m.previouscolor=[],m.mathcolor)m.previouscolor.push({key:"",val:m.mathcolor});else{var c=new a.SSDOM,f=c.getComputedStyle(y);f.color}m.previouscolor.push({key:e,val:n}),m.mathcolor=n}var d=this.setupPostFix(y,e,!0);if(d)try{m.HTMLhandleColor(y)}catch(e){m.PHTMLhandleColor(y)}this.setdownPostFix(y)}}}},{key:"removeFromPrevious",value:function(a,e){for(var t=0;t<a.length;t++)if(a[t].key===e)return void a.splice(t,1)}},{key:"setupPostFix",value:function(a,e,t){try{var n=a.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?a.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:a.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,r="-"+e;if(t){var i=a.id+n.idPostfix+r;if(null!=document.getElementById(i))return!1}"string"==typeof n.idPostfix?(this.m_strTmpPostFix=n.idPostfix,n.idPostfix+=r):(this.m_strTmpPostFix="",n.idPostfix=r)}catch(e){return!1}return!0}},{key:"setdownPostFix",value:function(n){try{var e=n.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?n.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:n.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(e.idPostfix=null,delete e.idPostfix),null!=this.m_strTmpPostFix&&(e.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}}]),i}()},{"../DOM/SSDOM":5,"./ElementHelper":12,"./HighlightData":13}],16:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.MathSpeak=function(){function t(){n(this,t),sre.System.getInstance().setupEngine({semantics:!1,domain:"mathspeak",style:"default"}),this.instance=sre.System.getInstance()}return o(t,[{key:"getTextFromMathJax",value:function(a){if(a.isMathJax){for(var e=a;null!=e&&e.isMathJax&&!e.id;)e=e.parentNode;var t=e&&e.id?"math:"+e.id+";":"math:none;"}var n=a.ownerDocument.defaultView.MathJax.Hub.getJaxFor(a);if(null!=n){var o=null;try{if(o=n.root.toMathML(""),null!=o||0<o.length)return t+o}catch(e){}return""}return""}},{key:"getSpeech",value:function(a){if("string"==typeof a){var o=document.getElementById(a);if(null!=o&&1==o.isMathJax){var t=this.getMathMLText(a),n=this.getMathMLObject(a);return t=t.replace(/<\/([^>]+)/g,"</mathml:$1>"),t=t.replace(/<([^>]+)/g,"<mathml:$1>"),this.instance.processExpression(this.getMathMLWithBookmarks(n,t,!1))}}return""}},{key:"getSpeechWithBookmarks",value:function(a){if("string"==typeof a){var o=document.getElementById(a);if(null!=o&&1==o.isMathJax){var o=document.getElementById(a),t=this.getMathMLText(a),n=this.getMathMLObject(a);return this.instance.processExpression(this.getMathMLWithBookmarks(n,t,!0))}}return""}},{key:"getSpeechWithBookmarksFromElement",value:function(a){if(null!=a&&1==a.isMathJax){var e="";try{var t=this.getMathMLText(a),n=this.getMathMLObject(a),o=this.getMathMLWithBookmarks(n,t,!0);""!=o&&(e=this.instance.processExpression(o))}catch(e){}return e}return""}},{key:"getMathMLOriginalText",value:function(n){if("string"==typeof n){var a=document.getElementById(n);if(null!=a&&1==a.isMathJax){var a=document.getElementById(n);return a.ownerDocument.defaultView.MathJax.Hub.getJaxFor(a).originalText}}return""}},{key:"getMathMLText",value:function(a){if(null!=a&&1==a.isMathJax){var e=a.ownerDocument.defaultView.MathJax.Hub.getJaxFor(a).root.toMathML(),t=new DOMParser,n=t.parseFromString(e,"text/xml");if("parsererror"==n.documentElement.nodeName||"parsererror"==n.documentElement.firstChild.nodeName)throw console.error("Mathml is invalid, Please contact page provider"),"Mathml is invalid, Please contact page provider";return e}return""}},{key:"getMathMLObject",value:function(t){return null!=t&&1==t.isMathJax?t.ownerDocument.defaultView.MathJax.Hub.getJaxFor(t).root:""}},{key:"isMathML",value:function(n){if("string"==typeof n){var a=document.getElementById(n);if(null!=a&&1==a.isMathJax)return!0}return!1}},{key:"getMathMLWithBookmarks",value:function(d,e,t){if(null!=e&&(e=e.replace(/<mathml:math.*>/,"<math xmlns=\"http://www.w3.org/1998/Math/MathML\">")),void 0!=d.data)for(var n=0;n<d.data.length;n++)if(null!=d.data[n]){var r=d.data[n].spanID?d.data[n].spanID:d.data[n].CHTMLnodeID;if(r=null!=r&&void 0!=r?r:d.data[n].PHTMLspanID,d.data[n].toMathML&&d.data[n].toMathML()&&void 0!=r&&void 0!=d.data[n].data[0]&&void 0!=d.data[n].data[0].data[0]&&void 0==d.data[n].data[0].data[0].toMathML){var i=d.data[n].toMathML();if(t)var o=i.replace(">"," bookmark =\""+r+"\">");else var o=i.replace(">"," nobookmark =\"\">");e=e.replace(i,o)}e=this.getMathMLWithBookmarks(d.data[n],e,t)}return e}},{key:"getMathMLTextWithBookmarks",value:function(a){if("string"==typeof a){var o=document.getElementById(a);if(null!=o&&1==o.isMathJax){var o=document.getElementById(a),t=this.getMathMLText(a),n=this.getMathMLObject(a);return this.getMathMLWithBookmarks(n,t,!0)}}return""}}]),t}()},{}],17:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.PredictionBaseClass=function(){function t(){n(this,t),this.curser=0,this.controlEdit=null,this.curser=0,this.currentChar=null,this.properties=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"]}return o(t,[{key:"setEditControl",value:function(t){this.controlEdit=t}},{key:"isEditable",value:function(){return!1}},{key:"getPositionOfPopup",value:function(){return{top:-100,left:-100}}}]),t}()},{}],18:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function i(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.PredictionEditableDiv=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=d("./PredictionBaseClass");t.PredictionEditableDiv=function(a){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return i(e,a),o(e,[{key:"setEditControl",value:function(t){this.controlEdit=t,this.sel=window.getSelection(),this.curser=this.getCaretPosition(t),this.currentChar=this.getCurrentCharacter()}},{key:"getCaretPosition",value:function(a){var e,t,n=0;if(window.getSelection)e=window.getSelection(),e.rangeCount&&(t=e.getRangeAt(0),t.commonAncestorContainer.parentNode==a&&(n=t.endOffset));else if(document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.parentElement()==a)){var r=document.createElement("span");a.insertBefore(r,a.firstChild);var i=t.duplicate();i.moveToElementText(r),i.setEndPoint("EndToEnd",t),n=i.text.length}return n}},{key:"isEditable",value:function(){return"undefined"!=typeof this.controlEdit&&"undefined"!=typeof this.controlEdit.contentEditable&&("true"==this.controlEdit.contentEditable||1==this.controlEdit.contentEditable)}},{key:"getSentence",value:function(){var a,e="";if(window.getSelection&&(a=window.getSelection()).modify){var t=a.getRangeAt(0);a.collapseToStart(),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0)?a.modify("extend","backward","sentenceboundary"):a.modify("extend","backward","sentenceboundary"),e=a.toString(),a.removeAllRanges(),a.addRange(t)}else if((a=document.selection)&&"Control"!=a.type){var n=a.createRange();n.collapse(!0),n.expand("sentence"),e=n.text}return e}},{key:"getPositionOfPopup",value:function(){var a=this.controlEdit;if("undefined"==typeof a)return{top:-100,left:-100};var d=getComputedStyle(a).getPropertyValue("font-size"),t=this.getCaretCoordinates(a,this.curser);this.sel=window.getSelection(),this.curser=this.sel.extentOffset;var n={x:0,y:0};this.GetOffset(a,n);var r=n.y-a.scrollTop+t.top+parseInt(d)+4+"px",l=n.x-a.scrollLeft+t.left+10+"px";return{top:r,left:l}}},{key:"GetOffset",value:function(n,e){n&&(e.x+=n.offsetLeft,e.y+=n.offsetTop,this.GetOffset(n.offsetParent,e))}},{key:"getCaretCoordinates",value:function(d,e){var t=document.getElementById(d.nodeName+"--mirror-div");t||(t=document.createElement("div"),t.id=d.nodeName+"--mirror-div",document.body.appendChild(t));var n=t.style,r=getComputedStyle(d);n.whiteSpace="pre-wrap","INPUT"!==d.nodeName&&(n.wordWrap="break-word"),n.position="absolute",n.top=d.offsetTop+parseInt(r.borderTopWidth)+"px",n.left="400px",n.visibility="hidden",this.properties.forEach(function(t){n[t]=r[t]}),n.overflow="hidden",t.textContent=d.textContent.substring(0,e),"INPUT"===d.nodeName&&(t.textContent=t.textContent.replace(/\s/g,"\xA0"));var i=document.createElement("span");i.textContent=d.textContent.substring(e)||".",i.style.backgroundColor="lightgrey",t.appendChild(i);var o={top:i.offsetTop+parseInt(r.borderTopWidth),left:i.offsetLeft+parseInt(r.borderLeftWidth)};return o}},{key:"setSelectionRange",value:function(a,e,t){"#text"!=a.nodeName&&(a=a.childNodes[0]);var n=document.createRange();n.setStart(a,e),n.setEnd(a,t);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}},{key:"setCaretPosition",value:function(a,e){if(null!=a)if(a.createTextRange){var t=a.createTextRange();t.move("character",e),t.select()}else a.selectionStart?(a.focus(),a.setSelectionRange(e,e)):a.focus()}},{key:"insertText",value:function(n){var e=this.controlEdit;this.CurrentPosition=this.curser,this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(n),this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(e,this.CurrentPosition),this.curser=this.CurrentPosition}},{key:"getCurrentCharacter",value:function(){return this.controlEdit.innerHTML.charAt(this.curser-1)}},{key:"replaceSelectedText",value:function(d){var e,t;d+=" ";var n=0;if(window.getSelection){e=window.getSelection();var r=this.controlEdit;if(0<this.curser)switch(this.currentChar.charCodeAt(0)){case 46:case 33:case 63:d=" "+d;case 32:case 160:break;case 38:e.collapseToStart(),e.modify("move","backward","character"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();" "==i?(e.modify("move","forward","character"),e.modify("extend","forward","character")):(e.modify("move","backward","word"),e.modify("extend","forward","word"));break;case 45:e.collapseToStart(),e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","word");break;default:e.collapseToStart(),e.modify("move","backward","word"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();if("-"==i?(e.modify("extend","backward","character"),e.modify("move","forward","character"),e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","word")):32==i.charCodeAt(0)&&e.modify("move","forward","character"),e.modify("extend","forward","word"),i=e.toString(),"-"==i.substr(i.length-1,1)&&e.modify("extend","forward","word"),i=e.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==i.substr(i.length-1,1)&&(e.modify("extend","backward","character"),d=d.trim(),n++),i=e.toString();var o=/^[0-9a-zA-Z]+$/;i.substr(i.length-1,1).match(o)||(e.modify("extend","backward","character"),d=d.trim(),n++)}}var a=r.textContent,l=this.sel.baseOffset,s=this.sel.extentOffset;if(-1!=navigator.appVersion.indexOf("Win"));else switch(a.slice(s).substr(0,1)){case" ":d=d.trim(),n++;break;case";":case":":case"!":case".":d=d.trim(),n++,n++;}r.textContent=a.slice(0,l)+d+a.slice(s),this.CurrentPosition=l+d.length+n}else document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.text=d)}},{key:"getSelection",value:function(){var a,e=this.controlEdit;if(void 0!=document.selection){e.focus();var t=document.selection.createRange();a=t.text}else if(void 0!=e.selectionStart){var n=e.selectionStart,o=e.selectionEnd;a=e.value.substring(n,o)}return a}}]),e}(a.PredictionBaseClass)},{"./PredictionBaseClass":17}],19:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PredictionManager=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=a("./PredictionTextArea");a("./PredictionEditableDiv"),a("./PredictionBaseClass"),t.PredictionManager=function(){function t(){n(this,t),this.predictionManager=null}return r(t,[{key:"getPredictionCoordinates",value:function(){return null==this.predictionManager?{top:-1e3,left:-1e3}:this.predictionManager.getPositionOfPopup()}},{key:"getPredictionSentence",value:function(){return null==this.predictionManager?null:this.predictionManager.getSentence()}},{key:"predictionInsertText",value:function(t){null!=this.predictionManager&&this.predictionManager.insertText(t)}},{key:"isEditable",value:function(){return null!=this.predictionManager&&this.predictionManager.isEditable()}},{key:"onMouseDown",value:function(t){this.predictionFactory(t),null!=this.predictionManager&&this.predictionManager.setEditControl(t.target)}},{key:"onKeyDown",value:function(t){this.predictionFactory(t),null!=this.predictionManager&&this.predictionManager.setEditControl(t.target)}},{key:"predictionFactory",value:function(n){var e=n.target;("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName&&"text"==e.type.toLowerCase())&&(this.predictionManager=new i.PredictionTextArea)}}]),t}()},{"./PredictionBaseClass":17,"./PredictionEditableDiv":18,"./PredictionTextArea":20}],20:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function i(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.PredictionTextArea=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=d("./PredictionBaseClass"),l=d("./textareaCaretPosition");t.PredictionTextArea=function(a){function e(){return n(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return i(e,a),o(e,[{key:"setEditControl",value:function(t){("TEXTAREA"==t.nodeName||"INPUT"==t.nodeName&&"text"==t.type.toLowerCase())&&(this.controlEdit=t,this.curser=t.selectionEnd,this.startSelection=t.selectionStart,this.currentChar=this.getCurrentCharacter(),t.setSelectionRange(this.startSelection,this.curser))}},{key:"isEditable",value:function(){return"undefined"!=typeof this.controlEdit&&("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase())&&this.curser==this.startSelection}},{key:"getSentence",value:function(){try{this.curser=this.controlEdit.selectionEnd,this.startSelection=this.controlEdit.selectionStart}catch(t){}var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){this.controlEdit.focus(),this.controlEdit.setSelectionRange(this.startSelection,this.startSelection);var n=e.getRangeAt(0);32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0)?e.modify("extend","backward","sentenceboundary"):e.modify("extend","backward","sentenceboundary"),t=e.toString();var a=/[.?!]/;a.test(t.slice(-1))&&(t=t.slice(0,t.length-1)),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return this.controlEdit.setSelectionRange(this.startSelection,this.curser),t}},{key:"getPositionOfPopup",value:function(){var d=this.controlEdit;if("undefined"==typeof d)return{top:-100,left:-100};var s=getComputedStyle(d).getPropertyValue("font-size");if("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase()){var t=new l.textareaCaretPosition,n=t.getCaretCoordinates(d,d.selectionEnd);this.curser=d.selectionEnd;var r={x:0,y:0};this.GetOffset(d,r);var i=r.y-d.scrollTop+n.top+parseInt(s)+4+"px",g=r.x-d.scrollLeft+n.left+10+"px";return{top:i,left:g}}return{top:-100,left:-100}}},{key:"GetOffset",value:function(n,e){n&&(e.x+=n.offsetLeft,e.y+=n.offsetTop,this.GetOffset(n.offsetParent,e))}},{key:"setSelectionRange",value:function(a,e,t){if(a.setSelectionRange)a.focus(),a.setSelectionRange(e,t);else if(a.createTextRange){var n=a.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}else a.focus()}},{key:"setCaretPosition",value:function(a,e){if(null!=a)if(a.createTextRange){var t=a.createTextRange();t.move("character",e),t.select()}else a.selectionStart?(a.focus(),a.setSelectionRange(e,e)):a.focus()}},{key:"insertText",value:function(a){var e=this.controlEdit;if("DIV"==e.tagName){e.focus();var t=document.getElementById("rwPredictionPosition");this.setCaretPositionDiv(currentContextControlID),this.setSelectionRange(e,t.value,t.value),this.currentChar=this.getCurrentCharacter(),this.replaceSelectedText(a)}else this.CurrentPosition=e.selectionStart,this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(a),this.setSelectionRange(e,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(e,this.CurrentPosition);return!1}},{key:"getCurrentCharacter",value:function(){var a,e="";if(window.getSelection&&(a=window.getSelection()).modify){var t=a.getRangeAt(0);a.modify("move","backward","character"),a.modify("extend","forward","character"),e=a.toString(),a.removeAllRanges(),a.addRange(t)}else if((a=document.selection)&&"Control"!=a.type){var n=a.createRange();n.collapse(!0),n.expand("word"),e=n.text}return e}},{key:"replaceSelectedText",value:function(d){var e,t;d+=" ";var n=0;if(window.getSelection){e=window.getSelection();var r=document.activeElement;if("TEXTAREA"==r.nodeName||"INPUT"==r.nodeName&&"text"==r.type.toLowerCase()){if(0<this.curser)switch(this.currentChar.charCodeAt(0)){case 32:case 160:d=d;break;case 46:case 33:case 63:d=d.trim()+this.currentChar+" ",e.modify("move","backward","character"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();" "==i?(e.modify("move","forward","character"),e.modify("extend","forward","character")):(e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","character"));break;case 10:d=d.trim()+" ";var i=e.toString();break;case 38:e.modify("move","backward","character"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();" "==i?(e.modify("move","forward","character"),e.modify("extend","forward","character")):(e.modify("move","backward","word"),e.modify("extend","forward","word"));break;case 45:e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","word");break;default:e.modify("move","backward","word"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();if("-"==i?(e.modify("extend","backward","character"),e.modify("move","forward","character"),e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","word")):32==i.charCodeAt(0)&&e.modify("move","forward","character"),e.modify("extend","forward","word"),i=e.toString(),"-"==i.substr(i.length-1,1)&&e.modify("extend","forward","word"),i=e.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==i.substr(i.length-1,1)&&(e.modify("extend","backward","character"),d=d.trim(),n++),i=e.toString();var o=/^[0-9a-zA-Z]+$/;i.substr(i.length-1,1).match(o)||(e.modify("extend","backward","character"),d=d.trim(),n++)}}var a=r.value,l=r.selectionStart,s=r.selectionEnd;if(-1!=navigator.appVersion.indexOf("Win"));else switch(a.slice(s).substr(0,1)){case" ":d=d.trim(),n++;break;case";":case":":case"!":case".":d=d.trim(),n++,n++;}r.value=a.slice(0,l)+d+a.slice(s),this.CurrentPosition=l+d.length+n}else{var e=window.getSelection();if(this.setCaretPositionDiv(r),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0));else{e.modify("move","backward","word"),e.modify("move","backward","character"),e.modify("extend","forward","character");var i=e.toString();"-"==i?(e.modify("extend","backward","character"),e.modify("move","forward","character"),e.modify("move","backward","word"),e.modify("extend","forward","word"),e.modify("extend","forward","word")):32==i.charCodeAt(0)&&e.modify("move","forward","character"),e.modify("extend","forward","word")}e.rangeCount?(t=e.getRangeAt(0),t.deleteContents(),t.insertNode(document.createTextNode(d))):e.deleteFromDocument();var a=r.value,l=r.selectionStart,s=r.selectionEnd;r.value=a.slice(0,l)+d+a.slice(s),setCaretPositionDiv(r,l+d.length)}}else document.selection&&document.selection.createRange&&(t=document.selection.createRange(),t.text=d)}},{key:"getSelection",value:function(){var a,e=this.controlEdit;if(void 0!=document.selection){e.focus();var t=document.selection.createRange();a=t.text}else if(void 0!=e.selectionStart){var n=e.selectionStart,o=e.selectionEnd;a=e.value.substring(n,o)}return a}}]),e}(a.PredictionBaseClass)},{"./PredictionBaseClass":17,"./textareaCaretPosition":21}],21:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.textareaCaretPosition=function(){function t(){n(this,t),this.properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],this.isBrowser="undefined"!=typeof window,this.isFirefox=this.isBrowser&&null!=window.mozInnerScreenX}return o(t,[{key:"getCaretCoordinates",value:function(d,e,t){if(!this.isBrowser)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var n=t&&t.debug||!1;if(n){var r=document.querySelector("#input-textarea-caret-position-mirror-div");r&&r.parentNode.removeChild(r)}var i=document.createElement("div");i.id="input-textarea-caret-position-mirror-div",document.body.appendChild(i);var o=i.style,a=window.getComputedStyle?getComputedStyle(d):d.currentStyle;o.whiteSpace="pre-wrap","INPUT"!==d.nodeName&&(o.wordWrap="break-word"),o.position="absolute",n||(o.visibility="hidden"),this.properties.forEach(function(t){o[t]=a[t]}),this.isFirefox?d.scrollHeight>parseInt(a.height)&&(o.overflowY="scroll"):o.overflowY="auto",i.textContent=d.value.substring(0,e),"INPUT"===d.nodeName&&(i.textContent=i.textContent.replace(/\s/g,"\xA0"));var l=document.createElement("span");l.textContent=d.value.substring(e)||".",i.appendChild(l);var s={top:l.offsetTop+parseInt(a.borderTopWidth),left:l.offsetLeft+parseInt(a.borderLeftWidth)};return n?l.style.backgroundColor="#aaa":document.body.removeChild(i),s}}]),t}()},{}],22:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollInToView=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),S=d("./DOM/SSDOM"),o=d("./Events/EventBus");t.ScrollInToView=function(){function t(){n(this,t)}return r(t,[{key:"rw_scrollToObject",value:function(a){var e=new S.SSDOM,t=!1;try{var n=e.getWindow(a);if(null==n||null==a||null==a.parentNode)return;var r=0,i=0,l=a;3==l.nodeType&&(l=l.parentNode);for(var s=null,u=l,c=l.ownerDocument.body,h=!1,f=null;null!=u&&u!=c;)"div"!=u.tagName.toLowerCase()&&"form"!=u.tagName.toLowerCase()||this.rw_isDivScrollable(u)&&(h=!0,s=this.rw_scrollToObjectDivCheck(l,u,s),f=u,l=u),u=u.parentNode;for(null!=f&&(l=f);null!=l;)r+=l.offsetLeft,i+=l.offsetTop,l=l.offsetParent;null!=s&&(i+=s.y,r+=s.x);var d,g,p,C,m=30;3==a.nodeType&&(m=10+5*a.nodeValue.length,60<m&&(m=60)),d=this.rw_getScreenOffsetLeft(n),g=this.rw_getScreenOffsetTop(n),"number"==typeof n.innerWidth?(p=n.innerWidth,C=n.innerHeight):0<n.document.documentElement.clientHeight&&0<n.document.documentElement.clientWidth?(p=n.document.documentElement.clientWidth,C=n.document.documentElement.clientHeight):(p=n.document.body.clientWidth,C=n.document.body.clientHeight),p-=m,C-=20;var y,v;if(y=r<d||r>d+p,v=i<g||i>g+C,y||v&&(0!=r||0!=i)){r>d+p&&(r=(r+d)/2),i>g+C&&(i=(i+g)/2),t&&(t=!1);var T=new o.EventBus;T.publish("pauseHover",null),n.scrollTo(y?r:d,v?i:g)}}catch(e){}}},{key:"rw_getScreenOffsetLeft",value:function(t){return"undefined"==typeof t&&(t=window),t.pageXOffset&&0<t.pageXOffset?t.pageXOffset:t.document.body.scrollLeft&&0<t.document.body.scrollLeft?t.document.body.scrollLeft:t.document.documentElement.scrollLeft&&0<t.document.documentElement.scrollLeft?t.document.documentElement.scrollLeft:0}},{key:"rw_getScreenOffsetTop",value:function(t){return"undefined"==typeof t&&(t=window),t.pageYOffset&&0<t.pageYOffset?t.pageYOffset:t.document.body.scrollTop&&0<t.document.body.scrollTop?t.document.body.scrollTop:t.document.documentElement.scrollTop&&0<t.document.documentElement.scrollTop?t.document.documentElement.scrollTop:0}},{key:"rw_getScreenOffsetLeftAlt",value:function(n){if("undefined"==typeof n&&(n=window),"CSS1Compat"==n.document.compatMode&&n.document.body.parentNode&&n.document.body.parentNode.scrollLeft)return n.document.body.parentNode.scrollLeft;var a=n.pageXOffset?n.pageXOffset:n.scrollX?n.scrollX:n.document.body.scrollLeft?n.document.body.scrollLeft:n.document.documentElement.scrollLeft?n.document.documentElement.scrollLeft:0;return a}},{key:"rw_scrollToObjectDivCheck",value:function(d,e,t){for(var n,g,f=e.clientHeight,o=e.clientWidth,a=d.getBoundingClientRect().right-d.getBoundingClientRect().left,l=0,s=0,u=d;u!=e&&null!=u;)l+=u.offsetTop,s+=u.offsetLeft,u=this.rw_safeOffsetParent(u,e);return null==u&&(s-=e.offsetLeft,l-=e.offsetTop),null!=t&&(l+=t.y,s+=t.x),(e.scrollTop>l||e.scrollTop+f<l+d.offsetHeight)&&(f>6*d.offsetHeight?e.scrollTop=l-d.offsetHeight:e.scrollTop=l),200>a&&(e.scrollLeft>s||e.scrollLeft+o<s+d.offsetWidth)&&(e.scrollLeft=s),n=s-e.scrollLeft,g=l-e.scrollTop,{x:n,y:g}}},{key:"rw_safeOffsetParent",value:function(a,e){var t=a,n=t.offsetParent;if(null==n)return null;if(null==e)return n;for(;null!=t&&t!=n;){if(t==e)return null;t=t.parentNode}return n}},{key:"rw_isDivScrollable",value:function(o){var e=new S.SSDOM,t=o.clientHeight,n=o.clientWidth,r=e.getComputedStyle(o),i=!1;return null!=r&&"visible"!=r.overflow&&"inline"!=r.display&&(o.scrollHeight>t&&"visible"!=r.overflowY&&(i=!0),o.scrollWidth>n&&"visible"!=r.overflowX&&(i=!0)),i}}]),t}()},{"./DOM/SSDOM":5,"./Events/EventBus":6}],23:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.BaseSelection=function(){function t(){n(this,t)}return o(t,[{key:"clearSelection_",value:function(){this.clearBrowserSelection()}},{key:"clearBrowserSelection",value:function(){if(window.getSelection){for(var t=0;t<window.frames.length;t++)try{window.getSelection().empty?window.frames[t].getSelection().empty():window.getSelection().removeAllRanges&&window.frames[t].getSelection().removeAllRanges()}catch(e){}window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else document.selection&&document.selection.empty()}},{key:"getSelectionRange",value:function(){}},{key:"hasSelection",value:function(){}}]),t}()},{}],24:[function(d,e,t){"use strict";function g(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function n(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.HoverSpeak=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),f=(d("../THCaretRange"),d("../THCaret"),d("../THDomRange")),a=d("../Selection/BaseSelection"),i=d("../Events/EventBus"),l=d("../SpeechObject");t.HoverSpeak=function(a){function d(){g(this,d);var t=r(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));t.event={},t.timerEvent=null,t.callback=null,t.caretRange=null;var e=new i.EventBus;return e.subscribe("pauseHover",t.clearTimer.bind(t)),t.sentence,t.readRange=null,t}return n(d,a),o(d,[{key:"mouseMoved",value:function(a,e){var t=this;clearTimeout(this.timerEvent),this.event=a,this.callback=e,this.timerEvent=setTimeout(function(){return t.startSpeech()},1e3)}},{key:"clearTimer",value:function(){clearTimeout(this.timerEvent)}},{key:"clearHoverSpeak",value:function(){clearTimeout(this.timerEvent),null==this.sentence}},{key:"startSpeech",value:function(){var d,e=this.event.target;if(null!=e&&("html"==e.tagName.toLowerCase()||"body"==e.tagName.toLowerCase()))return null;if(null!=e&&"img"==e.tagName.toLowerCase())d=new f.THDomRange(e,0,e,0);else if(document.caretRangeFromPoint){var t=this.event.target.ownerDocument.caretRangeFromPoint(this.event.clientX,this.event.clientY);d=new f.THDomRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}else{var t=this.event.target.ownerDocument.caretPositionFromPoint(this.event.clientX,this.event.clientY);d=new f.THDomRange(t.offsetNode,t.offset,t.offsetNode,t.offset)}var n=new l.SpeechObject;n.processRange(d,!0);var r=n.getFirstSentence(),i="",o="";this.sentence&&this.sentence.getRawText()&&(i=this.sentence.getRawText()),r.getRawText()&&(o=r.getRawText()),null!=this.sentence&&-1!=i.indexOf(o)||(this.sentence=r,this.readRange=d,this.callback())}},{key:"getSelectionRange",value:function(){return this.readRange}}]),d}(a.BaseSelection)},{"../Events/EventBus":6,"../Selection/BaseSelection":23,"../SpeechObject":30,"../THCaret":31,"../THCaretRange":32,"../THDomRange":33}],25:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function i(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionController=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),S=(d("../THCaretRange"),d("../THDomRange")),l=(d("../THRange"),d("../Utilities/Utilities")),T=d("../DOM/SSDOM"),a=d("./BaseSelection"),u=d("../DOM/DomNavigation");d("../DOM/Attribute"),t.SelectionController=function(a){function d(){n(this,d);var t=r(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));return t.g_ipadSelectionRange=null,t}return i(d,a),o(d,[{key:"getSelectionRange",value:function(){var t=this.getSelection_();return t?t.range:null}},{key:"getElementRangeById",value:function(n){var e=this.getSelectionById(n);return e?e.range:null}},{key:"getSelectionObject",value:function(){var t=this.getSelection_();return this.clearBrowserSelection(),t}},{key:"isMathJax",value:function(t){if("undefined"!=typeof t.startCaret.node.ownerDocument.defaultView.MathJax){if(t.startCaret.node.isMathJax)return!0;if(t.startCaret.node.parentNode.isMathJax)return!0}return!1}},{key:"hasSelection",value:function(){var t=this.getSelection_();return null!=t&&void 0!=t}},{key:"getSelectionString",value:function(){var n=this.getSelection_(),e=n.range.toString();return e}},{key:"getSelectionTextById",value:function(a){var e=this.getSelectionById(a),t=e.range.toString();return t}},{key:"getSelection_",value:function(){var s=new T.SSDOM,e=new u.DomNavigation,t=null,h=null;null!=this.g_ipadSelectionRange&&g_ipadSelectionWindow.getSelection().addRange(this.g_ipadSelectionRange);var C=window.getSelection(),i=null,o=new l.Utilities;if(!C.isCollapsed&&0<o.trim(C.toString()).length)t=window,i=C;else{var a=s.getFrameSelectionSFF(window);a.foundSel&&(t=a.theWindow,i=a.foundSel)}if(null==i)return null;if(i.focusNode&&i.focusNode.id&&"flashcontent"==i.focusNode.id)return null;if(null!=i.anchorNode&&i.anchorNode==i.focusNode&&i.anchorOffset==i.focusOffset)return null;var c=null;if(i.getRangeAt)c=i.getRangeAt(0);else{var f=s.getRangeObject();null!=f&&(i.anchorNode==i.focusNode&&i.anchorOffset==i.focusOffset?f=s.getRangeFromSelectionPoint(i):(f.setStart(i.anchorNode,i.anchorOffset),f.setEnd(i.focusNode,i.focusOffset),0==f.toString().length&&(f.setStart(i.focusNode,i.focusOffset),f.setEnd(i.anchorNode,i.anchorOffset))),c=f)}if(null==c)return null;var d=c.startContainer,g=c.startOffset,p=c.endContainer,b=c.endOffset;if(3!=d.nodeType){if(1!=d.nodeType)return null;if(0<g&&d.hasChildNodes()&&d.childNodes.length>g)if(d=d.childNodes[g],3==d.nodeType)g=0;else if(g=0,"[object HTMLEmbedElement]"==d.toString())return null}if(3!=p.nodeType){if(1!=p.nodeType)return null;if(p.hasChildNodes())if(p.childNodes.length>b)p=p.childNodes[b];else if(p=p.childNodes[b-1],3!=p.nodeType){var m=e.getLastChildTextNode(p,!0);null!=m&&(p=m)}if(3!=p.nodeType){var y=e.getPreviousNode(d,!0,null),m=e.getPreviousTextNode(p,!1,y);null!=m&&(p=m)}b=3==p.nodeType?p.nodeValue.length:0}return h=new S.THDomRange(d,g,p,b),null!=t&&null!=h?{frame:t,range:h}:null}},{key:"getSelectionById",value:function(l){var e=new T.SSDOM,t=new u.DomNavigation,n=document.getElementById(l),r=window;if(null!=n){if(1==n.nodeType&&"img"==n.tagName&&null==n.getAttribute("alt"))return{frame:r,range:f};var g=n.innerHTML;if(0<g.length){var o=t.getFirstChildTextNode(n,!0);if(null==o||3!=o.nodeType&&!o.isMathJax){if(null==o||1!=o.nodeType||"img"!=o.tagName)return null;var a=o.getAttribute("alt");if(!(null!=a&&0<a.length))return null}var s=t.getLastChildTextNode(n,!0);if(null==s||3!=s.nodeType&&!s.isMathJax){if(null==s||1!=s.nodeType||"img"!=s.tagName)return null;var c=s.getAttribute("alt");if(!(null!=c&&0<c.length))return null}var f=(e.rw_getRefPt(o,0),3==s.nodeType?e.rw_getRefPt(s,s.nodeValue.length):e.rw_getRefPt(s,0),new S.THDomRange(o,0,s,g.length));return null!=r&&null!=f?{frame:r,range:f}:null}}return null}}]),d}(a.BaseSelection)},{"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THCaretRange":32,"../THDomRange":33,"../THRange":35,"../Utilities/Utilities":38,"./BaseSelection":23}],26:[function(d,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseObject=void 0;var r=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=d("../THRange"),o=d("../DOM/SSDOM");t.BaseObject=function(){function a(e){n(this,a),this.m_range=null,this.m_type=e,this.m_bValid=!0,this.m_contents=null,this.Types={WORD:1,SENTENCE:2,SSML:3,DOCUMENT:4,SILENCE:5}}return r(a,[{key:"getRange",value:function(){return this.m_range}},{key:"setRange",value:function(t){t instanceof i.THRange&&(this.m_range=t)}},{key:"getType",value:function(){return this.m_type}},{key:"isValid",value:function(){return this.m_bValid}},{key:"setValid",value:function(t){this.m_bValid=t}},{key:"getContents",value:function(){return null==this.m_contents&&(this.m_contents=[]),this.m_contents}},{key:"setContents",value:function(t){this.m_contents=t instanceof Array?t:[t]}},{key:"addContent",value:function(t){null==this.m_contents&&(this.m_contents=[]),this.m_contents.push(t)}},{key:"isOverridingText",value:function(){return!1}},{key:"getWordCount",value:function(){if(this.m_type==this.Types.WORD||this.isOverridingText())return 1;var a=0;if(null==this.m_contents&&(this.m_contents=[]),0<this.m_contents.length){var e,t=this.m_contents.length;for(e=0;e<t;e++)a+=this.m_contents[e].getWordCount()}return a}},{key:"getWords",value:function(){if(this.m_type==this.Types.WORD||this.isOverridingText())return[this];var a=[];if(null==this.m_contents&&(this.m_contents=[]),0<this.m_contents.length){var e,t=this.m_contents.length;for(e=0;e<t;e++)a=a.concat(this.m_contents[e].getWords())}return a}},{key:"getFirstNode",value:function(){var a=new o.SSDOM,e=this.getRange();if(null!=e){var t=a.rw_getCaretFromRefPt(e.body,e.startRef);if(null!=t&&null!=t.node)return t.node}return null}},{key:"getSpokenText",value:function(){return""}}]),a}()},{"../DOM/SSDOM":5,"../THRange":35}],27:[function(d,e,t){"use strict";function s(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function n(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.MathWordObject=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=d("./BaseObject");t.MathWordObject=function(a){function i(t,e){s(this,i);var n=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,1));return n.spanID=t,n.m_strWord=e,n.m_strPronunciation=null,n}return n(i,a),o(i,[{key:"getRange",value:function(){return this.spanID}},{key:"setRange",value:function(t){this.spanID=t}},{key:"getWord",value:function(){return this.m_strWord}}]),i}(a.BaseObject)},{"./BaseObject":26}],28:[function(m,e,t){"use strict";function y(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function n(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.SentenceObject=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),S=m("../DOM/SSDOM"),a=m("../Utilities/Utilities"),i=m("../TextOverRangeBeanClass"),l=m("./BaseObject"),s=m("../THDomRange"),u=m("../MathJax/MathSpeak"),f=m("./WordObject"),d=m("./MathWordObject"),g=m("../THRange"),c=m("../DOM/DomNavigation");m("../DOM/Attribute"),t.SentenceObject=function(l){function h(t){y(this,h);var e=r(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,2));if(new S.SSDOM,e.m_range=new s.THDomRange(t.leftCaret.node,t.leftCaret.offset,t.rightCaret.node,t.rightCaret.offset),e.m_caretRange=t,t.leftCaret.node.isMathJax){var n=new u.MathSpeak;try{e.math=!0,e.m_strRawText=n.getSpeechWithBookmarksFromElement(t.leftCaret.node),e.splitMathIntoWords(),e.sentenceSpanId=t.leftCaret.node.id}catch(e){}}else e.laug=null,e.m_strRawText=t.getTextOverCaretRange(),e.setLangTag(t),e.math=!1;return e.m_strMarkedText,e}return n(h,l),o(h,[{key:"setVoice",value:function(t){this.m_strVoice=t}},{key:"setLangTag",value:function(n){var e=n.leftCaret.node;3==e.nodeType&&(e=e.parentElement),this.lang=e.lang}},{key:"getLangTag",value:function(){return this.lang}},{key:"getVoice",value:function(){return this.m_strVoice}},{key:"getSpanId",value:function(){return this.sentenceSpanId}},{key:"setCaretRange",value:function(t){this.m_caretRange=t,this.m_range=m_caretRange.rw_getTHRangeFromTHCaretRange()}},{key:"getCaretRange",value:function(){return this.m_caretRange}},{key:"getWords",value:function(){for(var a=[],e=this.getContents(),t=0;t<e.length;t++)a.push(e[t].getWord());return a}},{key:"getWordRange",value:function(n){var e=this.getContents();return n<e.length?e[n].getRange():null}},{key:"isMathML",value:function(){return this.math}},{key:"getRawText",value:function(){return this.m_strRawText}},{key:"setRawText",value:function(t){this.m_strRawText=t}},{key:"getMarkedText",value:function(){return this.m_strMarkedText}},{key:"setMarkedText",value:function(t){this.m_strMarkedText=t}},{key:"clone",value:function(){var t=new h(m_caretRange);return t.setContents(this.getContents()),t.setValid(this.isValid()),t.setVoice(m_strVoice),t.setRawText(m_strRawText),t.setMarkedText(m_strMarkedText),t}},{key:"splitMathIntoWords",value:function(){if(""!=this.m_strRawText){var a=this.m_strRawText.toLowerCase().match(/<bookmark mark="[0-9]+"\/>+/g),e=this.m_strRawText.toLowerCase().split(/<bookmark mark="[0-9]+"\/>+/g),t=0;0<e.length&&""==e[0]&&(t=1);for(var n=0;n<a.length;n++){var r=a[n].match(/[0-9]+/g),i=new d.MathWordObject(r[0],e[t]);this.addContent(i),t++}}}},{key:"processTextToSpeakInSentenceObject",value:function(){this.processTextToSpeakInSentenceObjectImpl();for(var a=this.getContents(),e=0;e<a.length;e++){var t=a[e],n=t.getFirstNode();null!=n&&this.isNestedSsml(n)&&this.insertInWrappingSsml(a,e,n)}}},{key:"isNestedSsml",value:function(a){for(var e=a.ownerDocument.body,t=a;t!=e&&null!=t;){if(null!=this.checkForSsmlAttribute(t))return!0;t=t.parentNode}return!1}},{key:"insertInWrappingSsml",value:function(d,e,t){for(var n=t.ownerDocument.body,r=t,i=new S.SSDOM;r!=n&&null!=r;)if(r=r.parentNode,null!=this.checkForSsmlAttribute(r)){var o=this.checkForSsmlAttribute(r);if(o.canContainContent()){var a=d[e];d[e]=o,o.setContents([a]);for(var l=e+1;l<d.length;l++){var s=d[l],g=s.getFirstNode();if(!i.checkIfElementInsideElement(g,r))break;a=d[l],o.addContent(a),d.splice(l,1),l--}}else{d[e]=o;for(var l=e+1;l<d.length;l++){var s=d[l],g=s.getFirstNode();if(!i.checkIfElementInsideElement(g,r))break;d.splice(l,1),l--}}}return!1}},{key:"processTextToSpeakInSentenceObjectImpl",value:function(){var a=new S.SSDOM;try{var e=new i.TextOverRangeBeanClass(this);for(this.setupCheck(e),e.startRefPt=a.rw_getRefPt(e.leftNode,e.leftOffset),e.endRefPt=null;null!=e.currentNode;){if(this.checkIfTooLong(e))return;var t=e.currentNode;a.isSpecialCase(t)?this.handleSpecialCase(e):1==t.nodeType?this.handleElement(e):3==t.nodeType?this.handleTextNode(e):this.moveToNextNode(e)}}catch(e){this.setValid(!1)}}},{key:"handleTextNode",value:function(d){var e=new S.SSDOM,t=new c.DomNavigation,n=d.currentNode,r=t.getTextFromNode(n);null==r&&(r="");var i=0;if(d.rightNode==n&&-1<d.rightOffset&&(r=r.substring(0,d.rightOffset)),d.leftNode==n&&0<d.leftOffset&&(r=r.substring(d.leftOffset),i=d.leftOffset),0==r.length&&0==d.storedText.length)d.startRefPt=null;else{null!=d.startRefPt&&0!=d.storedText.length||(d.startRefPt=e.rw_getRefPt(n,i));for(var o,l=e.rw_getBreakInCurrentWord(r);-1<l;){if(o=d.storedText+r.substring(0,l+1),d.storedText=this.filterWordToSpeak(o),null!=d.endRefPt&&0==l||(d.endRefPt=e.rw_getRefPt(n,l+i)),this.moveStoredTextToWordObject(d),this.checkIfTooLong(d))return void(d.currentNode=null);i+=l+1,r=r.substring(l+1),d.startRefPt=e.rw_getRefPt(n,i),d.endRefPt=null,l=e.rw_getBreakInCurrentWord(r)}if(0<r.length&&(d.storedText+=r,d.endRefPt=e.rw_getRefPt(n,r.length+i),null==d.endRefPt&&(d.storedText="")),n==d.rightNode)return this.moveStoredTextToWordObject(d),void(d.currentNode=null)}this.moveToNextNode(d)}},{key:"filterWordToSpeak",value:function(n){var e=(new S.SSDOM,new a.Utilities);return"*"==e.trim(n),n}},{key:"handleElement",value:function(a){var e=a.currentNode,t=this.checkForSsmlAttribute(e);null!=t||this.moveToNextNode(a)}},{key:"moveToNextNode",value:function(a){var e=(new S.SSDOM,new c.DomNavigation),t=a.currentNode,n=e.getNextNode(t,!0,a.rightNode);null==n?(a.storedText=this.getTextOverRangeToSpeakAddFullStop(a.storedText),this.moveStoredTextToWordObject(a),a.currentNode=e.getNextNode(t,!1,a.rightNode)):a.currentNode=n}},{key:"getTextOverRangeToSpeakAddFullStop",value:function(d){var e=new S.SSDOM,t=d.length;if(1<t&&". "==d.substr(t-2,2))return d;if(0<t&&"."==d.substr(t-1,1))return d+" ";var n=new a.Utilities,r=n.trimEndTH(d),i=r.charCodeAt(r.length-1);return e.rw_isLetter(i)||127<i?d+". ":d}},{key:"handleSpecialCase",value:function(a){var e=new S.SSDOM,t=new c.DomNavigation;this.moveStoredTextToWordObject(a);var n=a.currentNode;if(a.storedText=t.getTextFromNode(n),e.isSpecialCaseHighlightable(n)){var r=t.getFirstChildTextNode(n,!1),i=t.getLastChildTextNode(n,!1);null!=r&&null!=i?3==r.nodeType&&3==i.nodeType?(a.startRefPt=e.rw_getRefPt(r,0),a.endRefPt=e.rw_getRefPt(i,i.nodeValue.length)):(a.startRefPt=e.rw_getRefPt(r,-1),a.endRefPt=e.rw_getRefPt(i,-1)):(a.startRefPt=e.rw_getRefPt(n,-1),a.endRefPt=a.startRefPt)}else a.startRefPt=e.rw_getRefPt(n,-1),a.endRefPt=a.startRefPt;this.moveStoredTextToWordObject(a),a.currentNode=t.getNextNodeIgnoreChildren(n,!1,a.rightNode)}},{key:"moveStoredTextToWordObject",value:function(a){var e=new S.SSDOM;if(e.rw_isWordSpeakable(a.storedText)&&null!=a.startRefPt&&null!=a.endRefPt){var t=new f.WordObject(new g.THRange(a.body,a.startRefPt,a.endRefPt),a.storedText);a.sentenceObject.addContent(t)}this.clearState(a)}},{key:"clearState",value:function(t){t.startRefPt=null,t.endRefPt=null,t.storedText=""}},{key:"checkIfTooLong",value:function(t){return t.sentenceObject.getWordCount()>500}},{key:"setupCheck",value:function(a){var e=new S.SSDOM,t=new c.DomNavigation;1==a.leftNode.nodeType&&(e.isSpecialCase(a.leftNode)||null!=this.checkForSsmlAttribute(a.leftNode)||(a.leftNode=t.getNextNodeAllowMoveToChild(a.currentNode,!1,a.rightNode),a.leftOffset=0))}},{key:"checkForSsmlAttribute",value:function(n){if(1==n.nodeType){var e=this.checkForSsmlNoNamespace(n);if(null!=e)return e;if(e=this.checkForSsmlNamespace(n),null!=e)return e}return null}},{key:"checkForSsmlNamespace",value:function(){return null}},{key:"checkForSsmlNoNamespace",value:function(){return null}},{key:"checkForCommands",value:function(){if(g_bUseCommands){var d,e,t=this.getSentences();for(e=0;e<t.length;e++){d=t[e];var n=d.getCaretRange().leftCaret,r=d.getCaretRange().rightCaret,i=rw_findCommandNode(n.node),o=rw_checkForCommandChange(n.node,r.node,i);if(null!=o){var a=d.clone(),l=d.clone(),s=new THCaretRange(n,o),g=o.clone();g.forwardBias=!0,g=S.SSDOM.moveCaret(g,0,!1);var u=new THCaretRange(g,r);a.setCaretRange(s),l.setCaretRange(u),t.splice(e,1,a,l)}}this.setSentences(t)}}}]),h}(l.BaseObject)},{"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../MathJax/MathSpeak":16,"../THDomRange":33,"../THRange":35,"../TextOverRangeBeanClass":37,"../Utilities/Utilities":38,"./BaseObject":26,"./MathWordObject":27,"./WordObject":29}],29:[function(d,e,t){"use strict";function s(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function n(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.WordObject=void 0;var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=d("./BaseObject");t.WordObject=function(a){function i(t,e){s(this,i);var n=r(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,1));return n.setRange(t),n.m_strWord=e,n.m_strPronunciation=null,n}return n(i,a),o(i,[{key:"getWord",value:function(){return this.m_strWord.trim()}},{key:"setPronunciation",value:function(t){this.m_strPronunciation=t}},{key:"getPronunciation",value:function(){return this.m_strPronunciation}},{key:"isOverridingText",value:function(){return null!=this.m_strPronunciation}},{key:"getSpokenText",value:function(){var t;return t=null==this.m_strPronunciation?this.m_strWord:this.m_strPronunciation}}]),i}(a.BaseObject)},{"./BaseObject":26}],30:[function(d,e,t){"use strict";function m(a){if(Array.isArray(a)){for(var e=0,t=Array(a.length);e<a.length;e++)t[e]=a[e];return t}return Array.from(a)}function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function r(n,a){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&("object"==typeof a||"function"==typeof a)?a:n}function o(n,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);n.prototype=Object.create(a&&a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(n,a):n.__proto__=a)}Object.defineProperty(t,"__esModule",{value:!0}),t.SpeechObject=void 0;var a=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=d("./Sentence/BaseObject"),l=d("./DOM/SSDOM"),s=d("./Sentence/SentenceObject"),c=(d("./THCaret"),d("./Utilities/Utilities"),d("./THCaretRange")),h=(d("./THDomRange"),d("./DOM/DomSentences"));t.SpeechObject=function(i){function d(){n(this,d);var t=r(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,3));return t.m_bBatch=!1,t.SSML_NAMESPACE="ssml",t.SSMS_TYPES={SUB:"sub",PHONEME:"phoneme",SAYAS:"say-as",EMPHASIS:"emphasis",BREAK:"break",PROSODY:"prosody"},t.SSMS_ATTRIBUTES={ALPHABET:"alphabet",PH:"ph",ALIAS:"alias",INTERPRETAS:"interpret-as",FORMAT:"format",LEVEL:"level",STRENGTH:"strength",TIME:"time",PITCH:"pitch",RATE:"rate",VOLUME:"volume"},t.sentenceNo=0,t}return o(d,i),a(d,[{key:"setSentences",value:function(t){this.setContents(t)}},{key:"getSentences",value:function(){return this.getContents()}},{key:"setBatch",value:function(t){this.m_bBatch=t}},{key:"isBatch",value:function(){return this.m_bBatch}},{key:"getNextSentence",value:function(r){this.sentenceNo++;var e=this.getSentences();if(this.sentenceNo<e.length)return 0==e[this.sentenceNo].getWords().length?this.getNextSentence(r):e[this.sentenceNo];if(r){var t=e[e.length-1],n=t.getCaretRange();t.m_range.refresh();var i=new c.THCaretRange(t.m_range.body,t.m_range.startRef.path,t.m_range.startRef.offset,t.m_range.endRef.path,t.m_range.endRef.offset),o=new h.DomSentences,n=o.getSentenceFromPoint(i.leftCaret),a=o.getNextSentence(n,null),d=this.processSentence(a);return this.m_contents.length=0,this.setSentences.apply(this,m(d)),this.sentenceNo=0,0==d[0].getWords().length?this.getNextSentence(r):d[0]}return null}},{key:"getCurrentSentence",value:function(){var t=this.getSentences();return this.sentenceNo<t.length?t[this.sentenceNo]:t[t.length-1]}},{key:"getFirstSentence",value:function(){return this.sentenceNo=0,0<this.getSentences().length?this.getSentences()[0]:null}},{key:"processRange",value:function(r,e){this.setSentences([]),this.sentenceNo=0;var f=new c.THCaretRange(r.body,r.startRef.path,r.startRef.offset,r.endRef.path,r.endRef.offset);if(r.startCaret.node.tagName&&"textarea"==r.startCaret.node.tagName.toLowerCase()){var n=new s.SentenceObject(f);n.setWords(r.startCaret.node.value),n.m_strRawText=r.startCaret.node.value,this.setSentences(n)}else{var i,o=new h.DomSentences,a=o.getSentenceFromPoint(f.leftCaret),l=[],y=this.processSentence(a);if((i=l).push.apply(i,m(y)),!e){var u=!0;do{var d=o.getNextSentence(a,f.rightCaret.node);if(!(null!=d))u=!1;else if(d.leftCaret.node!=f.rightCaret.node||d.leftCaret.offset<f.rightCaret.offset){if(y=this.processSentence(d),null!=y){var g;(g=l).push.apply(g,m(y))}a=d}else u=!1}while(u);1==l.length&&a.rightCaret.offset>f.rightCaret.offset&&f.rightCaret.offset!=f.leftCaret.offset&&(l=this.processSentence(f))}this.setSentences(l)}}},{key:"processSentence",value:function(a){try{this.checkRange(a)||this.setValid(!1);var e=new s.SentenceObject(a),t=this.splitSentenceByLanguage(e);0==t.length&&this.setValid(!1);for(var n=t.length,o=0;o<n;o++)t[o].isMathML()||t[o].processTextToSpeakInSentenceObject();return t}catch(e){this.setValid(!1)}return null}},{key:"splitSentenceByLanguage",value:function(n){function e(){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(a){var e=a.getCaretRange(),t=e.leftCaret,n=e.rightCaret;return[a]})},{key:"checkRange",value:function(a){var e=new l.SSDOM;if(null==a||null==a.leftCaret||null==a.rightCaret||null==a.leftCaret.node||null==a.rightCaret.node)return!1;var t=a.leftCaret,n=a.rightCaret,o=e.checkForSpecialParent(t.node);return null!=o&&(t.node=o,t.setSpecialCase(!0),a.leftCaret=t),o=e.checkForSpecialParent(n.node),null!=o&&(n.node=o,n.setSpecialCase(!0),a.rightCaret=n),!0}}]),d}(i.BaseObject)},{"./DOM/DomSentences":4,"./DOM/SSDOM":5,"./Sentence/BaseObject":26,"./Sentence/SentenceObject":28,"./THCaret":31,"./THCaretRange":32,"./THDomRange":33,"./Utilities/Utilities":38}],31:[function(a,e,t){"use strict";function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.THCaret=function(){function a(e,t,n){o(this,a),this.node=e,this.offset=t,this.forwardBias=n,this.specialCase=!1}return n(a,[{key:"setSpecialCase",value:function(t){this.specialCase=t}},{key:"isSpecialCase",value:function(){return this.specialCase}},{key:"check",value:function(){var t=!0;return null==this.node||null==this.node.parentNode?t=!1:3==this.node.nodeType?(0>this.offset||this.offset>this.node.nodeValue.length)&&(t=!1):1==this.node.nodeType&&this.specialCase||(t=!1),t}},{key:"toString",value:function(){var t="THCaret ";return null!=this.node&&(3==this.node.nodeType?t+=this.node.nodeValue+" "+this.node.parentNode.tagName+" ":1==this.node.nodeType&&(t+=this.node.tagName+" ")),t+=this.offset}},{key:"equals",value:function(t){return null!=t&&this.node==t.node&&this.offset==t.offset&&this.forwardBias==t.forwardBias}},{key:"clone",value:function(){return new a(this.node,this.offset,this.forwardBias)}}]),a}()},{}],32:[function(d,e,t){"use strict";function g(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.THCaretRange=void 0;var n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),p=d("./THCaret"),m=d("./DOM/SSDOM"),a=d("./DOM/DomNavigation"),y=d("./DOM/Attribute");t.THCaretRange=function(){function r(e,t,n,i,o){g(this,r),this.leftCaret=null,this.rightCaret=null,null!=e&&null!=t&&null!=n&&null!=i&&null!=o&&this.getCaretPairFromDomPosition(e,t,n,i,o)}return n(r,[{key:"setCaretRange",value:function(n,e){this.leftCaret=n,this.rightCaret=e}},{key:"equals",value:function(t){return null!=t&&this.leftCaret.equals(t.leftCaret)&&this.rightCaret.equals(t.rightCaret)}},{key:"toString",value:function(){return this.getTextOverCaretRange()}},{key:"getTextOverCaretRange",value:function(){var a=new m.SSDOM,e=new y.Attribute;try{if(null==this.leftCaret||null==this.rightCaret)return"";var t,n=this.leftCaret,r=this.rightCaret,i=n.node,o=r.node,d="",l=a.getNodesOverRange(i,o);if(null!=l&&0<l.length)for(var s,g=0;g<l.length;g++)s=l[g],3==s.nodeType&&"textarea"!=s.parentNode.tagName.toLowerCase()?(t=s.nodeValue,d+=o==i?t.substring(n.offset,r.offset):s==i&&0<n.offset?t.substr(n.offset):s==o&&-1<r.offset?t.substring(0,r.offset):t):1==s.nodeType&&"img"==s.tagName.toLowerCase()&&e.rw_getAttribute(s,"alt")&&(d=e.rw_getAttribute(s,"alt"));return d.trimTH()}catch(e){return""}}},{key:"rw_getTHRangeFromTHCaretRange",value:function(){return null==this||null==this.leftCaret||null==this.rightCaret?null:new THRange(this.leftCaret.node.ownerDocument.body,this.rw_getRefPt(this.leftCaret.node,this.leftCaret.offset),this.rw_getRefPt(this.rightCaret.node,this.rightCaret.offset))}},{key:"getCaretPairFromDomPosition",value:function(a,e,t,n,r){var i=new m.SSDOM;this.leftCaret=i.getCaretFromDomPosition(a,e,t,!0),this.rightCaret=e==n&&t>=r?this.leftCaret:i.getCaretFromDomPosition(a,n,r,!1)}},{key:"getTextSpokenOverCaretRange",value:function(o){var e=new a.DomNavigation,t=new m.SSDOM;try{if(null==o||null==o.leftCaret||null==o.rightCaret)return"";var n=o.leftCaret,r=o.rightCaret,i=n.node,l=r.node,s=t.isSpecialCaseNested(i);s&&(i=t.checkForSpecialParent(i),n=new p.THCaret(i,0,!0));for(var g=i,u="";null!=g;){if(s=t.isSpecialCase(g),s||3==g.nodeType){var f=e.getTextFromNode(g);null!=f&&""!=f&&(s||(g==l&&-1<r.offset&&(f=f.substring(0,r.offset)),g==i&&-1<n.offset&&(f=f.substring(n.offset))),u+=f)}g=s?e.getNextNodeIgnoreChildren(g,!1,l):e.getNextNode(g,!1,l)}return u.trimTH()}catch(e){return""}}}]),r}()},{"./DOM/Attribute":2,"./DOM/DomNavigation":3,"./DOM/SSDOM":5,"./THCaret":31}],33:[function(r,e,t){"use strict";function d(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.THDomRange=void 0;var n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),o=r("./THCaretRange"),a=r("./THCaret"),g=r("./THDomRefPt"),p=r("./DOM/SSDOM"),u=r("./DOM/Attribute"),i=r("../Constants/Constants"),c=function(a){if(a&&a.__esModule)return a;var e={};if(null!=a)for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(e[t]=a[t]);return e["default"]=a,e}(i);t.THDomRange=function(){function i(e,t,n,r){d(this,i),this.body=e.ownerDocument.body,this.startCaret=new a.THCaret(e,t,!0),this.endCaret=new a.THCaret(n,r,!1),this.startRef=this.rw_getRefPt(e,t),this.endRef=this.rw_getRefPt(n,r)}return n(i,[{key:"getPositionInDom",value:function(f){var e=new p.SSDOM,t=new u.Attribute,n="",r=0,i="";if(null!=f&&null!=f.ownerDocument)for(var o=!1,a=!1,l=f.ownerDocument.body;null!=f&&f!=l;){e.isSpecialCase(f)&&(n=""),o=3==f.nodeType||1==f.nodeType&&f.tagName.toLowerCase()==c.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(f,"rwstate");for(var s=f.previousSibling;null!=s;)a=3==s.nodeType||1==s.nodeType&&s.tagName.toLowerCase()==c.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(s,"rwstate"),o&&a||++r,s=s.previousSibling,o=a;if(n=n+r+"~",r=0,f=f.parentNode,null!=f&&null!=f.getAttribute&&null!=f.tagName){var h=t.rw_getAttribute(f,"chunk");if("span"==f.tagName.toLowerCase()&&"1"==h){var d=t.getPositionInDom(f);i="#^th*"+d+"#^th*"}}}return i+n}},{key:"rw_getRefPt",value:function(d,e){var t="rwTHgen",n=new p.SSDOM,r=new u.Attribute;try{if(null==d)return null;if(1==d.nodeType||3==d.nodeType){var i=n.checkForSpecialParent(d);if(null!=i)return new g.THDomRefPt(this.getPositionInDom(i),e);var o,a;1==d.nodeType?(o=0,a=d):(o=this.getNodeOffset_(d),a=d.parentNode);for(var l=r.rw_getAttribute(a,"rwstate"),s=r.rw_getAttribute(a,t);null!=l&&0<l.length||null!=s;)o+=this.getNodeOffset_(a),a=a.parentNode,l=r.rw_getAttribute(a,"rwstate"),s=r.rw_getAttribute(a,t);return-1==e&&(o=-1),new g.THDomRefPt(this.getPositionInDom(a),o+e)}return null}catch(e){return null}}},{key:"getNodeOffset_",value:function(a){var e=new p.SSDOM;if(null==a)return 0;var t=0,n=a.previousSibling;return null!=n&&(t=e.rw_getNodeOffsetImpl(n)),t}},{key:"refresh",value:function(){if(0==this.startCaret.check()||0==this.endCaret.check()){var t=new o.THCaretRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);this.startCaret=t.leftCaret,this.endCaret=t.rightCaret,null==this.startCaret&&null==this.endCaret?(this.startCaret=new a.THCaret(document.body,0,!0),this.endCaret=new a.THCaret(document.body,0,!1)):null!=this.startCaret&&null!=this.endCaret||(null==this.startCaret?this.startCaret=new a.THCaret(this.endCaret.node,this.endCaret.offset,!0):this.endCaret=new a.THCaret(this.startCaret.node,this.startCaret.offset,!1))}}},{key:"toString",value:function(){new p.SSDOM,this.refresh();var t=new o.THCaretRange;return t.setCaretRange(this.startCaret,this.endCaret),t.getTextSpokenOverCaretRange(t)}},{key:"getRangeObject",value:function(n){"undefined"!=typeof n&&null!=n||(n=document.body);var a=n.ownerDocument;return a.createRange()}},{key:"getStartAsRange",value:function(){var t=this.getRangeObject(this.body);return t.setStart(this.startCaret.node,this.startCaret.offset),t.setEnd(this.startCaret.node,this.startCaret.offset),t}},{key:"getEndAsRange",value:function(){var t=this.getRangeObject(this.body);return t.setStart(this.endCaret.node,this.endCaret.offset),t.setEnd(this.endCaret.node,this.endCaret.offset),t}},{key:"equals",value:function(t){return this.startRef.path==t.startRef.path&&this.startRef.offset==t.startRef.offset&&this.endRef.path==t.endRef.path&&this.endRef.offset==t.endRef.offset}},{key:"compareRange",value:function(d){if(this.equals(d))return c.THDomRange_TARGET_SAME;this.refresh(),d.refresh();var e=this.getStartAsRange(),t=this.getEndAsRange(),n=d.getStartAsRange(),r=d.getEndAsRange(),i=e.compareBoundaryPoints("START_TO_START",n),o=e.compareBoundaryPoints("START_TO_START",r),a=t.compareBoundaryPoints("START_TO_START",n),l=t.compareBoundaryPoints("START_TO_START",r),s=c.THDomRange_ERROR;return s=-1<o?c.THDomRange_AFTER_TARGET:1>a?c.THDomRange_BEFORE_TARGET:-1==i?-1==l?c.THDomRange_OVERLAPS_START_OF_TARGET:c.THDomRange_TARGET_INSIDE:0==i?-1==l?c.THDomRange_TARGET_INCLUDES_THIS_AT_START:0==l?c.THDomRange_TARGET_SAME:c.THDomRange_TARGET_INSIDE:-1==l?c.THDomRange_TARGET_INCLUDES_THIS:0==l?c.THDomRange_TARGET_INCLUDES_THIS_AT_END:c.THDomRange_OVERLAPS_END_OF_TARGET}},{key:"rw_getTextFromRange",value:function(){var t="";return t=this.text?this.text:this.toString()}},{key:"rw_getTHCaretRangeFromTHDomRange",value:function(){var a=new p.SSDOM;if(null==this.startRef||null==this.endRef)return null;var e=a.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),t=a.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=e&&null!=t){var n=new o.THCaretRange;return n.setCaretRange(e,t),n}return null}}]),i}()},{"../Constants/Constants":1,"./DOM/Attribute":2,"./DOM/SSDOM":5,"./THCaret":31,"./THCaretRange":32,"./THDomRefPt":34}],34:[function(a,e,t){"use strict";function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();t.THDomRefPt=function(){function a(e,t){o(this,a),this.path=e,this.offset=t}return n(a,[{key:"toString",value:function(){return"THDomRefPt "+this.path+" "+this.offset}},{key:"getPath",value:function(){return this.path}},{key:"getOffset",value:function(){return this.getOffset}}]),a}()},{}],35:[function(d,e,t){"use strict";function l(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.THRange=void 0;var n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=d("./DOM/SSDOM"),o=d("./THCaretRange");t.THRange=function(){function a(e,t,n){l(this,a),this.body=e,this.startRef=t,this.endRef=n}return n(a,[{key:"equals",value:function(t){return this.body==t.body&&this.startRef.path==t.startRef.path&&this.startRef.offset==t.startRef.offset&&this.endRef.path==t.endRef.path&&this.endRef.offset==t.endRef.offset}},{key:"toString",value:function(){var t=this.getAsRange();return null==t?"":g_bIEOld?this.getAsRange().text:this.getAsRange().toString()}},{key:"getAsRange",value:function(){var a=null;if(g_bIEOld)a=rw_getAsTextRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);else{a=i.SSDOM.getRangeObject(this.body);var e=new new o.THCaretRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),t=e.leftCaret,n=e.rightCaret;null!=t&&null!=n?(a.setStart(t.node,t.offset),a.setEnd(n.node,n.offset)):a=null}return a}},{key:"clone",value:function(){return new a(this.body,this.startRef,this.endRef)}},{key:"rw_getTHCaretRangeFromTHRange",value:function(){var a=new i.SSDOM;if(null==this.startRef||null==this.endRef)return null;var e=a.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),t=a.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=e&&null!=t){var n=new o.THCaretRange;return n.setCaretRange(e,t),n}return null}}]),a}()},{"./DOM/SSDOM":5,"./THCaretRange":32}],36:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.THReturnObject=function e(){n(this,e),this.node=null,this.offset=0}},{}],37:[function(a,e,t){"use strict";function d(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.TextOverRangeBeanClass=void 0;var r=a("./DOM/SSDOM");t.TextOverRangeBeanClass=function a(o){d(this,a);var e=o.getCaretRange(),t=new r.SSDOM;this.sentenceObject=o,this.leftNode=e.leftCaret.node,this.rightNode=e.rightCaret.node,this.body=t.getBody(this.leftNode),this.leftOffset=e.leftCaret.offset,this.rightOffset=e.rightCaret.offset,this.currentNode=this.leftNode,this.storedText="",this.startRefPt=null,this.endRefPt=null}},{"./DOM/SSDOM":5}],38:[function(a,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();String.prototype.trimTH=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")},t.Utilities=function(){function t(){n(this,t)}return o(t,[{key:"trim",value:function(t){return t.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}},{key:"trimEndTH",value:function(t){return t.replace(/[\s\xA0]+$/,"")}},{key:"rw_filterForHtml",value:function(n){var e=n.replace(/\x26/g,"&amp;");return e=e.replace(/\x3c/g,"&lt;"),e=e.replace(/\x3e/g,"&gt;")}}]),t}()},{}],39:[function(m,e,t){"use strict";function y(a){if(Array.isArray(a)){for(var e=0,t=Array(a.length);e<a.length;e++)t[e]=a[e];return t}return Array.from(a)}function S(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ParserAPI=void 0;var T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(){function a(a,o){for(var t,r=0;r<o.length;r++)t=o[r],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=m("../SpeechStream/Selection/SelectionController"),a=m("../SpeechStream/Highlighting/SpeechHighlightManager"),l=m("../SpeechStream/SpeechObject"),u=m("../SpeechStream/Selection/HoverSpeak"),c=m("../SpeechStream/Highlighting/StudySkillsHighlighting"),h=m("../SpeechStream/Prediction/PredictionManager"),f=m("../SpeechStream/Events/EventBus"),o=m("../SpeechStream/THDomRange"),r=t.ParserAPI=function(){function d(e,t){if(S(this,d),this.selectionController=new i.SelectionController,this.speechHighlightManager=null,this.hoverSpeak=new u.HoverSpeak,this.speechObject=new l.SpeechObject,this.studySkills=new c.StudySkillsHighlighting,this.hoverSpeakOn=!1,this.mathLoaded=!1,this.url=t,"undefined"!=typeof MathJax&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var n=window.MathJax;delete window.MathJax,window.MathJax=n;var r=!1;for(var o in MathJax.Ajax.loaded)if(-1<o.indexOf("toMathML")){r=!0;break}r||MathJax.Ajax.Load(t+"toMathML.js"),this.load_script(t+"sre_browser.js"),this.mathLoaded=!0}this.predictionOn=!1,this.predictionManager=new h.PredictionManager;var a=new f.EventBus;a.subscribe("pauseHover",this.pauseHover.bind(this)),this.isHoverSpeakEnabled=!1,this.setUpiframes()}return n(d,[{key:"setUpIFrameObserver",value:function(){this.targetElement=document.body;this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(this.targetElement,{childList:!0,subtree:!0})}},{key:"observerFunction",value:function(t){t.forEach(function(t){[].filter.call(t.addedNodes,function(t){return"IFRAME"==t.nodeName}.bind(this)).forEach(function(t){t.addEventListener("load",function(){this.addEventsToFrame(t).bind(this)}.bind(this))}.bind(this))}.bind(this))}},{key:"addEventsToFrame",value:function(n){try{var e;n.document?e=n:n.contentWindow&&(e=n.contentWindow),null!=e&&(e.document.body.addEventListener("mouseover",this.iframeCallback.bind(this)),this.checkForChildFrames(e),this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(e.document.body,{childList:!0,subtree:!0}),"undefined"!=typeof e.MathJax&&(e.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}catch(e){}}},{key:"checkForChildFrames",value:function(n){if(0<n.frames.length){var e;for(e=0;e<n.frames.length;e++)this.addEventsToFrame(n.frames[e])}}},{key:"setUpiframes",value:function(){if(0<window.frames.length)for(var t=0;t<window.frames.length;t++)try{this.addEventsToFrame(window.frames[t])}catch(e){}}},{key:"iframeCallback",value:function(t){this.hoverSpeakOn&&this.speechCallback&&this.hoverSpeak.mouseMoved(t,this.speechCallback)}},{key:"forceLoadMath",value:function(a){if(MathJax.version&&"function"==typeof MathJax.Ajax.Load){var e=window.MathJax;if(delete window.MathJax,window.MathJax=e,a){if(T(a.MathJax.version)&&"function"==typeof a.MathJax.Ajax.Load){var e=a.MathJax;delete a.MathJax,a.MathJax=e;var t=!1;for(var n in a.MathJax.Ajax.loaded)if(-1<n.indexOf("toMathML")){t=!0;break}t||a.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)}}else if(!this.mathLoaded&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var e=window.MathJax;delete window.MathJax,window.MathJax=e;var o=!1;for(var n in MathJax.Ajax.loaded)if(-1<n.indexOf("toMathML")){o=!0;break}o||MathJax.Ajax.Load(this.url+"toMathML.js"),this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0}}}},{key:"pauseHover",value:function(){var t=this;this.hoverSpeakOn||this.isHoverSpeakEnabled?(this.hoverSpeakOn=!1,this.isHoverSpeakEnabled=!0,this.pauseHoverTimer=setTimeout(function(){return t.unPauseHover()},300)):this.isHoverSpeakEnabled=!1}},{key:"unPauseHover",value:function(){this.isHoverSpeakEnabled&&(this.hoverSpeakOn=!0)}},{key:"clearHoverSpeak",value:function(){this.hoverSpeak.clearHoverSpeak()}},{key:"load_script",value:function(n){var e=document.createElement("script");e.type="text/javascript",e.src=n,e.className="MyInjectedScript",document.getElementsByTagName("head")[0].appendChild(e)}},{key:"predictionEnabled",value:function(t){this.predictionOn=t}},{key:"getPredictionCoordinates",value:function(){return this.predictionManager.getPredictionCoordinates()}},{key:"getPredictionSentence",value:function(){return this.predictionManager.getPredictionSentence()}},{key:"predictionInsertText",value:function(t){this.predictionManager.predictionInsertText(t)}},{key:"isEditable",value:function(){return this.predictionManager.isEditable()}},{key:"hoverSpeakEnabled",value:function(t){this.hoverSpeakOn=t,this.isHoverSpeakEnabled=t,t||clearTimeout(this.pauseHoverTimer)}},{key:"mouseOverEvent",value:function(n,e){this.speechCallback=e,this.hoverSpeakOn?this.hoverSpeak.mouseMoved(n,this.speechCallback):clearTimeout(this.pauseHoverTimer)}},{key:"hasSelection",value:function(){return this.selectionController.hasSelection()}},{key:"getWord",value:function(){var n=[],e=this.selectionController.getSelectionRange();if(e){var n=e.toString().split(/\s/);if(0<n.length)return 2<n.length||1==n.length?Array(n[0]):[n[0],n[1]]}return null}},{key:"getSelection",value:function(){return this.selectionController.getSelectionRange().toString().split(/\s/)}},{key:"getSelectionLocal",value:function(){return this.getSelection()}},{key:"clearSelection_",value:function(){this.selectionController.clearSelection_()}},{key:"clearBrowserSelection",value:function(){this.selectionController.clearBrowserSelection()}},{key:"hiliteSelection",value:function(){var i=null;if(this.hasSelection()||this.hoverSpeakOn){if(this.sentenceNo=0,this.hoverSpeakOn){var e=this.hoverSpeak.getSelectionRange();this.speechObject.processRange(e,!0)}else this.speechObject.processRange(this.selectionController.getSelectionRange(),!1);i=this.speechObject.getFirstSentence(),i&&""==i.getRawText()&&(i=this.speechObject.getNextSentence(!0))}else{var e;if(document.caretRangeFromPoint){var t=document.caretRangeFromPoint(0,0);e=new o.THDomRange(t.startContainer,t.startOffset,t.endContainer,t.endContainer)}else{var t=document.caretPositionFromPoint(0,0);e=new o.THDomRange(t.offsetNode,t.offset,t.offsetNode,t.offset)}this.speechObject.processRange(e,!0),i=this.speechObject.getNextSentence(!0)}if(this.selectionController.clearBrowserSelection(),null!=i){var n=i.getWords();return 0==n.length?"":(this.speechHighlightManager=new a.SpeechHighlightManager(i),this.speechHighlightManager.highlightRange(),n)}return""}},{key:"highlightElementById",value:function(o){var e=null;if(this.speechObject.processRange(this.selectionController.getElementRangeById(o),!1),e=this.speechObject.getFirstSentence(),e&&""==e.getRawText()&&(e=this.speechObject.getNextSentence(!0)),this.selectionController.clearBrowserSelection(),null!=e){var t=e.getWords();return 0==t.length?"":(this.speechHighlightManager=new a.SpeechHighlightManager(e),this.speechHighlightManager.highlightRange(),t)}return""}},{key:"hiliteWord",value:function(t){this.speechHighlightManager.highlightWord(t)}},{key:"stop",value:function(){var t=this.speechObject.getCurrentSentence();null!=t&&null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange()}},{key:"hiliteNextSentence",value:function(o){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange();var e=this.speechObject.getNextSentence(o),t=null;return null!=e&&(t=e.getWords(),this.speechHighlightManager=new a.SpeechHighlightManager(e),this.speechHighlightManager.highlightRange(e)),t}},{key:"getLanguageForSentence",value:function(){var t=this.speechObject.getCurrentSentence();return t.getLangTag()}},{key:"highlightSelection",value:function(n){var e=this.selectionController.getSelectionObject();this.studySkills.studySkillsHTMLHighlightRange(n,e)}},{key:"clearHighlights",value:function(){var t=null;this.hasSelection()&&(t=this.selectionController.getSelectionObject()),this.studySkills.studySkillsClearHighlights(!1,t)}},{key:"collectHighlights",value:function(a,e){var t=[];if(2==a)for(var n=0;n<e.length;n++)t.push.apply(t,y(this.studySkills.studySkillsCollateForColour(e[n])));else t.push.apply(t,y(this.studySkills.studySkillsCollateForColour(e)));return t}},{key:"collectVocabWords",value:function(){}},{key:"addVoiceNote",value:function(){}},{key:"collectVocabs",value:function(){return this.studySkills.fetchWords()}},{key:"onMouseUp",value:function(){}},{key:"onMouseDown",value:function(t){this.predictionManager.onMouseDown(t)}},{key:"onKeyDown",value:function(t){this.predictionManager.onKeyDown(t)}}]),d}();window.textHelp=window.textHelp||{},textHelp.parsers=textHelp.parsers||{},textHelp.parsers.HTMLParserAPI=textHelp.parsers.HTMLParserAPI||{},textHelp.parsers.HTMLParserAPI=r},{"../SpeechStream/Events/EventBus":6,"../SpeechStream/Highlighting/SpeechHighlightManager":10,"../SpeechStream/Highlighting/StudySkillsHighlighting":11,"../SpeechStream/Prediction/PredictionManager":19,"../SpeechStream/Selection/HoverSpeak":24,"../SpeechStream/Selection/SelectionController":25,"../SpeechStream/SpeechObject":30,"../SpeechStream/THDomRange":33}],40:[function(t){"use strict";t("src/api/ParserAPI")},{"src/api/ParserAPI":39}]},{},[40]);