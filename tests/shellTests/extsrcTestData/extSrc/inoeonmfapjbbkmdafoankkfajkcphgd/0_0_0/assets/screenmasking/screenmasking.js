var textHelp=textHelp||{};textHelp.thScreenMasking={},function(){this.ScreenMasking=function(){var a,b=!1,c=textHelp.webreader.UserSettingsSingleton.getInst().getUserSettings();c.screenmasking==void 0&&(c.screenmasking={backgroundcolour:'#000000',backgroundopacity:50,readinglightheight:100,readinglightcolour:'#ffffff',readinglightopacity:0,readinglightvisibility:!0});var d=c.screenmasking.backgroundcolour?c.screenmasking.backgroundcolour:'#000000',e=c.screenmasking.backgroundopacity?c.screenmasking.backgroundopacity:50,f=c.screenmasking.readinglightheight?c.screenmasking.readinglightheight:100,g=c.screenmasking.readinglightcolour?c.screenmasking.readinglightcolour:'#ffffff',h=c.screenmasking.readinglightopacity?c.screenmasking.readinglightopacity:0,i=!!c.screenmasking.readinglightvisibility,j=this;textHelp.webreaderapi.EventBusSingleton.getInst().subscribe('onScreenMaskingChanged',function(b){try{d=b[0].backgroundcolour,e=b[0].backgroundopacity,f=b[0].readinglightheight,g=b[0].readinglightcolour,h=b[0].readinglightopacity,i=b[0].readinglightvisibility,'undefined'!=typeof a&&null!=document.getElementById('texthelpMiddleMask')&&this.drawMask(a.y,window.scrollY,window.scrollHeight,window.innerHeight)}catch(a){window.console.error(a.stack)}},this),this.maskMove=function(b){a=this.getPosition(b),this.drawMask(a.y,window.scrollY,window.scrollHeight,window.innerHeight)}.bind(this),this.frameMove=function(a){if(currFrame=a.view.frameElement,null!=currFrame){var b=currFrame.getBoundingClientRect(),c=currFrame.getBoundingClientRect(),d=b.left,e=b.top,f=window.scrollY;j.drawMask(a.clientY+e+f,f,currFrame.ownerDocument.body.scrollHeight,window.innerHeight)}}.bind(this);this.drawMask=function(a,b,c,j){var k=Math.max;if(!1==i){f=0,r=document.getElementById('texthelpTopMask'),r.style.display='none',r=document.getElementById('texthelpMiddleMask'),r.style.display='none',r=document.getElementById('texthelpBottomMask'),r.style.left='0px',r.style.backgroundColor=this.hexToRgb(d,e/100);var l=document.body,m=document.documentElement,n=k(l.scrollHeight,l.offsetHeight,m.clientHeight,m.scrollHeight,m.offsetHeight);return r.style.top='0px',void(r.style.height=n+'px')}var o=f/2,p=0,q=a-o,r=document.getElementById('texthelpTopMask');if(r.style.top='0px',r.style.left='0px',r.style.backgroundColor=this.hexToRgb(d,e/100),r.style.display='block',p=c,r.style.height=0<q?q+'px':'0px',r=document.getElementById('texthelpMiddleMask'),r.style.left='0px',r.style.backgroundColor=this.hexToRgb(g,h/100),r.style.display='block',r.style.top=0<q?q+'px':'0px',r.style.height=a-b+o>j?f:0<q?a+o-q+'px':parseInt(f)+parseInt(q)+'px',r=document.getElementById('texthelpBottomMask'),r.style.left='0px',r.style.backgroundColor=this.hexToRgb(d,e/100),r.style.display='block',a-b+o>j)r.style.height=b+j+'px',r.style.height='0px';else{var l=document.body,m=document.documentElement,n=k(l.scrollHeight,l.offsetHeight,m.clientHeight,m.scrollHeight,m.offsetHeight);r.style.top=a+o+'px',r.style.height=n-(a+o)+'px'}}.bind(this),this.getPosition=function(a){a=a||window.event;var b={x:0,y:0};return a.pageX||a.pageY?(b.x=a.pageX,b.y=a.pageY):(b.x=a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,b.y=a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop),b}.bind(this),this.toggle=function(a){b=a,b?(this.addMaskElement('div','texthelpMasking','texthelpTopMask'),this.addMaskElement('div','texthelpMiddleMask','texthelpMiddleMask'),this.addMaskElement('div','texthelpMasking','texthelpBottomMask'),document.addEventListener('mousemove',this.maskMove,!1),this.toggleFrameEvents(!0),texthelp.RW4GC.riot.screenmasking=texthelp.RW4GC.riot.mount('texthelp-screenmasking')[0],this.maskMove()):(document.removeEventListener('mousemove',this.maskMove,!1),this.toggleFrameEvents(!1),texthelp.RW4GC.riot.screenmasking.unmount(!0),this.removeMaskElement('texthelpTopMask'),this.removeMaskElement('texthelpMiddleMask'),this.removeMaskElement('texthelpBottomMask'))}.bind(this),this.toggleFrameEvents=function(a){if(b){try{var c=document.getElementById('texthelp-dictionary-frame').contentWindow.document;a?c.addEventListener('mousemove',this.frameMove,!1):c.removeEventListener('mousemove',this.frameMove,!1)}catch(a){}try{var d=document.getElementById('texthelp-picture-dictionary-frame').contentWindow.document;a?d.addEventListener('mousemove',this.frameMove,!1):d.removeEventListener('mousemove',this.frameMove,!1)}catch(a){}try{var e=document.getElementById('texthelp-translator-frame').contentWindow.document;a?e.addEventListener('mousemove',this.frameMove,!1):e.removeEventListener('mousemove',this.frameMove,!1)}catch(a){}try{var f=document.getElementById('texthelp-prediction-frame').contentWindow.document;a?f.addEventListener('mousemove',this.frameMove,!1):f.removeEventListener('mousemove',this.frameMove,!1)}catch(a){}}}.bind(this),this.addMaskElement=function(a,b,c){var d=document.body,e=document.createElement(a);e.setAttribute('id',c),e.setAttribute('class',b),d.appendChild(e)}.bind(this),this.hexToRgb=function(a,c){'#fffffe'==a&&(c=0,a='#ffffff'),a=a.replace('#','');var d=parseInt(3==a.length?a.slice(0,1).repeat(2):a.slice(0,2),16),e=parseInt(3==a.length?a.slice(1,2).repeat(2):a.slice(2,4),16),f=parseInt(3==a.length?a.slice(2,3).repeat(2):a.slice(4,6),16);return 1==c?'rgba('+d+', '+e+', '+f+', 1)':0==c?'rgba('+d+', '+e+', '+f+', 0)':'rgba('+d+', '+e+', '+f+', '+c+')'}.bind(this),this.removeMaskElement=function(a){var b=document.getElementById(a);b.parentNode.removeChild(b)},this.addElement=function(a,b){var c=documen.body,d=document.createElement(a);d.setAttribute('id',b),c.appendChild(d)},this.install=function(){}},this.screenmasking=new textHelp.thScreenMasking.ScreenMasking,this.screenmasking.install()}.apply(textHelp.thScreenMasking);