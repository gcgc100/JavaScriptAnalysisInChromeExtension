var textHelp=textHelp||{};textHelp.thScreenMasking={},function(){this.ScreenMasking=function(){function e(e){try{o=e[0].backgroundcolour,s=e[0].backgroundopacity,l=e[0].readinglightheight,r=e[0].readinglightcolour,a=e[0].readinglightopacity,d=e[0].readinglightvisibility,void 0!==t&&null!=document.getElementById("texthelpMiddleMask")&&this.drawMask(t.y,window.scrollY,window.scrollHeight,window.innerHeight)}catch(e){window.console.error(e.stack)}}var t,n=!1,i=textHelp.webreader.UserSettingsSingleton.getInst().getUserSettings();void 0==i.screenmasking&&(i.screenmasking=new Object({backgroundcolour:"#000000",backgroundopacity:50,readinglightheight:100,readinglightcolour:"#ffffff",readinglightopacity:0,readinglightvisibility:!0}));var o=i.screenmasking.backgroundcolour?i.screenmasking.backgroundcolour:"#000000",s=i.screenmasking.backgroundopacity?i.screenmasking.backgroundopacity:50,l=i.screenmasking.readinglightheight?i.screenmasking.readinglightheight:100,r=i.screenmasking.readinglightcolour?i.screenmasking.readinglightcolour:"#ffffff",a=i.screenmasking.readinglightopacity?i.screenmasking.readinglightopacity:0,d=!!i.screenmasking.readinglightvisibility,c=this;textHelp.webreaderapi.EventBusSingleton.getInst().subscribe("onScreenMaskingChanged",e,this),this.maskMove=function(e){t=this.getPosition(e),this.drawMask(t.y,window.scrollY,window.scrollHeight,window.innerHeight)}.bind(this),this.frameMove=function(e){if(currFrame=e.view.frameElement,null!=currFrame){var t=currFrame.getBoundingClientRect(),n=(currFrame.getBoundingClientRect(),t.left,t.top),i=window.scrollY;c.drawMask(e.clientY+n+i,i,currFrame.ownerDocument.body.scrollHeight,window.innerHeight)}}.bind(this),this.drawMask=function(e,t,n,i){if(0==d){l=0,v=document.getElementById("texthelpTopMask"),v.style.display="none",v=document.getElementById("texthelpMiddleMask"),v.style.display="none",v=document.getElementById("texthelpBottomMask"),v.style.left="0px",v.style.backgroundColor=this.hexToRgb(o,s/100);var c=document.body,m=document.documentElement,h=Math.max(c.scrollHeight,c.offsetHeight,m.clientHeight,m.scrollHeight,m.offsetHeight);return v.style.top="0px",void(v.style.height=h+"px")}var g=l/2,u=e-g,p=e+g,v=document.getElementById("texthelpTopMask");if(v.style.top="0px",v.style.left="0px",v.style.backgroundColor=this.hexToRgb(o,s/100),v.style.display="block",n,v.style.height=u>0?u+"px":"0px",v=document.getElementById("texthelpMiddleMask"),v.style.left="0px",v.style.backgroundColor=this.hexToRgb(r,a/100),v.style.display="block",v.style.top=u>0?u+"px":"0px",v.style.height=e-t+g>i?l:u>0?p-u+"px":parseInt(l)+parseInt(u)+"px",v=document.getElementById("texthelpBottomMask"),v.style.left="0px",v.style.backgroundColor=this.hexToRgb(o,s/100),v.style.display="block",e-t+g>i)v.style.height=t+i+"px",v.style.height="0px";else{var c=document.body,m=document.documentElement,h=Math.max(c.scrollHeight,c.offsetHeight,m.clientHeight,m.scrollHeight,m.offsetHeight);v.style.top=e+g+"px",v.style.height=h-(e+g)+"px"}}.bind(this),this.getPosition=function(e){e=e||window.event;var t={x:0,y:0};return e.pageX||e.pageY?(t.x=e.pageX,t.y=e.pageY):(t.x=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,t.y=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop),t}.bind(this),this.toggle=function(e){n=e,n?(this.addMaskElement("div","texthelpMasking","texthelpTopMask"),this.addMaskElement("div","texthelpMiddleMask","texthelpMiddleMask"),this.addMaskElement("div","texthelpMasking","texthelpBottomMask"),document.addEventListener("mousemove",this.maskMove,!1),this.toggleFrameEvents(!0),texthelp.RW4GC.riot.screenmasking=texthelp.RW4GC.riot.mount("texthelp-screenmasking")[0],this.maskMove()):(document.removeEventListener("mousemove",this.maskMove,!1),this.toggleFrameEvents(!1),texthelp.RW4GC.riot.screenmasking.unmount(!0),this.removeMaskElement("texthelpTopMask"),this.removeMaskElement("texthelpMiddleMask"),this.removeMaskElement("texthelpBottomMask"))}.bind(this),this.toggleFrameEvents=function(e){if(n){try{var t=document.getElementById("texthelp-dictionary-frame").contentWindow.document;e?t.addEventListener("mousemove",this.frameMove,!1):t.removeEventListener("mousemove",this.frameMove,!1)}catch(e){}try{var i=document.getElementById("texthelp-picture-dictionary-frame").contentWindow.document;e?i.addEventListener("mousemove",this.frameMove,!1):i.removeEventListener("mousemove",this.frameMove,!1)}catch(e){}try{var o=document.getElementById("texthelp-translator-frame").contentWindow.document;e?o.addEventListener("mousemove",this.frameMove,!1):o.removeEventListener("mousemove",this.frameMove,!1)}catch(e){}try{var s=document.getElementById("texthelp-prediction-frame").contentWindow.document;e?s.addEventListener("mousemove",this.frameMove,!1):s.removeEventListener("mousemove",this.frameMove,!1)}catch(e){}}}.bind(this),this.addMaskElement=function(e,t,n){var i=document.body,o=document.createElement(e);o.setAttribute("id",n),o.setAttribute("class",t),i.appendChild(o)}.bind(this),this.hexToRgb=function(e,t){e=e.replace("#","");var n=parseInt(3==e.length?e.slice(0,1).repeat(2):e.slice(0,2),16),i=parseInt(3==e.length?e.slice(1,2).repeat(2):e.slice(2,4),16),o=parseInt(3==e.length?e.slice(2,3).repeat(2):e.slice(4,6),16);return 1==t?"rgba("+n+", "+i+", "+o+", 1)":0==t?"rgba("+n+", "+i+", "+o+", 0)":"rgba("+n+", "+i+", "+o+", "+t+")"}.bind(this),this.removeMaskElement=function(e){var t=document.getElementById(e);t.parentNode.removeChild(t)},this.addElement=function(e,t){var n=documen.body,i=document.createElement(e);i.setAttribute("id",t),n.appendChild(i)},this.install=function(){}},this.screenmasking=new textHelp.thScreenMasking.ScreenMasking,this.screenmasking.install()}.apply(textHelp.thScreenMasking);