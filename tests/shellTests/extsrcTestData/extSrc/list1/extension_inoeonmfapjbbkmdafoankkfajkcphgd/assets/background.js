function updateChromeOptions(e){chrome.storage.sync.get({enabledRW4GC:!0},function(t){try{window.enabled=t.enabledRW4GC,window.enabled&&e?chrome.browserAction.setIcon({path:chrome.extension.getURL("/assets/24.png")}):chrome.browserAction.setIcon({path:chrome.extension.getURL("/assets/24disabled.png")})}catch(e){console.log(e)}})}function onPageAction(e){onPageActionHandler(e,!1)}function onPageActionHandler(e,t){window.enabled&&(chrome.storage.sync.set({enabledRW4GC:!0}),texthelp.RW4GC.IdentityManagerInstance.getLicense(!0,function(t){if(void 0!=t&&void 0===t.error&&!(t.HideUnlicensed&&0==t.Valid&&"group"==t.licence_type.toLowerCase()||t.HideUnlicensed&&0==t.Valid&&"single"==t.licence_type.toLowerCase())){for(var o=!1,n=e.url,s=0;s<disabledSites.length;s++)-1!=n.indexOf(disabledSites[s])&&(o=!0),-1!=n.indexOf("docs.google.com/presentation")&&(o=!1);chrome.tabs.sendMessage(e.id,{type:"1757FROM_BGRW4G",command:"connected",settingcookies:settingsCookiePosition,isClickHoverOn:getClickHoverOn(),forceInject:e.url,blockList:o})}}))}function authTokenCallback(e,t){if(void 0!=e){for(var o=!1,n=t[1],s=0;s<disabledSites.length;s++)-1!=n.indexOf(disabledSites[s])&&(o=!0),-1!=n.indexOf("docs.google.com/presentation")&&(o=!1);chrome.tabs.sendMessage(t[0],{type:"1757FROM_BGRW4G",command:"connected",settingcookies:settingsCookiePosition,isClickHoverOn:getClickHoverOn(),forceInject:t[1],blockList:o})}}function onStorageChange(e){try{eachTab(function(t,o){chrome.tabs.sendRequest(t.id,{method:"onGetthRWFGSettings",type:"1757FROM_BGRW4G",payload:e})})}catch(e){alert("Couldn't update settings for all tabs. Exception:"+e)}}function getAuthTokenCallback(e,t){t({method:"onGetOAuthToken",type:"1757FROM_BGRW4G",payload:e})}function getAuthTokenCallbackSilent(e,t){t({method:"onGetOAuthTokenSilent",type:"1757FROM_BGRW4G",payload:e})}function eachTab(e){chrome.windows.getAll(null,function(t){for(var o=0;o<t.length;o++)chrome.tabs.getAllInWindow(t[o].id,function(n){for(var s=0;s<n.length;s++)e(n[s],t[o])})})}function writeVocabDoc(e,t){var o=t[0].words,n=t[0].locale,s=(t[0].user,'https://rwgoogle-webservices-6.texthelp.com/v1.11.0/vocab?json={"t":"5","i":"f","g":"t","u":"rwfordocs6","e":"n4T7Y2AjS4","b":[');"fr"!=n&&"pt"!=n&&"es"!=n&&"nl"!=n||(s='https://rwgoogle-webservices-6.texthelp.com/v1.11.0/vocabHTML?json={"t":"5","i":"f","g":"t","u":"rwfordocs6","e":"n4T7Y2AjS4","b":[');for(var i=0;i<o.length;i++)s+='"'+o[i]+'"',i<o.length-1&&(s+=", ");s+='],"l":"'+n+'"}';var a=new XMLHttpRequest;a.params=t,a.open("POST",s,!0),a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var o=JSON.parse(this.response);if(t[0].response=o,void 0!==o.service)return void writeVocabHTMLResponse(e,t);writeVocabResponse(e,t)}},a.send()}function oddOrEven(e){return 1&e?"odd":"even"}function writeVocabHTMLResponse(e,t){var o=t[0].response.words,n=t[0].translations,s="<!DOCTYPE html><html><head><style>";s+='p {padding-top: 10px;}\r\nh1,th {font-family: "Open Sans", sans-serif; font-size: 1em;}\r\ntable {width: 100%;}\r\n.oddrow {background-color: #99ccff;}\r\n.evenrow {background-color: #ffffff;}\r\nh1 {text-align:center;}\r\n.VocabWord {font-family: "Open Sans", sans-serif; width:17%;}\r\n.VocabMeaning {font-family: "Open Sans", sans-serif; width:35%;}\r\n.VocabSymbol {font-family: "Open Sans", sans-serif; width:16%;}\r\n.VocabNotes {font-family: "Open Sans", sans-serif; width:32%;}\r\nth,td {font-family: "Open Sans", sans-serif; padding:5px;}\r\n.wordContainer,.BoldText {font-weight:bold; font-family: "Open Sans", sans-serif;}',s+="</style></head><body>",s+='<h1 class="vocabTitle">'+n.title+'</h1><table id="vocabTable">',s+="<tr>",s+='  <th class="VocabWord">'+n.heading+"</th>",s+='  <th class="VocabMeaning">'+n.meaning+"</th>",s+='  <th class="VocabSymbol">'+n.symbol+"</th>",s+='  <th class="VocabNotes">'+n.notes+"</th>",s+="</tr>";for(var i=0;i<o.length;i++){s+='<tr class="'+oddOrEven(i+1)+'row">',s+='   <td class="wordContainer">'+o[i].word+"</td>",s+='   <td class="meaningContainer">',s+=o[i].definition,s+="   </td>",s+='   <td class="picContainer">';for(var a=0;a<o[i].symbols.length;a++)s+='<img src="'+o[i].symbols[a]+'" /><br />';s+="   </td>",s+='   <td class="notesContainer">&nbsp;</td>',s+="</tr>"}s+="</body></html>";var r='--rw4g\nContent-Type: application/json; charset=UTF-8\n\n{"title": "'+n.docTitle+'", "description": "Read&Write for Google Chrome™"}\n--rw4g\nContent-Type: text/html\n\n'+s+"\n--rw4g--\n",c=new XMLHttpRequest;c.open("POST","https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart&convert=true",!0),c.setRequestHeader("Content-type",'multipart/related; boundary="rw4g"'),c.setRequestHeader("Authorization","Bearer "+e.token),c.sendResponse=t[1],c.onreadystatechange=function(){4==this.readyState&&200==this.status&&this.sendResponse({method:"onVocabWeb",type:"1757FROM_BGRW4G",payload:JSON.parse(this.response).alternateLink})},c.send(r)}function writeVocabResponse(e,t){var o=t[0].response.words,n=t[0].translations,s="<!DOCTYPE html><html><head><style>";s+='p {padding-top: 10px;}\r\nh1,th {font-family: "Open Sans", sans-serif; font-size: 1em;}\r\ntable {width: 100%;}\r\n.oddrow {background-color: #99ccff;}\r\n.evenrow {background-color: #ffffff;}\r\nh1 {text-align:center;}\r\n.VocabWord {font-family: "Open Sans", sans-serif; width:17%;}\r\n.VocabMeaning {font-family: "Open Sans", sans-serif; width:35%;}\r\n.VocabSymbol {font-family: "Open Sans", sans-serif; width:16%;}\r\n.VocabNotes {font-family: "Open Sans", sans-serif; width:32%;}\r\nth,td {font-family: "Open Sans", sans-serif; padding:5px;}\r\n.wordContainer,.BoldText {font-weight:bold; font-family: "Open Sans", sans-serif;}',s+="</style></head><body>",s+='<h1 class="vocabTitle">'+n.title+'</h1><table id="vocabTable">',s+="<tr>",s+='  <th class="VocabWord">'+n.heading+"</th>",s+='  <th class="VocabMeaning">'+n.meaning+"</th>",s+='  <th class="VocabSymbol">'+n.symbol+"</th>",s+='  <th class="VocabNotes">'+n.notes+"</th>",s+="</tr>";for(var i=0;i<o.length;i++){s+='<tr class="'+oddOrEven(i+1)+'row">',s+='   <td class="wordContainer">'+o[i].word+"</td>",s+='   <td class="meaningContainer">';for(var a=0;a<o[i].inflections.length;a++)for(var r=0;r<o[i].inflections[a].definitions.length;r++)s+=o[i].inflections[a].definitions[r].definition+"<br><br>";s+="   </td>",s+='   <td class="picContainer">';for(var a=0;a<o[i].inflections.length;a++)for(var r=0;r<o[i].inflections[a].symbols.length;r++)s+='<img src="'+o[i].inflections[a].symbols[r]+'" /><br />';s+="   </td>",s+='   <td class="notesContainer">&nbsp;</td>',s+="</tr>"}s+="</body></html>";var c='--rw4g\nContent-Type: application/json; charset=UTF-8\n\n{"title": "'+n.docTitle+'", "description": "Read&Write for Google Chrome™"}\n--rw4g\nContent-Type: text/html\n\n'+s+"\n--rw4g--\n",l=new XMLHttpRequest;l.open("POST","https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart&convert=true",!0),l.setRequestHeader("Content-type",'multipart/related; boundary="rw4g"'),l.setRequestHeader("Authorization","Bearer "+e.token),l.sendResponse=t[1],l.onreadystatechange=function(){4==this.readyState&&200==this.status&&this.sendResponse({method:"onVocabWeb",type:"1757FROM_BGRW4G",payload:JSON.parse(this.response).alternateLink})},l.send(c)}function trackPageView(){_gaq.push(["_trackPageview"])}function trackEvent(e,t,o){_gaq.push(["_trackEvent",e,t,o])}function getClickHoverOn(){return void 0!=LOCALSTORAGE.texthelpClickHoverOn&&(clickHoverOn=LOCALSTORAGE.texthelpClickHoverOn),clickHoverOn}function setClickHoverOn(e){clickHoverOn=e,LOCALSTORAGE.texthelpClickHoverOn=e}function loadCookieSettings(){settingsCookiePosition=null;try{null!=LOCALSTORAGE.texthelpSWASettingsPopupPositions&&(settingsCookiePosition=JSON.parse(LOCALSTORAGE.texthelpSWASettingsPopupPositions))}catch(e){console.log("Could not load settings for texthelpSWA. Resetting to default."),settingsCookiePosition=null}return null==settingsCookiePosition&&(settingsCookiePosition=createDefaultSettingsCookiePosition()),settingsCookiePosition}function checkExtensions(){var e={id:"ifajfiofeifbbhbionejdliodenmecna",desc:"DJDJDJ"},t=(new Date).getTime();chrome.storage.sync.get("thRWFGExtensionCheck",function(o){var n=!1,s=o.thRWFGExtensionCheck;if(void 0===s)n=!0,chrome.storage.sync.set({thRWFGExtensionCheck:t});else{s<(new Date).getTime()-6048e5?(n=!0,chrome.storage.sync.set({thRWFGExtensionCheck:t})):n=!1}n&&chrome.identity.getProfileUserInfo(function(t){var o="";if(t.email.length>0){o=t.email;try{chrome.management.get(e.id,function(t){if(chrome.runtime.lastError&&void 0==t);else{var n=[];n.push(e.desc),n.push(o),n.push(o.split("@")[1]),window.thFunctions.onSendEvent(n)}})}catch(e){}}})})}function createDefaultSettingsCookiePosition(){var e={g_afDivPosX:[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],g_afDivPosY:[0,0,0,0,0,0,0,0,0,0,0,0,.2,.2,.2,.2],g_fBarPosX:1,g_fBarPosY:.01};return settingsCookiePosition=e,settingsCookiePosition}function saveCookiePosition(e,t,o,n){var s=null;console.log("Saving the setting of popups cookies: "+e+t),settingsCookiePosition.g_afDivPosX=e,settingsCookiePosition.g_afDivPosY=t,settingsCookiePosition.g_fBarPosX=o,settingsCookiePosition.g_fBarPosY=n,s=JSON.stringify(settingsCookiePosition),LOCALSTORAGE.texthelpSWASettingsPopupPositions=s}function writeDocumentHighlightsToDocs(e,t){var o=t[0],n=t[2],s=t[3],i="<!DOCTYPE html><html><head><style>";i+="p{padding-bottom:10px}.blue{background-color:#0ff}.pink{background-color:#f0f}.green{background-color:#adff2f}.yellow{background-color:#ff0}.boldText{font-weight:700}",i+="</style></head><body>";var a=0;for(a=0;a<o.highlights.length;a++)"#FFFF00"==o.highlights[a].color&&(i+='<p><span class="yellow">'),"#ADFF2F"==o.highlights[a].color&&(i+='<p><span class="green">'),"#00FFFF"==o.highlights[a].color&&(i+='<p><span class="blue">'),"#FF00FF"==o.highlights[a].color&&(i+='<p><span class="pink">'),i+=o.highlights[a].text+"</span></p>";i+='<br><p><span class="boldText"><a href="'+o.url,i+='">'+o.title+"</a></span></p>",i+='<p><span class="user">'+n+"<br>"+s+"</span></p>",i+="</body></html>";var r='--rw4g\nContent-Type: application/json; charset=UTF-8\n\n{"title": "'+o.docTitle+'", "description": "Read&Write for Google Chrome™"}\n--rw4g\nContent-Type: text/html\n\n'+i+"\n--rw4g--\n",c=new XMLHttpRequest;c.open("POST","https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart&convert=true",!0),c.setRequestHeader("Content-type",'multipart/related; boundary="rw4g"'),c.setRequestHeader("Authorization","Bearer "+e.token),c.sendResponse=t[1],c.onreadystatechange=function(){4==this.readyState&&200==this.status&&this.sendResponse({method:"onCollectHighlightsWeb",type:"1757FROM_BGRW4G",payload:JSON.parse(this.response).alternateLink})},c.send(r)}function init(){checkExtensions(),loadCookieSettings()}function updatePageAction(e,t,o){try{if(null!==this.license&&0==this.license.Valid&&"Group"==this.license.licence_type&&1==this.license.HideUnlicensed)return void updateChromeOptions(!1);updateChromeOptions(e.enabled)}catch(e){console.log(e)}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};SETTING_CONTAINER="texthelpSpeechStreamTBSettings",PORT_NAME="texthelpSpeechStreamTB",STORAGE=chrome.storage.sync,LOCALSTORAGE=localStorage,extensionInstallTabID="",disabledSites=JSON.parse('["www.google.com/calendar","docs.google.com/presentation","docs.google.com/drawings","drive.google.com","www.mergeagency.com","cloud.feedly.com","outlook.com","rw.texthelp.com/pdfviewer/","rw.texthelp.com/epubviewer/","appsqa.texthelp.com/pdfviewer/","appsqa.texthelp.com/epubviewer/","maddensbar.com/","www.awinfosys.com"]'),this.messages=JSON.parse('{"p":{"m":{"link":"","message":"","messagedatenumerical":0,"expires":0}},"t":{"m":{"link":"","message":"","messagedatenumerical":0,"expires":0}},"f":{"m":{"link":"https://www.texthelp.com/en-us/company/education-blog/october-2016/practice-reading-aloud-with-read-write-for-google","message":"New Practice Reading Aloud feature now available! Click here to learn more.","messagedatenumerical":20170309000000,"expires":0}}}'),tab=null,settings=null,settingsCookiePosition=null,clickHoverOn=!0,this.license=null,this.lastGoogleID="",this.encryptedID="",this.lastDate=0,this.enabled=!0,this.licensed=!1;try{var stringStartsWith=function(e,t){return e.slice(0,t.length)==t},stringEndsWith=function(e,t){return""==t||e.slice(-t.length)==t},getQAAuthTokenCallbackSilent=function(e,t){try{texthelp.RW4GC.authenticator.getEmail(!1,function(e){if(null!=e){if(stringEndsWith(e,"@qaheroes.com")&&stringStartsWith(e,"chromepc"));else if("smores01@scary.docsplustesting.com"!=e)return;onPageActionHandler(t,!0),chrome.tabs.sendRequest(t.id,{method:"thGetType"})}}.bind(this))}catch(e){console.log(e)}},escapeJSON=function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\"]/g,'\\"').replace(/\\'/g,"\\'")},_AnalyticsCode="UA-35861859-4",_gaq=_gaq||[];_gaq.push(["_setAccount",_AnalyticsCode]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),chrome.browserAction.onClicked.addListener(onPageAction),chrome.tabs.onUpdated.addListener(function(e,t,o){try{if("complete"==t.status){if("chrome://identity-internals/"==o.url)return;texthelp.RW4GC.IdentityManagerInstance.getId(!1,function(e){if(null!=e&&0!=o.url.indexOf("https://docs.google.com/document")){if(stringEndsWith(e,"@qaheroes.com")&&stringStartsWith(e,"chromepc"));else if("smores01@scary.docsplustesting.com"!=e)return;onPageActionHandler(o,!0),chrome.tabs.sendRequest(o.id,{method:"thGetType"})}})}}catch(e){console.log(e)}});var getAccessToken=function(e){chrome.identity.getAuthToken({interactive:!0,scopes:["profile","email","https://www.googleapis.com/auth/classroom.courses.readonly","https://www.googleapis.com/auth/classroom.rosters.readonly","https://www.googleapis.com/auth/classroom.profile.emails","https://www.googleapis.com/auth/classroom.profile.photos"]},function(t){e({token:t})})},getProfileAccessToken=function(e){chrome.identity.getAuthToken({interactive:!0,scopes:["profile","email"]},function(t){e({token:t})})},getClassroomAccessToken=function(e){chrome.identity.getAuthToken({interactive:!0,scopes:["https://www.googleapis.com/auth/classroom.courses.readonly","https://www.googleapis.com/auth/classroom.rosters.readonly","https://www.googleapis.com/auth/classroom.profile.emails","https://www.googleapis.com/auth/classroom.profile.photos"]},function(t){e({token:t})})},revokeAccessToken=function(e,t){chrome.identity.removeCachedAuthToken({token:e},function(){t({value:!0})})};chrome.runtime.onMessageExternal.addListener(function(e,t,o){if(e&&"ft4g"==e.app){if("get_access_token"===e.type)return getAccessToken(o),!0;if("get_classroom_token"===e.type)return getClassroomAccessToken(o),!0;if("get_profile_token"===e.type)return getProfileAccessToken(o),!0;if("revoke_access_token"===e.type)return revokeAccessToken(e.custom,o),!0}});var g_lang=chrome.i18n.getUILanguage(),g_voices="";chrome.runtime.onMessage.addListener(function(e,t,o){"thChromeOptionsChanged"==e.method&&updatePageAction(e,t,o)}),chrome.extension.onRequest.addListener(function(e,t,o){var n=this,s="https://script.google.com/macros/s/AKfycbyPhfA6NYF8msRlb7BF4aR8Ax_JWSDM6eAj3tjR2CpkXUMfjhk/exec";if(void 0!=e.key&&"function"===e.key)return void this.thFunctions["on"+e.method](e.parameters,o,t.tab,t);if("thChromeOptionsChanged"===e.method&&"1757FROM_PAGERW4G"==e.type&&updateChromeOptions(e.enabled),"thCheckExtension"===e.method){var i=e.payload.Lang;void 0==i&&(i=g_lang);var a="http://rwchrome.texthelp.com/screenshotreaderinstall/?locale="+i;if(void 0==e.payload.defaultsettings){e.payload.defaultsettings={};var r={"en-AU":"Vocalizer Expressive Karen Premium High 22kHz","en-GB":"Vocalizer Expressive Serena Premium High 22kHz","en-US":"Vocalizer Expressive Ava Premium High 22kHz",fr:"Vocalizer Expressive Audrey Premium High 22kHz","fr-CA":"Vocalizer Expressive Amelie Premium High 22kHz",pt:"Vocalizer Expressive Luciana Premium High 22kHz","pt-BR":"ScanSoft Raquel_Full_22kHz","pt-PT":"Vocalizer Expressive Luciana Premium High 22kHz",es:"Vocalizer Expressive Monica Premium High 22kHz","es-419":"Vocalizer Expressive Paulina Premium High 22kHz"};e.payload.defaultsettings.voice="Vocalizer Expressive Ava Premium High 22kHz",void 0!=r[i]&&(e.payload.defaultsettings.voice=r[i]),e.payload.defaultsettings.speed=50}window.texthelp.RW4GC.ssrdefaults=e.payload.defaultsettings;try{chrome.management.get(e.payload.ChromeExtId,function(t){chrome.runtime.lastError?""==extensionInstallTabID?chrome.tabs.create({url:a,active:!0},function(e){extensionInstallTabID=e.id}):chrome.tabs.get(extensionInstallTabID,function(e){chrome.runtime.lastError?chrome.tabs.create({url:a,active:!0},function(e){extensionInstallTabID=e.id}):chrome.tabs.update(extensionInstallTabID,{url:a,active:!0})}):chrome.storage.sync.get("thRWFGSettings",function(t){var o=null;void 0==t.thRWFGSettings?(o={},o.voice=window.texthelp.RW4GC.ssrdefaults.voice,o.speed=window.texthelp.RW4GC.ssrdefaults.speed):(o=JSON.parse(t.thRWFGSettings),(void 0===o?"undefined":_typeof(o))!=Object&&o.length>0&&(o=JSON.parse(o)),void 0!==o.speechoptions&&(o=o.speechoptions));var n={};n.command="startScreenShotReader",n.voice=o.voice,n.speed=o.speed,n.speechServerURL="https://rwforg.speechstream.net/SpeechServices/index.html",n.user="rwforgdocs6",chrome.runtime.sendMessage(e.payload.ChromeExtId,n)})})}catch(e){console.log(e)}}if("thStopScreenShotReader"===e.method)try{chrome.management.get(e.payload.ChromeExtId,function(t){chrome.runtime.lastError||chrome.storage.sync.get("thRWFGSettings",function(t){var o={};o.command="stopScreenShotReader",chrome.runtime.sendMessage(e.payload.ChromeExtId,o)})})}catch(e){console.log(e)}if("thStopScreenShotReaderSpeech"===e.method)try{chrome.management.get(e.payload.ChromeExtId,function(t){chrome.runtime.lastError||chrome.storage.sync.get("thRWFGSettings",function(t){var o={};o.command="stopScreenShotReaderSpeech",chrome.runtime.sendMessage(e.payload.ChromeExtId,o)})})}catch(e){console.log(e)}if("getLang"===e.method&&o({method:"onLanguage",type:"1757FROM_BGRW4G",payload:g_lang.toString()}),"collectHighlightsRequest"===e.method&&"1757FROM_PAGERW4G"==e.type){var c=new XMLHttpRequest,l=(new Date).getTime();c.open("POST",s+"?ver="+l,!0),c.onreadystatechange=function(){var e="";4==this.readyState&&200==this.status&&(e=this.getResponseHeader("Content-Type"),"application/json"==e.substr(0,16)&&o({method:"onCollectHighlights",type:"1757FROM_BGRW4G",payload:this.responseText.toString()}),this.responseText.indexOf("<title>Error</title>")>-1||o({method:"onCollectHighlights",type:"1757FROM_BGRW4G",payload:JSON.stringify({auth:this.responseText.toString()})}))};var d=new FormData;e.sort<2?e.sort=0:e.sort=1;var h=JSON.stringify(e.colors),p='{"newHighlightsDocument":"'+e.docTitle+'","cmd":"collectHighlights", "sort":"'+e.sort+'", "docsToCollect":["'+e.payload+'"],"colors":'+h+"}";d.append("payload",p),c.send(d)}if("vocabWordsRequest"===e.method&&"1757FROM_PAGERW4G"==e.type){var c=new XMLHttpRequest,l=(new Date).getTime();c.open("POST",s+"?ver="+l,!0),c.onreadystatechange=function(){var e="";4==this.readyState&&200==this.status&&(e=this.getResponseHeader("Content-Type"),"application/json"==e.substr(0,16)&&o({method:"onVocabWords",type:"1757FROM_BGRW4G",payload:this.responseText.toString()}),this.responseText.indexOf("<title>Error</title>")>-1||o({method:"onVocabWords",type:"1757FROM_BGRW4G",payload:JSON.stringify({auth:this.responseText.toString()})}))};var d=new FormData,h=JSON.stringify(e.colors),g=JSON.stringify(e.translations),p='{"newVocabDocument":"'+e.translations.docTitle+'","cmd":"vocab","docsToCollect":["'+e.payload+'"],"colors":'+h+', "translations":'+g+"}";d.append("payload",p),c.send(d)}if("collectHighlightsO365Request"===e.method&&"1757FROM_PAGERW4G"==e.type){for(var m=e.filename,u=window.atob(e.filedata),f=u.length,y=new Uint8Array(f),v=0;v<f;v++)y[v]=u.charCodeAt(v);var R=y.buffer;this.texthelp.RW4GC.authenticator.upload0365SharepointDocument(m,R)}if("authenticate"===e.method&&"1757FROM_PAGERW4G"==e.type){var w=[];window.thFunctions.onAuthenticate(w);var c=new XMLHttpRequest,l=(new Date).getTime();c.open("GET",s+"?ver="+l,!0),c.onreadystatechange=function(){var e="";4==this.readyState&&200==this.status&&(e=this.getResponseHeader("Content-Type"),"text/html"==e.substr(0,9)&&o({method:"onAuthenticate",type:"1757FROM_BGRW4G",payload:this.responseText.toString()}))},c.send()}if("collectHighlightsWeb"===e.method&&e.type,"vocabWeb"===e.method&&"1757FROM_PAGERW4G"==e.type&&(e.payload.sendResponse=o,this.texthelp.RW4GC.authenticator.writeVocabDocument(e.payload)),"getOAuthToken"===e.method&&"1757FROM_PAGERW4G"==e.type&&texthelp.RW4GC.IdentityManagerInstance.getLicense(!0,function(e){o({method:"onGetOAuthToken",type:"1757FROM_BGRW4G",payload:e})}),"getOAuthTokenSilent"===e.method&&"1757FROM_PAGERW4G"==e.type&&"1757FROM_PAGERW4G"==e.type&&texthelp.RW4GC.IdentityManagerInstance.getLicense(!1,function(e){o({method:"onGetOAuthTokenSilent",type:"1757FROM_BGRW4G",payload:e})}),e.method,"GAE"===e.method&&"1757FROM_PAGERW4G"==e.type){var b=e.payload.category;try{e.payload.category.indexOf("@")>-1&&(b=thHash.hashEmail(e.payload.category))}catch(e){}_gaq.push(["_trackEvent",b,e.payload.action,e.payload.label])}if("highlightSelection"===e.method&&"1757FROM_PAGERW4G"==e.type){var c=new XMLHttpRequest,l=(new Date).getTime();c.open("POST",s+"?ver="+l,!0);var d=new FormData,p='{"cmd":"highlightSelection", "range":'+JSON.stringify(e.payload)+"}";d.append("payload",p),c.send(d)}if("clearHighlights"===e.method&&"1757FROM_PAGERW4G"==e.type){var c=new XMLHttpRequest,l=(new Date).getTime();c.open("POST",s+"?ver="+l,!0);var d=new FormData,p='{"cmd":"clearHighlights", "range":'+JSON.stringify(e.payload)+"}";d.append("payload",p),c.send(d)}if("thRWFGSettings"===e.method&&"1757FROM_PAGERW4G"==e.type){var G=JSON.stringify(e.payload);onStorageChange(G),chrome.storage.sync.set({thRWFGSettings:G})}if("thRWFGGetSettings"===e.method&&"1757FROM_PAGERW4G"==e.type&&chrome.storage.sync.get("thRWFGSettings",function(e){o({method:"onGetthRWFGSettings",type:"1757FROM_BGRW4G",payload:e})}),"thPrediction"===e.method&&"1757FROM_PAGERW4G"==e.type){c=new XMLHttpRequest;var i=e.payload.context[2],S=e.payload.context[0].replace(/ /g," "),O='{"u":"rwfordocs6","p":"'+S+'","c":"'+e.payload.context[1]+'","l":"'+i+'","s":"'+e.payload.seq+'","e":"n4T7Y2AjS4"}',k="";k="https://rwgoogle-webservices-6.texthelp.com/v1.11.0/prediction?json="+encodeURIComponent(O),parent=e.payload.parent,position=e.payload.position,c.open("POST",k,!0),c.onreadystatechange=function(e,t){return function(){var n="";if(4==this.readyState&&200==this.status){var s=[];if(s.push("prediction request timer"),window.thFunctions.onEndTiming(s),n=this.getResponseHeader("Content-Type"),"application/json"==n.substr(0,16)){var i=JSON.parse(this.responseText.toString());o({method:"thPrediction",type:"1757FROM_BGRW4G",payload:{words:i.predictions,seq:i.sequenceID,parentId:e,positionId:t}})}}}}(parent,position),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var w=[];w.push("prediction request timer"),w.push(this.texthelp.RW4GC.IdentityManagerInstance.id),w.push(this.texthelp.RW4GC.IdentityManagerInstance.id.split("@")[1]),this.thFunctions.onStartTiming(w),c.send()}if("thGetVoices"===e.method&&"1757FROM_PAGERW4G"==e.type){if(g_voices.length>0&&"true"!==e.payload.refresh)return void o({method:"thGetVoices",type:"1757FROM_BGRW4G",payload:{response:g_voices}});var c=new XMLHttpRequest;c.open("GET","https://rwforg.speechstream.net/SpeechServices/user.html?query=getVoices&userName=rwforgdocs4",!0),c.onreadystatechange=function(){4==this.readyState&&200==this.status&&(g_voices=this.responseText.toString(),o({method:"thGetVoices",type:"1757FROM_BGRW4G",payload:{response:g_voices}}))},c.send()}if("thDoPopupLicenseMessage"===e.method&&"1757FROM_PAGERW4G"==e.type){var d=e.payload;chrome.storage.sync.get("thRWFGPopup",function(e){return function(t){var n=JSON.parse('{"p":{"m":{"link":"","message":"","messagedatenumerical":20170311000000,"expires":30}},"t":{"m":{"link":"","message":"","messagedatenumerical":0,"expires":0}},"f":{"m":{"link":"https://www.texthelp.com/en-us/company/education-blog/october-2016/practice-reading-aloud-with-read-write-for-google","message":"New Practice Reading Aloud feature now available! Click here to learn more.","messagedatenumerical":20170310000000,"expires":0}}}'),s="0",i=n.p;e.daysleft<0?void 0!==e.daysleft&&(i=n.f):void 0!==e.trial&&e.trial&&(i=n.t);var a=i.m.messagedatenumerical;if(i.m.expires>0){if(parseInt(moment().format("YYYYMMDD")+"000000")-a>i.m.expires)return}if(void 0==t.thRWFGPopup&&chrome.storage.sync.set({thRWFGPopup:""}),void 0!==t.thRWFGPopup&&void 0!==t.thRWFGPopup.last&&(s=t.thRWFGPopup.last),!(s>=a)){var r=!1;void 0!==e.Valid?void 0!==e.HideUnlicensed&&(r=e.HideUnlicensed):void 0!==e.hide_unlicensed&&(r=e.hide_unlicensed),r||(chrome.storage.sync.set({thRWFGPopup:{last:a}}),o({method:"onthRWFGPopup",type:"1757FROM_BGRW4G",payload:i}))}}}(d))}if("trialValidation"===e.method&&"1757FROM_PAGERW4G"==e.type)return void texthelp.RW4GC.IdentityManagerInstance.getLicense(!1,function(e){o({method:"trialValidation",type:"1757FROM_BGRW4G",payload:e})});if("gdocsTrialValidation"===e.method&&"1757FROM_PAGERW4G"==e.type){var d=e.payload,C=new Date,T=C.getYear()+C.getYear()+C.getYear();if(null==this.license||this.lastGoogleID!==d.email||T!==this.lastDate){this.lastGoogleID=d.email,this.encryptedID=thHash.hashEmail(this.lastGoogleID),this.lastDate=T;var c=new XMLHttpRequest;c.open("GET","https://rw.texthelp.com/access/access/getaccess?id="+d.email+"&type=0",!0),c.onreadystatechange=function(){var e="";4==this.readyState&&200==this.status&&(e=this.getResponseHeader("Content-Type"),"application/json"==e.substr(0,16)&&(this.license=JSON.parse(this.responseText.toString()),o({method:"trialValidation",type:"1757FROM_BGRW4G",payload:this.license})))},c.send()}else o({method:"trialValidation",type:"1757FROM_BGRW4G",payload:this.license})}if("connect"==e.command&&o({type:"1757FROM_BGRW4G",command:"connected",settingcookies:settingsCookiePosition,isClickHoverOn:getClickHoverOn()}),"isRWRunning"==e.command&&chrome.identity.getProfileUserInfo(function(e){var t="";e.email.length>0&&(t=e.email),o({type:"1757FROM_BGRW4G",command:"isRWRunning",email:t,running:n.socketManager.isOpen()})}),"getLicense"==e.command&&o({type:"1757FROM_BGRW4G",command:"getLicense"}),"isDefaultOn"==e.command&&chrome.storage.sync.get("thRWFGSettings",function(e){var t={visible:!0};void 0==e.thRWFGSettings?t.visible="true":(t=JSON.parse(e.thRWFGSettings),void 0==t.visible&&(t.visible="true")),o({method:"thToolbarVisibility",type:"1757FROM_BGRW4G",visible:t.visible})}),"save"==e.command&&saveSettings(e.settings),"saveCookiePosition"==e.command&&saveCookiePosition(e.cookiex,e.cookiey,e.cookieBarx,e.cookieBary),"trackEvent"==e.command){if("FromWebReader"==e.settings.category)return void trackEvent(this.encryptedID,e.settings.action,e.settings.label);trackEvent(e.settings.category,e.settings.action,e.settings.label)}"saveOnClickHover"==e.command&&setClickHoverOn(e.settings.clickHoverOn)})}catch(e){console.log(e)}init();