var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};this.thFunctionManager=function(){this._service=null,this._tracker=null,this._license=null,this._timing=[],this._firstChromeStart=!0,this._links={},this._onInstalled={},this.initialise=function(){try{this._service=analytics.getService("RW4GC"),this._tracker=this._service.getTracker("UA-83720712-1"),chrome.storage.managed.get(null,function(t){texthelp.RW4GC.IdentityManagerInstance=new texthelp.RW4GC.IdentityManager(t.accountType)}),this._onInstalled=this.onInstall.bind(this),chrome.runtime.onInstalled.addListener(this._onInstalled)}catch(t){console.log(t)}},this.onInstall=function(t){chrome.runtime.onInstalled.removeListener(this._onInstalled),texthelp.RW4GC.IdentityManagerInstance.getLicenseNoCache(!1,function(t){try{if(void 0==t)return;if(void 0!==t.error)return}catch(t){}})},this.onRefreshLicense=function(t,e){texthelp.RW4GC.IdentityManagerInstance.getLicenseNoCache(!1,function(t){e({type:"1757FROM_BGRW4G",method:"onRefreshLicense",payload:{license:JSON.stringify(t)}})})},this.onAuthenticate=function(){},this.onCollectHighlights=function(t,e){try{"https://rw.texthelp.com/simplify/home/simplify"==t.url.split("?")[0]&&(t.url=t.url.split("simplify=")[1],t.title=t.url),this.params=t,texthelp.RW4GC.IdentityManagerInstance.collectHighlights(t,function(t){window.open(t,"_blank").focus()})}catch(t){console.log(t)}},this.onVocab=function(t,e){try{texthelp.RW4GC.IdentityManagerInstance.vocab(t,function(t){window.open(t,"_blank").focus()})}catch(t){console.log(t)}},this.onAddVoiceNote=function(t,e,n,o){try{if(!o.url.startsWith("https://docs.google.com/document"))return;texthelp.RW4GC.IdentityManagerInstance.getVoiceNoteOAuthToken(t,function(t){e({type:"1757FROM_BGRW4G",method:"onAddVoiceNoteToken",parameters:{token:t}})})}catch(t){console.log(t)}},this.onBarShown=function(t){var e=this;try{texthelp.RW4GC.IdentityManagerInstance.getLicense(!0,function(n){var o=[];o.push(t[0]),o.push(n),e.onSendAppView(o);var o=[];if(o.push("toolbar down"),o.push(n.Email),o.push(n.Email.split("@")[1]),e.onSendEvent(o),t[1].indexOf("https://docs.google.com/document/")>=0&&t[1].indexOf("/edit")>=0){var o=[];o.push(t[1]),o.push(n.Email),o.push(n.Email.split("@")[1]),e.onSendEvent(o)}texthelp.RW4GC.IdentityManagerInstance.onBarShown()})}catch(t){console.log(t)}},this.onOpenTab=function(t,e,n){if(t.startsWith("https://largemp3.speechstream.net/")){window.open(t,"_MP3Test3452").focus()}},this.openForm=function(t,e,n,o){var i=document.createElement("form");if(i.action=e,i.method=t,i.setAttribute("method","post"),i.enctype="application/x-www-form-urlencoded",i.target=o||"_blank",n)for(var s in n){var a=document.createElement("textarea");a.name=s,a.value="object"===_typeof(n[s])?JSON.stringify(n[s]):n[s],i.appendChild(a)}i.style.display="none",document.body.appendChild(i),i.submit()},this.onOpenPracticeReadingAloud=function(t){this.openForm("POST","https://fluency.texthelp.com/ReadWrite",t)},this.onSaveBarSettings=function(t){chrome.storage.sync.set({texthelpbar:t})},this.onLoadBarSettings=function(t,e){chrome.storage.sync.get({texthelpbar:t},function(n){null==n.texthelpbar&&(n.texthelpbar=t),e({type:"1757FROM_BGRW4G_FUNCTION",method:"LoadBarSettings",parameters:{texthelpbar:n.texthelpbar}})})},this.onSaveDialogSettings=function(t){chrome.storage.sync.set({texthelpdialogs:t})},this.onLoadDialogSettings=function(t,e){chrome.storage.sync.get({texthelpdialogs:t},function(n){null==n.texthelpdialogs&&(n.texthelpdialogs=t),e({type:"1757FROM_BGRW4G_FUNCTION",method:"LoadDialogSettings",parameters:{texthelpdialogs:n.texthelpdialogs}})})},this.onStartTiming=function(t){},this.onEndTiming=function(t){},this.onNewLicense=function(t){try{var e=[];if(null!==this._license)return;this._license=t;var n=!1;void 0!==t.trial&&(n=t.trial);var o=!1;void 0!==t.unlimited&&(o=t.unlimited),t.daysleft>0&&!n?e.push("premium"):t.daysleft>0&&n?e.push("trial"):e.push("freemium"),e.push(t.Email.toLowerCase()),e.push(t.Email.split("@")[1].toLowerCase()),e.push(1),this.onSendEvent(e),e.length=0,o?e.push("domain"):"group"==t.licence_type.toLowerCase()?e.push("group"):e.push("single"),e.push(t.Email.toLowerCase()),e.push(t.Email.split("@")[1].toLowerCase()),e.push(1),this.onSendEvent(e),e.length=0,e.push("lType:"+t.lType),e.push(t.Email.toLowerCase()),e.push(t.Email.split("@")[1].toLowerCase()),e.push(1),this.onSendEvent(e)}catch(t){console.log(t)}},this.onSendAppView=function(t){if(null!=this._tracker){this.onNewLicense(t[1]),console.log("SendAppView: "+t[0].toLowerCase());try{var e=thHash.hashEmail(t[1].Email.toLowerCase());this._tracker.set("userId",e)}catch(t){}this._tracker.sendAppView(t[0].toLowerCase())}},this.onSendEvent=function(t){if(null!=this._tracker){if(t[1].indexOf("@")>-1&&(t[1]=thHash.hashEmail(t[1])),4==t.length)return this._tracker.set("userId",t[1].toLowerCase()),this._tracker.sendEvent(t[0].toLowerCase(),t[1].toLowerCase(),t[2].toLowerCase(),t[3]),void console.log("SendEvent: "+t[0].toLowerCase()+":"+t[1].toLowerCase()+":"+t[2].toLowerCase()+":"+t[3]);console.log("SendEvent: "+t[0].toLowerCase()+":"+t[1].toLowerCase()+":"+t[2].toLowerCase()),this._tracker.set("userId",t[1].toLowerCase()),this._tracker.sendEvent(t[0].toLowerCase(),t[1].toLowerCase(),t[2].toLowerCase())}},this.onGetLocaleDate=function(t,e){var n=moment(t[1]);n.locale(t[0]);var o=n.format("DD MMMM YYYY");moment(t[1]),e({type:"1757FROM_BGRW4G",method:"onGetLocaleDate",payload:{date:o}})},this.onActivateProductCode=function(t,e){texthelp.RW4GC.IdentityManagerInstance.setproductCode(t[0],function(t){e({type:"1757FROM_BGRW4G",method:"onRefreshLicense",payload:{license:JSON.stringify(t)}})})}},void 0==this.thFunctions&&(this.thFunctions=new this.thFunctionManager,this.thFunctions.initialise());