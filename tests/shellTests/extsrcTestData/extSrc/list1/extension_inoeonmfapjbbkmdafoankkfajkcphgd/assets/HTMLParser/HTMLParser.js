var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function e(t,n,r){function i(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n||e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HIGHLIGHT_TAG="texthelp-highlight-span",n.WRAPPER_TAG="texthelp-wrapper-span",n.THDomRange_ERROR=-1,n.THDomRange_TARGET_SAME=0,n.THDomRange_AFTER_TARGET=1,n.THDomRange_BEFORE_TARGET=2,n.THDomRange_TARGET_INSIDE=3,n.THDomRange_TARGET_INCLUDES_THIS=4,n.THDomRange_OVERLAPS_END_OF_TARGET=5,n.THDomRange_OVERLAPS_START_OF_TARGET=6,n.THDomRange_TARGET_INCLUDES_THIS_AT_START=7,n.THDomRange_TARGET_INCLUDES_THIS_AT_END=8,n.SPEECH_RANGE_COLOUR="colour:#rrggbb; background:#FFFF00",n.SPEECH_WORD_COLOUR="color:#FFFFFF; background:#0000FF; padding: 2px; margin: -2px; border-radius: 4px; text-shadow: 0 3px 8px #2A2A2A;position:relative"},{}],2:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Attribute=function(){function e(){r(this,e)}return i(e,[{key:"rw_getAttribute",value:function(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){var n=null;return 0!=t.indexOf("data-texthelp-")&&(n=e.getAttribute("data-texthelp-"+t)),null==n&&0!=t.indexOf("data-")&&(n=e.getAttribute("data-"+t)),null==n&&(n=e.getAttribute(t)),n}return null}},{key:"rw_setAttribute",value:function(e,t,n){null!=e&&1==e.nodeType&&"string"==typeof t&&"string"==typeof n&&(0!=t.indexOf("data-")&&"style"!=t&&(t="data-"+t),e.setAttribute(t,n))}},{key:"rw_removeAttribute",value:function(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){if(0!=t.indexOf("data-")&&null!=e.getAttribute("data-"+t))return void e.removeAttribute("data-"+t);null!=e.getAttribute(t)&&e.removeAttribute(t)}}}]),e}()},{}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.DomNavigation=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../Utilities/Utilities"),a=e("./SSDOM"),l=e("./Attribute"),s=e("../MathJax/MathSpeak"),u=(e("../THCaret"),e("../THCaretRange"),e("../../Constants/Constants")),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u);n.DomNavigation=function(){function e(){r(this,e)}return i(e,[{key:"getActualNextNodeIgnoreChildren",value:function(e,t){if(null==e||e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(n=n.parentNode,t==n)return null;if(null!=n.nextSibling)return n.nextSibling}return null}},{key:"getActualNextNode",value:function(e,t){if(null==e)return null;if(null!=e.firstChild)return e.firstChild;if(e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(n=n.parentNode,t==n)return null;if(null!=n.nextSibling)return n.nextSibling}return null}},{key:"getNodeFromPosition",value:function(e,t){var n=new l.Attribute,r=e;if(t.lastIndexOf("*")>-1){var i=t.lastIndexOf("*");t=t.substring(i+1)}var o,a=t.split("~"),s=a.length;for(o=s-2;o>-1;o--){if(null==(r=r.firstChild))return null;var u;u=0==a[o].length?0:parseInt(a[o],10);for(var h=!1,f=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==c.HIGHLIGHT_TAG&&null!=n.rw_getAttribute(r,"rwstate");u>0;){if(null==(r=r.nextSibling))return null;(h=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==c.HIGHLIGHT_TAG&&null!=n.rw_getAttribute(r,"rwstate"))&&f||(--u,f=h)}}return r}},{key:"getTextFromNode",value:function(e){var t=new a.SSDOM,n=new l.Attribute,r="";if(t.isInvalidNode(e)||t.isIgnored(e))return r;if(3==e.nodeType)"textarea"!=e.parentNode.tagName.toLowerCase()&&(r=e.nodeValue);else if(1==e.nodeType){var i=e.tagName.toLowerCase();if("img"==i){var u=n.rw_getAttribute(e,"alt");null!=u&&u.trimTH().length>0&&(r=" "+u.trimTH()+" ")}else if("span"==i){var u=n.rw_getAttribute(e,"pron");if(null!=u&&u.trimTH().length>0&&(r=u.trimTH()),u=n.rw_getAttribute(e,"chunk"),null!=u&&"1"==u&&(r=e.innerHTML),u=e.isMathJax){var c=new s.MathSpeak;r=c.getTextFromMathJax(e)}}else if("acronym"==i||"abbr"==i){var u=n.rw_getAttribute(e,"pron"),h=new o.Utilities;null!=u&&h.trim(u).length>0?r=h.trim(u):null!=(u=e.getAttribute("title"))&&h.trim(u).length>0&&(r=h.trim(u))}else"math"==i&&(r=this.getTextFromMathMl(e))}return r}},{key:"getNextNodeAllowMoveToChild",value:function(e,t,n){return this.getNextNodeImpl(e,t,n,!0,!1)}},{key:"getNextNodeIgnoreChildren",value:function(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!0)}},{key:"getLastChildTextNode",value:function(e,t){var n=new l.Attribute,r=new a.SSDOM;if(null==e||null==e.lastChild||r.isInvalidNode(e))return e;if(r.isSpecialCaseWithIgnoredContent(e))return e;for(var i=e.lastChild;null!=i;){var o=r.isIgnored(e);if(!o&&3==i.nodeType)return i;if(!o&&1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&null!=n.rw_getAttribute(i,"alt")&&n.rw_getAttribute(i,"alt").length>0)return i;if(r.isInvalidNode(i)||null==i.lastChild||r.isSpecialCaseWithIgnoredContent(e)){return t?this.getPreviousTextNode(i,!1,e):this.getPreviousTextNodeNoImg(i,!1,e,!0)}i=i.lastChild}return e}},{key:"getPreviousTextNodeNoImg",value:function(e,t,n,r){for(var i=r?this.getPreviousTextNode(e,t,n):this.getPreviousTextNodeNoBlank(e,t,n);null!=i&&3!=i.nodeType&&i!=n&&"math"!=i.tagName.toLowerCase()&&!i.isMathJax;)i=r?this.getPreviousTextNode(i,t,n):this.getPreviousTextNodeNoBlank(i,t,n);return i}},{key:"getPreviousTextNodeNoBlank",value:function(e,t,n){for(var r=new l.Attribute,i=new a.SSDOM,o=e;null!=o&&o!=n;)if(null!=(o=this.getPreviousTextNode(o,t,n))){var u;if(3==o.nodeType)u=o.nodeValue.trimTH();else if("img"==o.tagName.toLowerCase()&&null!=r.rw_getAttribute(o,"alt"))u=r.rw_getAttribute(o,"alt").trimTH();else if("math"==o.tagName.toLowerCase())u=this.getTextFromMathMl(o);else if(o.isMathJax){var c=new s.MathSpeak;u=c.getTextFromMathJax(o)}if(i.rw_isWordSpeakable(u))return o}return null}},{key:"getPreviousTextNode",value:function(e,t,n){for(var r=new l.Attribute,i=e,o=!1;null!=i&&i!=n;)if(null!=(i=this.getPreviousNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(o=!0),1==i.nodeType&&"math"==i.tagName.toLowerCase())o=!0;else if(1==i.nodeType&&i.isMathJax)o=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var a=r.rw_getAttribute(i,"alt");null!=a&&a.length>0&&(o=!0)}if(o)return i}return null}},{key:"getPreviousNode",value:function(e,t,n){var r=new a.SSDOM;if(null==e||e==n)return null;var i=e;if(null!=i.previousSibling){if(i=i.previousSibling,t&&!r.isStyleNode(i))return null;if(null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n)}else{for(;null!=i&&null!=i.lastChild&&!r.isSpecialCaseWithIgnoredContent(i);)if(i=i.lastChild,t&&(r.isStyleNode(i)||(i=null)),null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n);break}if(null!=i&&r.isIgnored(i)){if(i==n)return null;i=this.getPreviousNode(i,t,n)}}}else if(i=i.parentNode,t&&null!=i&&(r.isStyleNode(i)||(i=null)),null!=i&&r.isIgnored(i)){if(i==n)return null;i=this.getPreviousNode(i,t,n)}return i}},{key:"getFirstChildTextNode",value:function(e,t){var n=new a.SSDOM,r=new l.Attribute;if(null==e||null==e.firstChild||n.isInvalidNode(e))return e;if(n.isSpecialCaseWithIgnoredContent(e))return e;var i=e.firstChild;return 3==i.nodeType?i:1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&null!=r.rw_getAttribute(i,"alt")&&r.rw_getAttribute(i,"alt").length>0?i:t?this.getNextTextNode(i,!1,e):this.getNextTextNodeNoImg(i,!1,e,!0)}},{key:"getNextTextNodeNoImg",value:function(e,t,n,r){for(var i=r?this.getNextTextNode(e,t,n):this.getNextTextNodeNoBlank(e,t,n);null!=i&&3!=i.nodeType&&i!=n&&"math"!=i.tagName.toLowerCase()&&!i.isMathJax;)i=r?this.getNextTextNode(i,t,n):this.getNextTextNodeNoBlank(i,t,n);return i}},{key:"getNextTextNodeNoBlank",value:function(e,t,n){for(var r=new l.Attribute,i=new a.SSDOM,o=e;null!=o&&o!=n;)if(null!=(o=this.getNextTextNode(o,t,n))){var u;if(3==o.nodeType)u=o.nodeValue.trimTH();else if("img"==o.tagName.toLowerCase()&&null!=r.rw_getAttribute(o,"alt"))u=r.rw_getAttribute(o,"alt").trimTH();else if("math"==o.tagName.toLowerCase())u=this.getTextFromMathMl(o);else if(o.isMathJax){var c=new s.MathSpeak;u=c.getTextFromMathJax(o)}if(i.rw_isWordSpeakable(u))return o}return null}},{key:"getTextFromMathMl",value:function(e){var t=new a.SSDOM;if(null!=e.previousSibling||null!=e.nextSibling){var n=t.createWrapperElement();e.parentNode.replaceChild(n,e),n.appendChild(e)}var r,r=e.parentNode.innerHTML;return null!=r&&r.length>0?r:""}},{key:"getNextTextNode",value:function(e,t,n){for(var r=new l.Attribute,i=e,o=!1;null!=i&&i!=n;)if(null!=(i=this.getNextNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(o=!0),1==i.nodeType&&"math"==i.tagName.toLowerCase())o=!0;else if(1==i.nodeType&&i.isMathJax)o=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var a=r.rw_getAttribute(i,"alt");null!=a&&a.length>0&&(o=!0)}if(o)return i}return null}},{key:"getNextNode",value:function(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!1)}},{key:"getNextNodeImpl",value:function(e,t,n,r,i){var o=new a.SSDOM;if(null==e||e==n&&(i||!r))return null;var l=o.isInvalidNode(e);o.isSpecialCaseWithIgnoredContent(e)&&(l=!0);var s=null;if(e==n&&r){if(l||null==e.firstChild)return null;s=e.firstChild}else if(s=e,null==s.firstChild||l||i){if(null!=s.firstChild&&i&&null!=n&&o.checkIfElementInsideElement(n,s))return null;if(null!=s.nextSibling)s=s.nextSibling;else{for(;null!=s&&null==s.nextSibling&&(s=s.parentNode,t&&(o.isStyleNode(s)||(s=null)),n!=s););null!=s&&n!=s&&(s=s.nextSibling)}}else s=s.firstChild;return null!=s&&t&&(o.isStyleNode(s)||(s=null)),null!=s&&(o.isInvalidNode(s)?s=this.getNextNodeImpl(s,t,n,!1,!0):o.isIgnored(s)&&(s=this.getNextNodeImpl(s,t,n,!1,!1)),r&&s==n&&e==n&&(s=null)),s}}]),e}()},{"../../Constants/Constants":1,"../MathJax/MathSpeak":16,"../THCaret":31,"../THCaretRange":32,"../Utilities/Utilities":38,"./Attribute":2,"./SSDOM":5}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.DomSentences=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../Utilities/Utilities"),a=e("./SSDOM"),l=e("./Attribute"),s=e("./DomNavigation"),u=e("../THCaret"),c=e("../THCaretRange");n.DomSentences=function(){function e(){r(this,e)}return i(e,[{key:"getSentenceFromPoint",value:function(e){if(null!=e.node.tagName&&"img"==e.node.tagName.toLowerCase()){var t=new c.THCaretRange;t.setCaretRange(e,e)}else{var n=this.getSentenceBreakToRight(e),r=this.getSentenceBreakToLeft(n);if(null==r||null==n)return null;var t=new c.THCaretRange;t.setCaretRange(r,n)}return t}},{key:"getNextSentence",value:function(e,t){var n=new s.DomNavigation,r=new a.SSDOM;if(null==e)return null;void 0===t&&(t=null);var i=e.rightCaret.node,o=e.rightCaret.offset;if(r.rw_checkForHiddenParent(e.rightCaret.node))return null;e.rightCaret.isSpecialCase()&&(i=n.getNextNodeIgnoreChildren(i,!1,t),o=0);for(var l,h;null!=i;){if(3==i.nodeType&&o<i.nodeValue.length){if(null==(l=this.getSentenceBreakToRight(new u.THCaret(i,o,!1),t)))return null;if(l.node==i&&l.offset==o){var f=n.getNextTextNodeNoBlank(i,!1,t);if(null==f)return null;l=this.getSentenceBreakToRight(new u.THCaret(f,0,!1),t)}}else{var f=n.getNextTextNodeNoBlank(i,!1,t);if(null==f)return null;l=this.getSentenceBreakToRight(new u.THCaret(f,0,!1),t)}if(null==(h=this.getSentenceBreakToLeft(l,null)))return null;if(e.leftCaret.node!=h.node||e.leftCaret.offset!=h.offset){var d=new c.THCaretRange;if(d.setCaretRange(h,l),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d))return d}if(i=l.node,3==i.nodeType){var g=i.nodeValue.replace(/[\x21\x3f\x3a]/g,"."),v=g.indexOf(".",l.offset+1);o=-1==v?g.length:v}}return null}},{key:"checkSentence",value:function(e){for(var t=new l.Attribute,n="rwTHcomp",r=e.leftCaret.node,i=r.ownerDocument.body;null!=r&&r!=i;){if(1==r.nodeType){if("rwDictDefin"==r.className||"rwPopupContent"==r.className||"rwToolbarBarCollect"==r.className)break;if(null!=t.rw_getAttribute(r,n))return!1}r=r.parentNode}var o=e.rightCaret.node;if(o!=r)for(;null!=o&&o!=i&&"rwDictDefin"!=o.className&&"rwPopupContent"!=o.className&&"rwToolbarBarCollect"!=o.className;){if(1==o.nodeType&&null!=t.rw_getAttribute(o,n))return!1;o=o.parentNode}return!0}},{key:"getPreviousSentence",value:function(e,t){var n=new s.DomNavigation,r=new a.SSDOM;void 0===t&&(t=null);for(var i,o,l=e.leftCaret.node,h=e.leftCaret.offset;null!=l;){if(3==l.nodeType){var f,d=l.nodeValue.replace(/[\x21\x3f\x3a]/g,".");for(f=h>0?d.lastIndexOf(".",h):0==h?-1:d.lastIndexOf(".");f>-1;){if(h=f,null==(o=this.getSentenceBreakToRight(new u.THCaret(l,h,!0),t)))return null;if(o.node!=e.rightCaret.node||o.offset!=e.rightCaret.offset){if(null==(i=this.getSentenceBreakToLeft(o,t)))return null;var g=new c.THCaretRange;if(g.setCaretRange(i,o),this.checkSentence(g)&&r.rw_caretRangeIsSpeakable(g))return g}f=0==f?-1:d.lastIndexOf(".",f-1)}}if(h=-1,tmpNode=n.getPreviousTextNodeNoImg(l,!0,t,!1),null!=tmpNode)l=tmpNode;else if(null!=(l=n.getPreviousTextNodeNoBlank(l,!1,t))){if(null==(o=3==l.nodeType?this.getSentenceBreakToRight(new u.THCaret(l,l.nodeValue.length,!1),t):this.getSentenceBreakToRight(new u.THCaret(l,0,!1),t)))return null;if(o.node!=e.rightCaret.node||o.offset!=e.rightCaret.offset)return i=this.getSentenceBreakToLeft(o,t),null==i?null:new c.THCaretRange(i,o)}}return null}},{key:"getSentenceBreakToLeft",value:function(e,t){var n=new s.DomNavigation,r=new a.SSDOM;if(void 0===t&&(t=null),null==e||null==e.node)return null;var i=e.node,l=e.offset;if(1==e.node.nodeType&&"math"==e.node.tagName.toLowerCase())return e;if(1==e.node.nodeType&&e.node.isMathJax)return e;if(e.forwardBias)3==i.nodeType&&l==i.nodeValue.length&&(i=n.getNextTextNode(i,!0,t),l=0,null==i&&(i=e.node,l=e.offset));else if(l>0)--l;else{if(null==(i=n.getPreviousTextNode(i,!0,t)))return e;if(3==i.nodeType)l=i.nodeValue.length-1;else{if(l=0,"math"==i.tagName.toLowerCase())return e;if(i.isMathJax)return e}}if(3==i.nodeType){var c=i.nodeValue.charAt(l);if("."==c||"!"==c||"?"==c||":"==c)if(l>0)--l;else{if(null==(i=n.getPreviousTextNode(i,!0,t)))return e;if(3==i.nodeType)l=i.nodeValue.length-1;else{if(l=0,"math"==i.tagName.toLowerCase())return e;if(i.isMathJax)return e}}}for(var h=i,f=l,d=i,g=l,v=!1,p=" ";!v;){if(r.isSpecialCaseNested(d)){if(d=r.checkForSpecialParent(d),"math"==d.tagName.toLowerCase()){v=!0;break}if(d.isMathJax){v=!0;break}h=d,f=0}else if(3==d.nodeType){var m=d.nodeValue;if(m.length>0){-1==g&&(g=m.length),m=m.replace(/[\x21\x3f\x3a]/g,".");for(var y=m.lastIndexOf(".",g);y>-1;){if(r.rw_isFullStop(m,y,d)){if(y<m.length-1){h=d,f=y+1,v=!0;break}if(!r.rw_isTextChar(p)){v=!0;break}}y=0==y?-1:m.lastIndexOf(".",y-1)}if(v)break;var w=new o.Utilities;w.trim(m).length>0&&(h=d,f=0),p=m.charAt(0)}}if(d=n.getPreviousNode(d,!0,t),g=-1,null==d){v=!0;break}if(3==d.nodeType&&r.isSpecialCaseNested(d)&&null==(d=r.checkForSpecialParent(d))){v=!0;break}}if(3==h.nodeType){var m=h.nodeValue;if(f<m.length)for(;f<m.length&&r.rw_isWhiteSpace(m.charAt(f));)++f}return new u.THCaret(h,f,!0)}},{key:"getSentenceBreakToRight",value:function(e,t){var n=new s.DomNavigation,r=new a.SSDOM;if(void 0===t&&(t=null),null==e||null==e.node)return null;for(var i=e.node,l=e.offset,c=i,h=l,f=!1,d=" ";!f;){if(r.isSpecialCaseNested(i)){if(i=r.checkForSpecialParent(i),"math"==i.tagName.toLowerCase()){f=!0;break}if(i.isMathJax){f=!0;break}c=i,h=0,i=n.getNextNodeIgnoreChildren(i,!0,t)}else if(3==i.nodeType){var g=i.nodeValue;if(g.length>0){if("."==d){var v=g.charAt(l);if(!r.rw_isTextChar(v)){f=!0;break}}g=g.replace(/[\x21\x3f\x3a]/g,".");for(var p=g.indexOf(".",l);p>-1;){if(r.rw_isFullStop(g,p,i)){p<g.length-1&&(c=i,h=p+1,f=!0);break}l=p+1,p=g.indexOf(".",l)}if(f)break;var m=new o.Utilities;m.trim(g).length>0&&(c=i,h=g.length),"."==(d=g.charAt(g.length-1))&&(r.rw_isFullStop(g,g.length-1,i)||(d=" "))}i=n.getNextNode(i,!0,t)}else i=n.getNextNode(i,!0,t);if(l=0,null==i){f=!0;break}}if(3==c.nodeType){var g=c.nodeValue;if(h>0&&h<=g.length)for(;h>0&&r.rw_isWhiteSpace(g.charAt(h-1));)--h}return new u.THCaret(c,h,!1)}}]),e}()},{"../THCaret":31,"../THCaretRange":32,"../Utilities/Utilities":38,"./Attribute":2,"./DomNavigation":3,"./SSDOM":5}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SSDOM=void 0;var i=("function"==typeof Symbol&&_typeof(Symbol.iterator),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),o=e("../Utilities/Utilities"),a=e("../THCaret"),l=e("../THCaretRange"),s=e("../THRange"),u=e("../THDomRefPt"),c=e("../MathJax/MathSpeak"),h=e("./DomNavigation"),f=e("./Attribute"),d=e("./DomSentences"),g=e("../../Constants/Constants"),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(g);n.SSDOM=function(){function e(){r(this,e)}return i(e,[{key:"checkForSpecialParent",value:function(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return n;n=n.parentNode}return null}},{key:"getBody",value:function(e){return e.document?e.document.body:e.ownerDocument.body}},{key:"isSpecialCase",value:function(e){var t=new f.Attribute;if(null==e)return!1;if(1==e.nodeType){var n=e.tagName.toLowerCase();if(n==v.HIGHLIGHT_TAG||"span"==n){var r=t.rw_getAttribute(e,"pron");if(null!=r)return!0;if(null!=(r=t.rw_getAttribute(e,"chunk")))return!0;if(null!=(r=e.isMathJax)&&r)return!0}else if("acronym"==n||"abbr"==n){var r=e.getAttribute("title");if(null!=r)return!0}else{if("chunk"==n)return!0;if("img"==n){var r=t.rw_getAttribute(e,"alt");if(null!=r)return!0}else if("math"==n)return!0}}return!1}},{key:"isSpecialCaseHighlightable",value:function(e){var t=new f.Attribute;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){var r=t.rw_getAttribute(e,"pron");if(null!=r)return!0;if(null!=(r=t.rw_getAttribute(e,"chunk"))&&"1"==r)return!0;if(null!=(r=e.isMathJax)&&r){if((new c.MathSpeak).getTextFromMathJax(e).length>0)return!0}}else if("acronym"==n||"abbr"==n){var r=e.getAttribute("title");if(null!=r)return!0}else if("math"==n)return!1}return!1}},{key:"checkIfElementInsideElement",value:function(e,t){if(null==e||null==t)return!1;for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}},{key:"isSpecialCaseWithIgnoredContent",value:function(e){var t=new f.Attribute;if(null==e)return!1;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){var r=e.isMathJax;if(null!=r&&r)return!0}else{if("textarea"==n)return!0;if("img"==n){var r=t.rw_getAttribute(e,"alt");if(null!=r)return!0}else if("math"==n)return!0}}return!1}},{key:"rw_isWordSpeakable",value:function(e){if(null==e||0==e.length)return!1;var t=new o.Utilities,n=t.trim(e);if(1==n.length){var r=n.charCodeAt(0);if(96==r||180==r||8216==r||8217==r||8220==r||8221==r)return!1}var i,a=n.length,l=0;for(l=0;l<a;l++){if((i=n.charCodeAt(l))>63&&i<91||i>96&&i<123||i>127&&160!=i)return!0;if(i>46&&i<58)return!0;if(i>35&&i<39||43==i||61==i)return!0}return!1}},{key:"createWrapperElement",value:function(){return this.createObject(v.WRAPPER_TAG,null,null,g_bOverrideSpan?"thspan":null)}},{key:"createObject",value:function(e,t,n,r){return this.createObjectForDoc(e,t,n,r,document)}},{key:"createObjectForDoc",value:function(e,t,n,r,i){var o=i.createElement(e);if(null!=n&&(o.id=n),null!=r&&(o.className=r),null!=t)for(var a=t.length,l=0;l<a;l+=2)o.setAttribute(t[l],t[l+1]);return o}},{key:"isStyleNode",value:function(e){var t=new f.Attribute;if(null==e)return!1;if(1!=e.nodeType)return 3==e.nodeType||8==e.nodeType;var n=e.tagName.toLowerCase().trimTH();if(n==v.HIGHLIGHT_TAG){var r=t.rw_getAttribute(e,"started");if(null!=r&&"1"==r)return!1}return this.isInStyleList(n)}},{key:"isInStyleList",value:function(e){return("~em~strong~b~i~u~tt~font~kbd~dfn~cite~sup~sub~a~embed~span~small~nobr~wbr~acronym~abbr~code~s~chunk~th:pron~img~/th:pron~w~/w~lic/lic~break~silence~thspan~beelinereader~beelinespan~"+v.HIGHLIGHT_TAG+"~"+v.WRAPPER_TAG+"~").indexOf("~"+e+"~")>-1}},{key:"isInvalidNode",value:function(e){if(null==e)return!0;if(1!=e.nodeType)return 3!=e.nodeType||this.isInvalidNode(e.parentNode);var t=this.getComputedStyle(e);if(null!=t&&("hidden"==t.visibility||"none"==t.display))return!0;var n=e.tagName.toLowerCase();return"link"==n||"area"==n||"script"==n||"noscript"==n||"annotation"==n||"style"==n||"!--"==n||"title"==n||"html:script"==n}},{key:"getComputedStyle",value:function(e){return null==e?null:3==e.nodeType&&null==(e=e.parentNode)?null:window.getComputedStyle(e,null)}},{key:"isIgnored",value:function(e){var t=new f.Attribute;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var n=e.ownerDocument.body,r=e;null!=r&&1==r.nodeType;){if(null!=t.rw_getAttribute(r,"ignore"))return!0;if(null!=t.rw_getAttribute(r,"allow"))return!1;if("button"==r.tagName.toLowerCase())return!1;if(r==n)break;r=r.parentNode}return!1}},{key:"allTextFromNodeTH",value:function(e){var t="";if(3==e.nodeType)t=e.nodeValue;else if(1==e.nodeType)for(var n=e.firstChild;null!=n;)3==n.nodeType?t+=n.nodeValue:1==n.nodeType&&(t+=this.allTextFromNodeTH(n)),n=n.nextSibling;return t}},{key:"mergeTextNodes",value:function(e){if(null==e)return e;var t=e.parentNode;if(null!=t&&3==e.nodeType){for(var n=e.ownerDocument;null!=e.previousSibling&&3==e.previousSibling.nodeType;){var r=e.previousSibling.nodeValue+e.nodeValue,i=n.createTextNode(r);t.removeChild(e.previousSibling),t.replaceChild(i,e),e=i}for(;null!=e.nextSibling&&3==e.nextSibling.nodeType;){var r=e.nodeValue+e.nextSibling.nodeValue,i=n.createTextNode(r);t.removeChild(e.nextSibling),t.replaceChild(i,e),e=i}}return e}},{key:"rw_reduceSelectionForNonSpeechChar",value:function(e){var t=new h.DomNavigation,n=!1,r=e.rightCaret.node,i=e.rightCaret.offset,o=e.leftCaret.node,s=e.leftCaret.offset;try{var u,c;if(!e.rightCaret.isSpecialCase())for(var f=r.nodeValue;;){if(0==i){if(null==(u=t.getPreviousTextNode(r,!1,o)))break;if(1==u.nodeType){r=u,i=0,n=!0;break}r=u,f=r.nodeValue,i=f.length,n=!0}if(r==o&&i==s)break;if(!(i>0))break;if(c=f.charAt(i-1),!this.rw_isWhiteSpace(c))break;--i,n=!0}if(!e.leftCaret.isSpecialCase())for(var d=o.nodeValue,g=d.length;;){if(s==g){if(null==(u=t.getNextTextNode(o,!1,r)))break;if(1==u.nodeType){o=u,s=0,g=0,n=!0;break}o=u,d=o.nodeValue,s=0,g=d.length,n=!0}if(r==o&&i==s)break;if(!(s<g))break;if(c=d.charAt(s),!this.rw_isWhiteSpace(c))break;++s,n=!0}}catch(e){console.log(e)}return n?new l.THCaretRange(new a.THCaret(o,s,!0),new a.THCaret(r,i,!1)):e}},{key:"rw_isWhiteSpace",value:function(e){return e.search(/[\s\xa0]/)>-1}},{key:"getSentenceFromPointByLang",value:function(e){var t=new d.DomSentences,n=t.getSentenceBreakToRight(e),r=t.getSentenceBreakToLeft(n),i=new l.THCaretRange;return i.setCaretRange(r,n),i}},{key:"isSpecialCaseNested",value:function(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return!0;n=n.parentNode}return!1}},{key:"rw_isTextChar",value:function(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}},{key:"rw_isFullStop",value:function(e,t,n){var r=new h.DomNavigation,i=!0;if(e.length>t+1){var o=e.charCodeAt(t+1);this.rw_isTextChar(o)&&(i=!1)}if(i&&null!=n&&"."!=n.nodeValue.charAt(t))return!0;if(i)if(t>1){var a=e.substring(t-2,t);if((" "==a.charAt(0)||"\n"==a.charAt(0)||"\r"==a.charAt(0)||"\t"==a.charAt(0))&&a.charCodeAt(1)>63&&a.charCodeAt(1)<91)i=!1;else if("."==a.charAt(0)&&this.rw_isTextChar(a.charCodeAt(1)))i=!1;else if("Dr"==a||"Mr"==a||"Ms"==a||"Av"==a||"St"==a||"eg"==a)i=!1;else if(t>2){var l=e.substring(t-3,t);if("Mrs"==l||"etc"==l||"i.e"==l||"P.O"==l||"PhD"==l)i=!1;else if(t>3){var s=e.substring(t-4,t);"Ph.D"==s&&(i=!1)}}}else try{if(null!=n&&0==t){var u=r.getPreviousTextNode(n,!0,null);if(null!=u&&3==u.nodeType&&u!=n)return!!this.rw_isFullStop(u.nodeValue+e,u.nodeValue.length,null)}}catch(e){}return i}},{key:"rw_caretRangeIsSpeakable",value:function(e){var t=new h.DomNavigation;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return!1;if(this.rw_checkForHiddenParent(e.leftCaret.node))return!1;for(var n=e.leftCaret,r=e.rightCaret,i=n.node,o=r.node,a=!0,l=!1,s=i;null!=s;){if((l=this.isSpecialCase(s))||3==s.nodeType){var u=t.getTextFromNode(s);if(null!=u&&""!=u&&(l||(s==o&&r.offset>-1&&(u=u.substring(0,r.offset)),s==i&&n.offset>0&&(u=u.substring(n.offset))),this.rw_isWordSpeakable(u)))return!0}s=l?t.getNextNodeIgnoreChildren(s,!1,o):a?t.getNextNodeAllowMoveToChild(s,!0,o):t.getNextNode(s,!1,o),a=!1}}catch(e){}return!1}},{key:"rw_checkForHiddenParent",value:function(e){try{var t=this.getComputedStyle(e);if(null!=t&&("none"==t.display||"hidden"==t.visibility))return!0;for(var n=e,r=n.ownerDocument.body;n!=r;)if(n=n.parentNode,"none"==this.getComputedStyle(n).display)return!0}catch(e){}return!1}},{key:"rw_getRefPt",value:function(e,t){var n=new f.Attribute,r="rwTHgen";try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var i=this.checkForSpecialParent(e);if(null!=i)return new u.THDomRefPt(this.getPositionInDom(i),t);var o,a;1==e.nodeType?(o=0,a=e):(o=this.rw_getNodeOffset(e),a=e.parentNode);for(var l=n.rw_getAttribute(a,"rwstate"),s=n.rw_getAttribute(a,r);null!=l&&l.length>0||null!=s;)o+=this.rw_getNodeOffset(a),a=a.parentNode,l=n.rw_getAttribute(a,"rwstate"),s=n.rw_getAttribute(a,r);return-1==t&&(o=-1),new u.THDomRefPt(this.getPositionInDom(a),o+t)}return null}catch(e){return null}}},{key:"rw_getNodeOffset",value:function(e){if(null==e)return 0;var t=0,n=e.previousSibling;return null!=n&&(t=this.rw_getNodeOffsetImpl(n)),t}},{key:"getPositionInDom",value:function(e){var t=new f.Attribute,n="",r=0,i="";if(null!=e&&null!=e.ownerDocument)for(var o=!1,a=!1,l=e.ownerDocument.body;null!=e&&e!=l;){this.isSpecialCase(e)&&(n=""),o=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==v.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(e,"rwstate");for(var s=e.previousSibling;null!=s;)a=3==s.nodeType||1==s.nodeType&&s.tagName.toLowerCase()==v.HIGHLIGHT_TAG&&null!=t.rw_getAttribute(s,"rwstate"),o&&a||++r,s=s.previousSibling,o=a;if(n=n+r+"~",r=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var u=t.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==u){var c=this.getPositionInDom(e);i="#^th*"+c+"#^th*"}}}return i+n}},{key:"rw_getBreakInCurrentWord",value:function(e){return null==e||0==e.length?-1:e.search("["+String.fromCharCode(8212)+'\\s"]')}},{key:"rw_isLetter",value:function(e){return e>64&&e<91||e>96&&e<123}},{key:"rw_getNodeOffsetImpl",value:function(e){for(var t,n=0,r=e;null!=r;)3!=r.nodeType||this.isIgnored(r)?1==r.nodeType&&(this.isInvalidNode(r)||(n+=this.isSpecialCase(r)?1:"textarea"!=r.tagName.toLowerCase()?this.rw_getNodeOffsetImpl(r.lastChild):1)):(t=r.nodeValue,n+=t.length),r=r.previousSibling;return n}},{key:"rw_getCaretFromRefPt",value:function(e,t){return this.getCaretFromDomPosition(e,t.path,t.offset,!0)}},{key:"getCaretFromDomPosition",value:function(e,t,n,r,i){var o=new h.DomNavigation;void 0===i&&(i=!1);try{if(null==e)return null;var l=o.getNodeFromPosition(e,t);if(i){var s=new a.THCaret(l,0,r);return s.setSpecialCase(!0),s}var u=this.checkForSpecialParent(l);if(null!=u){if(l=u,this.isSpecialCaseHighlightable(u)){if(r){var c=o.getFirstChildTextNode(l,!1);return null!=c?new a.THCaret(c,0,r):new a.THCaret(l,0,r)}var f=o.getLastChildTextNode(l,!1);return null!=f?3==f.nodeType?new a.THCaret(f,f.length,r):new a.THCaret(f,0,r):new a.THCaret(l,0,r)}return new a.THCaret(u,0,r)}var d=0;if(r||++d,n>-1){if(null==l)return null;for(var g,v=!1,f=l.parentNode,p=l;!v;){if(3==l.nodeType){if(g=l.nodeValue,n<d+g.length){v=!0;break}p=l,d+=l.nodeValue.length,l=o.getNextNode(l,!1,f)}else if(1==l.nodeType)if(null!=(u=this.checkForSpecialParent(l))){l=u;var m=n-d;if(!(m>0)){v=!0;break}d+=1,l=o.getNextNodeIgnoreChildren(l,!1,f)}else l=o.getNextNode(l,!1,f);if(null==l||l==f){if(null!=p){l=p,d=3==l.nodeType?n-l.nodeValue.length:0,r||++d;break}return null}}return r?new a.THCaret(l,n-d,r):new a.THCaret(l,n-(d-1),r)}return new a.THCaret(l,n,r)}catch(e){return null}}},{key:"getNodesOverRange",value:function(e,t){var n=new h.DomNavigation,r=[];if(null==e||null==t)return r;for(var i=e;i;)this.isInvalidNode(i)?i=n.getActualNextNodeIgnoreChildren(i,t):(this.isIgnored(i)||r.push(i),i=n.getActualNextNode(i,t));return r}},{key:"getWindow",value:function(e){try{if(null==e)return window;if(0===top.frames.length)return window;var t=e.ownerDocument.body;if(t===window.document.body)return window;var n,r=top.frames.length;for(n=0;n<r;n++)try{if(top.frames[n].document.body===t)return top.frames[n]}catch(e){}}catch(e){}return window}},{key:"rw_getTextRangeAsTHRange",value:function(e,t){var n=t.duplicate();n.collapse(!0);var r=rw_getTextRangeAsRefPtIE(e,n);n=t.duplicate(),n.collapse(!1);var i=rw_getTextRangeAsRefPtIE(e,n);return new s.THRange(e,r,i)}},{key:"rw_getAsTextRange",value:function(e,t,n,r,i){var o=this.getRangeObject(e),a=new l.THCaretRange(e,t,-1,r,-1),s=a.leftCaret,u=a.rightCaret;if(null!=s&&null!=s.node&&null!=u&&null!=u.node){var c=s.node;if(3==c.nodeType){var h=this.rw_getNodeOffset(c);c=c.parentNode,n+=h}var f=u.node;if(3==f.nodeType){var h=this.rw_getNodeOffset(f);f=f.parentNode,i+=h}o.moveToElementText(c),o.collapse(),rw_moveEnd(o,n),o.collapse(!1),o.select();var d=this.getRangeObject(e);d.moveToElementText(f),d.collapse(),rw_moveEnd(d,i),d.collapse(!1),o.setEndPoint("EndToEnd",d)}else o=null;return o}},{key:"rw_collapseSelection",value:function(){var e=this.getSelectionObject();null!=e&&(e.collapseToStart?e.collapseToStart():e.execCommand&&e.execCommand("UnSelect",!1,null))}},{key:"getSelectionObject",value:function(){var e=null;if(window.getSelection){return null}else if(document.selection){var t=document.selection.createRange();if(t.text.length>0)theWindow=window,e=t;else{var n=this.getFrameSelectionOldIE(window);n.theRange&&(e=n.theRange)}}return e}},{key:"getFrameSelectionOldIE",value:function(e){var t,n={};if(e.frames&&e.length>0){var r,i=e.length;for(r=0;r<i;r++)try{var o=e[r];if(null!=(t=o.document.selection.createRange())&&null!=t.text&&t.text.length>0){n.theWindow=o,n.theRange=t;break}if(o.length>0){var a=this.getFrameSelectionOldIE(o);if(a.theRange){n=a;break}}}catch(e){}}return n}},{key:"getFrameSelectionSFF",value:function(e){var t={},n=this.getFrameSelection(e);return null!=n&&(t.theWindow=n,t.foundSel=n.getSelection()),t}},{key:"getFrameSelection",
value:function(e){if(e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{var r=e[t].getSelection();if(null!=r&&!r.isCollapsed)return e[t];if(e[t].length>0){var i=this.getFrameSelection(e[t]);if(i)return i}}catch(e){}}return null}}]),e}()},{"../../Constants/Constants":1,"../MathJax/MathSpeak":16,"../THCaret":31,"../THCaretRange":32,"../THDomRefPt":34,"../THRange":35,"../Utilities/Utilities":38,"./Attribute":2,"./DomNavigation":3,"./DomSentences":4}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=null;n.EventBus=function(){function e(){return r(this,e),o||(o=this),this.events=new Array,o}return i(e,[{key:"unSubscribe",value:function(e,t){for(var n=0;n<this.events.length;n++)this.events[n].event==e&&this.events[n].callback==t&&this.events.splice(n,1)}},{key:"subscribe",value:function(e,t){this.events.push({event:e,callback:t})}},{key:"publish",value:function(e,t){for(var n=0;n<this.events.length;n++)this.events[n].event==e&&this.events[n].callback(t)}}]),e}()},{}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.HighlightBaseController=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../DOM/SSDOM"),a=e("../THReturnObject"),l=e("../Utilities/Utilities"),s=e("../DOM/DomNavigation"),u=e("../DOM/Attribute"),c=e("../../Constants/Constants"),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(c);n.HighlightBaseController=function(){function e(){r(this,e)}return i(e,[{key:"highlightRange",value:function(){}},{key:"unHighlightRange",value:function(){}},{key:"rw_setNodeBackground",value:function(e,t,n,r,i){var c=new o.SSDOM,f=new u.Attribute,d=new s.DomNavigation,g=new a.THReturnObject;if(g.node=e,g.offset=t,3!=e.nodeType){if(1==e.nodeType&&c.isSpecialCaseHighlightable(e)){if("math"==e.tagName.toLowerCase()){var v=e.parentNode;g=rw_setNodeBackgroundImpl(v,e,t,n,r,"")}else if(e.isMathJax){var v=e.parentNode;g=rw_setNodeBackgroundImpl(v,e,t,n,r,"")}else{var p=d.getFirstChildTextNode(e,!1),m=d.getLastChildTextNode(e,!1);null!=p&&3==p.nodeType&&null!=m&&3==m.nodeType&&(this.rw_setSpeechRangeImpl(p,0,m,m.nodeValue.length,r),g.node=p,g.offset=0)}return g}return g}if(3==e.nodeType){var y=e.nodeValue,w=new l.Utilities;if(y=w.trim(y),0==y.length){var T=e.parentNode;if(null!=T){var b=w.trim(T.tagName).toLowerCase();if("tr"==b||"table"==b)return g}}}var v=e.parentNode,S=null;if(v.tagName.toLowerCase()==h.HIGHLIGHT_TAG&&(S=f.rw_getAttribute(v,"rwstate")),"spell"==r){if(null!=S&&""!=S)return g;g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,i)}else if("hom"==r){if(null!=S&&""!=S)return g;g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,i)}else if("grammar"==r){if(null!=S&&""!=S)return g;g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,i)}else if("ss"==r){if(null!=S&&""!=S)return g;g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,i)}else if("sp"==r){if("csp"==S)return g;if("sp"==S)return g;g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,"")}else if("csp"==r){if("csp"==S)return g;"sp"==S&&(g=this.rw_setNodeBackgroundImpl(v,e,t,n,r,""))}return g}},{key:"rw_setNodeBackgroundImpl",value:function(e,t,n,r,i,l){var s=(new o.SSDOM,new u.Attribute),c="sp"===i||"csp"===i,f="";if(1==t.nodeType&&(f=t.tagName.toLowerCase()),3==t.nodeType&&(-1==r||r>n)||"math"==f||t.isMathJax){var d;if(d="ss"==i?"strikethrough"==l?"text-decoration:line-through":"background:"+l:"sp"==i?h.SPEECH_RANGE_COLOUR:"csp"==i?h.SPEECH_WORD_COLOUR:"spell"==i?"":"hom"==i?"":"grammar"==i?"":"color:#ff000; background:#00ff00","math"==f||t.isMathJax)c&&this.rw_highlightMathElement(t,i,d,!0);else{var g=t.nodeValue.length;if(1==g&&("\n"==t.nodeValue||"\r"==t.nodeValue)||2==g&&"\r\n"==t.nodeValue){var v=new a.THReturnObject;return v.node=t,v.offset=n<0?0:n,v}var p=e.ownerDocument,m=!1;-1==n&&-1==r?m=!0:-1==r&&(r=g),0==n&&r>=g&&(m=!0);var y=p.createElement(h.HIGHLIGHT_TAG);if("spell"==i&&(rw_setAttribute(y,"spellnum",l),y.className="thspell"),"grammar"==i){rw_setAttribute(y,"grammarnum",l),y.className="thgrammar"}if(m)y.setAttribute("style",d),s.rw_setAttribute(y,"rwstate",i),c&&s.rw_setAttribute(y,"started","1"),e.replaceChild(y,t),y.appendChild(t);else{var w,T,b,S=t.nodeValue;"span"==e.tagName.toLowerCase()&&null!=s.rw_getAttribute(e,"pron")?(w="",T=S,b=""):(w=S.substring(0,n),T=S.substring(n,r),b=S.substring(r)),y.setAttribute("style",d),s.rw_setAttribute(y,"rwstate",i),c&&s.rw_setAttribute(y,"started","1");var C,_=null,x=null;w.length>0&&(_=p.createTextNode(w)),C=p.createTextNode(T),b.length>0&&(x=p.createTextNode(b)),y.appendChild(C),e.replaceChild(y,t),null!=_&&e.insertBefore(_,y),null!=x&&(null==y.nextSibling?e.insertBefore(x,null):e.insertBefore(x,y.nextSibling)),t=C}}}var v=new a.THReturnObject;return v.node=t,v.offset=n<0?0:n,v}},{key:"rw_highlightMathElement",value:function(e,t,n,r){var i=(new o.SSDOM,new u.Attribute);if(null!=e)for(var a=(h.HIGHLIGHT_TAG,e.firstChild);null!=a;)1==a.nodeType&&(r?null!=i.rw_getAttribute(a,"started")?(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t)):null==i.rw_getAttribute(a,"style")&&(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t),i.rw_setAttribute(a,"started","1")):null!=i.rw_getAttribute(a,"started")&&(a.removeAttribute("style"),i.rw_removeAttribute(a,"started"),i.rw_removeAttribute(a,"rwstate"))),a=a.nextSibling}},{key:"getListOfHighlightableNodes",value:function(e,t){var n=(new o.SSDOM,new s.DomNavigation),r=new Array;try{var i=e.node,a=t.node;if(3!=i.nodeType)if(1==i.nodeType&&"math"==i.tagName.toLowerCase()){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(g_bIE&&1==i.nodeType&&null!=i.firstChild&&1==i.firstChild.nodeType&&"math"==i.firstChild.tagName.toLowerCase()){if(r.push(i.firstChild),i==a)return r;i=i.firstChild,i=n.getNextTextNode(i,!1,a)}else if(1==i.nodeType&&i.isMathJax){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(g_bIE&&1==i.nodeType&&null!=i.firstChild&&i.firstChild.isMathJax){if(r.push(i.firstChild),i==a)return r;i=i.firstChild,i=n.getNextTextNode(i,!1,a)}else if(null==(i=n.getFirstChildTextNode(i,!1)))return r;if(i==a){if(3==i.nodeType){var l=i.nodeValue;l.length>0&&e.offset<l.length&&t.offset>0&&t.offset>e.offset&&r.push(i)}}else{if(3==i.nodeType){var l=i.nodeValue;l.length>0&&e.offset<l.length&&r.push(i)}else 1==i.nodeType&&"math"==i.tagName.toLowerCase()?r.push(i):1==i.nodeType&&i.isMathJax&&r.push(i);for(var u=n.getNextTextNodeNoImg(i,!1,a,!0);null!=u;){if(u==a){if(3==a.nodeType){var l=a.nodeValue;l.length>0&&t.offset>0&&r.push(a)}else 1==u.nodeType&&"math"==u.tagName.toLowerCase()?r.push(u):1==u.nodeType&&u.isMathJax&&r.push(u);break}r.push(u),u=n.getNextTextNodeNoImg(u,!1,a,!0)}}}catch(e){}return r}}]),e}()},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THReturnObject":36,"../Utilities/Utilities":38}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.MathJaxHighlightController=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../MathJax/MathJaxHighlighter");n.MathJaxHighlightController=function(){function e(t){r(this,e),this.m_setupHash={},this.m_defaultContextBg={r:255,g:255,b:0},this.m_defaultContextFg={r:0,g:0,b:0},this.m_defaultWordBg={r:0,g:0,b:255},this.m_defaultWordFg={r:255,g:255,b:255},this.m_contextBg={r:255,g:255,b:0},this.m_contextFg={r:0,g:0,b:0},this.m_wordBg={r:0,g:0,b:255},this.m_wordFg={r:255,g:255,b:255},this.m_strContextStyle="highlight",this.m_strWordStyle="highlight",this.sentence=t,this.lastMathId=null}return i(e,[{key:"highlight",value:function(e){try{var t=this.sentence.m_range.body.ownerDocument.getElementById(e),n=this.getJaxFor(t);this.h=new o.MathJaxHighlighter(n),"highlight"===this.m_strContextStyle?(this.h.setHighlightStyle("context","bg",this.m_contextBg.r,this.m_contextBg.g,this.m_contextBg.b),this.h.setHighlightStyle("context","fg",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b)):"outline"===this.m_strContextStyle?this.h.setHighlightStyle("context","outline",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b):"underline"===this.m_strContextStyle&&this.h.setHighlightStyle("context","underline",this.m_contextFg.r,this.m_contextFg.g,this.m_contextFg.b),"highlight"===this.m_strWordStyle?(this.h.setHighlightStyle("word","bg",this.m_wordBg.r,this.m_wordBg.g,this.m_wordBg.b),this.h.setHighlightStyle("word","fg",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b)):"outline"===this.m_strWordStyle?this.h.setHighlightStyle("word","outline",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b):"underline"===this.m_strWordStyle&&this.h.setHighlightStyle("word","underline",this.m_wordFg.r,this.m_wordFg.g,this.m_wordFg.b)}catch(e){}}},{key:"highlightRange",value:function(){var e=this.sentence.getSpanId();try{this.lastMathId&&this.clearHighlights(),this.lastMathId=e,this.m_setupHash[e]||(this.highlight(e),this.m_setupHash[e]=!0);var t=this.sentence.m_range.body.ownerDocument.getElementById(e),n=this.getJaxFor(t),r=n.root.spanID?n.root.spanID:n.root.CHTMLnodeID;r=null!=r&&void 0!=r?r:n.root.PHTMLspanID,this.h.highlightNodes("context",r)}catch(e){}}},{key:"unHighlightRange",value:function(){try{var e=this.sentence.getSpanId(),t=this.sentence.m_range.body.ownerDocument.getElementById(e);this.getJaxFor(t),this.h.clearHighlights()}catch(e){}}},{key:"highlightWord",value:function(e){var t=this.sentence.getSpanId(e),n=this.sentence.getWordRange(e);try{this.m_setupHash[t]||(this.highlight(t),this.m_setupHash[t]=!0);var r=this.sentence.m_range.body.ownerDocument.getElementById(t);this.getJaxFor(r),this.h.highlightNodes("word",n)}catch(e){}}},{key:"setHighlightStyle",value:function(e,t,n,r){if(this.m_setupHash=[],"string"==typeof e){void 0===t&&(t="word");var i="undefined"==typeof p_rgb;"context"===t?(this.m_strContextStyle=e,"highlight"===e?(this.m_contextBg=i?this.m_defaultContextBg:r,this.m_contextFg=i?this.m_defaultContextFg:n):"outline"!==e&&"underline"!==e||(this.m_contextFg=i?this.m_defaultContextBg:n)):"word"===t&&(this.m_strWordStyle=e,"highlight"===this.m_strWordStyle?(this.m_wordBg=i?this.m_defaultWordBg:r,this.m_wordFg=i?this.m_defaultWordFg:n):"outline"!==e&&"underline"!==e||(this.m_wordFg=i?this.m_defaultWordBg:n))}}},{key:"getJaxFor",value:function(e){return e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e)}},{key:"checkText",value:function(e){for(var t,n,r=e.indexOf("<mtext>");r>-1&&(t=e.indexOf("</mtext>",r))>r;)n=e.substring(r+7,t),n=n.trimTH(),0==n.length?(e=e.substr(0,r)+e.substr(t+8),r=e.indexOf("<mtext>",r)):r=e.indexOf("<mtext>",t+8);for(r=e.indexOf("<mn>");r>-1&&(t=e.indexOf("</mn>",r))>r;)n=e.substring(r+4,t),n=n.trimTH(),0==n.length?(e=e.substr(0,r)+e.substr(t+5),r=e.indexOf("<mn>",r)):r=e.indexOf("<mn>",t+5);for(var t,n,r=e.indexOf("<mover>");r>-1&&(t=e.indexOf("</mover>",r))>r;)n=e.substring(r+7,t),n=n.trimTH(),0==n.length?(e=e.substr(0,r)+e.substr(t+8),r=e.indexOf("<mover>",r)):r=e.indexOf("<mover>",t+8);return e}}]),e}()},{"../MathJax/MathJaxHighlighter":15}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SpeechHighlightController=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../THCaretRange"),s=(e("../THReturnObject"),e("../DOM/SSDOM")),u=(e("../Utilities/Utilities"),e("../Sentence/SentenceObject"),e("../SpeechObject"),e("../ScrollInToView")),c=e("./HighlightBaseController"),h=e("../DOM/DomNavigation"),f=e("../DOM/Attribute"),d=e("../../Constants/Constants"),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(d);n.SpeechHighlightController=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.sentence=e,n}return o(t,e),a(t,[{key:"highlightRange",value:function(){var e=this.sentence.getRange();new s.SSDOM;try{if(null!=e){var t=new l.THCaretRange(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_setSpeechRangeImpl(n.node,n.offset,r.node,r.offset,"sp")}}catch(e){}}},{key:"unHighlightRange",value:function(){var e=this.sentence.getRange();new s.SSDOM;try{if(null!=e){var t=new l.THCaretRange(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(n,r),!1)}}catch(e){}}},{key:"highlightWord",value:function(e){if(e<this.sentence.getWords().length){if(new s.SSDOM,e>0){var t=this.sentence.getWordRange(e-1);if(null!=t){var n=new l.THCaretRange(t.body,t.startRef.path,t.startRef.offset,t.endRef.path,t.endRef.offset),r=n.leftCaret,i=n.rightCaret;null!=r&&null!=i&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(r,i),!0)}}var o=this.sentence.getWordRange(e);if(null!=o){var n=new l.THCaretRange(o.body,o.startRef.path,o.startRef.offset,o.endRef.path,o.endRef.offset),r=n.leftCaret,i=n.rightCaret,a=new u.ScrollInToView;if(null!=r&&null!=i){var c=this.rw_setSpeechRangeImpl(r.node,r.offset,i.node,i.offset,"csp");null!=c&&null!=c.node?a.rw_scrollToObject(c.node):a.rw_scrollToObject(r.node)}}}}},{key:"rw_removeSpeechHighlight",value:function(e,t){var n=new s.SSDOM;try{if(void 0===t&&(t=!1),null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsSpeechText(i,t)){var o=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var a=n.allTextFromNodeTH(o);i=o.ownerDocument.createTextNode(a)}o.parentNode.replaceChild(i,o),i=n.mergeTextNodes(i),e[r]=i,this.rw_checkNodeIsSpeechText(i,t)&&--r}else{var l="";1==i.nodeType&&(l=i.tagName.toLowerCase()),"math"==l&&this.rw_highlightMathElement(i,null,null,!1),i.isMathJax&&this.rw_highlightMathElement(i,null,null,!1)}}}catch(e){}}},{key:"rw_checkNodeIsSpeechText",value:function(e,t){var n=(new s.SSDOM,new f.Attribute);if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return!1;var r=e.parentNode,i=n.rw_getAttribute(r,"rwstate");return r.tagName.toLowerCase()==g.HIGHLIGHT_TAG&&null!=i&&(!t&&"sp"==i||"csp"==i)}},{key:"rw_setSpeechRangeImpl",value:function(e,t,n,r,i){var o=(new s.SSDOM,new h.DomNavigation),a=null;try{if(n==e)return a=this.rw_setNodeBackground(e,t,r,i,"");a=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,i,""):this.rw_setNodeBackground(e,-1,-1,i,"");for(var l=o.getNextTextNodeNoImg(a.node,!1,n,!0);null!=l;){if(l==n){a=this.rw_setNodeBackground(l,0,r,i,""),l=a.node;break}a=this.rw_setNodeBackground(l,-1,-1,i,""),l=a.node,l=o.getNextTextNodeNoImg(l,!1,n,!0)}}catch(e){}return a}}]),t}(c.HighlightBaseController)},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../ScrollInToView":22,"../Sentence/SentenceObject":28,"../SpeechObject":30,"../THCaretRange":32,"../THReturnObject":36,"../Utilities/Utilities":38,"./HighlightBaseController":7}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SpeechHighlightManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./SpeechHighlightController"),a=e("./MathJaxHighlightController");n.SpeechHighlightManager=function(){function e(t){r(this,e),t.isMathML()?this.highlightController=new a.MathJaxHighlightController(t):this.highlightController=new o.SpeechHighlightController(t)}return i(e,[{key:"highlightRange",value:function(){this.highlightController.highlightRange()}},{key:"unHighlightRange",value:function(){this.highlightController.unHighlightRange()}},{key:"highlightWord",value:function(e){this.highlightController.highlightWord(e)}}]),e}()},{"./MathJaxHighlightController":8,"./SpeechHighlightController":9}],11:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.StudySkillsHighlighting=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../DOM/SSDOM"),s=e("../THDomRange"),u=e("../THCaretRange"),c=(e("../THReturnObject"),e("../Utilities/Utilities")),h=e("./HighlightBaseController"),f=e("../DOM/DomNavigation"),d=e("../DOM/Attribute"),g=e("../../Constants/Constants"),v=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(g);n.StudySkillsHighlighting=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.g_aTextRange=new Array,e.g_aHighlightColour=new Array,e}return o(t,e),a(t,[{key:"fetchWords",value:function(){for(var e=new Array,t=new Array,n=this.g_aTextRange.length,r=0;r<n;r++){var i;i=this.g_aTextRange[r].toString(),-1==i.trimTH().indexOf(" ")?t.push(this.g_aTextRange.slice(r,r+1).pop()):this.m_bSentenceSelection=!0}t.sort(this.sortBySFF);for(var o,a=t.length,l=0;l<a;l++){o=t[l].toString(),o=o.trim();var s=".,?!";s=function(e){return e.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")}(s),o=o.replace(new RegExp("^["+s+"]+|["+s+"]+$","g"),""),e.push(o)}return e}},{key:"studySkillsCollateForColour",value:function(e){for(var t=new l.SSDOM,n=new Array,r=this.g_aTextRange.length,i=0;i<r;i++){this.g_aHighlightColour[i]==e&&n.push(this.g_aTextRange.slice(i,i+1).pop())}f?n.sort(this.sortBy):n.sort(this.sortBySFF);for(var o,a=n.length,s=new c.Utilities,u=new Array,i=0;i<a;i++){var h,f=!1;if(f){var d=n.slice(i,i+1).pop();h=t.rw_getTextRangeAsTHRange(d.parentElement().ownerDocument.body,d).rw_getTHCaretRangeFromTHRange()}else h=n[i].rw_getTHCaretRangeFromTHDomRange();o=h.getTextOverCaretRange(),o.length>0&&(o=s.rw_filterForHtml(o),u.push({color:e,text:o}))}return u}},{key:"studySkillsCollateForColour",value:function(e){for(var t=(new l.SSDOM,new Array),n=(new Array,[]),r=this.g_aTextRange.length,i=0,o=0;o<r;o++){var a=this.g_aHighlightColour[o];if(-1!=e.indexOf(a)){var s=this.g_aTextRange.slice(o,o+1).pop();s.color=a,t.push(s)}}t.sort(this.sortBySFF);for(var u,h=t.length,f=new c.Utilities,o=0;o<h;o++){var d,g=t[o].color;d=t[o].rw_getTHCaretRangeFromTHDomRange(),u=d.getTextOverCaretRange(),u.length>0&&(u=f.rw_filterForHtml(u),i++,n.push({text:u,color:g}))}return n}},{key:"sortBy",value:function(e,t){try{return e.compareEndPoints("EndToEnd",t)}catch(e){return 0}}},{key:"sortBySFF",value:function(e,t){try{if(e.equals(t))return 0;e.refresh(),t.refresh();var n=e.getEndAsRange(),r=t.getEndAsRange();return n.compareBoundaryPoints("END_TO_END",r)}catch(e){return 0}}},{key:"studySkillsHTMLHighlightRange",value:function(e,t){var n=new l.SSDOM;try{if(null==t||null==t.range||t.range instanceof String)return!1;var r=t.range;if(null==(r=this.rw_checkTHRangeForValidHighlight(r)))return!1;n.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e);var i=SpeechStream.analytics;return i.report(i.categories.HIGHLIGHT,e),!0}catch(e){return!1}}},{key:"studySkillsHTMLHighlightRangeImpl",value:function(e,t){try{var n=new l.SSDOM,r=!1,i=null,o=null,a=!0;if(null==e||e instanceof String)return;var s,u=0,c=!1;if(!e.toString)return;if(null==e||null==e.toString()||""==e.toString())return;for(var s=0;s<this.g_aTextRange.length;s++){var h=this.g_aTextRange[s];if(e.body.ownerDocument==h.body.ownerDocument){var f=e.compareRange(h);switch(f){case v.THDomRange_ERROR:window.status="Error occurred when trying to add a highlight.";break;case v.THDomRange_TARGET_SAME:case v.THDomRange_TARGET_INSIDE:h.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret)),this.g_aTextRange.splice(s,1),this.g_aHighlightColour.splice(s,1),--s,e.refresh(),c=!0;break;case v.THDomRange_TARGET_INCLUDES_THIS:case v.THDomRange_TARGET_INCLUDES_THIS_AT_START:case v.THDomRange_TARGET_INCLUDES_THIS_AT_END:this.g_aHighlightColour[s]==t?a=!1:(this.case1SFF(s,e,f),++s,c=!0);break;case v.THDomRange_OVERLAPS_START_OF_TARGET:this.case2SFF(s,e),c=!0;break;case v.THDomRange_OVERLAPS_END_OF_TARGET:this.case3SFF(s,e),c=!0;break;case v.THDomRange_AFTER_TARGET:break;case v.THDomRange_BEFORE_TARGET:}}c&&++u<100&&(s=-1)}if(a){if(e.execCommand)this.studySkillsClearRangeIE(e),this.rw_ieSpecificCallToSetHighlight(e,t);else{var d=e.startCaret,g=e.endCaret;this.rw_setHighlight(d.node,d.offset,g.node,g.offset,t)}this.g_aTextRange.push(e),this.g_aHighlightColour.push(t)}return n.rw_collapseSelection(),r&&(i.style.display=o),!0}catch(e){return!1}}},{key:"rw_setHighlight",value:function(e,t,n,r,i){var o=e,a=n,s=(new l.SSDOM,new f.DomNavigation);try{var u=null;if(n==e)u=this.rw_setNodeBackground(e,t,r,"ss",i),o=u.node,a=u.node;else{u=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,"ss",i):this.rw_setNodeBackground(e,-1,-1,"ss",i),o=u.node;for(var c=s.getNextTextNodeNoImg(u.node,!1,n,!0);null!=c;){if(c==n){u=this.rw_setNodeBackground(c,0,r,"ss",i),c=u.node,a=c;break}u=this.rw_setNodeBackground(c,-1,-1,"ss",i),c=u.node,a=c,c=s.getNextTextNodeNoImg(c,!1,n,!0)}}}catch(e){}return{start:o,end:a}}},{key:"rw_ieSpecificCallToSetHighlight",value:function(e,t){"strikethrough"==t?e.execCommand("strikethrough",!1,null):e.execCommand("backcolor",!1,t)}},{key:"studySkillsClearRangeIE",value:function(e){e.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&e.execCommand("RemoveFormat",!1,null)}},{key:"rw_removeHighlight",value:function(e){var t=new l.SSDOM,n=new d.Attribute;try{if(null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsHighlightedText(i)){var o=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var a=t.allTextFromNodeTH(o);i=o.ownerDocument.createTextNode(a)}o.parentNode.replaceChild(i,o),i=t.mergeTextNodes(i),e[r]=i}else{var s=this.rw_getNestedNodeForHighlightedText(i);null!=s&&(n.rw_removeAttribute(s,"rwstate"),s.removeAttribute("style"))}}}catch(e){}}},{key:"rw_getNestedNodeForHighlightedText",value:function(e){var t=(new l.SSDOM,new d.Attribute);if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return null;var n=v.HIGHLIGHT_TAG,r=e.parentNode,i=t.rw_getAttribute(r,"rwstate");if(r.tagName.toLowerCase()!=n||null==i||"ss"!=i){if(null!=t.rw_getAttribute(r,"rwthgen")){var o=r;for(i="1";null!=i;){if(o=o.parentNode,"ss"==t.rw_getAttribute(o,"rwState")&&o.tagName.toLowerCase()==n)return o;i=t.rw_getAttribute(o,"rwthgen")}}return null}return r}},{key:"rw_checkNodeIsHighlightedText",value:function(e){var t=(new l.SSDOM,new d.Attribute);if(null==e.parentNode||null==e.parentNode.parentNode)return!1;var n=e.parentNode,r=t.rw_getAttribute(n,"rwstate");return n.tagName.toLowerCase()==v.HIGHLIGHT_TAG&&null!=r&&"csp"!=r&&"sp"!=r||"thspell"==n.className||"thhom"==n.className||"thgrammar"==n.className}},{key:"rw_checkTHRangeForValidHighlight",value:function(e){var t=new l.SSDOM,n=new f.DomNavigation,r=e.startCaret,i=e.endCaret,o=!1;if(t.isInvalidNode(r.node)){if(r.node==i.node)return;var a=n.getNextTextNodeNoImg(r.node,!1,i.node,!1);if(null==a||t.isInvalidNode(a))return;r.node=a,r.offset=0,o=!0}var u=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length;if(u){for(o=!0;u;){if(r.node==i.node)return null;if(r.node=n.getNextTextNodeNoBlank(r.node,!1,i.node),null==r.node)return null;u=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length}r.offset=0}if(t.isInvalidNode(i.node)){if(r.node==i.node)return;var a=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1);if(null==a||t.isInvalidNode(a))return;i.node=a,i.offset=a.nodeValue.length,o=!0}if(u=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length){for(o=!0;u;){if(r.node==i.node)return null;if(i.node=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1),null==i.node)return null;u=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length}3==i.node.nodeType&&(i.offset=i.node.nodeValue.length)}return null==r.node||null==i.node?null:(o&&(e=new s.THDomRange(r.node,r.offset,i.node,i.offset)),e)}},{key:"studySkillsClearHighlights",value:function(e,t){try{var n=null;if(null!=t&&null!=t.range&&(n=t.range,t.frame),null!=n&&n instanceof String){var r=!1;if(null!=r&&(r.selectionStart=0,r.selectionEnd=0),r=null,!e)return;n=null}var i,o,a,o,s;if(null==n||e){if(!e){var i=!1;if(!i)return}var u=this.g_aTextRange;this.g_aTextRange=new Array,this.g_aHighlightColour=new Array;for(var c=new l.SSDOM,a=0;a<u.length;a++){var s=u[a];s.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(s.startCaret,s.endCaret))}}else{n.refresh();for(var o=0;o<this.g_aTextRange.length;o++){var h=this.g_aTextRange[o];if(n.body==h.body){var f=n.compareRange(h);switch(f){case v.THDomRange_ERROR:window.status="Error occurred when trying to remove a highlight.";break;case v.THDomRange_TARGET_SAME:case v.THDomRange_TARGET_INSIDE:h.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret)),this.g_aTextRange.splice(o,1),this.g_aHighlightColour.splice(o,1),--o,n.refresh();break;case v.THDomRange_TARGET_INCLUDES_THIS:case v.THDomRange_TARGET_INCLUDES_THIS_AT_START:case v.THDomRange_TARGET_INCLUDES_THIS_AT_END:this.case1SFF(o,n,f),++o;break;case v.THDomRange_OVERLAPS_START_OF_TARGET:this.case2SFF(o,n);break;case v.THDomRange_OVERLAPS_END_OF_TARGET:this.case3SFF(o,n);break;case v.THDomRange_AFTER_TARGET:break;case v.THDomRange_BEFORE_TARGET:}}}}c.rw_collapseSelection()}catch(e){}}},{key:"studySkillsHTMLRefreshRanges",value:function(){try{var e=null,t=!1,n=0;for(n=0;n<this.g_aTextRange.length;n++){e=this.g_aTextRange[n];try{null!=e.text&&""!=e.text||(e=null)}catch(t){e=null}null==e&&(this.g_aTextRange.splice(n,1),this.g_aHighlightColour.splice(n,1),t=!0,n--)}return t}catch(e){return!1}}},{key:"case1SFF",value:function(e,t,n){var r=(new l.SSDOM,this.g_aHighlightColour[e]),i=this.g_aTextRange[e];i.refresh();var o=i.startRef,a=t.startRef,c=t.endRef,h=i.endRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1);var f,d,g,p;if(n!=v.THDomRange_TARGET_INCLUDES_THIS_AT_START){var m=new u.THCaretRange(t.body,o.path,o.offset,a.path,a.offset);f=m.leftCaret,d=m.rightCaret,g=this.rw_setHighlight(f.node,f.offset,d.node,d.offset,r),p=new s.THDomRange(g.start,0,g.end,g.end.nodeValue.length),this.g_aTextRange.push(p),this.g_aHighlightColour.push(r)}n!=v.THDomRange_TARGET_INCLUDES_THIS_AT_END&&(m=new u.THCaretRange(t.body,c.path,c.offset,h.path,h.offset),f=m.leftCaret,d=m.rightCaret,g=this.rw_setHighlight(f.node,f.offset,d.node,d.offset,r),p=new s.THDomRange(g.start,0,g.end,g.end.nodeValue.length),this.g_aTextRange.push(p),this.g_aHighlightColour.push(r)),t.refresh()}},{key:"case2SFF",value:function(e,t){var n=(new l.SSDOM,this.g_aHighlightColour[e]),r=this.g_aTextRange[e];r.refresh();var i=t.endRef,o=r.endRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(r.startCaret,r.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1);var a=new u.THCaretRange(t.body,i.path,i.offset,o.path,o.offset),c=a.leftCaret,h=a.rightCaret,f=this.rw_setHighlight(c.node,c.offset,h.node,h.offset,n),d=new s.THDomRange(f.start,0,f.end,f.end.nodeValue.length);this.g_aTextRange.push(d),this.g_aHighlightColour.push(n),t.refresh()}},{key:"case3SFF",value:function(e,t){var n=(new l.SSDOM,this.g_aHighlightColour[e]),r=this.g_aTextRange[e];r.refresh();var i=r.startRef,o=t.startRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(r.startCaret,r.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1);var a=new u.THCaretRange(t.body,i.path,i.offset,o.path,o.offset),c=a.leftCaret,h=a.rightCaret,f=this.rw_setHighlight(c.node,c.offset,h.node,h.offset,n),d=new s.THDomRange(f.start,0,f.end,f.end.nodeValue.length);this.g_aTextRange.push(d),this.g_aHighlightColour.push(n),t.refresh()}}]),t}(h.HighlightBaseController)},{"../../Constants/Constants":1,"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THCaretRange":32,"../THDomRange":33,"../THReturnObject":36,"../Utilities/Utilities":38,"./HighlightBaseController":7}],12:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ElementHelper=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./LoopState");n.ElementHelper=function(){function e(){r(this,e)}return i(e,[{key:"isTokenType",value:function(e){return"entity"==e||"char"==e||"entities"==e||"chars"==e}},{key:"looper",value:function(e,t,n){if(null!=e){var r=e.spanID?e.spanID:e.CHTMLnodeID;if(null!=(r=null!=r&&void 0!=r?r:e.PHTMLspanID)&&r==t)return n.pushToList(e),++n.count,!0;if(null!=e.data)for(var i=0;i<e.data.length;i++){var o=this.looper(e.data[i],t,n);if(o)return o}}return!1}},{key:"getList",value:function(e,t){var n=new o.LoopState;return this.looper(e,t,n),n.getList()}}]),e}()},{"./LoopState":14}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),
n.HighlightData=function e(){r(this,e),this.style=null,this.fg=null,this.bg=null,this.lastSpanId=0}},{}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.LoopState=function(){function e(){r(this,e),this.count=1,this.list=[]}return i(e,[{key:"pushToList",value:function(e){this.list.push(e)}},{key:"getList",value:function(){return this.list}}]),e}()},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.MathJaxHighlighter=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./HighlightData"),a=e("./ElementHelper"),l=e("../DOM/SSDOM");n.MathJaxHighlighter=function(){function e(t){r(this,e),this.highlightDataStore={},this.highlightJaxRoot=t.root,this.highlightClearLast=!0,this.elementHelper=new a.ElementHelper}return i(e,[{key:"setClearLastHighlight",value:function(e){this.highlightClearLast=e}},{key:"setHighlightStyle",value:function(e,t,n,r,i){if("string"!=typeof e)return!1;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)){var a=this.highlightDataStore[e];a&&a.lastSpanId>0&&this.clearHighlightNodesImpl(e,a.style,a.lastSpanId)}if(null===t)return delete this.highlightDataStore[e],!0;if("string"!=typeof t)return!1;if(""===(t=t.toLowerCase())||"none"===t)return delete this.highlightDataStore[e],!0;var l,s,u;try{l=this.parseColor(n),s=this.parseColor(r),u=this.parseColor(i)}catch(e){return!1}var c;return this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)?(c=this.highlightDataStore[e],"highlight"!==c.style&&(c.fg=null,c.bg=null)):c=new o.HighlightData,"fg"===t?(c.style="highlight",c.fg="rgb("+l+","+s+","+u+")"):"bg"===t?(c.style="highlight",c.bg="rgb("+l+","+s+","+u+")"):"outline"===t?(c.style=t,c.fg="rgb("+l+","+s+","+u+")",c.bg=null):"underline"===t&&(c.style=t,c.fg="rgb("+l+","+s+","+u+")",c.bg=null),this.highlightDataStore[e]=c,!0}},{key:"highlightNodes",value:function(e,t){var n;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)&&(n=this.highlightDataStore[e],null!==n.style)){n.lastSpanId>0&&this.highlightClearLast&&this.clearHighlightNodesImpl(e,n.style,n.lastSpanId),n.lastSpanId=t;var r=this.elementHelper.getList(this.highlightJaxRoot,t);this.highlightImpl(r,e,n.style,n.fg,n.bg)}}},{key:"clearHighlights",value:function(){for(var e in this.highlightDataStore)if(this.highlightDataStore.hasOwnProperty(e)){var t=this.highlightDataStore[e];this.clearHighlightNodesImpl(e,"",t.lastSpanId),t.lastSpanId=0}}},{key:"clearHighlightNodes",value:function(e,t){this.clearHighlightNodesImpl(e,"",t)}},{key:"parseColor",value:function(e){var t;if("string"==typeof e)t=parseInt(e,10);else{if("number"!=typeof e)throw"invalid";t=e}if(t<0||t>255)throw"invalid";return t}},{key:"clearHighlightNodesImpl",value:function(e,t,n){for(var r=this.elementHelper.getList(this.highlightJaxRoot,n),i=0,o=r.length;i<o;i++){var a=r[i];if(""!==t&&"outline"!==t||delete a.mathoutline,""===t||"underline"===t)if(a.previousline){this.removeFromPrevious(a.previousline,e);var l=a.previousline.length;a.mathunderline=l>0?a.previousline[l-1].val:""}else a.mathunderline="";if(""===t||"highlight"===t){if(a.previouscolor){this.removeFromPrevious(a.previouscolor,e);var l=a.previouscolor.length;a.mathcolor=l>0?a.previouscolor[l-1].val:""}else a.mathcolor=" ";delete a.mathbackground}var s=null;try{s=a.HTMLspanElement()}catch(e){}if(null==s)try{s=a.CHTMLnodeElement()}catch(e){}if(null==s)return;var u=!0;if(void 0!=a.HTMLremoveColor&&(u=this.setupPostFix(s,e,!0)),u)try{a.HTMLhandleColor(s)}catch(e){a.PHTMLhandleColor(s)}this.setdownPostFix(s);var u=!0;if(void 0!=a.HTMLremoveColor&&(u=this.setupPostFix(s,e,!1)),u)if(void 0!=a.HTMLremoveColor)a.HTMLremoveColor();else{var c;try{c=a.HTMLspanElement()}catch(e){c=a.CHTMLnodeElement()}null!=c&&(c.style.background="",c.style.color="")}if(this.setdownPostFix(s),void 0!=a.HTMLremoveColor){var c;try{c=a.HTMLspanElement()}catch(e){c=a.CHTMLnodeElement()}null!=c&&(c.style.background="",c.style.color="")}}}},{key:"highlightImpl",value:function(e,t,n,r,i){for(var o=0,a=e.length;o<a;o++){var s=e[o];if("function"==typeof(s.HTMLhandleColor?s.HTMLhandleColor:s.CHTMLhandleColor)){var u=null;try{u=s.CHTMLnodeElement()}catch(e){}if(null==u)try{u=s.HTMLspanElement()}catch(e){}if(null==u)return;if("highlight"===n){if(null!=i&&(s.mathbackground=i),null!=r){if(s.previouscolor)this.removeFromPrevious(s.previouscolor,t);else if(s.previouscolor=[],s.mathcolor)s.previouscolor.push({key:"",val:s.mathcolor});else{var c=new l.SSDOM,h=c.getComputedStyle(u);h.color}s.previouscolor.push({key:t,val:r}),s.mathcolor=r}}else"outline"===n?s.mathoutline=r+"thin solid":"underline"===n&&(s.previousline?this.removeFromPrevious(s.previousline,t):(s.previousline=[],s.textDecoration&&s.previousline.push({key:"",val:s.textDecoration})),s.previousline.push({key:t,val:"underline"}),s.mathunderline="underline");if(this.setupPostFix(u,t,!0))try{s.HTMLhandleColor(u)}catch(e){s.PHTMLhandleColor(u)}this.setdownPostFix(u)}}}},{key:"removeFromPrevious",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}},{key:"setupPostFix",value:function(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var o=e.id+r.idPostfix+i;if(null!=document.getElementById(o))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}},{key:"setdownPostFix",value:function(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}}]),e}()},{"../DOM/SSDOM":5,"./ElementHelper":12,"./HighlightData":13}],16:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.MathSpeak=function(){function e(){r(this,e),sre.System.getInstance().setupEngine({semantics:!1,domain:"mathspeak",style:"default"}),this.instance=sre.System.getInstance()}return i(e,[{key:"getTextFromMathJax",value:function(e){if(e.isMathJax){for(var t=e;null!=t&&t.isMathJax&&!t.id;)t=t.parentNode;var n;n=t&&t.id?"math:"+t.id+";":"math:none;"}var r=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e);if(null!=r){var i=null;try{if(null!=(i=r.root.toMathML(""))||i.length>0)return n+i}catch(e){}return""}return""}},{key:"getSpeech",value:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null!=t&&1==t.isMathJax){var n=this.getMathMLText(e),r=this.getMathMLObject(e);return n=n.replace(/<\/([^>]+)/g,"</mathml:$1>"),n=n.replace(/<([^>]+)/g,"<mathml:$1>"),this.instance.processExpression(this.getMathMLWithBookmarks(r,n,!1))}}return""}},{key:"getSpeechWithBookmarks",value:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null!=t&&1==t.isMathJax){var t=document.getElementById(e),n=this.getMathMLText(e),r=this.getMathMLObject(e);return this.instance.processExpression(this.getMathMLWithBookmarks(r,n,!0))}}return""}},{key:"getSpeechWithBookmarksFromElement",value:function(e){if(null!=e&&1==e.isMathJax){var t="";try{var n=this.getMathMLText(e),r=this.getMathMLObject(e),i=this.getMathMLWithBookmarks(r,n,!0);""!=i&&(t=this.instance.processExpression(i))}catch(e){}return t}return""}},{key:"getMathMLOriginalText",value:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null!=t&&1==t.isMathJax){var t=document.getElementById(e);return t.ownerDocument.defaultView.MathJax.Hub.getJaxFor(t).originalText}}return""}},{key:"getMathMLText",value:function(e){if(null!=e&&1==e.isMathJax){var t=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root.toMathML(),n=new DOMParser,r=n.parseFromString(t,"text/xml");if("parsererror"==r.documentElement.nodeName||"parsererror"==r.documentElement.firstChild.nodeName)throw console.error("Mathml is invalid, Please contact page provider"),"Mathml is invalid, Please contact page provider";return t}return""}},{key:"getMathMLObject",value:function(e){return null!=e&&1==e.isMathJax?e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root:""}},{key:"isMathML",value:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null!=t&&1==t.isMathJax)return!0}return!1}},{key:"getMathMLWithBookmarks",value:function(e,t,n){if(null!=t&&(t=t.replace(/<mathml:math.*>/,'<math xmlns="http://www.w3.org/1998/Math/MathML">')),void 0!=e.data)for(var r=0;r<e.data.length;r++)if(null!=e.data[r]){var i=e.data[r].spanID?e.data[r].spanID:e.data[r].CHTMLnodeID;if(i=null!=i&&void 0!=i?i:e.data[r].PHTMLspanID,e.data[r].toMathML&&e.data[r].toMathML()&&void 0!=i&&void 0!=e.data[r].data[0]&&void 0!=e.data[r].data[0].data[0]&&void 0==e.data[r].data[0].data[0].toMathML){var o=e.data[r].toMathML();if(n)var a=o.replace(">",' bookmark ="'+i+'">');else var a=o.replace(">",' nobookmark ="">');t=t.replace(o,a)}t=this.getMathMLWithBookmarks(e.data[r],t,n)}return t}},{key:"getMathMLTextWithBookmarks",value:function(e){if("string"==typeof e){var t=document.getElementById(e);if(null!=t&&1==t.isMathJax){var t=document.getElementById(e),n=this.getMathMLText(e),r=this.getMathMLObject(e);return this.getMathMLWithBookmarks(r,n,!0)}}return""}}]),e}()},{}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.PredictionBaseClass=function(){function e(){r(this,e),this.curser=0,this.controlEdit=null,this.curser=0,this.currentChar=null,this.properties=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"]}return i(e,[{key:"setEditControl",value:function(e){this.controlEdit=e}},{key:"isEditable",value:function(){return!1}},{key:"getPositionOfPopup",value:function(){return{top:-100,left:-100}}}]),e}()},{}],18:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.PredictionEditableDiv=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./PredictionBaseClass");n.PredictionEditableDiv=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),a(t,[{key:"setEditControl",value:function(e){this.controlEdit=e,this.sel=window.getSelection(),this.curser=this.getCaretPosition(e),this.currentChar=this.getCurrentCharacter()}},{key:"getCaretPosition",value:function(e){var t,n,r=0;if(window.getSelection)t=window.getSelection(),t.rangeCount&&(n=t.getRangeAt(0),n.commonAncestorContainer.parentNode==e&&(r=n.endOffset));else if(document.selection&&document.selection.createRange&&(n=document.selection.createRange(),n.parentElement()==e)){var i=document.createElement("span");e.insertBefore(i,e.firstChild);var o=n.duplicate();o.moveToElementText(i),o.setEndPoint("EndToEnd",n),r=o.text.length}return r}},{key:"isEditable",value:function(){return void 0!==this.controlEdit&&void 0!==this.controlEdit.contentEditable&&("true"==this.controlEdit.contentEditable||1==this.controlEdit.contentEditable)}},{key:"getSentence",value:function(){var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){var n=e.getRangeAt(0);e.collapseToStart(),32==this.currentChar.charCodeAt(0)||this.currentChar.charCodeAt(0),e.modify("extend","backward","sentenceboundary"),t=e.toString(),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return t}},{key:"getPositionOfPopup",value:function(){var e=this.controlEdit;if(void 0===e)return{top:-100,left:-100};var t=getComputedStyle(e).getPropertyValue("font-size"),n=this.getCaretCoordinates(e,this.curser);this.sel=window.getSelection(),this.curser=this.sel.extentOffset;var r={x:0,y:0};return this.GetOffset(e,r),{top:r.y-e.scrollTop+n.top+parseInt(t)+4+"px",left:r.x-e.scrollLeft+n.left+10+"px"}}},{key:"GetOffset",value:function(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,this.GetOffset(e.offsetParent,t))}},{key:"getCaretCoordinates",value:function(e,t){var n=document.getElementById(e.nodeName+"--mirror-div");n||(n=document.createElement("div"),n.id=e.nodeName+"--mirror-div",document.body.appendChild(n));var r=n.style,i=getComputedStyle(e);r.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.top=e.offsetTop+parseInt(i.borderTopWidth)+"px",r.left="400px",r.visibility="hidden",this.properties.forEach(function(e){r[e]=i[e]}),r.overflow="hidden",n.textContent=e.textContent.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var o=document.createElement("span");return o.textContent=e.textContent.substring(t)||".",o.style.backgroundColor="lightgrey",n.appendChild(o),{top:o.offsetTop+parseInt(i.borderTopWidth),left:o.offsetLeft+parseInt(i.borderLeftWidth)}}},{key:"setSelectionRange",value:function(e,t,n){"#text"!=e.nodeName&&(e=e.childNodes[0]);var r=document.createRange();r.setStart(e,t),r.setEnd(e,n);var i=window.getSelection();i.removeAllRanges(),i.addRange(r)}},{key:"setCaretPosition",value:function(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}},{key:"insertText",value:function(e){var t=this.controlEdit;this.CurrentPosition=this.curser,this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(e),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(t,this.CurrentPosition),this.curser=this.CurrentPosition}},{key:"getCurrentCharacter",value:function(){return this.controlEdit.innerHTML.charAt(this.curser-1)}},{key:"replaceSelectedText",value:function(e){var t,n;e+=" ";var r=0;if(window.getSelection){t=window.getSelection();var i=this.controlEdit;if(this.curser>0)switch(this.currentChar.charCodeAt(0)){case 46:case 33:case 63:e=" "+e;case 32:case 160:break;case 38:t.collapseToStart(),t.modify("move","backward","character"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();" "==o?(t.modify("move","forward","character"),t.modify("extend","forward","character")):(t.modify("move","backward","word"),t.modify("extend","forward","word"));break;case 45:t.collapseToStart(),t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","word");break;default:t.collapseToStart(),t.modify("move","backward","word"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();if("-"==o?(t.modify("extend","backward","character"),t.modify("move","forward","character"),t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","word")):32==o.charCodeAt(0)&&t.modify("move","forward","character"),t.modify("extend","forward","word"),o=t.toString(),"-"==o.substr(o.length-1,1)&&t.modify("extend","forward","word"),o=t.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==o.substr(o.length-1,1)&&(t.modify("extend","backward","character"),e=e.trim(),r++),o=t.toString();var a=/^[0-9a-zA-Z]+$/;o.substr(o.length-1,1).match(a)||(t.modify("extend","backward","character"),e=e.trim(),r++)}}var l=i.textContent,s=this.sel.baseOffset,u=this.sel.extentOffset;if(-1!=navigator.appVersion.indexOf("Win"));else switch(l.slice(u).substr(0,1)){case" ":e=e.trim(),r++;break;case";":case":":case"!":case".":e=e.trim(),r++,r++}i.textContent=l.slice(0,s)+e+l.slice(u),this.CurrentPosition=s+e.length+r}else document.selection&&document.selection.createRange&&(n=document.selection.createRange(),n.text=e)}},{key:"getSelection",value:function(){var e,t=this.controlEdit;if(void 0!=document.selection){t.focus();e=document.selection.createRange().text}else if(void 0!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}]),t}(l.PredictionBaseClass)},{"./PredictionBaseClass":17}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PredictionManager=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./PredictionTextArea");e("./PredictionEditableDiv"),e("./PredictionBaseClass"),n.PredictionManager=function(){function e(){r(this,e),this.predictionManager=null}return i(e,[{key:"getPredictionCoordinates",value:function(){return null!=this.predictionManager?this.predictionManager.getPositionOfPopup():{top:-1e3,left:-1e3}}},{key:"getPredictionSentence",value:function(){return null!=this.predictionManager?this.predictionManager.getSentence():null}},{key:"predictionInsertText",value:function(e){null!=this.predictionManager&&this.predictionManager.insertText(e)}},{key:"isEditable",value:function(){return null!=this.predictionManager&&this.predictionManager.isEditable()}},{key:"onMouseDown",value:function(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}},{key:"onKeyDown",value:function(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}},{key:"predictionFactory",value:function(e){var t=e.target;("TEXTAREA"==t.nodeName||"INPUT"==t.nodeName&&"text"==t.type.toLowerCase())&&(this.predictionManager=new o.PredictionTextArea)}}]),e}()},{"./PredictionBaseClass":17,"./PredictionEditableDiv":18,"./PredictionTextArea":20}],20:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.PredictionTextArea=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./PredictionBaseClass"),s=e("./textareaCaretPosition");n.PredictionTextArea=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),a(t,[{key:"setEditControl",value:function(e){("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName&&"text"==e.type.toLowerCase())&&(this.controlEdit=e,this.curser=e.selectionEnd,this.startSelection=e.selectionStart,this.currentChar=this.getCurrentCharacter(),e.setSelectionRange(this.startSelection,this.curser))}},{key:"isEditable",value:function(){return void 0!==this.controlEdit&&("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase())&&this.curser==this.startSelection}},{key:"getSentence",value:function(){try{this.curser=this.controlEdit.selectionEnd,this.startSelection=this.controlEdit.selectionStart}catch(e){}var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){this.controlEdit.focus(),this.controlEdit.setSelectionRange(this.startSelection,this.startSelection);var n=e.getRangeAt(0);32==this.currentChar.charCodeAt(0)||this.currentChar.charCodeAt(0),e.modify("extend","backward","sentenceboundary"),t=e.toString();new RegExp("[.?!]").test(t.slice(-1))&&(t=t.slice(0,t.length-1)),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return this.controlEdit.setSelectionRange(this.startSelection,this.curser),t}},{key:"getPositionOfPopup",value:function(){var e=this.controlEdit;if(void 0===e)return{top:-100,left:-100};var t=getComputedStyle(e).getPropertyValue("font-size");if("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase()){var n=new s.textareaCaretPosition,r=n.getCaretCoordinates(e,e.selectionEnd);this.curser=e.selectionEnd;var i={x:0,y:0};this.GetOffset(e,i);return{top:i.y-e.scrollTop+r.top+parseInt(t)+4+"px",left:i.x-e.scrollLeft+r.left+10+"px"}}return{top:-100,left:-100}}},{key:"GetOffset",value:function(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,this.GetOffset(e.offsetParent,t))}},{key:"setSelectionRange",value:function(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}else e.focus()}},{key:"setCaretPosition",value:function(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}},{key:"insertText",value:function(e){var t=this.controlEdit;if("DIV"==t.tagName){t.focus();var n=document.getElementById("rwPredictionPosition");this.setCaretPositionDiv(currentContextControlID),this.setSelectionRange(t,n.value,n.value),this.currentChar=this.getCurrentCharacter(),this.replaceSelectedText(e)}else this.CurrentPosition=t.selectionStart,this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(e),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(t,this.CurrentPosition);return!1}},{key:"getCurrentCharacter",value:function(){var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){var n=e.getRangeAt(0);e.modify("move","backward","character"),e.modify("extend","forward","character"),t=e.toString(),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("word"),t=r.text}return t}},{key:"replaceSelectedText",value:function(e){var t,n;e+=" ";var r=0;if(window.getSelection){t=window.getSelection();var i=document.activeElement;if("TEXTAREA"==i.nodeName||"INPUT"==i.nodeName&&"text"==i.type.toLowerCase()){if(this.curser>0)switch(this.currentChar.charCodeAt(0)){case 32:case 160:e=e;break;case 46:case 33:case 63:e=e.trim()+this.currentChar+" ",t.modify("move","backward","character"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();" "==o?(t.modify("move","forward","character"),t.modify("extend","forward","character")):(t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","character"));break;case 10:e=e.trim()+" ";var o=t.toString();break;case 38:t.modify("move","backward","character"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();" "==o?(t.modify("move","forward","character"),t.modify("extend","forward","character")):(t.modify("move","backward","word"),t.modify("extend","forward","word"));break;case 45:t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","word");break;default:t.modify("move","backward","word"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();if("-"==o?(t.modify("extend","backward","character"),t.modify("move","forward","character"),t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","word")):32==o.charCodeAt(0)&&t.modify("move","forward","character"),t.modify("extend","forward","word"),o=t.toString(),"-"==o.substr(o.length-1,1)&&t.modify("extend","forward","word"),o=t.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==o.substr(o.length-1,1)&&(t.modify("extend","backward","character"),e=e.trim(),r++),o=t.toString();var a=/^[0-9a-zA-Z]+$/;o.substr(o.length-1,1).match(a)||(t.modify("extend","backward","character"),e=e.trim(),r++)}}var l=i.value,s=i.selectionStart,u=i.selectionEnd;if(-1!=navigator.appVersion.indexOf("Win"));else switch(l.slice(u).substr(0,1)){case" ":e=e.trim(),r++;break;case";":case":":case"!":case".":e=e.trim(),r++,r++}i.value=l.slice(0,s)+e+l.slice(u),this.CurrentPosition=s+e.length+r}else{var t=window.getSelection();if(this.setCaretPositionDiv(i),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0));else{t.modify("move","backward","word"),t.modify("move","backward","character"),t.modify("extend","forward","character");var o=t.toString();"-"==o?(t.modify("extend","backward","character"),t.modify("move","forward","character"),t.modify("move","backward","word"),t.modify("extend","forward","word"),t.modify("extend","forward","word")):32==o.charCodeAt(0)&&t.modify("move","forward","character"),t.modify("extend","forward","word")}t.rangeCount?(n=t.getRangeAt(0),n.deleteContents(),n.insertNode(document.createTextNode(e))):t.deleteFromDocument();var l=i.value,s=i.selectionStart,u=i.selectionEnd;i.value=l.slice(0,s)+e+l.slice(u),setCaretPositionDiv(i,s+e.length)}}else document.selection&&document.selection.createRange&&(n=document.selection.createRange(),n.text=e)}},{key:"getSelection",value:function(){var e,t=this.controlEdit;if(void 0!=document.selection){t.focus();e=document.selection.createRange().text}else if(void 0!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}]),t}(l.PredictionBaseClass)},{"./PredictionBaseClass":17,"./textareaCaretPosition":21}],21:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.textareaCaretPosition=function(){function e(){r(this,e),this.properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],this.isBrowser="undefined"!=typeof window,this.isFirefox=this.isBrowser&&null!=window.mozInnerScreenX}return i(e,[{key:"getCaretCoordinates",value:function(e,t,n){if(!this.isBrowser)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=n&&n.debug||!1;if(r){var i=document.querySelector("#input-textarea-caret-position-mirror-div");i&&i.parentNode.removeChild(i)}var o=document.createElement("div");o.id="input-textarea-caret-position-mirror-div",document.body.appendChild(o);var a=o.style,l=window.getComputedStyle?getComputedStyle(e):e.currentStyle;a.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(a.wordWrap="break-word"),a.position="absolute",r||(a.visibility="hidden"),this.properties.forEach(function(e){a[e]=l[e]}),this.isFirefox?e.scrollHeight>parseInt(l.height)&&(a.overflowY="scroll"):a.overflowY="auto",o.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(o.textContent=o.textContent.replace(/\s/g," "));var s=document.createElement("span");s.textContent=e.value.substring(t)||".",o.appendChild(s);var u={top:s.offsetTop+parseInt(l.borderTopWidth),left:s.offsetLeft+parseInt(l.borderLeftWidth)};return r?s.style.backgroundColor="#aaa":document.body.removeChild(o),u}}]),e}()},{}],22:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ScrollInToView=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./DOM/SSDOM"),a=e("./Events/EventBus");n.ScrollInToView=function(){function e(){r(this,e)}return i(e,[{key:"rw_scrollToObject",value:function(e){var t=new o.SSDOM,n=!1;try{var r=t.getWindow(e);if(null==r||null==e||null==e.parentNode)return;var i=0,l=0,s=e;3==s.nodeType&&(s=s.parentNode);for(var u=null,c=s,h=s.ownerDocument.body,f=null;null!=c&&c!=h;)"div"!=c.tagName.toLowerCase()&&"form"!=c.tagName.toLowerCase()||this.rw_isDivScrollable(c)&&(!0,u=this.rw_scrollToObjectDivCheck(s,c,u),f=c,s=c),c=c.parentNode;for(null!=f&&(s=f);null!=s;)i+=s.offsetLeft,l+=s.offsetTop,s=s.offsetParent;null!=u&&(l+=u.y,i+=u.x);var d,g,v,p,m=30;3==e.nodeType&&(m=10+5*e.nodeValue.length)>60&&(m=60),d=this.rw_getScreenOffsetLeft(r),g=this.rw_getScreenOffsetTop(r),"number"==typeof r.innerWidth?(v=r.innerWidth,
p=r.innerHeight):r.document.documentElement.clientHeight>0&&r.document.documentElement.clientWidth>0?(v=r.document.documentElement.clientWidth,p=r.document.documentElement.clientHeight):(v=r.document.body.clientWidth,p=r.document.body.clientHeight),v-=m,p-=20;var y,w;if(y=i<d||i>d+v,w=l<g||l>g+p,y||w&&(0!=i||0!=l)){i>d+v&&(i=(i+d)/2),l>g+p&&(l=(l+g)/2),n&&(n=!1);(new a.EventBus).publish("pauseHover",null),r.scrollTo(y?i:d,w?l:g)}}catch(e){}}},{key:"rw_getScreenOffsetLeft",value:function(e){return void 0===e&&(e=window),e.pageXOffset&&e.pageXOffset>0?e.pageXOffset:e.document.body.scrollLeft&&e.document.body.scrollLeft>0?e.document.body.scrollLeft:e.document.documentElement.scrollLeft&&e.document.documentElement.scrollLeft>0?e.document.documentElement.scrollLeft:0}},{key:"rw_getScreenOffsetTop",value:function(e){return void 0===e&&(e=window),e.pageYOffset&&e.pageYOffset>0?e.pageYOffset:e.document.body.scrollTop&&e.document.body.scrollTop>0?e.document.body.scrollTop:e.document.documentElement.scrollTop&&e.document.documentElement.scrollTop>0?e.document.documentElement.scrollTop:0}},{key:"rw_getScreenOffsetLeftAlt",value:function(e){return void 0===e&&(e=window),"CSS1Compat"==e.document.compatMode&&e.document.body.parentNode&&e.document.body.parentNode.scrollLeft?e.document.body.parentNode.scrollLeft:e.pageXOffset?e.pageXOffset:e.scrollX?e.scrollX:e.document.body.scrollLeft?e.document.body.scrollLeft:e.document.documentElement.scrollLeft?e.document.documentElement.scrollLeft:0}},{key:"rw_scrollToObjectDivCheck",value:function(e,t,n){for(var r,i,o=t.clientHeight,a=t.clientWidth,l=e.getBoundingClientRect().right-e.getBoundingClientRect().left,s=0,u=0,c=e;c!=t&&null!=c;)s+=c.offsetTop,u+=c.offsetLeft,c=this.rw_safeOffsetParent(c,t);return null==c&&(u-=t.offsetLeft,s-=t.offsetTop),null!=n&&(s+=n.y,u+=n.x),(t.scrollTop>s||t.scrollTop+o<s+e.offsetHeight)&&(o>6*e.offsetHeight?t.scrollTop=s-e.offsetHeight:t.scrollTop=s),l<200&&(t.scrollLeft>u||t.scrollLeft+a<u+e.offsetWidth)&&(t.scrollLeft=u),r=u-t.scrollLeft,i=s-t.scrollTop,{x:r,y:i}}},{key:"rw_safeOffsetParent",value:function(e,t){var n=e,r=n.offsetParent;if(null==r)return null;if(null==t)return r;for(;null!=n&&n!=r;){if(n==t)return null;n=n.parentNode}return r}},{key:"rw_isDivScrollable",value:function(e){var t=new o.SSDOM,n=e.clientHeight,r=e.clientWidth,i=t.getComputedStyle(e),a=!1;return null!=i&&"visible"!=i.overflow&&"inline"!=i.display&&(e.scrollHeight>n&&"visible"!=i.overflowY&&(a=!0),e.scrollWidth>r&&"visible"!=i.overflowX&&(a=!0)),a}}]),e}()},{"./DOM/SSDOM":5,"./Events/EventBus":6}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.BaseSelection=function(){function e(){r(this,e)}return i(e,[{key:"clearSelection_",value:function(){this.clearBrowserSelection()}},{key:"clearBrowserSelection",value:function(){if(window.getSelection){for(var e=0;e<window.frames.length;e++)try{window.getSelection().empty?window.frames[e].getSelection().empty():window.getSelection().removeAllRanges&&window.frames[e].getSelection().removeAllRanges()}catch(e){}window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else document.selection&&document.selection.empty()}},{key:"getSelectionRange",value:function(){}},{key:"hasSelection",value:function(){}}]),e}()},{}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.HoverSpeak=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(e("../THCaretRange"),e("../THCaret"),e("../THDomRange")),s=e("../Selection/BaseSelection"),u=e("../Events/EventBus"),c=e("../SpeechObject");n.HoverSpeak=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.event={},e.timerEvent=null,e.callback=null,e.caretRange=null,(new u.EventBus).subscribe("pauseHover",e.clearTimer.bind(e)),e.sentence,e.readRange=null,e}return o(t,e),a(t,[{key:"mouseMoved",value:function(e,t){var n=this;clearTimeout(this.timerEvent),this.event=e,this.callback=t,this.timerEvent=setTimeout(function(){return n.startSpeech()},1e3)}},{key:"clearTimer",value:function(){clearTimeout(this.timerEvent)}},{key:"clearHoverSpeak",value:function(){clearTimeout(this.timerEvent),this.sentence}},{key:"startSpeech",value:function(){var e,t=this.event.target;if(null!=t&&("html"==t.tagName.toLowerCase()||"body"==t.tagName.toLowerCase()))return null;if(null!=t&&"img"==t.tagName.toLowerCase())e=new l.THDomRange(t,0,t,0);else if(document.caretRangeFromPoint){var n=this.event.target.ownerDocument.caretRangeFromPoint(this.event.clientX,this.event.clientY);e=new l.THDomRange(n.startContainer,n.startOffset,n.endContainer,n.endOffset)}else{var n=this.event.target.ownerDocument.caretPositionFromPoint(this.event.clientX,this.event.clientY);e=new l.THDomRange(n.offsetNode,n.offset,n.offsetNode,n.offset)}var r=new c.SpeechObject;r.processRange(e,!0);var i=r.getFirstSentence(),o="",a="";this.sentence&&this.sentence.getRawText()&&(o=this.sentence.getRawText()),i.getRawText()&&(a=i.getRawText()),null!=this.sentence&&-1!=o.indexOf(a)||(this.sentence=i,this.readRange=e,this.callback())}},{key:"getSelectionRange",value:function(){return this.readRange}}]),t}(s.BaseSelection)},{"../Events/EventBus":6,"../Selection/BaseSelection":23,"../SpeechObject":30,"../THCaret":31,"../THCaretRange":32,"../THDomRange":33}],25:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SelectionController=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=(e("../THCaretRange"),e("../THDomRange")),s=(e("../THRange"),e("../Utilities/Utilities")),u=e("../DOM/SSDOM"),c=e("./BaseSelection"),h=e("../DOM/DomNavigation");e("../DOM/Attribute"),n.SelectionController=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.g_ipadSelectionRange=null,e}return o(t,e),a(t,[{key:"getSelectionRange",value:function(){var e=this.getSelection_();return e?e.range:null}},{key:"getElementRangeById",value:function(e){var t=this.getSelectionById(e);return t?t.range:null}},{key:"getSelectionObject",value:function(){var e=this.getSelection_();return this.clearBrowserSelection(),e}},{key:"isMathJax",value:function(e){if(void 0!==e.startCaret.node.ownerDocument.defaultView.MathJax){if(e.startCaret.node.isMathJax)return!0;if(e.startCaret.node.parentNode.isMathJax)return!0}return!1}},{key:"hasSelection",value:function(){var e=this.getSelection_();return null!=e&&void 0!=e}},{key:"getSelectionString",value:function(){return this.getSelection_().range.toString()}},{key:"getSelectionTextById",value:function(e){return this.getSelectionById(e).range.toString()}},{key:"getSelection_",value:function(){var e=new u.SSDOM,t=new h.DomNavigation,n=null,r=null;null!=this.g_ipadSelectionRange&&g_ipadSelectionWindow.getSelection().addRange(this.g_ipadSelectionRange);var i=window.getSelection(),o=null,a=new s.Utilities;if(!i.isCollapsed&&a.trim(i.toString()).length>0)n=window,o=i;else{var c=e.getFrameSelectionSFF(window);c.foundSel&&(n=c.theWindow,o=c.foundSel)}if(null==o)return null;if(o.focusNode&&o.focusNode.id&&"flashcontent"==o.focusNode.id)return null;if(null!=o.anchorNode&&o.anchorNode==o.focusNode&&o.anchorOffset==o.focusOffset)return null;var f=null;if(o.getRangeAt)f=o.getRangeAt(0);else{var d=e.getRangeObject();null!=d&&(o.anchorNode==o.focusNode&&o.anchorOffset==o.focusOffset?d=e.getRangeFromSelectionPoint(o):(d.setStart(o.anchorNode,o.anchorOffset),d.setEnd(o.focusNode,o.focusOffset),0==d.toString().length&&(d.setStart(o.focusNode,o.focusOffset),d.setEnd(o.anchorNode,o.anchorOffset))),f=d)}if(null==f)return null;var g=f.startContainer,v=f.startOffset,p=f.endContainer,m=f.endOffset;if(3!=g.nodeType){if(1!=g.nodeType)return null;if(v>0&&g.hasChildNodes()&&g.childNodes.length>v)if(g=g.childNodes[v],3==g.nodeType)v=0;else if(v=0,"[object HTMLEmbedElement]"==g.toString())return null}if(3!=p.nodeType){if(1!=p.nodeType)return null;if(p.hasChildNodes())if(p.childNodes.length>m)p=p.childNodes[m];else if(p=p.childNodes[m-1],3!=p.nodeType){var y=t.getLastChildTextNode(p,!0);null!=y&&(p=y)}if(3!=p.nodeType){var w=t.getPreviousNode(g,!0,null),y=t.getPreviousTextNode(p,!1,w);null!=y&&(p=y)}m=3==p.nodeType?p.nodeValue.length:0}return r=new l.THDomRange(g,v,p,m),null!=n&&null!=r?{frame:n,range:r}:null}},{key:"getSelectionById",value:function(e){var t=new u.SSDOM,n=new h.DomNavigation,r=document.getElementById(e),i=window;if(null!=r){if(1==r.nodeType&&"img"==r.tagName&&null==r.getAttribute("alt"))return{frame:i,range:d};var o=r.innerHTML;if(o.length>0){var a=n.getFirstChildTextNode(r,!0);if(null==a||3!=a.nodeType&&!a.isMathJax){if(null==a||1!=a.nodeType||"img"!=a.tagName)return null;var s=a.getAttribute("alt");if(!(null!=s&&s.length>0))return null}var c=n.getLastChildTextNode(r,!0);if(null==c||3!=c.nodeType&&!c.isMathJax){if(null==c||1!=c.nodeType||"img"!=c.tagName)return null;var f=c.getAttribute("alt");if(!(null!=f&&f.length>0))return null}var d=(t.rw_getRefPt(a,0),3==c.nodeType?t.rw_getRefPt(c,c.nodeValue.length):t.rw_getRefPt(c,0),new l.THDomRange(a,0,c,o.length));return null!=i&&null!=d?{frame:i,range:d}:null}}return null}}]),t}(c.BaseSelection)},{"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../THCaretRange":32,"../THDomRange":33,"../THRange":35,"../Utilities/Utilities":38,"./BaseSelection":23}],26:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.BaseObject=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../THRange"),a=e("../DOM/SSDOM");n.BaseObject=function(){function e(t){r(this,e),this.m_range=null,this.m_type=t,this.m_bValid=!0,this.m_contents=null,this.Types={WORD:1,SENTENCE:2,SSML:3,DOCUMENT:4,SILENCE:5}}return i(e,[{key:"getRange",value:function(){return this.m_range}},{key:"setRange",value:function(e){e instanceof o.THRange&&(this.m_range=e)}},{key:"getType",value:function(){return this.m_type}},{key:"isValid",value:function(){return this.m_bValid}},{key:"setValid",value:function(e){this.m_bValid=e}},{key:"getContents",value:function(){return null==this.m_contents&&(this.m_contents=[]),this.m_contents}},{key:"setContents",value:function(e){e instanceof Array?this.m_contents=e:this.m_contents=[e]}},{key:"addContent",value:function(e){null==this.m_contents&&(this.m_contents=[]),this.m_contents.push(e)}},{key:"isOverridingText",value:function(){return!1}},{key:"getWordCount",value:function(){if(this.m_type==this.Types.WORD||this.isOverridingText())return 1;var e=0;if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e+=this.m_contents[t].getWordCount()}return e}},{key:"getWords",value:function(){if(this.m_type==this.Types.WORD||this.isOverridingText())return[this];var e=[];if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e=e.concat(this.m_contents[t].getWords())}return e}},{key:"getFirstNode",value:function(){var e=new a.SSDOM,t=this.getRange();if(null!=t){var n=e.rw_getCaretFromRefPt(t.body,t.startRef);if(null!=n&&null!=n.node)return n.node}return null}},{key:"getSpokenText",value:function(){return""}}]),e}()},{"../DOM/SSDOM":5,"../THRange":35}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.MathWordObject=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./BaseObject");n.MathWordObject=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,1));return o.spanID=e,o.m_strWord=n,o.m_strPronunciation=null,o}return o(t,e),a(t,[{key:"getRange",value:function(){return this.spanID}},{key:"setRange",value:function(e){this.spanID=e}},{key:"getWord",value:function(){return this.m_strWord}}]),t}(l.BaseObject)},{"./BaseObject":26}],28:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SentenceObject=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../DOM/SSDOM"),s=e("../Utilities/Utilities"),u=e("../TextOverRangeBeanClass"),c=e("./BaseObject"),h=e("../THDomRange"),f=e("../MathJax/MathSpeak"),d=e("./WordObject"),g=e("./MathWordObject"),v=e("../THRange"),p=e("../DOM/DomNavigation");e("../DOM/Attribute"),n.SentenceObject=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,2));if(new l.SSDOM,n.m_range=new h.THDomRange(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset),n.m_caretRange=e,e.leftCaret.node.isMathJax){var o=new f.MathSpeak;try{n.math=!0,n.m_strRawText=o.getSpeechWithBookmarksFromElement(e.leftCaret.node),n.splitMathIntoWords(),n.sentenceSpanId=e.leftCaret.node.id}catch(e){}}else n.laug=null,n.m_strRawText=e.getTextOverCaretRange(),n.setLangTag(e),n.math=!1;return n.m_strMarkedText,n}return o(t,e),a(t,[{key:"setVoice",value:function(e){this.m_strVoice=e}},{key:"setLangTag",value:function(e){var t=e.leftCaret.node;3==t.nodeType&&(t=t.parentElement),this.lang=t.lang}},{key:"getLangTag",value:function(){return this.lang}},{key:"getVoice",value:function(){return this.m_strVoice}},{key:"getSpanId",value:function(){return this.sentenceSpanId}},{key:"setCaretRange",value:function(e){this.m_caretRange=e,this.m_range=m_caretRange.rw_getTHRangeFromTHCaretRange()}},{key:"getCaretRange",value:function(){return this.m_caretRange}},{key:"getWords",value:function(){for(var e=new Array,t=this.getContents(),n=0;n<t.length;n++)e.push(t[n].getWord());return e}},{key:"getWordRange",value:function(e){var t=this.getContents();return e<t.length?t[e].getRange():null}},{key:"isMathML",value:function(){return this.math}},{key:"getRawText",value:function(){return this.m_strRawText}},{key:"setRawText",value:function(e){this.m_strRawText=e}},{key:"getMarkedText",value:function(){return this.m_strMarkedText}},{key:"setMarkedText",value:function(e){this.m_strMarkedText=e}},{key:"clone",value:function(){var e=new t(m_caretRange);return e.setContents(this.getContents()),e.setValid(this.isValid()),e.setVoice(m_strVoice),e.setRawText(m_strRawText),e.setMarkedText(m_strMarkedText),e}},{key:"splitMathIntoWords",value:function(){if(""!=this.m_strRawText){var e=this.m_strRawText.toLowerCase().match(/<bookmark mark="[0-9]+"\/>+/g),t=this.m_strRawText.toLowerCase().split(/<bookmark mark="[0-9]+"\/>+/g),n=0;t.length>0&&""==t[0]&&(n=1);for(var r=0;r<e.length;r++){var i=e[r].match(/[0-9]+/g),o=new g.MathWordObject(i[0],t[n]);this.addContent(o),n++}}}},{key:"processTextToSpeakInSentenceObject",value:function(){this.processTextToSpeakInSentenceObjectImpl();for(var e=this.getContents(),t=0;t<e.length;t++){var n=e[t],r=n.getFirstNode();null!=r&&this.isNestedSsml(r)&&this.insertInWrappingSsml(e,t,r)}}},{key:"isNestedSsml",value:function(e){for(var t=e.ownerDocument.body,n=e;n!=t&&null!=n;){if(null!=this.checkForSsmlAttribute(n))return!0;n=n.parentNode}return!1}},{key:"insertInWrappingSsml",value:function(e,t,n){for(var r=n.ownerDocument.body,i=n,o=new l.SSDOM;i!=r&&null!=i;)if(i=i.parentNode,null!=this.checkForSsmlAttribute(i)){var a=this.checkForSsmlAttribute(i);if(a.canContainContent()){var s=e[t];e[t]=a,a.setContents([s]);for(var u=t+1;u<e.length;u++){var c=e[u],h=c.getFirstNode();if(!o.checkIfElementInsideElement(h,i))break;s=e[u],a.addContent(s),e.splice(u,1),u--}}else{e[t]=a;for(var u=t+1;u<e.length;u++){var c=e[u],h=c.getFirstNode();if(!o.checkIfElementInsideElement(h,i))break;e.splice(u,1),u--}}}return!1}},{key:"processTextToSpeakInSentenceObjectImpl",value:function(){var e=new l.SSDOM;try{var t=new u.TextOverRangeBeanClass(this);for(this.setupCheck(t),t.startRefPt=e.rw_getRefPt(t.leftNode,t.leftOffset),t.endRefPt=null;null!=t.currentNode;){if(this.checkIfTooLong(t))return;var n=t.currentNode;e.isSpecialCase(n)?this.handleSpecialCase(t):1==n.nodeType?this.handleElement(t):3==n.nodeType?this.handleTextNode(t):this.moveToNextNode(t)}}catch(e){this.setValid(!1)}}},{key:"handleTextNode",value:function(e){var t=new l.SSDOM,n=new p.DomNavigation,r=e.currentNode,i=n.getTextFromNode(r);null==i&&(i="");var o=0;if(e.rightNode==r&&e.rightOffset>-1&&(i=i.substring(0,e.rightOffset)),e.leftNode==r&&e.leftOffset>0&&(i=i.substring(e.leftOffset),o=e.leftOffset),0==i.length&&0==e.storedText.length)e.startRefPt=null;else{null!=e.startRefPt&&0!=e.storedText.length||(e.startRefPt=t.rw_getRefPt(r,o));for(var a=t.rw_getBreakInCurrentWord(i);a>-1;){var s=e.storedText+i.substring(0,a+1);if(e.storedText=this.filterWordToSpeak(s),null!=e.endRefPt&&0==a||(e.endRefPt=t.rw_getRefPt(r,a+o)),this.moveStoredTextToWordObject(e),this.checkIfTooLong(e))return void(e.currentNode=null);o+=a+1,i=i.substring(a+1),e.startRefPt=t.rw_getRefPt(r,o),e.endRefPt=null,a=t.rw_getBreakInCurrentWord(i)}if(i.length>0&&(e.storedText+=i,e.endRefPt=t.rw_getRefPt(r,i.length+o),null==e.endRefPt&&(e.storedText="")),r==e.rightNode)return this.moveStoredTextToWordObject(e),void(e.currentNode=null)}this.moveToNextNode(e)}},{key:"filterWordToSpeak",value:function(e){return(new l.SSDOM,new s.Utilities).trim(e),e}},{key:"handleElement",value:function(e){var t=e.currentNode;null!=this.checkForSsmlAttribute(t)||this.moveToNextNode(e)}},{key:"moveToNextNode",value:function(e){var t=(new l.SSDOM,new p.DomNavigation),n=e.currentNode,r=t.getNextNode(n,!0,e.rightNode);null==r?(e.storedText=this.getTextOverRangeToSpeakAddFullStop(e.storedText),this.moveStoredTextToWordObject(e),e.currentNode=t.getNextNode(n,!1,e.rightNode)):e.currentNode=r}},{key:"getTextOverRangeToSpeakAddFullStop",value:function(e){var t=new l.SSDOM,n=e.length;if(n>1&&". "==e.substr(n-2,2))return e;if(n>0&&"."==e.substr(n-1,1))return e+" ";var r=new s.Utilities,i=r.trimEndTH(e),o=i.charCodeAt(i.length-1);return t.rw_isLetter(o)||o>127?e+". ":e}},{key:"handleSpecialCase",value:function(e){var t=new l.SSDOM,n=new p.DomNavigation;this.moveStoredTextToWordObject(e);var r=e.currentNode;if(e.storedText=n.getTextFromNode(r),t.isSpecialCaseHighlightable(r)){var i=n.getFirstChildTextNode(r,!1),o=n.getLastChildTextNode(r,!1);null!=i&&null!=o?3==i.nodeType&&3==o.nodeType?(e.startRefPt=t.rw_getRefPt(i,0),e.endRefPt=t.rw_getRefPt(o,o.nodeValue.length)):(e.startRefPt=t.rw_getRefPt(i,-1),e.endRefPt=t.rw_getRefPt(o,-1)):(e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt)}else e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt;this.moveStoredTextToWordObject(e),e.currentNode=n.getNextNodeIgnoreChildren(r,!1,e.rightNode)}},{key:"moveStoredTextToWordObject",value:function(e){if((new l.SSDOM).rw_isWordSpeakable(e.storedText)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new d.WordObject(new v.THRange(e.body,e.startRefPt,e.endRefPt),e.storedText);e.sentenceObject.addContent(t)}this.clearState(e)}},{key:"clearState",value:function(e){e.startRefPt=null,e.endRefPt=null,e.storedText=""}},{key:"checkIfTooLong",value:function(e){return e.sentenceObject.getWordCount()>500}},{key:"setupCheck",value:function(e){var t=new l.SSDOM,n=new p.DomNavigation;1==e.leftNode.nodeType&&(t.isSpecialCase(e.leftNode)||null!=this.checkForSsmlAttribute(e.leftNode)||(e.leftNode=n.getNextNodeAllowMoveToChild(e.currentNode,!1,e.rightNode),e.leftOffset=0))}},{key:"checkForSsmlAttribute",value:function(e){if(1==e.nodeType){var t=this.checkForSsmlNoNamespace(e);if(null!=t)return t;if(null!=(t=this.checkForSsmlNamespace(e)))return t}return null}},{key:"checkForSsmlNamespace",value:function(e){return null}},{key:"checkForSsmlNoNamespace",value:function(e){return null}},{key:"checkForCommands",value:function(){if(g_bUseCommands){var e,t,n=this.getSentences();for(t=0;t<n.length;t++){e=n[t];var r=e.getCaretRange().leftCaret,i=e.getCaretRange().rightCaret,o=rw_findCommandNode(r.node),a=rw_checkForCommandChange(r.node,i.node,o);if(null!=a){var s=e.clone(),u=e.clone(),c=new THCaretRange(r,a),h=a.clone();h.forwardBias=!0,h=l.SSDOM.moveCaret(h,0,!1);var f=new THCaretRange(h,i);s.setCaretRange(c),u.setCaretRange(f),n.splice(t,1,s,u)}}this.setSentences(n)}}}]),t}(c.BaseObject)},{"../DOM/Attribute":2,"../DOM/DomNavigation":3,"../DOM/SSDOM":5,"../MathJax/MathSpeak":16,"../THDomRange":33,"../THRange":35,"../TextOverRangeBeanClass":37,"../Utilities/Utilities":38,"./BaseObject":26,"./MathWordObject":27,"./WordObject":29}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.WordObject=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./BaseObject");n.WordObject=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,1));return o.setRange(e),o.m_strWord=n,o.m_strPronunciation=null,o}return o(t,e),a(t,[{key:"getWord",value:function(){return this.m_strWord.trim()}},{key:"setPronunciation",value:function(e){this.m_strPronunciation=e}},{key:"getPronunciation",value:function(){return this.m_strPronunciation}},{key:"isOverridingText",value:function(){return null!=this.m_strPronunciation}},{key:"getSpokenText",value:function(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}}]),t}(l.BaseObject)},{"./BaseObject":26}],30:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.SpeechObject=void 0;var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./Sentence/BaseObject"),u=e("./DOM/SSDOM"),c=e("./Sentence/SentenceObject"),h=(e("./THCaret"),e("./Utilities/Utilities"),e("./THCaretRange")),f=(e("./THDomRange"),e("./DOM/DomSentences"));n.SpeechObject=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,3));return e.m_bBatch=!1,e.SSML_NAMESPACE="ssml",e.SSMS_TYPES={SUB:"sub",PHONEME:"phoneme",SAYAS:"say-as",EMPHASIS:"emphasis",BREAK:"break",PROSODY:"prosody"},e.SSMS_ATTRIBUTES={ALPHABET:"alphabet",PH:"ph",ALIAS:"alias",INTERPRETAS:"interpret-as",FORMAT:"format",LEVEL:"level",STRENGTH:"strength",TIME:"time",PITCH:"pitch",RATE:"rate",VOLUME:"volume"},e.sentenceNo=0,e}return a(t,e),l(t,[{key:"setSentences",value:function(e){this.setContents(e)}},{key:"getSentences",value:function(){return this.getContents()}},{key:"setBatch",value:function(e){this.m_bBatch=e}},{key:"isBatch",value:function(){return this.m_bBatch}},{key:"getNextSentence",value:function(e){this.sentenceNo++;var t=this.getSentences();if(this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length?this.getNextSentence(e):t[this.sentenceNo];if(e){var n=t[t.length-1],i=n.getCaretRange();n.m_range.refresh();var o=new h.THCaretRange(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset),a=new f.DomSentences,i=a.getSentenceFromPoint(o.leftCaret),l=a.getNextSentence(i,null),s=this.processSentence(l);return this.m_contents.length=0,this.setSentences.apply(this,r(s)),this.sentenceNo=0,0==s[0].getWords().length?this.getNextSentence(e):s[0]}return null}},{key:"getCurrentSentence",value:function(){var e=this.getSentences();return this.sentenceNo<e.length?e[this.sentenceNo]:e[e.length-1]}},{key:"getFirstSentence",value:function(){return this.sentenceNo=0,this.getSentences().length>0?this.getSentences()[0]:null}},{key:"processRange",value:function(e,t){this.setSentences([]),this.sentenceNo=0;var n=new h.THCaretRange(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset);if(e.startCaret.node.tagName&&"textarea"==e.startCaret.node.tagName.toLowerCase()){var i=new c.SentenceObject(n);i.setWords(e.startCaret.node.value),i.m_strRawText=e.startCaret.node.value,this.setSentences(i)}else{var o,a=new f.DomSentences,l=a.getSentenceFromPoint(n.leftCaret),s=new Array,u=this.processSentence(l);if((o=s).push.apply(o,r(u)),!t){var d=!0;do{var g=a.getNextSentence(l,n.rightCaret.node);if(null!=g)if(g.leftCaret.node!=n.rightCaret.node||g.leftCaret.offset<n.rightCaret.offset){if(null!=(u=this.processSentence(g))){var v;(v=s).push.apply(v,r(u))}l=g}else d=!1;else d=!1}while(d);1==s.length&&l.rightCaret.offset>n.rightCaret.offset&&n.rightCaret.offset!=n.leftCaret.offset&&(s=this.processSentence(n))}this.setSentences(s)}}},{key:"processSentence",value:function(e){try{this.checkRange(e)||this.setValid(!1);var t=new c.SentenceObject(e),n=this.splitSentenceByLanguage(t);0==n.length&&this.setValid(!1);for(var r=n.length,i=0;i<r;i++)n[i].isMathML()||n[i].processTextToSpeakInSentenceObject();return n}catch(e){this.setValid(!1)}return null}},{key:"splitSentenceByLanguage",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=e.getCaretRange();t.leftCaret,t.rightCaret;return[e]})},{key:"checkRange",value:function(e){var t=new u.SSDOM;if(null==e||null==e.leftCaret||null==e.rightCaret||null==e.leftCaret.node||null==e.rightCaret.node)return!1;var n=e.leftCaret,r=e.rightCaret,i=t.checkForSpecialParent(n.node);return null!=i&&(n.node=i,n.setSpecialCase(!0),e.leftCaret=n),i=t.checkForSpecialParent(r.node),null!=i&&(r.node=i,r.setSpecialCase(!0),e.rightCaret=r),!0}}]),t}(s.BaseObject)},{"./DOM/DomSentences":4,"./DOM/SSDOM":5,"./Sentence/BaseObject":26,"./Sentence/SentenceObject":28,"./THCaret":31,"./THCaretRange":32,"./THDomRange":33,"./Utilities/Utilities":38}],31:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.THCaret=function(){function e(t,n,i){r(this,e),this.node=t,this.offset=n,this.forwardBias=i,this.specialCase=!1}return i(e,[{key:"setSpecialCase",value:function(e){this.specialCase=e}},{key:"isSpecialCase",value:function(){return this.specialCase}},{key:"check",value:function(){var e=!0;return null==this.node||null==this.node.parentNode?e=!1:3!=this.node.nodeType?1==this.node.nodeType&&this.specialCase||(e=!1):(this.offset<0||this.offset>this.node.nodeValue.length)&&(e=!1),e}},{key:"toString",value:function(){var e="THCaret ";return null!=this.node&&(3==this.node.nodeType?e+=this.node.nodeValue+" "+this.node.parentNode.tagName+" ":1==this.node.nodeType&&(e+=this.node.tagName+" ")),e+=this.offset}},{key:"equals",value:function(e){
return null!=e&&this.node==e.node&&this.offset==e.offset&&this.forwardBias==e.forwardBias}},{key:"clone",value:function(){return new e(this.node,this.offset,this.forwardBias)}}]),e}()},{}],32:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.THCaretRange=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./THCaret"),a=e("./DOM/SSDOM"),l=e("./DOM/DomNavigation"),s=e("./DOM/Attribute");n.THCaretRange=function(){function e(t,n,i,o,a){r(this,e),this.leftCaret=null,this.rightCaret=null,null!=t&&null!=n&&null!=i&&null!=o&&null!=a&&this.getCaretPairFromDomPosition(t,n,i,o,a)}return i(e,[{key:"setCaretRange",value:function(e,t){this.leftCaret=e,this.rightCaret=t}},{key:"equals",value:function(e){return null!=e&&this.leftCaret.equals(e.leftCaret)&&this.rightCaret.equals(e.rightCaret)}},{key:"toString",value:function(){return this.getTextOverCaretRange()}},{key:"getTextOverCaretRange",value:function(){var e=new a.SSDOM,t=new s.Attribute;try{if(null==this.leftCaret||null==this.rightCaret)return"";var n,r=this.leftCaret,i=this.rightCaret,o=r.node,l=i.node,u="",c=e.getNodesOverRange(o,l);if(null!=c&&c.length>0)for(var h=0;h<c.length;h++){var f=c[h];3==f.nodeType&&"textarea"!=f.parentNode.tagName.toLowerCase()?(n=f.nodeValue,u+=l==o?n.substring(r.offset,i.offset):f==o&&r.offset>0?n.substr(r.offset):f==l&&i.offset>-1?n.substring(0,i.offset):n):1==f.nodeType&&"img"==f.tagName.toLowerCase()&&t.rw_getAttribute(f,"alt")&&(u=t.rw_getAttribute(f,"alt"))}return u.trimTH()}catch(e){return""}}},{key:"rw_getTHRangeFromTHCaretRange",value:function(){return null==this||null==this.leftCaret||null==this.rightCaret?null:new THRange(this.leftCaret.node.ownerDocument.body,this.rw_getRefPt(this.leftCaret.node,this.leftCaret.offset),this.rw_getRefPt(this.rightCaret.node,this.rightCaret.offset))}},{key:"getCaretPairFromDomPosition",value:function(e,t,n,r,i){var o=new a.SSDOM;this.leftCaret=o.getCaretFromDomPosition(e,t,n,!0),this.rightCaret=t==r&&n>=i?this.leftCaret:o.getCaretFromDomPosition(e,r,i,!1)}},{key:"getTextSpokenOverCaretRange",value:function(e){var t=new l.DomNavigation,n=new a.SSDOM;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return"";var r=e.leftCaret,i=e.rightCaret,s=r.node,u=i.node,c=n.isSpecialCaseNested(s);c&&(s=n.checkForSpecialParent(s),r=new o.THCaret(s,0,!0));for(var h=s,f="";null!=h;){if((c=n.isSpecialCase(h))||3==h.nodeType){var d=t.getTextFromNode(h);null!=d&&""!=d&&(c||(h==u&&i.offset>-1&&(d=d.substring(0,i.offset)),h==s&&r.offset>-1&&(d=d.substring(r.offset))),f+=d)}h=c?t.getNextNodeIgnoreChildren(h,!1,u):t.getNextNode(h,!1,u)}return f.trimTH()}catch(e){return""}}}]),e}()},{"./DOM/Attribute":2,"./DOM/DomNavigation":3,"./DOM/SSDOM":5,"./THCaret":31}],33:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.THDomRange=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./THCaretRange"),a=e("./THCaret"),l=e("./THDomRefPt"),s=e("./DOM/SSDOM"),u=e("./DOM/Attribute"),c=e("../Constants/Constants"),h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(c);n.THDomRange=function(){function e(t,n,i,o){r(this,e),this.body=t.ownerDocument.body,this.startCaret=new a.THCaret(t,n,!0),this.endCaret=new a.THCaret(i,o,!1),this.startRef=this.rw_getRefPt(t,n),this.endRef=this.rw_getRefPt(i,o)}return i(e,[{key:"getPositionInDom",value:function(e){var t=new s.SSDOM,n=new u.Attribute,r="",i=0,o="";if(null!=e&&null!=e.ownerDocument)for(var a=!1,l=!1,c=e.ownerDocument.body;null!=e&&e!=c;){t.isSpecialCase(e)&&(r=""),a=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==h.HIGHLIGHT_TAG&&null!=n.rw_getAttribute(e,"rwstate");for(var f=e.previousSibling;null!=f;)l=3==f.nodeType||1==f.nodeType&&f.tagName.toLowerCase()==h.HIGHLIGHT_TAG&&null!=n.rw_getAttribute(f,"rwstate"),a&&l||++i,f=f.previousSibling,a=l;if(r=r+i+"~",i=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var d=n.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==d){var g=n.getPositionInDom(e);o="#^th*"+g+"#^th*"}}}return o+r}},{key:"rw_getRefPt",value:function(e,t){var n="rwTHgen",r=new s.SSDOM,i=new u.Attribute;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var o=r.checkForSpecialParent(e);if(null!=o)return new l.THDomRefPt(this.getPositionInDom(o),t);var a,c;1==e.nodeType?(a=0,c=e):(a=this.getNodeOffset_(e),c=e.parentNode);for(var h=i.rw_getAttribute(c,"rwstate"),f=i.rw_getAttribute(c,n);null!=h&&h.length>0||null!=f;)a+=this.getNodeOffset_(c),c=c.parentNode,h=i.rw_getAttribute(c,"rwstate"),f=i.rw_getAttribute(c,n);return-1==t&&(a=-1),new l.THDomRefPt(this.getPositionInDom(c),a+t)}return null}catch(e){return null}}},{key:"getNodeOffset_",value:function(e){var t=new s.SSDOM;if(null==e)return 0;var n=0,r=e.previousSibling;return null!=r&&(n=t.rw_getNodeOffsetImpl(r)),n}},{key:"refresh",value:function(){if(0==this.startCaret.check()||0==this.endCaret.check()){var e=new o.THCaretRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);this.startCaret=e.leftCaret,this.endCaret=e.rightCaret,null==this.startCaret&&null==this.endCaret?(this.startCaret=new a.THCaret(document.body,0,!0),this.endCaret=new a.THCaret(document.body,0,!1)):null!=this.startCaret&&null!=this.endCaret||(null==this.startCaret?this.startCaret=new a.THCaret(this.endCaret.node,this.endCaret.offset,!0):this.endCaret=new a.THCaret(this.startCaret.node,this.startCaret.offset,!1))}}},{key:"toString",value:function(){new s.SSDOM,this.refresh();var e=new o.THCaretRange;return e.setCaretRange(this.startCaret,this.endCaret),e.getTextSpokenOverCaretRange(e)}},{key:"getRangeObject",value:function(e){return void 0!==e&&null!=e||(e=document.body),e.ownerDocument.createRange()}},{key:"getStartAsRange",value:function(){var e=this.getRangeObject(this.body);return e.setStart(this.startCaret.node,this.startCaret.offset),e.setEnd(this.startCaret.node,this.startCaret.offset),e}},{key:"getEndAsRange",value:function(){var e=this.getRangeObject(this.body);return e.setStart(this.endCaret.node,this.endCaret.offset),e.setEnd(this.endCaret.node,this.endCaret.offset),e}},{key:"equals",value:function(e){return this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}},{key:"compareRange",value:function(e){if(this.equals(e))return h.THDomRange_TARGET_SAME;this.refresh(),e.refresh();var t=this.getStartAsRange(),n=this.getEndAsRange(),r=e.getStartAsRange(),i=e.getEndAsRange(),o=t.compareBoundaryPoints("START_TO_START",r),a=t.compareBoundaryPoints("START_TO_START",i),l=n.compareBoundaryPoints("START_TO_START",r),s=n.compareBoundaryPoints("START_TO_START",i);h.THDomRange_ERROR;return a>-1?h.THDomRange_AFTER_TARGET:l<1?h.THDomRange_BEFORE_TARGET:-1==o?-1==s?h.THDomRange_OVERLAPS_START_OF_TARGET:h.THDomRange_TARGET_INSIDE:0==o?-1==s?h.THDomRange_TARGET_INCLUDES_THIS_AT_START:0==s?h.THDomRange_TARGET_SAME:h.THDomRange_TARGET_INSIDE:-1==s?h.THDomRange_TARGET_INCLUDES_THIS:0==s?h.THDomRange_TARGET_INCLUDES_THIS_AT_END:h.THDomRange_OVERLAPS_END_OF_TARGET}},{key:"rw_getTextFromRange",value:function(){return this.text?this.text:this.toString()}},{key:"rw_getTHCaretRangeFromTHDomRange",value:function(){var e=new s.SSDOM;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new o.THCaretRange;return r.setCaretRange(t,n),r}return null}}]),e}()},{"../Constants/Constants":1,"./DOM/Attribute":2,"./DOM/SSDOM":5,"./THCaret":31,"./THCaretRange":32,"./THDomRefPt":34}],34:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.THDomRefPt=function(){function e(t,n){r(this,e),this.path=t,this.offset=n}return i(e,[{key:"toString",value:function(){return"THDomRefPt "+this.path+" "+this.offset}},{key:"getPath",value:function(){return this.path}},{key:"getOffset",value:function(){return this.getOffset}}]),e}()},{}],35:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.THRange=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./DOM/SSDOM"),a=e("./THCaretRange");n.THRange=function(){function e(t,n,i){r(this,e),this.body=t,this.startRef=n,this.endRef=i}return i(e,[{key:"equals",value:function(e){return this.body==e.body&&this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}},{key:"toString",value:function(){return null!=this.getAsRange()?g_bIEOld?this.getAsRange().text:this.getAsRange().toString():""}},{key:"getAsRange",value:function(){var e=null;if(g_bIEOld)e=rw_getAsTextRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);else{e=o.SSDOM.getRangeObject(this.body);var t=new new a.THCaretRange(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null}return e}},{key:"clone",value:function(){return new e(this.body,this.startRef,this.endRef)}},{key:"rw_getTHCaretRangeFromTHRange",value:function(){var e=new o.SSDOM;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new a.THCaretRange;return r.setCaretRange(t,n),r}return null}}]),e}()},{"./DOM/SSDOM":5,"./THCaretRange":32}],36:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.THReturnObject=function e(){r(this,e),this.node=null,this.offset=0}},{}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TextOverRangeBeanClass=void 0;var i=e("./DOM/SSDOM");n.TextOverRangeBeanClass=function e(t){r(this,e);var n=t.getCaretRange(),o=new i.SSDOM;this.sentenceObject=t,this.leftNode=n.leftCaret.node,this.rightNode=n.rightCaret.node,this.body=o.getBody(this.leftNode),this.leftOffset=n.leftCaret.offset,this.rightOffset=n.rightCaret.offset,this.currentNode=this.leftNode,this.storedText="",this.startRefPt=null,this.endRefPt=null}},{"./DOM/SSDOM":5}],38:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();String.prototype.trimTH=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")},n.Utilities=function(){function e(){r(this,e)}return i(e,[{key:"trim",value:function(e){return e.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}},{key:"trimEndTH",value:function(e){return e.replace(/[\s\xA0]+$/,"")}},{key:"rw_filterForHtml",value:function(e){var t=e.replace(/\x26/g,"&amp;");return t=t.replace(/\x3c/g,"&lt;"),t=t.replace(/\x3e/g,"&gt;")}}]),e}()},{}],39:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.ParserAPI=void 0;var o="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../SpeechStream/Selection/SelectionController"),s=e("../SpeechStream/Highlighting/SpeechHighlightManager"),u=e("../SpeechStream/SpeechObject"),c=e("../SpeechStream/Selection/HoverSpeak"),h=e("../SpeechStream/Highlighting/StudySkillsHighlighting"),f=e("../SpeechStream/Prediction/PredictionManager"),d=e("../SpeechStream/Events/EventBus"),g=e("../SpeechStream/THDomRange"),v=n.ParserAPI=function(){function e(t,n){if(i(this,e),this.selectionController=new l.SelectionController,this.speechHighlightManager=null,this.hoverSpeak=new c.HoverSpeak,this.speechObject=new u.SpeechObject,this.studySkills=new h.StudySkillsHighlighting,this.hoverSpeakOn=!1,this.mathLoaded=!1,this.url=n,"undefined"!=typeof MathJax&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var r=window.MathJax;delete window.MathJax,window.MathJax=r;var o=!1;for(var a in MathJax.Ajax.loaded)if(a.indexOf("toMathML")>-1){o=!0;break}o||MathJax.Ajax.Load(n+"toMathML.js"),this.load_script(n+"sre_browser.js"),this.mathLoaded=!0}this.predictionOn=!1,this.predictionManager=new f.PredictionManager,(new d.EventBus).subscribe("pauseHover",this.pauseHover.bind(this)),this.isHoverSpeakEnabled=!1,this.setUpiframes()}return a(e,[{key:"setUpIFrameObserver",value:function(){this.targetElement=document.body;var e={childList:!0,subtree:!0};this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(this.targetElement,e)}},{key:"observerFunction",value:function(e){e.forEach(function(e){[].filter.call(e.addedNodes,function(e){return"IFRAME"==e.nodeName}.bind(this)).forEach(function(e){e.addEventListener("load",function(t){this.addEventsToFrame(e).bind(this)}.bind(this))}.bind(this))}.bind(this))}},{key:"addEventsToFrame",value:function(e){try{var t;e.document?t=e:e.contentWindow&&(t=e.contentWindow),null!=t&&(t.document.body.addEventListener("mouseover",this.iframeCallback.bind(this)),this.checkForChildFrames(t),this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(t.document.body,{childList:!0,subtree:!0}),void 0!==t.MathJax&&(t.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}catch(e){}}},{key:"checkForChildFrames",value:function(e){if(e.frames.length>0){var t;for(t=0;t<e.frames.length;t++)this.addEventsToFrame(e.frames[t])}}},{key:"setUpiframes",value:function(){if(window.frames.length>0)for(var e=0;e<window.frames.length;e++)try{this.addEventsToFrame(window.frames[e])}catch(e){}}},{key:"iframeCallback",value:function(e){this.hoverSpeakOn&&this.speechCallback&&this.hoverSpeak.mouseMoved(e,this.speechCallback)}},{key:"forceLoadMath",value:function(e){if(MathJax.version&&"function"==typeof MathJax.Ajax.Load){var t=window.MathJax;if(delete window.MathJax,window.MathJax=t,e){if(o(e.MathJax.version)&&"function"==typeof e.MathJax.Ajax.Load){var t=e.MathJax;delete e.MathJax,e.MathJax=t;var n=!1;for(var r in e.MathJax.Ajax.loaded)if(r.indexOf("toMathML")>-1){n=!0;break}n||e.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)}}else if(!this.mathLoaded&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var t=window.MathJax;delete window.MathJax,window.MathJax=t;var i=!1;for(var r in MathJax.Ajax.loaded)if(r.indexOf("toMathML")>-1){i=!0;break}i||MathJax.Ajax.Load(this.url+"toMathML.js"),this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0}}}},{key:"pauseHover",value:function(){var e=this;this.hoverSpeakOn||this.isHoverSpeakEnabled?(this.hoverSpeakOn=!1,this.isHoverSpeakEnabled=!0,this.pauseHoverTimer=setTimeout(function(){return e.unPauseHover()},300)):this.isHoverSpeakEnabled=!1}},{key:"unPauseHover",value:function(){this.isHoverSpeakEnabled&&(this.hoverSpeakOn=!0)}},{key:"clearHoverSpeak",value:function(){this.hoverSpeak.clearHoverSpeak()}},{key:"load_script",value:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.className="MyInjectedScript",document.getElementsByTagName("head")[0].appendChild(t)}},{key:"predictionEnabled",value:function(e){this.predictionOn=e}},{key:"getPredictionCoordinates",value:function(){return this.predictionManager.getPredictionCoordinates()}},{key:"getPredictionSentence",value:function(){return this.predictionManager.getPredictionSentence()}},{key:"predictionInsertText",value:function(e){this.predictionManager.predictionInsertText(e)}},{key:"isEditable",value:function(){return this.predictionManager.isEditable()}},{key:"hoverSpeakEnabled",value:function(e){this.hoverSpeakOn=e,this.isHoverSpeakEnabled=e,e||clearTimeout(this.pauseHoverTimer)}},{key:"mouseOverEvent",value:function(e,t){this.speechCallback=t,this.hoverSpeakOn?this.hoverSpeak.mouseMoved(e,this.speechCallback):clearTimeout(this.pauseHoverTimer)}},{key:"hasSelection",value:function(){return this.selectionController.hasSelection()}},{key:"getWord",value:function(){var e=new Array,t=this.selectionController.getSelectionRange();if(t){var e=t.toString().split(/\s/);if(e.length>0)return e.length>2||1==e.length?new Array(e[0]):new Array(e[0],e[1])}return null}},{key:"getSelection",value:function(){return this.selectionController.getSelectionRange().toString().split(/\s/)}},{key:"getSelectionLocal",value:function(){return this.getSelection()}},{key:"clearSelection_",value:function(){this.selectionController.clearSelection_()}},{key:"clearBrowserSelection",value:function(){this.selectionController.clearBrowserSelection()}},{key:"hiliteSelection",value:function(){var e=null;if(this.hasSelection()||this.hoverSpeakOn){if(this.sentenceNo=0,this.hoverSpeakOn){var t=this.hoverSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else this.speechObject.processRange(this.selectionController.getSelectionRange(),!1);(e=this.speechObject.getFirstSentence())&&""==e.getRawText()&&(e=this.speechObject.getNextSentence(!0))}else{var t;if(document.caretRangeFromPoint){var n=document.caretRangeFromPoint(0,0);t=new g.THDomRange(n.startContainer,n.startOffset,n.endContainer,n.endContainer)}else{var n=document.caretPositionFromPoint(0,0);t=new g.THDomRange(n.offsetNode,n.offset,n.offsetNode,n.offset)}this.speechObject.processRange(t,!0),e=this.speechObject.getNextSentence(!0)}if(this.selectionController.clearBrowserSelection(),null!=e){var r=e.getWords();return 0==r.length?"":(this.speechHighlightManager=new s.SpeechHighlightManager(e),this.speechHighlightManager.highlightRange(),r)}return""}},{key:"highlightElementById",value:function(e){var t=null;if(this.speechObject.processRange(this.selectionController.getElementRangeById(e),!1),t=this.speechObject.getFirstSentence(),t&&""==t.getRawText()&&(t=this.speechObject.getNextSentence(!0)),this.selectionController.clearBrowserSelection(),null!=t){var n=t.getWords();return 0==n.length?"":(this.speechHighlightManager=new s.SpeechHighlightManager(t),this.speechHighlightManager.highlightRange(),n)}return""}},{key:"hiliteWord",value:function(e){this.speechHighlightManager.highlightWord(e)}},{key:"stop",value:function(){null!=this.speechObject.getCurrentSentence()&&null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange()}},{key:"hiliteNextSentence",value:function(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange();var t=this.speechObject.getNextSentence(e),n=null;return null!=t&&(n=t.getWords(),this.speechHighlightManager=new s.SpeechHighlightManager(t),this.speechHighlightManager.highlightRange(t)),n}},{key:"getLanguageForSentence",value:function(){return this.speechObject.getCurrentSentence().getLangTag()}},{key:"highlightSelection",value:function(e){var t=this.selectionController.getSelectionObject();this.studySkills.studySkillsHTMLHighlightRange(e,t)}},{key:"clearHighlights",value:function(){var e=null;this.hasSelection()&&(e=this.selectionController.getSelectionObject()),this.studySkills.studySkillsClearHighlights(!1,e)}},{key:"collectHighlights",value:function(e,t){var n=new Array;if(2==e)for(var i=0;i<t.length;i++)n.push.apply(n,r(this.studySkills.studySkillsCollateForColour(t[i])));else n.push.apply(n,r(this.studySkills.studySkillsCollateForColour(t)));return n}},{key:"collectVocabWords",value:function(e){}},{key:"addVoiceNote",value:function(){}},{key:"collectVocabs",value:function(e,t,n){return this.studySkills.fetchWords()}},{key:"onMouseUp",value:function(e){}},{key:"onMouseDown",value:function(e){this.predictionManager.onMouseDown(e)}},{key:"onKeyDown",value:function(e){this.predictionManager.onKeyDown(e)}}]),e}();window.textHelp=window.textHelp||{},textHelp.parsers=textHelp.parsers||{},textHelp.parsers.HTMLParserAPI=textHelp.parsers.HTMLParserAPI||{},textHelp.parsers.HTMLParserAPI=v},{"../SpeechStream/Events/EventBus":6,"../SpeechStream/Highlighting/SpeechHighlightManager":10,"../SpeechStream/Highlighting/StudySkillsHighlighting":11,"../SpeechStream/Prediction/PredictionManager":19,"../SpeechStream/Selection/HoverSpeak":24,"../SpeechStream/Selection/SelectionController":25,"../SpeechStream/SpeechObject":30,"../SpeechStream/THDomRange":33}],40:[function(e,t,n){"use strict";e("src/api/ParserAPI")},{"src/api/ParserAPI":39}]},{},[40]);