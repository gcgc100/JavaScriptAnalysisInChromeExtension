function $rw_barSSInit(){SSDAT.paths.strFileLoc;if((g_nIcons&collect_icon)==collect_icon||(g_nNoDisplayIcons&collect_icon)==collect_icon){g_bIE;var e="";e+='<span texthelpStopContinuous="1"></span>',SSDOM.BetterInnerHTML(SSDAT.pageData.placeholder,e,!1)}g_bSSLoaded=!0,"function"==typeof $rw_toolbarHighlightLoadedCallback&&$rw_toolbarHighlightLoadedCallback()}function studySkillsHTMLHighlightRange(e){try{var t=rw_getSelection();if(null==t||null==t.range||t.range instanceof String)return!1;var o=t.range;if(g_bIEOld){var n=o.parentElement().ownerDocument.body,l=rw_getTextRangeAsTHRange(n,o);if(null==l)return!1;var a=SSDOM.getCaretPairFromDomPosition(n,l.startRef.path,l.startRef.offset,l.endRef.path,l.endRef.offset),r=a.leftCaret,i=a.rightCaret;if(null==r||null==i)return!1;var g=new THDomRange(r.node,r.offset,i.node,i.offset);if(null==g)return null;if(null==(g=rw_checkTHRangeForValidHighlight(g)))return null;o=rw_getAsTextRange(n,g.startRef.path,g.startRef.offset,g.endRef.path,g.endRef.offset)}else o=rw_checkTHRangeForValidHighlight(o);return null==o?(rw_alert("Failed to do the highlight, possibly due to selection going into a non textual part of the page."),!1):(studySkillsHTMLHighlightRangeImpl(o,e),rw_collapseSelection(),g_bPersistAnnotations&&g_bPersistHighlights&&void 0!==rw_storeHighlightData&&rw_storeHighlightData(),!0)}catch(e){return!1}}function rw_checkTHRangeForValidHighlight(e){var t=e.startCaret,o=e.endCaret,n=!1;if(SSDOM.isInvalidNode(t.node)){if(t.node==o.node)return;var l=SSDOM.getNextTextNodeNoImg(t.node,!1,o.node,!1);if(null==l||SSDOM.isInvalidNode(l))return;t.node=l,t.offset=0,n=!0}var a=3!=t.node.nodeType||3==t.node.nodeType&&0==t.node.nodeValue.trimTH().length;if(a){for(n=!0;a;){if(t.node==o.node)return null;if(t.node=SSDOM.getNextTextNodeNoBlank(t.node,!1,o.node),null==t.node)return null;a=3!=t.node.nodeType||3==t.node.nodeType&&0==t.node.nodeValue.trimTH().length}t.offset=0}if(SSDOM.isInvalidNode(o.node)){if(t.node==o.node)return;var l=SSDOM.getPreviousTextNodeNoImg(o.node,!1,t.node,!1);if(null==l||SSDOM.isInvalidNode(l))return;o.node=l,o.offset=l.nodeValue.length,n=!0}if(a=3!=o.node.nodeType||3==o.node.nodeType&&0==o.node.nodeValue.trimTH().length){for(n=!0;a;){if(t.node==o.node)return null;if(o.node=SSDOM.getPreviousTextNodeNoImg(o.node,!1,t.node,!1),null==o.node)return null;a=3!=o.node.nodeType||3==o.node.nodeType&&0==o.node.nodeValue.trimTH().length}3==o.node.nodeType&&(o.offset=o.node.nodeValue.length)}return null==t.node||null==o.node?null:(n&&(e=new THDomRange(t.node,t.offset,o.node,o.offset)),e)}function studySkillsHTMLHighlightRangeImpl(e,t){try{var o=!1,n=null,l=null,a=null,r=!0;if(null==e||e instanceof String)return;var i=0,g=!1;if(g_bIEOld){if(a=rw_getTextFromRange(e),0==a.length)return;try{n=e.parentElement();var s=SSDOM.getComputedStyle(n);if(null!=s&&"none"==s.display)o=!0;else for(var c=n.ownerDocument.body;n!=c;)if(n=n.parentNode,"none"==SSDOM.getComputedStyle(n).display){o=!0;break}o&&(l=n.style.display,n.style.display="inline")}catch(e){}studySkillsHTMLRefreshRanges();for(var h=0;h<g_aTextRange.length;h++){var d=g_aTextRange[h],u=e.duplicate();u.collapse(!0);var _=d.inRange(u);u=e.duplicate(),u.collapse(!1);var S=d.inRange(u);g=!1,_&&S?g_aHighlightColour[h]==t?r=!1:(case1IE(h,e),g=!0):!_&&S?(case2IE(h,e),g=!0):_&&!S?(case3IE(h,e),g=!0):e.inRange(d)&&(g_aTextRange.splice(h,1),g_aHighlightColour.splice(h,1),h--,g=!0),g&&++i<100&&(h=-1)}}else{if(!e.toString)return;if(null==e||null==e.toString()||""==e.toString())return;for(var h=0;h<g_aTextRange.length;h++){var f=g_aTextRange[h];if(e.body.ownerDocument==f.body.ownerDocument){var p=e.compareRange(f);switch(p){case THDomRange_ERROR:window.status="Error occurred when trying to add a highlight.";break;case THDomRange_TARGET_SAME:if(g_aHighlightColour[h]==t){r=!1;break}case THDomRange_TARGET_INSIDE:f.refresh(),rw_removeHighlight(SSDOM.getListOfHighlightableNodes(f.startCaret,f.endCaret)),g_aTextRange.splice(h,1),g_aHighlightColour.splice(h,1),--h,e.refresh(),g=!0;break;case THDomRange_TARGET_INCLUDES_THIS:case THDomRange_TARGET_INCLUDES_THIS_AT_START:case THDomRange_TARGET_INCLUDES_THIS_AT_END:g_aHighlightColour[h]==t?r=!1:(case1SFF(h,e,p),++h,g=!0);break;case THDomRange_OVERLAPS_START_OF_TARGET:case2SFF(h,e),g=!0;break;case THDomRange_OVERLAPS_END_OF_TARGET:case3SFF(h,e),g=!0;break;case THDomRange_AFTER_TARGET:case THDomRange_BEFORE_TARGET:}}g&&++i<100&&(h=-1)}}if(g_bIENew&&rw_collapseSelection(),r){if(e.execCommand)studySkillsClearRangeIE(e),rw_ieSpecificCallToSetHighlight(e,t);else{var b=e.startCaret,v=e.endCaret;rw_setHighlight(b.node,b.offset,v.node,v.offset,t)}g_aTextRange.push(e),g_aHighlightColour.push(t)}return rw_collapseSelection(),o&&(n.style.display=l),!0}catch(e){return!1}}function rw_ieSpecificCallToSetHighlight(e,t){"strikethrough"==t?e.execCommand("strikethrough",!1,null):e.execCommand("backcolor",!1,t)}function case1IE(e,t){var o=g_aTextRange[e].duplicate(),n=g_aTextRange[e].duplicate();for(o.collapse(!0),n.collapse(!1);o.compareEndPoints("EndToStart",t)<0;)o.moveEnd("character",1);for(;n.compareEndPoints("StartToEnd",t)>0;)n.moveStart("character",-1);studySkillsClearRangeIE(g_aTextRange[e]),0==o.text.length?(g_aTextRange[e]=n,rw_ieSpecificCallToSetHighlight(g_aTextRange[e],g_aHighlightColour[e])):(g_aTextRange[e]=o,rw_ieSpecificCallToSetHighlight(g_aTextRange[e],g_aHighlightColour[e]),n.text.length>0&&(g_aTextRange.push(n),g_aHighlightColour.push(g_aHighlightColour[e]),rw_ieSpecificCallToSetHighlight(n,g_aHighlightColour[e])))}function case2IE(e,t){var o=g_aTextRange[e].duplicate();for(o.collapse(!1);o.compareEndPoints("StartToEnd",t)>0;)o.moveStart("character",-1);g_aTextRange[e]=o}function case3IE(e,t){var o=g_aTextRange[e].duplicate();for(o.collapse(!0);o.compareEndPoints("EndToStart",t)<0;)o.moveEnd("character",1);g_aTextRange[e]=o}function case1SFF(e,t,o){var n=g_aHighlightColour[e],l=g_aTextRange[e];l.refresh();var a=l.startRef,r=t.startRef,i=t.endRef,g=l.endRef;rw_removeHighlight(SSDOM.getListOfHighlightableNodes(l.startCaret,l.endCaret)),g_aTextRange.splice(e,1),g_aHighlightColour.splice(e,1);var s,c,h,d;o!=THDomRange_TARGET_INCLUDES_THIS_AT_START&&(caretRange=SSDOM.getCaretPairFromDomPosition(t.body,a.path,a.offset,r.path,r.offset),s=caretRange.leftCaret,c=caretRange.rightCaret,h=rw_setHighlight(s.node,s.offset,c.node,c.offset,n),d=new THDomRange(h.start,0,h.end,h.end.nodeValue.length),g_aTextRange.push(d),g_aHighlightColour.push(n)),o!=THDomRange_TARGET_INCLUDES_THIS_AT_END&&(caretRange=SSDOM.getCaretPairFromDomPosition(t.body,i.path,i.offset,g.path,g.offset),s=caretRange.leftCaret,c=caretRange.rightCaret,h=rw_setHighlight(s.node,s.offset,c.node,c.offset,n),d=new THDomRange(h.start,0,h.end,h.end.nodeValue.length),g_aTextRange.push(d),g_aHighlightColour.push(n)),t.refresh()}function case2SFF(e,t){var o=g_aHighlightColour[e],n=g_aTextRange[e];n.refresh();var l=t.endRef,a=n.endRef;rw_removeHighlight(SSDOM.getListOfHighlightableNodes(n.startCaret,n.endCaret)),g_aTextRange.splice(e,1),g_aHighlightColour.splice(e,1);var r=SSDOM.getCaretPairFromDomPosition(t.body,l.path,l.offset,a.path,a.offset),i=r.leftCaret,g=r.rightCaret,s=rw_setHighlight(i.node,i.offset,g.node,g.offset,o),c=new THDomRange(s.start,0,s.end,s.end.nodeValue.length);g_aTextRange.push(c),g_aHighlightColour.push(o),t.refresh()}function case3SFF(e,t){var o=g_aHighlightColour[e],n=g_aTextRange[e];n.refresh();var l=n.startRef,a=t.startRef;rw_removeHighlight(SSDOM.getListOfHighlightableNodes(n.startCaret,n.endCaret)),g_aTextRange.splice(e,1),g_aHighlightColour.splice(e,1);var r=SSDOM.getCaretPairFromDomPosition(t.body,l.path,l.offset,a.path,a.offset),i=r.leftCaret,g=r.rightCaret,s=rw_setHighlight(i.node,i.offset,g.node,g.offset,o),c=new THDomRange(s.start,0,s.end,s.end.nodeValue.length);g_aTextRange.push(c),g_aHighlightColour.push(o),t.refresh()}function testRange(e){var t="";t+="range.collapse="+e.collapse+"\n",t+="range.duplicate="+e.duplicate+"\n",t+="range.inRange="+e.inRange+"\n",t+="range.text="+e.text+"\n",t+="range.compareEndPoints="+e.compareEndPoints+"\n",rw_alert(t)}function studySkillsClearHighlights(e){try{var t=rw_getSelection(),o=null;if(null!=t&&null!=t.range&&(o=t.range,t.frame),null!=o&&o instanceof String){if(null!=g_lastInputSelectSFF&&(g_lastInputSelectSFF.selectionStart=0,g_lastInputSelectSFF.selectionEnd=0),g_lastInputSelectSFF=null,!e)return;o=null}if(g_bIEOld){if(null==o||0==o.length||0==o.text.length||e){if(!e){var n=confirm(textHelp.webreader.LocaleSingleton.getInst().getLocaleString("speechstream_msh_removehighlights"));if(!n)return}g_bPersistAnnotations&&(g_strStoredHighlightData=null,g_strStoredHighlightUnprocessedData=null);for(var l=g_aTextRange.length,a=0;a<l;a++){studySkillsClearRangeIE(g_aTextRange[a]),g_aTextRange[a]=null,g_aHighlightColour[a]=null}if(g_aTextRange=new Array,g_aHighlightColour=new Array,!document.compatMode.equalsTH("CSS1Compat"))if(!g_bIgnoreFrames&&top.frames.length>0){var r=0,i=top.frames.length;for(r=0;r<i;r++)try{var g=top.frames[r];o=g.document.selection.createRange(),o.expand("textedit"),studySkillsClearRangeIE(o)}catch(e){}}else o=document.selection.createRange(),o.expand("textedit"),studySkillsClearRangeIE(o);return void(g_bPersistAnnotations&&g_bPersistHighlights&&void 0!==rw_storeHighlightData&&rw_storeHighlightData())}studySkillsClearRangeIE(o),studySkillsHTMLRefreshRanges();var l=g_aTextRange.length,a=0,s=null,c=null;for(a=0;a<l;a++)if(null!=(s=g_aTextRange[a])){if(o.inRange(s)){s=null,g_aTextRange.splice(a,1),g_aHighlightColour.splice(a,1),a--;continue}if(c=s.duplicate(),c.collapse(!0),o.inRange(c)){var h=s.duplicate();for(h.collapse(!1);h.compareEndPoints("StartToEnd",o)>0;)h.moveStart("character",-1);studySkillsClearRangeIE(g_aTextRange[a]),g_aTextRange[a]=h,rw_ieSpecificCallToSetHighlight(g_aTextRange[a],g_aHighlightColour[a])}else if(c=s.duplicate(),c.collapse(!1),o.inRange(c)){var d=s.duplicate();for(d.collapse(!0);d.compareEndPoints("EndToStart",o)<0;)d.moveEnd("character",1);studySkillsClearRangeIE(g_aTextRange[a]),g_aTextRange[a]=d,rw_ieSpecificCallToSetHighlight(g_aTextRange[a],g_aHighlightColour[a])}if(s.inRange(o)){studySkillsClearRangeIE(s);var d=s.duplicate(),h=s.duplicate();for(d.collapse(!0),h.collapse(!1);d.compareEndPoints("EndToStart",o)<0;)d.moveEnd("character",1);for(;h.compareEndPoints("StartToEnd",o)>0;)h.moveStart("character",-1);studySkillsClearRangeIE(g_aTextRange[a]),g_aTextRange[a]=d,g_aTextRange.push(h),g_aHighlightColour.push(g_aHighlightColour[a]),rw_ieSpecificCallToSetHighlight(d,g_aHighlightColour[a]),rw_ieSpecificCallToSetHighlight(h,g_aHighlightColour[a])}}o.execCommand("UnSelect",!1,null)}else{if(null==o||e){if(!e){var n=confirm(textHelp.webreader.LocaleSingleton.getInst().getLocaleString("speechstream_msh_removehighlights"));if(!n)return}g_bPersistAnnotations&&(g_strStoredHighlightData=null,g_strStoredHighlightUnprocessedData=null);var u=g_aTextRange;g_aTextRange=new Array,g_aHighlightColour=new Array;for(var r=0;r<u.length;r++){var s=u[r];s.refresh(),rw_removeHighlight(SSDOM.getListOfHighlightableNodes(s.startCaret,s.endCaret))}}else{o.refresh();for(var a=0;a<g_aTextRange.length;a++){var _=g_aTextRange[a];if(o.body==_.body){var S=o.compareRange(_);switch(S){case THDomRange_ERROR:window.status="Error occurred when trying to remove a highlight.";break;case THDomRange_TARGET_SAME:case THDomRange_TARGET_INSIDE:_.refresh(),rw_removeHighlight(SSDOM.getListOfHighlightableNodes(_.startCaret,_.endCaret)),g_aTextRange.splice(a,1),g_aHighlightColour.splice(a,1),--a,o.refresh();break;case THDomRange_TARGET_INCLUDES_THIS:case THDomRange_TARGET_INCLUDES_THIS_AT_START:case THDomRange_TARGET_INCLUDES_THIS_AT_END:case1SFF(a,o,S),++a;break;case THDomRange_OVERLAPS_START_OF_TARGET:case2SFF(a,o);break;case THDomRange_OVERLAPS_END_OF_TARGET:case3SFF(a,o);break;case THDomRange_AFTER_TARGET:case THDomRange_BEFORE_TARGET:}}}}rw_collapseSelection()}g_bPersistAnnotations&&g_bPersistHighlights&&void 0!==rw_storeHighlightData&&rw_storeHighlightData(),g_abVisible[POPUP_COLLECT]&&$rw_divPress(POPUP_COLLECT)}catch(e){thLog("Error in method: "+e.name+" "+e.message+" "+e.description+" "+e.toString())}}function studySkillsClearRangeIE(e){e.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&e.execCommand("RemoveFormat",!1,null)}function sortBy(e,t){try{return e.compareEndPoints("EndToEnd",t)}catch(e){return thLog("sortby "+e.message),0}}function sortBySFF(e,t){try{if(e.equals(t))return 0;e.refresh(),t.refresh();var o=e.getEndAsRange(),n=t.getEndAsRange();return o.compareBoundaryPoints("END_TO_END",n)}catch(e){return thLog("sortBySFF "+e.message),0}}function showDialog(){g_eventSubScribeID=textHelp.webreaderapi.EventBusSingleton.getInst().subscribe("onGetSettingsChanged",this.onGetSettingsChanged,this),textHelp.webreader.UserSettingsSingleton.getInst().updateUserSettings()}function hasClassName(e,t){return e.classList.contains(t)}function changeClassName(e,t,o){e.classList.remove(t),e.classList.add(o)}function showDialogwithSetting(e){var t=document.querySelector("#thSSCHODialog");if(null!==t)return void(g_showTHCHDialog=!1);t=document.createElement("div"),t.id="thSSCHODialog",t.className="gdwr-modal-dialog-bg";var o="opacity: 0.5; width: "+document.body.clientWidth+"px; height: "+document.body.clientHeight+"px;";t.setAttribute("style",o),dialog=document.createElement("div"),dialog.className="gdwr-modal-dialog gdwr-collecthighlights-dialog",dialog.id="thCHDialog",o="left: "+(Math.round(screen.width/2)-125)+"px; top: "+(Math.round(screen.height/2)-160)+"px;",dialog.setAttribute("style",o),dialog.innerHTML='<div class="gdwr-modal-dialog-title" id=":0"><span class="gdwr-modal-dialog-title-text" data-speechstream-collecthighlights-dialog="speechstream_collect_highlights_dialog_heading">Collect Highlights</span><span class="gdwr-modal-dialog-title-close"></span></div><div class="gdwr-modal-dialog-content"><div class="thchitems"><div class="sortLabel" data-speechstream-collecthighlights-dialog="speechstream_collecthighlights_sort">Sort highlights by</div><select id="sortSelect" class="thSelect"><option value="0" data-speechstream-collecthighlights-dialog="speechstream_collecthighlights_color">color</option><option value="1" data-speechstream-collecthighlights-dialog="speechstream_collecthighlights_position">position</option></select><div class="thchcolors"><span data-speechstream-collecthighlights-dialog="speechstream_collecthighlights_to_collect">Colors to collect</span><div><div id="thYellowChk" class="thCollectChks thYellowChk goog-checkbox-checked goog-checkbox" tabindex="0" aria-checked="true" role="checkbox" style="-webkit-user-select: none;"><div class="thRects thYellowRect"></div></div><br><div id="thBlueChk" class="thCollectChks thBlueChk goog-checkbox-checked goog-checkbox" tabindex="0" aria-checked="true" role="checkbox" style="-webkit-user-select: none;"><div class="thRects thBlueRect"></div></div><br><div id="thGreenChk" class="thCollectChks thGreenChk goog-checkbox-checked goog-checkbox" style="-webkit-user-select: none;" 0"="" aria-checked="true" role="checkbox" tabindex="0"><div class="thRects thGreenRect"></div></div><br><div id="thPinkChk" class="thCollectChks thPinkChk goog-checkbox-checked goog-checkbox" tabindex="0" aria-checked="true" role="checkbox" style="-webkit-user-select: none;"><div class="thRects thPinkRect"></div></div><br></div></div></div><div class="gdwr-modal-dialog-buttons gdwr-collect-dialog-buttons"><button class="goog-button gdwr-dialog-button" title="" value="" data-speechstream-collecthighlights-dialog="dialog_Cancel">Cancel</button><button class="goog-button gdwr-dialog-button" title="" value="" data-speechstream-collecthighlights-dialog="dialog_OK">OK</button></div></div><div class="gdwr-modal-dialog-buttons" style="display: none;"></div>';var n=document.getElementById("thSpeechStreamTBPlaceHolder");n.appendChild(t),n.appendChild(dialog);var l=e.sortAlgorithm;document.querySelector("#sortSelect").selectedIndex=l;var a=document.querySelector("#thYellowChk");!0!==e.yellow&&void 0!==e.yellow&&changeClassName(a,"goog-checkbox-checked","goog-checkbox-unchecked"),a.addEventListener("click",function(e){hasClassName(a,"goog-checkbox-checked")?changeClassName(a,"goog-checkbox-checked","goog-checkbox-unchecked"):changeClassName(a,"goog-checkbox-unchecked","goog-checkbox-checked")},!0);var r=document.querySelector("#thBlueChk");!0!==e.blue&&void 0!==e.blue&&changeClassName(r,"goog-checkbox-checked","goog-checkbox-unchecked"),r.addEventListener("click",function(e){hasClassName(r,"goog-checkbox-checked")?changeClassName(r,"goog-checkbox-checked","goog-checkbox-unchecked"):changeClassName(r,"goog-checkbox-unchecked","goog-checkbox-checked")},!0);var i=document.querySelector("#thGreenChk");!0!==e.green&&void 0!==e.green&&changeClassName(i,"goog-checkbox-checked","goog-checkbox-unchecked"),i.addEventListener("click",function(e){hasClassName(i,"goog-checkbox-checked")?changeClassName(i,"goog-checkbox-checked","goog-checkbox-unchecked"):changeClassName(i,"goog-checkbox-unchecked","goog-checkbox-checked")},!0);var g=document.querySelector("#thPinkChk");!0!==e.pink&&void 0!==e.pink&&changeClassName(g,"goog-checkbox-checked","goog-checkbox-unchecked"),g.addEventListener("click",function(e){hasClassName(g,"goog-checkbox-checked")?changeClassName(g,"goog-checkbox-checked","goog-checkbox-unchecked"):changeClassName(g,"goog-checkbox-unchecked","goog-checkbox-checked")},!0),dialog.addEventListener("click",function(e){var t=e.target.nodeName,o=e.target.innerText;if("BUTTON"==t)switch(o){case"OK":onOKCHDialog();break;default:onCancelCHDialog()}},!0);for(var s=dialog.querySelectorAll("[data-speechstream-collecthighlights-dialog]"),c=0;c<s.length;c++){var h=s[c].getAttribute("data-speechstream-collecthighlights-dialog");s[c].innerText=textHelp.webreader.LocaleSingleton.getInst().getLocaleString(h)}}function onOKCHDialog(){textHelp.webreaderapi.EventBusSingleton.getInst().unsubscribe(g_eventSubScribeID);var e=textHelp.webreader.UserSettingsSingleton.getInst().getUserSettings(),t=document.querySelector("#sortSelect");e.collecthighlights.sortAlgorithm=t.selectedIndex,hasClassName(document.querySelector("#thYellowChk"),"goog-checkbox-checked")?e.collecthighlights.yellow=!0:e.collecthighlights.yellow=!1,hasClassName(document.querySelector("#thBlueChk"),"goog-checkbox-checked")?e.collecthighlights.blue=!0:e.collecthighlights.blue=!1,hasClassName(document.querySelector("#thGreenChk"),"goog-checkbox-checked")?e.collecthighlights.green=!0:e.collecthighlights.green=!1,hasClassName(document.querySelector("#thPinkChk"),"goog-checkbox-checked")?e.collecthighlights.pink=!0:e.collecthighlights.pink=!1,textHelp.webreader.UserSettingsSingleton.getInst().saveUserSettings(e);var o=document.querySelector("#thCHDialog");null!==o&&o.parentNode.removeChild(o);var n=document.querySelector("#thSSCHODialog");null!==n&&n.parentNode.removeChild(n),g_showTHCHDialog=!1;var l=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("collect_highlights_notification"),a=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("collect_highlights_notification_text"),r={msg:'<div><div class="vl-notification"><div class="vl-notification-content"><div class="vl-notification-heading">'+l+'</div><div class="vl-notification-msg">'+a+"</div></div></div></div>",sticky:!0,type:"success",animIn:"fadeInRight",animOut:"fadeOutDown"},i=window.notification(r);g_collectHighlightsTab=window.open("","_blank"),collectHighlightsWithSettings({sortBy:t.selectedIndex,yellow:e.collecthighlights.yellow,blue:e.collecthighlights.blue,green:e.collecthighlights.green,pink:e.collecthighlights.pink,title:document.getElementsByTagName("title")[0].innerHTML,url:window.location.href},i)}function collectHighlightsWithSettings(e,t){if(0==e.sortBy)return void collectHighlightsByColor(e,t);collectHighlightsByPosition(e,t)}function collectHighlightsByColor(e,t){var o=[];e.yellow&&(o=o.concat(studySkillsCollateForColour(["yellow"]))),e.blue&&(o=o.concat(studySkillsCollateForColour(["blue"]))),e.green&&(o=o.concat(studySkillsCollateForColour(["green"]))),e.pink&&(o=o.concat(studySkillsCollateForColour(["pink"])));var n=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("ch_documentTitle"),l={highlights:o,title:document.getElementsByTagName("title")[0].innerHTML,url:window.location.href,docTitle:n};g_notifID=t,g_eventSubScribeCollectID=textHelp.webreaderapi.EventBusSingleton.getInst().subscribe("onCollectHighlightsWeb",this.onCollectHighlightsWeb,this),window.postMessage({method:"collectHighlightsWeb",type:"1757FROM_PAGERW4G",documentHighlights:l},"*")}function collectHighlightsByPosition(e,t){var o=[],n=[],o=[];e.yellow&&n.push("yellow"),e.blue&&n.push("blue"),e.green&&n.push("green"),e.pink&&n.push("pink"),o=o.concat(studySkillsCollateForColour(n));var l={highlights:o,title:document.getElementsByTagName("title")[0].innerHTML,url:window.location.href};g_notifID=t,g_eventSubScribeCollectID=textHelp.webreaderapi.EventBusSingleton.getInst().subscribe("onCollectHighlightsWeb",this.onCollectHighlightsWeb,this),window.postMessage({method:"collectHighlightsWeb",type:"1757FROM_PAGERW4G",documentHighlights:l},"*")}function onGetSettingsChanged(e){try{textHelp.webreaderapi.EventBusSingleton.getInst().unsubscribe(g_eventSubScribeID)}catch(e){window.console.error(e.stack)}}function onCollectHighlightsWeb(e){try{g_notifID.remove(),textHelp.webreaderapi.EventBusSingleton.getInst().unsubscribe(g_eventSubScribeCollectID),g_collectHighlightsTab.location=e,g_collectHighlightsTab.focus()}catch(e){window.console.error(e.stack)}}function onVocabWeb(e){try{g_notifID.remove(),textHelp.webreaderapi.EventBusSingleton.getInst().unsubscribe(g_eventSubScribeVocabID),g_vocabTab.location=e,g_vocabTab.focus()}catch(e){window.console.error(e.stack)}}function onCancelCHDialog(){textHelp.webreaderapi.EventBusSingleton.getInst().unsubscribe(g_eventSubScribeID);var e=document.querySelector("#thCHDialog");null!==e&&e.parentNode.removeChild(e);var t=document.querySelector("#thSSCHODialog");null!==t&&t.parentNode.removeChild(t),g_showTHCHDialog=!1}function onGetSettingsChanged(e){try{if(void 0==e.thRWFGSettings)return;if(null!==document.querySelector("#thCHDialog"))return;if(g_showTHCHDialog)return;g_showTHCHDialog=!0,showDialogwithSetting(window.JSON.parse(e.thRWFGSettings))}catch(e){window.console.error(e.stack)}}function studySkillsCollate(){try{return showDialog(),""}catch(e){return thLog("Error in method: "+e.name+" "+e.message+" "+e.toString()),""}}function collateFilter(e){if(e.indexOf("\\")>-1||e.indexOf("~")>-1||e.indexOf("|")>-1){var t,o;for(o=0;o<e.length;o++)t=e.charCodeAt(o),126==t?(e=e.substring(0,o)+"\\h"+e.substr(o+1),++o):124==t?(e=e.substring(0,o)+"\\v"+e.substr(o+1),++o):92==t&&(e=e.substring(0,o)+"\\\\"+e.substr(o+1),++o)}return e}function studySkillsCollateValuesOnly(){try{var e;e=studySkillsCollateForColourValuesOnly("cyan");var t=studySkillsCollateForColourValuesOnly("magenta");e.length>0&&t.length>0&&(e+="|"),e+=t;var o=studySkillsCollateForColourValuesOnly("yellow");e.length>0&&o.length>0&&(e+="|"),e+=o;var n=studySkillsCollateForColourValuesOnly("orange");e.length>0&&n.length>0&&(e+="|"),e+=n;var l=studySkillsCollateForColourValuesOnly("lightgreen");return e.length>0&&l.length>0&&(e+="|"),e+=l}catch(e){return thLog("Error in method: "+e.name+" "+e.message+" "+e.toString()),""}}function rw_selectCollateText(){var e=document.getElementById("rwcollatewrapper");if(null!=e){if(g_bIEOld){var t=SSDOM.getRangeObject(e.ownerDocument.body);t.moveToElementText(e),t.select()}else{var o=SSDOM.getNextNodeIgnoreChildren(e,!1,null);if(null!=o){var t=new THDomRange(e,0,o,0);rw_selectSection(t)}}try{var n=g_controllerFactory.getConnector();if(null!=n){var l=rw_getSelectionNonParsed();null!=l&&0!=l.length&&n.setToClipboard(l.valueOf())}}catch(e){thLogE(e)}}}function $rw_getHighlights(e){return e=e.toLowerCase(),"blue"==e?e="cyan":"red"==e&&(e="magenta"),"green"==e&&(e="lightgreen"),studySkillsCollateForColour(e)}function getColor(e){return e=e.toLowerCase(),"cyan"==e?e="blue":"magenta"==e&&(e="pink"),"lightgreen"==e&&(e="green"),e}function studySkillsCollateForColour(e){for(var t=new Array,o=(new Array,[]),n=g_aTextRange.length,l=0,a=0;a<n;a++){var r=getColor(g_aHighlightColour[a]);if(-1!=e.indexOf(r)){var i=g_aTextRange.slice(a,a+1).pop();i.color=r,t.push(i)}}g_bIEOld?t.sort(sortBy):t.sort(sortBySFF);for(var g,s=t.length,a=0;a<s;a++){var c,h=t[a].color;if(g_bIEOld){var d=t.slice(a,a+1).pop(),u=rw_getTextRangeAsTHRange(d.parentElement().ownerDocument.body,d);c=rw_getTHCaretRangeFromTHRange(u)}else c=rw_getTHCaretRangeFromTHDomRange(t[a]);g=SSDOM.getTextOverCaretRange(c),g.length>0&&(g=rw_filterForHtml(g),l++,o.push({text:g,color:h}))}return o}function studySkillsCollateForColourValuesOnly(e){for(var t=new Array,o=g_aTextRange.length,n="",l="",a=0;a<o;a++){g_aHighlightColour[a]==e&&t.push(g_aTextRange.slice(a,a+1).pop())}g_bIEOld?t.sort(sortBy):t.sort(sortBySFF);for(var r,i=t.length,a=0;a<i;a++)r=g_bIEOld?t.slice(a,a+1).pop().text:t[a].toString(),r.length>0&&(l+="~"+collateFilter(r));return l.length>0&&(n+=e,n+=l),n}function hasStudySkills(){return null!=g_aTextRange&&g_aTextRange.length>0}function $rw_event_cyan(){try{stopTexthelpScreenshotReading(),studySkillsHTMLHighlightRange("cyan")}catch(e){thLogE(e)}}function $rw_event_magenta(){try{stopTexthelpScreenshotReading(),studySkillsHTMLHighlightRange("magenta")}catch(e){thLogE(e)}}function $rw_event_yellow(){try{stopTexthelpScreenshotReading(),studySkillsHTMLHighlightRange("yellow")}catch(e){thLogE(e)}}function $rw_event_orange(){try{stopTexthelpScreenshotReading(),studySkillsHTMLHighlightRange("orange")}catch(e){thLogE(e)}}function $rw_event_green(){try{stopTexthelpScreenshotReading(),studySkillsHTMLHighlightRange("lightgreen")}catch(e){thLogE(e)}}function $rw_event_strike(){try{studySkillsHTMLHighlightRange("strikethrough")}catch(e){thLogE(e)}}function $rw_event_clear(){try{stopTexthelpScreenshotReading(),studySkillsClearHighlights(!1)}catch(e){thLogE(e)}}function $rw_clearAllHighlights(){studySkillsClearHighlights(!0)}function $rw_refreshHighlights(){var e=g_bPersistAnnotations;g_bPersistAnnotations=!1,g_strStoredHighlightData=null,g_strStoredHighlightUnprocessedData=null,studySkillsClearHighlights(!0),g_bPersistAnnotations=e,rw_retrieveHighlightDataForPKT()}function $rw_event_collect(){try{stopTexthelpScreenshotReading(),rw_doCollect()}catch(e){thLogE(e)}}function $rw_event_vocabulary(){try{stopTexthelpScreenshotReading(),(new SpeechStream.Vocab).sendRequest()}catch(e){thLogE(e)}}function studySkillsHTMLRefreshRanges(){try{var e=null,t=!1,o=0;for(o=0;o<g_aTextRange.length;o++){e=g_aTextRange[o];try{null!=e.text&&""!=e.text||(e=null)}catch(t){thLogE(t),e=null}null==e&&(g_aTextRange.splice(o,1),g_aHighlightColour.splice(o,1),t=!0,o--)}return t}catch(e){return thLog("Error in method studySkillsHTMLRefreshRanges: "+e.toString()),!1}}function rw_submitSSDataWithPost(e){var t;t=null!=g_strHighlightStorageUrl?g_strHighlightStorageUrl:g_strPersistStorageUrl;var o=rw_getHTTPText(!1)+t+"/stickynoteserver/",n="cmd="+CMD_ADD_SSDATA;g_bPktFlag||(n+="&custid="+rw_custEscape(g_strCustId)),n+="&titleid="+rw_custEscape(g_strBookId),n+="&pageid="+rw_custEscape(g_strPageId),n+="&teacherid="+rw_custEscape(g_strPersistHighlightReaderId),n+="&studentid="+rw_custEscape(g_strPersistHighlightEditorId);var l=e[0],a=e[1];n+="&ssdata="+rw_custEscape(l),null!=a&&(n+="&highlighttext="+a),(new SpeechStream.AjaxRequest).doPost(o,n,rw_SSPostCallback,null,!1)}function rw_submitSSDataWithGet(e){var t;t=null!=g_strHighlightStorageUrl?g_strHighlightStorageUrl:g_strPersistStorageUrl;var o=rw_getHTTPText(!1)+t+"/stickynoteserver/?"+CMD_CODE+"="+CMD_ADD_SSDATA;g_bPktFlag||(o+="&custid="+rw_custEscape(g_strCustId)),o+="&titleid="+rw_custEscape(g_strBookId),o+="&pageid="+rw_custEscape(g_strPageId),o+="&teacherid="+rw_custEscape(g_strPersistHighlightReaderId),o+="&studentid="+rw_custEscape(g_strPersistHighlightEditorId);var n=e[0],l=e[1];o+="&ssdata="+rw_custEscape(n),null!=l&&(o+="&highlighttext="+encodeURIComponent(l));var a=document.createElement("script");a.type="text/javascript",a.src=o,document.body.appendChild(a)}function rw_submitViaFlash(e){var t=g_controllerFactory.getConnector();if(null!=t){var o,n=e[0],l=e[1];o=null!=g_strHighlightStorageUrl?g_strHighlightStorageUrl:g_strPersistStorageUrl;var a=rw_getHTTPText(!1)+o+"/stickynoteserver/",r=CMD_ADD_SSDATA,i=g_bPktFlag?null:g_strCustId,g=g_strBookId,s=g_strPageId,c=g_strPersistHighlightReaderId,h=g_strPersistHighlightEditorId;t.storeIEHighlightData(a,r,i,g,s,c,h,n,l)}}function $rw_submitViaFlashCallback(p_strSrc){eval(p_strSrc)}function rw_getStudySkillsPositionData(){var e=g_aTextRange.length,t="",o=null;g_bStoreHighlightText&&(o="|");try{for(var n=0;n<e;n++){t+="|";t+=g_aHighlightColour[n]+"|";var l,a,r,i=g_aTextRange[n];if(g_bIEOld){g_bStoreHighlightText&&(r=i.text);var g=rw_getTextRangeAsTHRange(i.body,i);l=g.startRef,a=g.endRef}else{i.refresh(),g_bStoreHighlightText&&(r=i.toString());var s=i.startCaret.node,c=i.startCaret.offset,h=i.endCaret.node,d=i.endCaret.offset;if(3==s.nodeType&&0==s.nodeValue.trimTH().length){for(s=SSDOM.getNextNode(s,!1,h),c=0;null!=s&&3==s.nodeType&&0==s.nodeValue.trimTH().length;)s=SSDOM.getNextNode(s,!1,h);null==s&&(s=h)}var u=rw_getRefPt(s,c);if(3==h.nodeType&&0==h.nodeValue.trimTH().length){for(d=0;s!=h&&null!=h&&3==h.nodeType&&0==h.nodeValue.trimTH().length;)h=SSDOM.getPreviousNode(h,!1,s);null!=h&&3==h.nodeType&&h.nodeValue.trimTH().length>0&&(d=h.nodeValue.length)}var _=rw_getRefPt(h,d);l=u,a=_}if(null!=l&&null!=a){var S=SSDOM.getCaretPairFromDomPosition(i.body,l.path,l.offset,a.path,a.offset),f=S.leftCaret,p=S.rightCaret;t+=rw_convertToPermCaretPosition(f)+"|"+rw_convertToPermCaretPosition(p),g_bStoreHighlightText&&(r=rw_replaceAll(r,"|","&#124;"),o+=encodeURIComponent(r)+"|")}}t.length>0&&(t+="|*188")}catch(e){thLogE(e)}return new Array(t,o)}function rw_convertToPermCaretPosition(e){var t=e.node.ownerDocument.body,o=e.node,n=e.offset;n+=rw_getNodeOffset(o);for(var l=o.parentNode,a=l.getAttribute("id");(null==a||0==a.length)&&l!=t;)n+=rw_getNodeOffset(l),l=l.parentNode,a=l.getAttribute("id");if(null!=a&&a.length>0){if(strPos="idx"+a,null!=l&&null!=l.firstChild){var r=SSDOM.getFirstChildTextNode(l,!1);if(3==r.nodeType){for(var i=0,g=r.nodeValue;g.length>i&&32==g.charCodeAt(i);)++i;n-=i}}}else{var s=rw_getRefPt(e.node,e.offset);strPos=s.path,n=s.offset}return strPos+"|"+n}function rw_convertFromPermCaretPosition(e,t,o){var n=SSDOM.getPositionInDom(e),l=0;if(o&&null!=e.firstChild){var a=SSDOM.getFirstChildTextNode(e,!1);if(null==a)return null;if(3==a.nodeType)for(var r=a.nodeValue;r.length>l&&32==r.charCodeAt(l);)++l}return new THDomRefPt(n,t+l)}function rw_restoreHighlights(e){var t=!1;if(e.length>4){var o=e.substr(e.length-4);if("*"==o.charAt(0)){parseInt(o.substr(o.length-3),10)>=188&&(t=!0)}}for(var n,l,a,r,i,g,s,c,h=e.indexOf("|"),d=e.indexOf("|",h+1),u=e.indexOf("|",d+1),_=e.indexOf("|",u+1),S=e.indexOf("|",_+1),f=e.indexOf("|",S+1);h>-1&&d>-1&&u>-1&&_>-1&&S>-1&&f>-1;){c=!0,n=e.substring(h+1,d),l=e.substring(d+1,u),a=e.substring(u+1,_),i=e.substring(_+1,S),g=e.substring(S+1,f),r=parseInt(a,10),s=parseInt(g,10);var p=document.body;if(l.length>3&&"idx"==l.substring(0,3)){var b=rw_getElementById(l.substr(3));if(null==b)c=!1;else{p=b.ownerDocument.body;var v=rw_convertFromPermCaretPosition(b,r,t);null==v?c=!1:(l=v.path,r=v.offset)}}if(i.length>3&&"idx"==i.substring(0,3)){var b=rw_getElementById(i.substr(3));if(null==b)c=!1;else{p=b.ownerDocument.body;var v=rw_convertFromPermCaretPosition(b,s,t);null==v?c=!1:(i=v.path,s=v.offset)}}if(c){var T=null;if(g_bIEOld)T=rw_getAsTextRange(p,l,r,i,s);else{var m=SSDOM.getCaretPairFromDomPosition(p,l,r,i,s),H=m.leftCaret,C=m.rightCaret;null!=H&&null!=C&&(T=new THDomRange(H.node,H.offset,C.node,C.offset))}null!=T?studySkillsHTMLHighlightRangeImpl(T,n):c=!1}
c||(null==g_strStoredHighlightUnprocessedData&&(g_strStoredHighlightUnprocessedData=""),g_strStoredHighlightUnprocessedData+=e.substring(h,f)),h=f,d=e.indexOf("|",h+1),u=e.indexOf("|",d+1),_=e.indexOf("|",u+1),S=e.indexOf("|",_+1),f=e.indexOf("|",S+1)}}function rw_storeHighlightData(){g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var e=rw_getStudySkillsPositionData();null!=g_strStoredHighlightUnprocessedData?(e[0]=g_strStoredHighlightUnprocessedData+e[0],g_bStoreHighlightText&&(g_nHighlightNotSyncedState=1)):g_nHighlightNotSyncedState=0,g_strStoredHighlightData=null,g_bIE&&!g_controllerFactory.doesSupportHtml5()?rw_submitViaFlash(e):g_bStoreHighlightText?rw_submitSSDataWithPost(e):rw_submitSSDataWithGet(e)}function rw_storeHighlightCallback(p_strRes){eval(p_strRes)}function rw_retrieveHighlightDataForPKT(){if(SpeechStream.annotateBlock.m_bUseAnnotations){if(null!=g_strStoredHighlightData)return void $rw_retrieveHighlightDataForPKTReply(g_strStoredHighlightData);if(!g_bAnnotationGlobalCheck||g_bAnnotationGlobalAllowed){var e,t=new Date,o=t.getTime();e=null!=g_strHighlightStorageUrl?g_strHighlightStorageUrl:g_strPersistStorageUrl;var n=rw_getHTTPText(!1)+e+"/stickynoteserver/?"+CMD_CODE+"=";g_bAnnotationGlobalCheck&&g_bAnnotationGlobalUnknown?n+=CMD_RETRIEVE_SSDATA_EXTRA:n+=CMD_RETRIEVE_SSDATA,g_bPktFlag||(n+="&custid="+rw_custEscape(g_strCustId)),n+="&titleid="+rw_custEscape(g_strBookId),n+="&pageid="+rw_custEscape(g_strPageId),n+="&teacherid="+rw_custEscape(g_strPersistHighlightReaderId),n+="&studentid="+rw_custEscape(g_strPersistHighlightEditorId),n+="&"+o+Math.floor(111*Math.random());var l=document.createElement("script");l.type="text/javascript",l.src=n,document.body.appendChild(l)}}}function $rw_retrieveHighlightDataForPKTReply(e){var t=g_bIgnoreHidden;try{"boolean"!=typeof eba_ignore_hidden||eba_ignore_hidden||(g_bIgnoreHidden=!1),"[e2020-nomatch]"==e?rw_setNotUsingAnnotations():g_bAnnotationGlobalCheck&&g_bAnnotationGlobalUnknown&&rw_setUsingAnnotations();var o;2==g_nHighlightNotSyncedState&&(o=g_strStoredHighlightUnprocessedData),g_strStoredHighlightUnprocessedData=null,rw_restoreHighlights(e),g_strStoredHighlightData=e,2==g_nHighlightNotSyncedState&&(o!=g_strStoredHighlightUnprocessedData&&rw_storeHighlightData(),g_nHighlightNotSyncedState=null==g_strStoredHighlightUnprocessedData?0:1)}catch(e){thLog(e.message)}"boolean"!=typeof eba_ignore_hidden||eba_ignore_hidden||(g_bIgnoreHidden=t),"*"!=g_strPersistNoteEditorId&&"undefined"!=typeof rw_unserialiseStickyNotes&&rw_unserialiseStickyNotes()}if($rw_barSSInit(),void 0===g_aTextRange)var g_aTextRange=new Array;if(void 0===g_aHighlightColour)var g_aHighlightColour=new Array;var g_showTHCHDialog=!1,g_eventSubScribeID,g_eventSubScribeCollectID,g_eventSubScribeVocabID,g_collectHighlightsTab,g_vocabTab,g_notifID=null,rw_SSPostCallback=function rw_SSPostCallback(p_strData){try{eval(p_strData)}catch(e){}},g_nHighlightNotSyncedState=0,g_strStoredHighlightData=null,g_strStoredHighlightUnprocessedData=null;SpeechStream.Vocab=function(){this.m_bSentenceSelection=!1},SpeechStream.Vocab.prototype.fetchWords=function(){for(var e=new Array,t=new Array,o=g_aTextRange.length,n=0;n<o;n++){var l;if(l=g_bIEOld?g_aTextRange.slice(n,n+1).pop().text:g_aTextRange[n].toString(),-1==l.trimTH().indexOf(" ")){if(t.push(g_aTextRange.slice(n,n+1).pop()),t.length>=g_nVocabLimit&&-1!=g_nVocabLimit)break}else this.m_bSentenceSelection=!0}g_bIEOld?t.sort(sortBy):t.sort(sortBySFF);for(var a,r=t.length,i=0;i<r;i++){a=g_bIEOld?t.slice(i,i+1).pop().text:t[i].toString(),a=a.trim();var g=".,?!";g=function(e){return e.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&")}(g),a=a.replace(new RegExp("^["+g+"]+|["+g+"]+$","g"),""),e.push(a)}return e},SpeechStream.Vocab.prototype.generateRequestData=function(){var e=this.fetchWords();if(0==e.length)return this.m_bSentenceSelection?alert(textHelp.webreader.LocaleSingleton.getInst().getLocaleString("speechstream_msh_singlewordnoselection")):alert(textHelp.webreader.LocaleSingleton.getInst().getLocaleString("speechstream_msh_noselection")),null;var t=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_notification"),o=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_notification_text"),n={msg:'<div><div class="vl-notification"><div class="vl-notification-content"><div class="vl-notification-heading">'+t+'</div><div class="vl-notification-msg">'+o+"</div></div></div></div>",sticky:!0,type:"success",animIn:"fadeInRight",animOut:"fadeOutDown"};g_notifID=window.notification(n),g_vocabTab=window.open("","_blank");var l=textHelp.webreader.ConfigurationSingleton.getInst().getConfiguration(),a=new Object;a.words=e,a.locale=l.locale,a.user=l.serversettings.user,a.translations=new Object,a.translations.docTitle=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_document_title"),a.translations.title=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_title"),a.translations.heading=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_word_heading"),a.translations.symbol=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_word_symbol"),a.translations.notes=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_word_notes"),a.translations.meaning=textHelp.webreader.LocaleSingleton.getInst().getLocaleString("vocab_word_meaning"),a.locale=textHelp.webreader.UserSettingsSingleton.getInst().getUserSettings().language.services,g_eventSubScribeVocabID=textHelp.webreaderapi.EventBusSingleton.getInst().subscribe("onVocabWeb",onVocabWeb,this),window.postMessage({method:"vocabWeb",type:"1757FROM_PAGERW4G",payload:a},"*")},SpeechStream.Vocab.prototype.sendRequest=function(){this.generateRequestData()};