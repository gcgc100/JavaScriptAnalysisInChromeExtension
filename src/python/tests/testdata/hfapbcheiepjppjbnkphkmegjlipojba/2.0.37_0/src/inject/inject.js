!function(){var e=CoFund.State.get(),o=CoFund.Store.get("ruleset"),a=CoFund.Store.get("codes"),n=CoFund.Store.get("codeDetails"),t=CoFund.Store.get("cashback");chrome.runtime.sendMessage({action:"start",state:e,ruleset:o,codes:a,codeDetails:n,cashback:t}),CoFund.Cashback.init(!1),o&&o.hasOwnProperty("cookieDomain")&&o.cookieDomain&&CoFund.Cookie.setDomain(o.cookieDomain)}();var Inject={lastUrlTested:"",testForCheckout:function(e){var o,a=this,n=["checkout","cart","basket"],t=function(o){return e.toLowerCase().indexOf(o)>=0};if(this.lastUrlTested!==e){var r=CoFund.Store.get("ruleset"),s=CoFund.Store.get("codes"),i=CoFund.Store.get("codeDetails"),c=CoFund.Store.get("cashback");if(r||s&&0!==s.length||c&&Number(c.pay)){console.log("Testing url");var l=!1;if(r&&r.checkoutUrls){for(var p in r.checkoutUrls)if(r.checkoutUrls[p]instanceof Object&&r.checkoutUrls[p].hasOwnProperty("url")){var d=r.checkoutUrls[p].url,u=r.checkoutUrls[p].hasOwnProperty("codeFieldSelectors")?r.checkoutUrls[p].codeFieldSelectors:null;if(e.startsWith(d))if(u instanceof Array)for(var C in u)if($(u[C]).length>0)r.checkoutUrls[p].hasOwnProperty("waitForVisible")?o=setInterval(function(){0!=$(u[C]).get(0).getBoundingClientRect().top&&(clearInterval(o),a.presentCodes(),a.showCouponTab(!0))},100):l=!0;else{var h=150;o=setInterval(function(){$(u[C]).length>0&&(clearInterval(o),a.presentCodes(),a.showCouponTab(!0)),--h<0&&clearInterval(o)},100)}else if($(u).length>0)r.checkoutUrls[p].hasOwnProperty("waitForVisible")?o=setInterval(function(){0!=$(u).get(0).getBoundingClientRect().top&&(clearInterval(o),a.presentCodes(),a.showCouponTab(!0))},100):l=!0;else{var h=150;o=setInterval(function(){$(u).length>0&&(clearInterval(o),a.presentCodes(),a.showCouponTab(!0)),--h<0&&clearInterval(o)},100)}}else e.startsWith(r.checkoutUrls[p])&&(l=!0);for(var C in r.codeFieldSelectors)$(r.codeFieldSelectors[C]).length>0&&(l=!0)}this.lastUrlTested=e,l?(r.manualCodes?this.showCouponList(s,i,!0):(this.presentCodes(),this.showCouponTab(!0)),CoFund.Session.updateOne(CoFund.Session.TR_CHECKOUT_MATCHED,!0)):s.length>0&&(!r||!r.checkoutUrls)&&n.filter(t).length>0?this.showCouponList(s,i,!0):Number(c.pay)&&(!r||!r.checkoutUrls)&&n.filter(t).length>0?(this.cashbackButtonActive?$("#cashback-button").hide():!1,this.showNoCouponsWithCashback()):this.showCouponTab()}}},togglePageDrawer:function(){this.$pageDrawer&&this.$pageDrawer.isReady&&(this.$pageDrawer.isShowing?this.$pageDrawer.hide():(this.$pageDrawer.show(),CoFund.Session.updateOne(CoFund.Session.TR_DRAWER_MAN_OPEN,!0)))},showCouponList:function(e,o,a){if(this.$pageDrawer)return void this.togglePageDrawer();if(a&&CoFund.Sliders.hasShown(CoFund.Sliders.CLOSED_MANUAL_DRAWER))return void this.showCouponTab();var n=this,t=CoFund.Store.get("cashback"),r=CoFund.Store.get("ruleset");this.$pageDrawer=new PageDrawer({width:"300px",hasInsetShadow:!1,hasDismiss:!1,onHide:function(){CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED),CoFund.Events.logDrawerClosed("Manual-Codes"),CoFund.Session.updateOne(CoFund.Session.TR_DRAWER_CLOSED,!0)}}),this.$pageDrawer.init(),a?this.$pageDrawer.ready(function(){var a=Templates.manualCoupons[Math.floor(Math.random()*Templates.manualCoupons.length)];this.$("head").append(Layouts.pageDrawerHead),this.$(".inner").append(a.templateContent.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(t)).replace(/\{codes\}/g,e).replace(/\{codeCount\}/g,e.length)),this.$(".manual").on("click",function(){n.$pageDrawer.$(".manual-coupons").hide(),n.loadCoupons(n.$pageDrawer,e,o),n.$pageDrawer.$(".coupon-details .piggy-slideright-header a").attr("data-template",a.templateName),n.$pageDrawer.$(".coupon-details").removeClass("hide"),n.$pageDrawer.$(".view-deals").hide(),n.$pageDrawer.enableDismiss(),n.hideDrawerOnClose(),CoFund.Session.updateOne(CoFund.Session.TR_US_VIEWED_AUTOLOAD_MANUAL,!0)}),CoFund.Events.logCodesPresented("Manual-Codes: "+a.templateName);var r={};r[CoFund.Session.TR_DRAWER_SHOWN]=!0,r[CoFund.Session.TR_DRAWER_MSG]="coupons_autoloaded_"+a.templateName,r[CoFund.Session.TR_COUNT_CODES]=e.length,CoFund.Session.update(r)}):(this.$pageDrawer.ready(function(){this.$("body").append(Layouts.pageDrawerHead);var o={};o[CoFund.Session.TR_DRAWER_SHOWN]=!0,o[CoFund.Session.TR_DRAWER_MSG]="coupons_manual",o[CoFund.Session.TR_COUNT_CODES]=e.length,CoFund.Session.update(o)}),this.loadCoupons(this.$pageDrawer,e,o),this.$pageDrawer.$(".coupon-details").removeClass("hide"),this.$pageDrawer.$(".view-deals").hide(),this.$pageDrawer.enableDismiss(),r&&!r.manualCodes?this.$pageDrawer.$(".img-alert").attr("src",chrome.extension.getURL("src/new-img/autotry-alert.png")).css("display","block"):this.$pageDrawer.$(".img-alert").attr("src",chrome.extension.getURL("src/new-img/manual-alert.png")).css("display","block")),this.togglePageDrawer()},hideDrawerOnClose:function(){this.$pageDrawer.$(".close-manual-coupon").on("click",function(){CoFund.Sliders.hasShown(CoFund.Sliders.COPIED_CODE)||CoFund.Sliders.show(CoFund.Sliders.CLOSED_MANUAL_DRAWER)}),CoFund.Sliders.reset(CoFund.Sliders.COPIED_CODE)},showCouponTab:function(e){var o=CoFund.Store.get("codes"),a=CoFund.Store.get("codeDetails"),n=CoFund.Store.get("cashback"),t=this;if(!CoFund.Flags.hasFlag(CoFund.Flags.hideCouponTab)||e){var r=$('<iframe id="piggy-coupon-tab"></iframe>').appendTo("body");r.contents().find("head").append(Layouts.couponTabHead),r.css({border:"0",width:"60px",height:"185px","z-index":"2147483646",position:"fixed",background:"transparent",bottom:"18%",left:"initial",right:"0px"}),r.contents().find("body").append(Layouts.couponTabBody),r.contents().find("body").on("click",function(){t.$pageDrawer?t.togglePageDrawer():o.length>0?(t.showCouponList(o,a),CoFund.Sliders.reset(CoFund.Sliders.COPIED_CODE)):Number(n.pay)&&t.showNoCouponsWithCashback(),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_COUPON_TAB_CLICK)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_COUPON_TAB_CLICK),CoFund.Session.updateOne(CoFund.Session.TR_DRAWER_MAN_OPEN,!0)}),r.contents().find("#coupon-tab").addClass("active")}},showNoCouponsWithCashback:function(){if(this.$pageDrawer)return void this.togglePageDrawer();var e=this,o=CoFund.Store.get("cashback");this.$pageDrawer=new PageDrawer({width:"300px",hasInsetShadow:!1,hasDismiss:!1,onHide:function(){CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED),CoFund.Events.logDrawerClosed("No-coupons-with-cashback"),CoFund.Session.updateOne(CoFund.Session.TR_DRAWER_CLOSED,!0)}}),this.$pageDrawer.init(),this.$pageDrawer.ready(function(){this.$("head").append(Layouts.pageDrawerHead),this.$(".inner").html(Templates.noCouponsWithCashback.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(o))),this.$(".inner").append(Templates.doubleCheckingForCoupons),setTimeout(function(){this.$(".with-cashback, .checking").toggleClass("hide")}.bind(this),Config.waitFor.doubleCheckingCoupons);var a=this;this.$(".reload-with-cashback").on("click",function(e){e.preventDefault(),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED,null,"-e"),a.hide()}),this.enableDismiss(),e.togglePageDrawer(),CoFund.Events.logNoCodes()})},showSlideIn:function(e,o,a){if(o&&o.hasOwnProperty("pay")&&Number(o.pay)&&!(o.hasOwnProperty("suppressPrompts")||CoFund.Sliders.hasShown(CoFund.Sliders.SLIDER_IN)||this.$pageDrawer||(e instanceof Array||(e=[]),CoFund.Flags.hasFlag(CoFund.Flags.hideSlideInPGW)))){var n=$('<iframe id="piggy-slideup"></iframe>').appendTo("body");n.contents().find("head").append(Layouts.slideUpHead),n.css({border:"0",width:"400px",height:"350px","z-index":"2147483647",position:"fixed",background:"transparent",bottom:"20px",left:"initial",right:"0px",display:"none"}),n.contents().find("body").append(Layouts.slideUpBody.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(o,!0)).replace(/\{codeCount\}/g,e.length)),0==e.length&&n.contents().find("#piggyCodeCount").hide();var t=n.contents().find("#piggy-slideup"),r=this._timer,s=this;setTimeout(function(){return $("#pageDrawer").length?void CoFund.Sliders.show(CoFund.Sliders.SLIDER_IN):(n.css("display","block"),n.contents().find("#piggy-slideup-close").on("click",function(e){e.preventDefault(),t.animate({right:"-1000px"},"slow","swing",function(){n.css("display","none"),s.showCouponTab()}).removeClass("piggy-slide-up-visible")}),t.animate({right:"0px"},"slow").addClass("piggy-slide-up-visible"),CoFund.Sliders.show(CoFund.Sliders.SLIDER_IN),void r(5e3,function(e){n.contents().find("#piggy-timer").html(e+" second(s)")},function(){t.animate({right:"-1000px"},"slow","swing",function(){n.css("display","none"),s.showCouponTab()}).removeClass("piggy-slide-up-visible")}))},Config.waitFor.slider),t.on("click",function(){CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED,null,"-a"),t.animate({right:"-1000px"},"slow","swing",function(){n.css("display","none"),s.showCouponTab()}).removeClass("piggy-slide-up-visible")}),n.contents().find("#slider-coupons").on("click",function(){t.animate({right:"-1000px"},"slow","swing",function(){n.css("display","none"),s.showCouponTab()}).removeClass("piggy-slide-up-visible"),s.showCouponList(e,a)})}},showCashbackButton:function(e){if(e&&Number(e.pay)&&!this.$pageDrawer&&!CoFund.Sliders.hasShown(CoFund.Sliders.CASHBACK_BUTTON)){this.cashbackButtonActive=!0;var o=$('<iframe id="cashback-button"></iframe>').appendTo("body");o.css({border:"0","z-index":"2147483646",position:"fixed",background:"transparent",top:"10px",right:"20px",width:"420px"});var a=[{cashbackBody:'                    <div class="button-wrapper">                        <div class="button-header">                            Click to Activate {cashback} in Reward Points                        </div>                        <div class="button-content">                            <div class="sm4 icon">                                <img src="'+chrome.extension.getURL("src/new-img/piggy-logo-p.png")+'">                            </div>                            <div class="sm8">                                <a href="#" class="btn cashbackButton">ACTIVATE REWARDS</a>                                <a href="#" class="opt-out">Remind me later.</a>                            </div>                        </div>                    </div>                ',cashbackAction:"m-a"},{cashbackBody:'                    <div class="button-wrapper">                        <div class="button-header">                            Click to Activate Bonus Rewards                        </div>                        <div class="button-content">                            <div class="sm4 icon">                                <img src="'+chrome.extension.getURL("src/new-img/piggy-logo-p.png")+'">                            </div>                            <div class="sm8">                                <a href="#" class="btn cashbackButton">MY REWARDS</a>                                <a href="#" class="opt-out">Remind me later.</a>                            </div>                        </div>                    </div>                ',cashbackAction:"m-a-nonspecific-rewards"},{cashbackBody:'                    <div class="button-wrapper">                        <div class="button-header">                            Activate to Earn Bonus Cash Back                        </div>                        <div class="button-content">                            <div class="sm4 icon">                                <img src="'+chrome.extension.getURL("src/new-img/piggy-logo-p.png")+'">                            </div>                            <div class="sm8">                                <a href="#" class="btn cashbackButton">Activate Bonus</a>                                <a href="#" class="opt-out">Remind me later.</a>                            </div>                        </div>                    </div>                ',cashbackAction:"m-c-nonspecific"}],n=a[Math.floor(2*Math.random())];o.contents().find("head").append(Layouts.cashbackButtonHead),o.contents().find("body").append(n.cashbackBody.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(e))),o.contents().find(".cashbackButton").on("click",function(e){e.preventDefault(),CoFund.Cashback.isButtonABTest=!0,CoFund.Cashback.buttonABRef=n.cashbackAction,CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED,null,"-b"),CoFund.Session.updateOne(CoFund.Session.TR_CASHBACK_FIRE_TRIG,!0),o.hide()}),o.contents().find(".opt-out").on("click",function(e){e.preventDefault(),CoFund.Events.logCashbackButtonDismissed(n.cashbackAction),o.hide()}),CoFund.Sliders.show(CoFund.Sliders.CASHBACK_BUTTON)}},showReviewModal:function(){var e=$('<iframe id="add-review"></iframe>').appendTo("body");setTimeout(function(){$(".piggy-is-werkin").css("background-color","rgba(64, 63, 63, 0.6)"),e.css({position:"fixed",top:"50%",left:"50%",transform:"translateY(-50%) translateX(-50%)","background-color":"#F9F9F9",width:"400px",height:"300px","box-shadow":"0 2px 4px rgba(0,0,0,0.5)","border-radius":"5px","z-index":"999999",padding:"20px"}),e.contents().find("head").append(Layouts.reviewModalStyles),e.contents().find("body").append(Templates.reviewModal),e.contents().find("a.btn").on("click",function(o){o.preventDefault(),chrome.runtime.sendMessage({action:"addReview"}),e.hide(),$(".piggy-is-werkin").css("background-color","rgba(64, 63, 63, 0.31)")}),e.contents().find("a#later").on("click",function(o){o.preventDefault(),chrome.runtime.sendMessage({action:"reviewLater"}),e.hide(),$(".piggy-is-werkin").css("background-color","rgba(64, 63, 63, 0.31)")})},1500)},loadExternalProvider:function(){var e=CoFund.Store.get("ruleset");e.hasOwnProperty("loadExternalProvider")&&$.ajax({url:Config.server+"/toolbar/provider",cache:!1,dataType:"text",success:function(o){chrome.runtime.sendMessage({action:"loadExternalProvider",script:o}),setTimeout(function(){"undefined"==typeof ExternalProvider&&CoFund.Events.logProviderError("Error loading ExternalProvider: "+e.loadExternalProvider)},1e3)},error:function(){console.log("Error loading provider")}})},presentCodes:function(){var e=CoFund.Store.get("codes"),o=CoFund.Store.get("codeDetails"),a=CoFund.Store.get("cashback");if(e instanceof Array){!CoFund.State.get()||CoFund.State.get()<CoFund.State.STATE_RECEIVED||CoFund.State.get()>=CoFund.State.CODES_PRESENTED;for(var n=[],t=0,r=e.length;r>t;t++)n.push('<li><input type="checkbox" id="codeCheckbox_'+t+'" value="'+e[t]+'" class="css-checkbox" checked><label class="code-label css-label" for="codeCheckbox_'+t+'"> '+e[t]+"</label></li>");var s=this;this.$pageDrawer=new PageDrawer({width:"300px",hasInsetShadow:!1,hasDismiss:!1,onHide:function(){CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_DRAWER_CLOSED),CoFund.Events.logDrawerClosed(),CoFund.Session.updateOne(CoFund.Session.TR_DRAWER_CLOSED,!0)}}),this.$pageDrawer.init(),this.$pageDrawer.ready(function(){var n=Templates.deals[Math.floor(Math.random()*Templates.deals.length)];if(this.$("body").append(Layouts.pageDrawerHead),0===e.length&&Number(a.pay)){this.$(".inner").html(Templates.noCouponsWithCashback.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(a))),this.$(".inner").append(Templates.doubleCheckingForCoupons),setTimeout(function(){this.$(".with-cashback, .checking").toggleClass("hide")}.bind(this),Config.waitFor.doubleCheckingCoupons);var t=this;this.$(".reload-with-cashback").on("click",function(e){e.preventDefault(),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED,null,"-c"),t.hide()}),CoFund.Events.logNoCodes()}else 0!==e.length||Number(a.pay)?e.length>0&&this.$(".inner").html(n.templateContent.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(a)).replace(/\{codes\}/g,e).replace(/\{codeCount\}/g,e.length)):(this.$(".inner").html(Templates.noCouponsNoCashback),this.$(".inner").append(Templates.doubleCheckingForCoupons),setTimeout(function(){this.$(".no-cashback, .checking").toggleClass("hide")}.bind(this),Config.waitFor.doubleCheckingCoupons),CoFund.Events.logNoCodesNoCashback());if(this.enableDismiss(),this.$(".okay").on("click",function(o){o.preventDefault(),s.$pageDrawer.$(".coupon-deals, .coupon-details").addClass("hide");for(var a=[],t=0,r=e.length;r>t;t++)0===t?a.push('<li class="piggy-coupon-active" data-code="'+e[t]+'">'+e[t]+"</li>"):a.push('<li data-code="'+e[t]+'">'+e[t]+"</li>");s.$pageDrawer.$(".inner").append('                    <div class="navmenu navmenu-default navmenu-fixed-right piggy-slideright in">                        <div class="piggy-slideright-header">                            <a data-canvas=".canvas" data-target=".navmenu" data-recalc="false" data-toggle="offcanvas" data-dismiss="drawer" data-template="'+n.templateName+'"><span class="glyphicon glyphicon-remove"></span></a>                            <img src="'+chrome.extension.getURL("src/new-img/app-logo.png")+'" alt="Piggy">                        </div>                        <div class="piggy-slideright-notification">                            <p>Let Piggy Find you the best deal!</p>                        </div>                        <div class="piggy-slideright-content-full  piggy-vertical-full">                            <h1>Now trying all coupons</h1>                            <ul id="piggy-trying-coupon-list" class="codes-selected">                                '+a.join("")+"                            </ul>                        </div>                    </div>                "),Scrollable.init(s.$pageDrawer.$("#piggy-trying-coupon-list"),s.$pageDrawer.$("#piggy-trying-coupon-list li.piggy-coupon-active"),200);var i=CoFund.Store.get("ruleset");if(!i)return void s.$pageDrawer.$(".inner").html('                        <div class="content">Hmm... something went wrong. <a href="#" onclick="top.document.location.reload(); return false;">Reload the page</a> and let\'s try again?</div>                    ');if(i.hasOwnProperty("applyCouponUrl")&&(i.applyCouponUrl.hasOwnProperty("data")&&(i.applyCouponUrl.data=s.parseParams(i.applyCouponUrl.data,i.applyCouponUrl.dataType)),i.applyCouponUrl.hasOwnProperty("url")&&(i.applyCouponUrl.url=s.parseURL(i.applyCouponUrl.url,i.applyCouponUrl.dataType))),i.hasOwnProperty("resultUrl")&&(i.resultUrl.hasOwnProperty("data")&&(i.resultUrl.data=s.parseParams(i.resultUrl.data,i.resultUrl.dataType||(i.hasOwnProperty("applyCouponUrl")?i.applyCouponUrl.dataType:"object"))),i.resultUrl.hasOwnProperty("url")&&(i.resultUrl.url=s.parseURL(i.resultUrl.url,i.resultUrl.dataType||(i.hasOwnProperty("applyCouponUrl")?i.applyCouponUrl.dataType:"object")))),i.hasOwnProperty("clearCouponUrl")&&(i.clearCouponUrl.hasOwnProperty("data")&&(i.clearCouponUrl.data=s.parseParams(i.clearCouponUrl.data,i.clearCouponUrl.dataType||(i.hasOwnProperty("applyCouponUrl")?i.applyCouponUrl.dataType:"object"))),i.clearCouponUrl.hasOwnProperty("url")&&(i.clearCouponUrl.url=s.parseURL(i.clearCouponUrl.url,i.clearCouponUrl.dataType||(i.hasOwnProperty("applyCouponUrl")?i.applyCouponUrl.dataType:"object")))),"undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&(i.externalProvider=ExternalProvider,ExternalProvider.hasOwnProperty("init")&&ExternalProvider.init instanceof Function))try{ExternalProvider.init()}catch(o){CoFund.Events.logProviderError("Error in init: "+o)}CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_ACTIVATED),CoFund.Session.updateOne(CoFund.Session.TR_US_TRIED_CODES,!0),s.processCodes({codes:e,ruleset:i})}),s.loadExternalProvider(),s.loadCoupons(this,e,o),CoFund.Sliders.hasShown(CoFund.Sliders.ACTIVATED_AUTOTRY_SUCCESS))CoFund.Sliders.reset(CoFund.Sliders.ACTIVATED_AUTOTRY_SUCCESS);else{setTimeout(function(){s.$pageDrawer.show()},100);var r={};r[CoFund.Session.TR_DRAWER_SHOWN]=!0,r[CoFund.Session.TR_DRAWER_MSG]="autoloaded_"+n.templateName,r[CoFund.Session.TR_COUNT_CODES]=e.length,CoFund.Session.update(r)}chrome.runtime.sendMessage({action:"setPopup",popup:""}),CoFund.State.set(CoFund.State.CODES_PRESENTED),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_PRESENTED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_PRESENTED),CoFund.Events.logCodesPresented("Auto-try: "+n.templateName)})}},loadCoupons:function(e,o,a){function n(e){e.preventDefault();var o=$(this).parent();$.ajax({url:$(this).attr("href"),method:"GET",complete:function(){o.hide()}})}var t="";for(var r in o)a.hasOwnProperty(o[r])&&(t+=Templates.couponRow.replace(/\{code\}/g,o[r]).replace(/\{codeDescription\}/g,a[o[r]].text).replace(/\{offerId\}/g,a[o[r]].o?a[o[r]].o:"").replace(/\{appUid\}/g,CoFund.Info.getExtId()));var s=navigator.platform.indexOf("Mac")>=0?"CMD":"CTRL";e.$(".inner").append(Templates.coupons.replace(/\{codeCount\}/g,o.length).replace(/\{couponList\}/g,t).replace(/\{OS\}/g,s)),e.$(".view-coupons, .view-deals").on("click",function(o){o.preventDefault(),e.$(".coupon-deals, .coupon-details").toggleClass("hide"),$(".piggy-is-werkin").fadeOut(500),$(this).hasClass("view-coupons")&&(CoFund.Events.logCodesPresented("View-Manual-Codes"),CoFund.Session.updateOne(CoFund.Session.TR_US_VIEWED_CODES,!0))});var i=$("<input>");i.css({position:"absolute",top:"-10000px"}),$("body").append(i),e.$(".piggy-slideright-coupon").on("click",function(){i.val($("h1",this).text()),i.select(),document.execCommand("copy"),e.$("em").css("display","none"),$("em",this).css("display","block"),$(".piggy-is-werkin").fadeOut(500);var o=$(".rate-code",this);e.$(".rate-code").css("display","none"),o.show(),$(".rate-code .offer-status",this).on("click",n),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_COPIED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_COPIED),CoFund.Session.updateOne(CoFund.Session.TR_US_COPIED_CODES,!0),CoFund.Sliders.reset(CoFund.Sliders.CLOSED_MANUAL_DRAWER),CoFund.Sliders.show(CoFund.Sliders.COPIED_CODE)}),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_PRESENTED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_PRESENTED)},parseParams:function(params,dataType){for(var param in params){var value=params[param];if(value instanceof Object&&value.hasOwnProperty("type"))switch(value.type){case"regexp":if(value.hasOwnProperty("pattern")&&value.hasOwnProperty("return")){var result=document.body.outerHTML.match(new RegExp(value.pattern));params[param]=result[value["return"]]}break;case"jquery":value.hasOwnProperty("pattern")&&value.hasOwnProperty("return")&&(params[param]=$(value.pattern).attr(value["return"]));break;case"variable":value.hasOwnProperty("pattern")&&eval('params[param] = "'+this.retrieveWindowVariable(value.pattern)+'";');break;case"cookie":value.hasOwnProperty("return")&&(params[param]=CoFund.Cookie.getExternal(value["return"]))}}return"json"==dataType&&(params=JSON.stringify(params)),params},parseURL:function(e,o){var a=this;if(e instanceof Object&&e.hasOwnProperty("_original")){var n=a.parseParams(e),t=e.fullDynamic?n._original:n._original+"?";for(var r in n)"_original"!=r&&"fullDynamic"!==r&&"["!=r.substr(0,1)?t+=r+"="+n[r].replace(new RegExp("/("+r+"=).*?(&|$)/"),"$1"+n[r]+"$2")+"&":"["==r.substr(0,1)&&(t=t.replace(r,n[r]));e=t}return e},retrieveWindowVariable:function(e){var o="if (typeof "+e+" !== 'undefined') { $('body').attr('tmp_"+e+"', "+e+"); }\n",a=document.createElement("script");a.id="tmpScript",a.appendChild(document.createTextNode(o)),(document.body||document.head||document.documentElement).appendChild(a);var n=$("body").attr("tmp_"+e);return $("body").removeAttr("tmp_"+e),n},processCodes:function(e){var o=this;this.codesRequested=e.codes,this.codesProcessed={},this.queueName="_cfq";var a,n,t=e.ruleset;for(var r in this.codesRequested){var s=this.codesRequested[r];if(t.hasOwnProperty("applyCouponUrl")){if(n=null,"undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{n=ExternalProvider.prepare("applyCouponUrl",s)}catch(i){CoFund.Events.logProviderError("Error in prepare: "+i)}n||(n="json"==t.applyCouponUrl.dataType?JSON.stringify(new ObjectTraverser(JSON.parse(t.applyCouponUrl.data)).replaceChildNode(t.applyCouponUrl.codeProperty,s)):JSON.parse(JSON.stringify(new ObjectTraverser(t.applyCouponUrl.data).replaceChildNode(t.applyCouponUrl.codeProperty,s))));var c=t.applyCouponUrl.url.replace(/CLAIMCODE/g,s).replace(/HOST/g,document.location.host);$(document).queue(this.queueName,function(e,a,n){return function(r){var s=new Date;$.ajax({type:t.applyCouponUrl.mode,url:e,cache:!1,data:a,headers:o.parseParams(t.applyCouponUrl.headers||{}),contentType:"json"==t.applyCouponUrl.dataType?"application/json":"application/x-www-form-urlencoded",dataType:t.applyCouponUrl.responseType,timeout:Config.ajaxTimeouts.applyCouponUrl,success:function(e,a,i){t.hasOwnProperty("resultUrl")||o.processResponse(e,a,i,t,n),Config.waitFor.applyCouponUrl&&(new Date).getTime()-s.getTime()<Config.waitFor.applyCouponUrl?setTimeout(function(){r()},Config.waitFor.applyCouponUrl-((new Date).getTime()-s.getTime())):r()},error:function(e,a,i){t.hasOwnProperty("resultUrl")||o.processResponse(e,a,i,t,n),Config.waitFor.applyCouponUrl&&(new Date).getTime()-s.getTime()<Config.waitFor.applyCouponUrl?setTimeout(function(){r()},Config.waitFor.applyCouponUrl-((new Date).getTime()-s.getTime())):r()}})}}(c,n,s))}else t.hasOwnProperty("injectCoupon")&&$(document).queue(this.queueName,function(e){return function(a){var n=new Date;if("undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{ExternalProvider.prepare("injectCoupon",e)}catch(r){CoFund.Events.logProviderError("Error in init: "+r)}else $(t.injectCoupon.codeField).val(e),$(t.injectCoupon.submitButton).click();setTimeout(function(){o.processResponse(document.body.outerHTML,null,null,t,e),Config.waitFor.injectCoupon&&(new Date).getTime()-n.getTime()<Config.waitFor.injectCoupon?setTimeout(function(){a()},Config.waitFor.injectCoupon-((new Date).getTime()-n.getTime())):a()},t.injectCoupon.waitPeriod||1e3)}}(s));if(t.hasOwnProperty("resultUrl")&&t.resultUrl instanceof Object&&t.resultUrl.hasOwnProperty("url")){if(a={mode:t.resultUrl.mode||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.mode:null)||"GET",dataType:t.resultUrl.dataType||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.dataType:null)||"object",responseType:t.resultUrl.responseType||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.responseType:null)||"json",headers:t.resultUrl.headers||{}},n=null,"undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{n=ExternalProvider.prepare("resultUrl",s)}catch(i){CoFund.Events.logProviderError("Error in init: "+i)}n||(n=t.resultUrl.hasOwnProperty("data")?t.resultUrl.data:{}),t.resultUrl.codeProperty&&(n="json"==a.dataType?JSON.stringify(new ObjectTraverser(JSON.parse(n)).replaceChildNode(t.resultUrl.codeProperty,s)):JSON.parse(JSON.stringify(new ObjectTraverser(n).replaceChildNode(t.resultUrl.codeProperty,s)))),c=t.resultUrl.url.replace(/CLAIMCODE/g,s).replace(/HOST/g,document.location.host),$(document).queue(this.queueName,function(e,a,n,r){return function(s){var i=new Date;$.ajax({type:n.mode,url:e,cache:!1,data:a,headers:n.headers,contentType:"json"==n.dataType?"application/json":"application/x-www-form-urlencoded",dataType:n.responseType,timeout:Config.ajaxTimeouts.resultUrl,success:function(e,a,n){o.processResponse(e,a,n,t,r),Config.waitFor.resultUrl&&(new Date).getTime()-i.getTime()<Config.waitFor.resultUrl?setTimeout(function(){s()},Config.waitFor.resultUrl-((new Date).getTime()-i.getTime())):s()},error:function(e,a,n){o.processResponse(e,a,n,t,r),Config.waitFor.resultUrl&&(new Date).getTime()-i.getTime()<Config.waitFor.resultUrl?setTimeout(function(){s()},Config.waitFor.resultUrl-((new Date).getTime()-i.getTime())):s()}})}}(c,n,a,s))}if(t.hasOwnProperty("clearCouponUrl")&&t.clearCouponUrl instanceof Object&&t.clearCouponUrl.hasOwnProperty("url")){if(a={mode:t.clearCouponUrl.mode||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.mode:null)||"POST",dataType:t.clearCouponUrl.dataType||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.dataType:null)||"object",responseType:t.clearCouponUrl.responseType||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.responseType:null)||"json",headers:t.clearCouponUrl.headers||{}},n=null,"undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{n=ExternalProvider.prepare("clearCouponUrl",s)}catch(i){CoFund.Events.logProviderError("Error in init: "+i)}n||(n=t.clearCouponUrl.hasOwnProperty("data")?t.clearCouponUrl.data:{}),t.clearCouponUrl.codeProperty&&(n="json"==a.dataType?JSON.stringify(new ObjectTraverser(JSON.parse(n)).replaceChildNode(t.clearCouponUrl.codeProperty||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.codeProperty:null),s)):JSON.parse(JSON.stringify(new ObjectTraverser(n).replaceChildNode(t.clearCouponUrl.codeProperty||(t.hasOwnProperty("applyCouponUrl")?t.applyCouponUrl.codeProperty:null),s)))),c=t.clearCouponUrl.url.replace(/CLAIMCODE/g,s).replace(/HOST/g,document.location.host),$(document).queue(this.queueName,function(e,o,a,n){return function(n){var t=new Date;$.ajax({type:a.mode,url:e,cache:!1,data:o,headers:a.headers,contentType:"json"==a.dataType?"application/json":"application/x-www-form-urlencoded",dataType:a.responseType,timeout:Config.ajaxTimeouts.clearCouponUrl,success:function(e,o,a){Config.waitFor.clearCouponUrl&&(new Date).getTime()-t.getTime()<Config.waitFor.clearCouponUrl?setTimeout(function(){n()},Config.waitFor.clearCouponUrl-((new Date).getTime()-t.getTime())):n()},error:function(e){Config.waitFor.clearCouponUrl&&(new Date).getTime()-t.getTime()<Config.waitFor.clearCouponUrl?setTimeout(function(){n()},Config.waitFor.clearCouponUrl-((new Date).getTime()-t.getTime())):n()}})}}(c,n,a,s))}}$(document).dequeue(this.queueName)},processResponse:function(e,o,a,n,t){if(n.hasOwnProperty("externalProvider")&&n.externalProvider instanceof Object&&n.externalProvider.hasOwnProperty("parse")&&n.externalProvider.parse instanceof Function){try{var r=n.externalProvider.parse(e,o,a,t)}catch(s){CoFund.Events.logProviderError("Error in prepare: "+s)}r instanceof Object&&r.hasOwnProperty("success")&&r.hasOwnProperty("savings")&&(this.codesProcessed[t]=r.success?r.savings:!1)}if(!this.codesProcessed.hasOwnProperty(t)){var i;if(n.hasOwnProperty("applyCouponUrl")?i=n.applyCouponUrl:n.hasOwnProperty("injectCoupon")&&(i=n.injectCoupon),i)switch(i.responseType){case"html":var c=$.parseHTML(e),l=$(i.successResponseProperty,c),p=0;i.successResponseAmountProperty&&$(i.successResponseAmountProperty,c).length>0&&(p=Number($(i.successResponseAmountProperty,c).text().replace(/[^0-9\.]+/g,""))),i.successResponseValue?this.codesProcessed[t]=l.length>0&&$.trim(l.html())==i.successResponseValue.replace(/CLAIMCODE/g,t)?p:!1:this.codesProcessed[t]=l.length>0?p:!1;break;default:var d=new ObjectTraverser(e).getChildNode(i.successResponseProperty),u=0;i.successResponseAmountProperty&&$(i.successResponseAmountProperty).length>0&&(u=Number(new ObjectTraverser(e).getChildNode(i.successResponseAmountProperty).replace(/[^0-9\.]+/g,""))),i.successResponseValue?this.codesProcessed[t]=$.trim(d)===i.successResponseValue.replace(/CLAIMCODE/g,t)?u:!1:this.codesProcessed[t]=d!==!1&&null!==d?u:!1}}if(!this.codesProcessed.hasOwnProperty(t))return void CoFund.Events.logProviderError("Unable to parse code "+t+": no provider configured.");
this.onSingleCodeResult(t,this.codesProcessed[t]);var C=this;if(Object.keys(this.codesProcessed).length==this.codesRequested.length){var h=!1,g=0,y="";for(var f in this.codesProcessed)this.codesProcessed[f]&&(h=!0,this.codesProcessed[f]>g&&(y=f,g=this.codesProcessed[f]));if(g>0)if(n.hasOwnProperty("applyCouponUrl")&&n.applyCouponUrl.hasOwnProperty("reApplyOnSuccess")&&n.applyCouponUrl.reApplyOnSuccess){var m;if("undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{m=ExternalProvider.prepare("applyCouponUrl",t)}catch(s){CoFund.Events.logProviderError("Error in prepare: "+s)}m||(m="json"==n.applyCouponUrl.dataType?JSON.stringify(new ObjectTraverser(JSON.parse(n.applyCouponUrl.data)).replaceChildNode(n.applyCouponUrl.codeProperty,y)):JSON.parse(JSON.stringify(new ObjectTraverser(n.applyCouponUrl.data).replaceChildNode(n.applyCouponUrl.codeProperty,y))));var w=n.applyCouponUrl.url.replace(/CLAIMCODE/g,t).replace(/HOST/g,document.location.host);$(document).queue(this.queueName,function(e,o,a){return function(a){$.ajax({type:n.applyCouponUrl.mode,url:e,data:o,contentType:"json"==n.applyCouponUrl.dataType?"application/json":"application/x-www-form-urlencoded",dataType:n.applyCouponUrl.responseType,timeout:Config.ajaxTimeouts.applyCouponUrl,success:function(e){C.onAllCodesProcessed(h,y,g)},error:function(e){C.onAllCodesProcessed(h,y,g)}})}}(w,m,t))}else n.hasOwnProperty("injectCoupon")&&n.injectCoupon.hasOwnProperty("reApplyOnSuccess")&&n.injectCoupon.reApplyOnSuccess?$(document).queue(this.queueName,function(e,o,a){return function(r){if("undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("prepare")&&ExternalProvider.prepare instanceof Function)try{ExternalProvider.prepare("injectCoupon",o)}catch(s){CoFund.Events.logProviderError("Error in prepare: "+s)}else $(n.injectCoupon.codeField).val(t),$(n.injectCoupon.submitButton).click();setTimeout(function(){C.onAllCodesProcessed(e,o,a)},n.injectCoupon.waitPeriod||1e3)}}(h,y,g)):Config.waitFor.afterCodeProcessing?setTimeout(function(){C.onAllCodesProcessed(h,y,g)},Config.waitFor.afterCodeProcessing):C.onAllCodesProcessed(h,y,g);else Config.waitFor.afterCodeProcessing?setTimeout(function(){C.onAllCodesProcessed(h,"",0)},Config.waitFor.afterCodeProcessing):C.onAllCodesProcessed(h,"",0)}},onSingleCodeResult:function(e,o){this.$pageDrawer.$('ul.codes-selected li[data-code="'+e+'"]').addClass(o?"piggy-coupon-passed":"piggy-coupon-failed").prepend("<em>$"+parseFloat(o).toFixed(2)+"</em>").next().addClass("piggy-coupon-active"),Object.keys(this.codesProcessed).length>3&&Scrollable.scroll()},onAllCodesProcessed:function(e,o,a){CoFund.State.set(CoFund.State.CODES_PROCESSED),CoFund.Sliders.show(CoFund.Sliders.ACTIVATED_AUTOTRY_SUCCESS),a=parseFloat(a);var n=this,t=CoFund.Store.get("ruleset"),r=CoFund.Store.get("cashback"),s=Number(r.pay)>0?'<p style="color: grey; text-transform: none; font-size:0.8em; padding-top: 6px;"><strong>+'+CoFund.Cashback.formatForDisplay(r)+" Cash back in your Piggy bank!</strong></p>":"",i=Number(r.pay)>0?"Piggy found Coupons and <strong>"+CoFund.Cashback.formatForDisplay(r)+"</strong> Cashback!":"<strong>Piggy found the best coupons for you!</strong>",c=Math.floor(a),l=a.toFixed(2).split(".")[1];if(e){var p;p=a.toFixed()>10?2:3,a>20&&chrome.runtime.sendMessage({action:"checkReview"},function(e){e&&n.showReviewModal()}),n.$pageDrawer.$(".inner").html('                <div class="navmenu navmenu-default navmenu-fixed-right piggy-slideright in">                    <div class="piggy-slideright-header">                        <a data-canvas=".canvas" data-target=".navmenu" data-recalc="false" data-toggle="offcanvas" data-dismiss="drawer"><span class="glyphicon glyphicon-remove"></span></a>                        <img src="'+chrome.extension.getURL("src/new-img/app-logo.png")+'" alt="Piggy">                    </div>                    <div class="piggy-slideright-notification">                        <p>'+i+'</p>                    </div>                    <div class="piggy-slideright-content-full piggy-vertical-full piggy-saved-full">                        <h1>Piggy saved you:</h1>                        <p class="piggy-saved">                            <sup>$</sup>'+c+"<sup>"+l+'</sup>                            <img src="'+chrome.extension.getURL("src/new-img/piggy-happy-"+p+"star-right-170x170.png")+'" alt="Coupon Applied">                        </p>                        <h5>Using the following codes:</h5>                        <ul id="piggy-passed-coupon-list">                            <li>'+o+'</li>                        </ul>                        <a class="reload-cart btn btn-primary btn-lg btn-return">< Return to Cart                            <br></a>'+(CoFund.Info.getUser()?s:'<p style="font-size:0.8em; color: grey; margin: 10px 20px;"><a href="'+Config.server+'/register" target="_blank" style="color: grey;">(You can log in later to claim Cash Back)</a></p>')+'</div>                    <div class="piggy-slideright-footer">                        <p>Share </p>                        <ul>                            <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-facebook.png")+'" alt="Facebook"></a></li>                            <li><a href="https://twitter.com/share?text=Piggy+-+Coupons+%26+Cashback!&url=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-twitter.png")+'" alt="Twitter"></a></li>                            <li><a href=https://plus.google.com/share?url=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-google.png")+'" alt="Google Plus"></a></li>                            <li><a href="https://pinterest.com/pin/create/button/?url=http%3A//www.joinpiggy.com/r/111&media=&description=" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-pinterest.png")+'" alt="Pinterest"></a></li>                        </ul>                    </div>                </div>            '),"undefined"!=typeof ExternalProvider&&ExternalProvider instanceof Object&&ExternalProvider.hasOwnProperty("complete")&&ExternalProvider.complete instanceof Function?n.$pageDrawer.$(".reload-cart").on("click",n.copyClickHandle(".piggy-is-werkin",function(e){e.preventDefault();try{ExternalProvider.complete(o,a)}catch(e){CoFund.Events.logProviderError("Error in complete: "+e)}})):t&&t.hasOwnProperty("onComplete")&&t.onComplete.hasOwnProperty("action")?"reload"==t.onComplete.action&&t.onComplete.hasOwnProperty("url")?n.$pageDrawer.$(".reload-cart").on("click",n.copyClickHandle(".piggy-is-werkin",function(e){e.preventDefault(),window.top.document.location=t.onComplete.url.replace(/CLAIMCODE/g,o)})):"submitCode"==t.onComplete.action&&t.onComplete.hasOwnProperty("codeField")&&t.onComplete.hasOwnProperty("submitButton")&&n.$pageDrawer.$(".reload-cart").on("click",n.copyClickHandle(".piggy-is-werkin",function(e){e.preventDefault(),$(t.onComplete.codeField).val(o),$(t.onComplete.submitButton).click(),n.$pageDrawer.hide()})):n.$pageDrawer.enableDismiss();var r=CoFund.Store.get("cashback"),d=CoFund.Store.get("codeDetails"),u=null,C=null;r.hasOwnProperty("s")&&(u=r.s),o&&d&&d.hasOwnProperty(o)&&d[o].hasOwnProperty("o")&&(C=d[o].o),chrome.runtime.sendMessage({action:"addSavings",savings:a,storeId:u||0,offerId:C||0}),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_SUCCESSFUL)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_SUCCESSFUL,o),CoFund.Events.logCodeSuccess(),CoFund.Session.updateOne(CoFund.Session.TR_CODE_SUCCESS,!0)}else Number(r.pay)?(n.$pageDrawer.$(".inner").html(Templates.noCouponsWithCashback.replace(/\{cashback\}/g,CoFund.Cashback.formatForDisplay(r))),n.$pageDrawer.$(".with-cashback").removeClass("hide"),n.$pageDrawer.enableDismiss(),n.$pageDrawer.$(".reload-with-cashback").on("click",n.copyClickHandle(".piggy-is-werkin",function(e){e.preventDefault(),CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CASHBACK_ACTIVATED,null,"-d"),n.$pageDrawer.hide()})),CoFund.Events.logCodeFailure(),CoFund.Session.updateOne(CoFund.Session.TR_CODE_FAILED,!0)):(n.$pageDrawer.$(".inner").html('                <!-- the original else! -->                <div class="navmenu navmenu-default navmenu-fixed-right piggy-slideright in">                    <div class="piggy-slideright-header">                        <a data-canvas=".canvas" data-target=".navmenu" data-recalc="false" data-toggle="offcanvas" data-dismiss="drawer"><span class="glyphicon glyphicon-remove"></span></a>                        <img src="'+chrome.extension.getURL("src/new-img/app-logo.png")+'" alt="Piggy">                    </div>                    <div class="piggy-slideright-notification">                        <p>Sorry! No coupons matched your cart today.</p>                    </div>                    <div class="piggy-slideright-content-full piggy-vertical-full">                        <h1>No codes fit the items in your cart today.</h1>                        <img src="'+chrome.extension.getURL("src/new-img/piggy-sad-170x170.png")+'">                        <p>Piggy always takes it so hard.</p>                        <a data-dismiss="drawer" class="reload-cart btn btn-primary btn-lg btn-return"> <  Back to cart</a>                    </div>                    <div class="piggy-slideright-footer">                        <p>Share </p>                        <ul>                            <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-facebook.png")+'" alt="Facebook"></a></li>                            <li><a href="https://twitter.com/share?text=Piggy+-+Coupons+%26+Cashback!&url=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-twitter.png")+'" alt="Twitter"></a></li>                            <li><a href=https://plus.google.com/share?url=http%3A//www.joinpiggy.com/r/111" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-google.png")+'" alt="Google Plus"></a></li>                            <li><a href="https://pinterest.com/pin/create/button/?url=http%3A//www.joinpiggy.com/r/111&media=&description=" target="_top"><img src="'+chrome.extension.getURL("src/new-img/icon-social-pinterest.png")+'" alt="Pinterest"></a></li>                        </ul>                    </div>                </div>            '),n.$pageDrawer.enableDismiss(),CoFund.Events.logCodeFailure(),CoFund.Session.updateOne(CoFund.Session.TR_CODE_FAILED,!0));n.$pageDrawer.setOption("autoHide",!0)},_timer:function(e,o,a){var n=(new Date).getTime(),t=setInterval(function(){var r=e-((new Date).getTime()-n);0>=r?(clearInterval(t),a()):o(Math.floor(r/1e3))},100)},_prepareCashbackPercent:function(e){var o=parseFloat(e);return o>9.9?o.toFixed(0):o.toFixed(1)},copyClickHandle:function(e,o){return e&&$(e).on("click",o),o}};chrome.runtime.onMessage.addListener(function(e,o,a){if(e.hasOwnProperty("action"))switch(e.action){case"saveConfig":if(CoFund.State.get()&&CoFund.State.get()>=CoFund.State.STATE_RECEIVED)return;e.cookieDomain&&(e.ruleset.cookieDomain=e.cookieDomain),e.flags&&(e.ruleset||(e.ruleset={}),e.ruleset.flags=e.flags),e.hasOwnProperty("cashback")&&e.cashback.hasOwnProperty("suppressPrompts")&&e.cashback.hasOwnProperty("action")&&(e.cashback.action&CoFund.Cashback.FIRE_ON_30)===CoFund.Cashback.FIRE_ON_30&&(e.cashback.action=e.cashback.action-CoFund.Cashback.FIRE_ON_30),CoFund.Store.set("ruleset",e.ruleset),CoFund.Store.set("codes",e.codes),CoFund.Store.set("codeDetails",e.codeDetails),CoFund.Store.set("cashback",e.cashback),CoFund.State.set(CoFund.State.STATE_RECEIVED),chrome.runtime.sendMessage({action:"setBadge",state:CoFund.State.STATE_RECEIVED,codes:e.codes,cashback:e.cashback}),CoFund.Cashback.init(!0),e.hasOwnProperty("ruleset")&&e.ruleset&&e.ruleset.hasOwnProperty("cookieDomain")&&e.ruleset.cookieDomain&&CoFund.Cookie.setDomain(e.ruleset.cookieDomain),e.codes&&e.codes.length>0&&CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_CODES_FOUND)&&CoFund.Cashback.fire(CoFund.Cashback.FIRE_ON_CODES_FOUND),Inject.showSlideIn(e.codes,e.cashback,e.codeDetails);break;case"showCouponDetails":CoFund.Events.logCodesPresented("Popup-View-Manual-Codes"),Inject.showCouponList(e.codes,e.codeDetails);break;case"setStateConfigReceived":CoFund.State.set(CoFund.State.STATE_RECEIVED);break;case"setStateCodesPresented":CoFund.State.set(CoFund.State.CODES_PRESENTED);break;case"setStateCodesProcessed":CoFund.State.set(CoFund.State.CODES_PROCESSED);break;case"initStorage":e&&e.hasOwnProperty("extId")&&CoFund.Info.setExtId(e.extId),e&&e.hasOwnProperty("user")&&CoFund.Info.setUser(e.user),e&&e.hasOwnProperty("preferences")&&CoFund.Info.setPreferences(e.preferences),e&&e.hasOwnProperty("savings")&&CoFund.Info.setSavings(e.savings);break;case"testForCheckout":Inject.testForCheckout(e.url);break;case"getConfig":a({ruleset:CoFund.Store.get("ruleset"),codes:CoFund.Store.get("codes"),codeDetails:CoFund.Store.get("codeDetails"),cashback:CoFund.Store.get("cashback"),extId:CoFund.Info.getExtId(),user:CoFund.Info.getUser(),preferences:CoFund.Info.getPreferences(),savings:CoFund.Info.getSavings()});break;case"showPageDrawer":Inject.togglePageDrawer()}}),document.location.href.toString().startsWith(Config.server)&&document.addEventListener("fbAuthComplete",function(e){"detail"in e&&(chrome.runtime.sendMessage({action:"setUser",user:{auth:e.detail.auth,app_key:e.detail.app_key,earnings:e.detail.earnings}},function(e){}),chrome.runtime.sendMessage({action:"setSavings",savings:e.detail.savings},function(e){}))}),document.location.href.toString().replace("http://","https://").startsWith(Config.server)&&(CoFund.Info.getUser()||document.addEventListener("autoLogin",function(e){"detail"in e&&(chrome.runtime.sendMessage({action:"setUser",user:{auth:e.detail.auth,app_key:e.detail.app_key,earnings:e.detail.earnings}},function(e){}),chrome.runtime.sendMessage({action:"setSavings",savings:e.detail.savings},function(e){}))})),2!==CoFund.Cashback.getPageCount()||CoFund.Cashback.hasFired()||0!==CoFund.Store.get("codes").length||CoFund.Cashback.hasAction(CoFund.Cashback.FIRE_ON_30)||Inject.showCashbackButton(CoFund.Store.get("cashback"));
//# sourceMappingURL=chrome-minified/src/inject/inject.js.map