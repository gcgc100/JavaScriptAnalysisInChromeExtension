var CoFund={};CoFund.Store={getCompositeKey:function(e){return"_cofund."+e},isset:function(e){return null!==sessionStorage.getItem(this.getCompositeKey(e))},set:function(e,t){sessionStorage.setItem(this.getCompositeKey(e),JSON.stringify(t))},get:function(e){try{return JSON.parse(sessionStorage.getItem(this.getCompositeKey(e)))}catch(t){return null}}},CoFund.Info={extId:null,user:null,preferences:{worksHere:!0},savings:0,getExtId:function(){return this.extId},setExtId:function(e){this.extId=e},getUser:function(){return this.user},setUser:function(e){this.user=e},getPreferences:function(){return this.preferences},setPreferences:function(e){this.preferences=e},getSavings:function(){return this.savings},setSavings:function(e){this.savings=e}},CoFund.Cookie={cookie:{name:"_cofund.ext",expires:7200,path:"/"},setDomain:function(e){this.cookie.domain=e},set:function(e,t){var o,s;try{o=JSON.parse(this._getJson())}catch(n){o={}}t?o[e]=t:delete o[e],s=new Date,s.setSeconds(s.getSeconds()+this.cookie.expires),document.cookie=[encodeURIComponent(this.cookie.name)+"="+encodeURIComponent(JSON.stringify(o)),s?"; expires="+s.toUTCString():"",this.cookie.path?"; path="+this.cookie.path:"",this.cookie.domain?"; domain="+this.cookie.domain:"",this.cookie.secure?"; secure":""].join("")},get:function(e){try{return JSON.parse(this._getJson())[e]}catch(t){return null}},getAll:function(){try{return JSON.parse(this._getJson())}catch(e){return{}}},isset:function(e){var t=this._getJson();if(t){var o=JSON.parse(t);if(o.hasOwnProperty(e))return!0}return!1},clear:function(e){this.set(e,null)},clearAll:function(){var e=this;Object.keys(this.getAll()).forEach(function(t){e.set(t,null)})},getExternal:function(e){for(var t=document.cookie.split("; "),o=0,s=t.length;s>o;o++){var n=t[o].split("=");if(n[0]="undefined"!==n[0]?decodeURIComponent(n[0].replace(/\+/g," ")):"",n[1]="undefined"!==n[1]?decodeURIComponent(n[1].replace(/\+/g," ")):"",n[0]===e)return n[1]}},_getJson:function(){for(var e=document.cookie.split("; "),t=0,o=e.length;o>t;t++){var s=e[t].split("=");if(s[0]="undefined"!==s[0]?decodeURIComponent(s[0].replace(/\+/g," ")):"",s[1]="undefined"!==s[1]?decodeURIComponent(s[1].replace(/\+/g," ")):"",s[0]===this.cookie.name)return s[1]}}},CoFund.State={PENDING:0,STATE_RECEIVED:1,CODES_PRESENTED:2,CODES_PROCESSED:3,get:function(){return CoFund.Store.get("state")},set:function(e){CoFund.Store.set("state",e)},clear:function(){this.set(null)}},CoFund.Sliders={SLIDER_IN:1,CASHBACK_BUTTON:2,ACTIVATED_AUTOTRY_SUCCESS:4,COPIED_CODE:8,CLOSED_MANUAL_DRAWER:16,show:function(e){if(!this.hasShown(e)){var t=CoFund.Cookie.get("Sliders")?CoFund.Cookie.get("Sliders")+e:e;CoFund.Cookie.set("Sliders",t)}},hasShown:function(e){return(CoFund.Cookie.get("Sliders")&e)===e},reset:function(e){if(this.hasShown(e)){var t=CoFund.Cookie.get("Sliders")-e;CoFund.Cookie.set("Sliders",t)}}},CoFund.Cashback={FIRE_ON_30:1,FIRE_ON_CODES_FOUND:2,FIRE_ON_CODES_PRESENTED:4,FIRE_ON_CODES_SUCCESSFUL:8,FIRE_ON_CODES_ACTIVATED:16,FIRE_ON_DRAWER_CLOSED:32,FIRE_ON_SLIDER_CLOSED:64,FIRE_ON_CASHBACK_ACTIVATED:128,FIRE_ON_CODES_COPIED:256,FIRE_ON_120:512,FIRE_ON_180:1024,FIRE_ON_COUPON_TAB_CLICK:2048,refCodes:[],tracker:null,fireOnActions:null,isButtonABTest:!1,buttonABRef:null,init:function(e){this.refCodes[this.FIRE_ON_30]="30",this.refCodes[this.FIRE_ON_CODES_FOUND]="cf",this.refCodes[this.FIRE_ON_CODES_PRESENTED]="cp",this.refCodes[this.FIRE_ON_CODES_SUCCESSFUL]="cs",this.refCodes[this.FIRE_ON_CODES_ACTIVATED]="ca",this.refCodes[this.FIRE_ON_DRAWER_CLOSED]="dc",this.refCodes[this.FIRE_ON_SLIDER_CLOSED]="sc",this.refCodes[this.FIRE_ON_CASHBACK_ACTIVATED]="cb",this.refCodes[this.FIRE_ON_CODES_COPIED]="cc",this.refCodes[this.FIRE_ON_120]="120",this.refCodes[this.FIRE_ON_180]="180",this.refCodes[this.FIRE_ON_COUPON_TAB_CLICK]="tc",CoFund.Store.isset("cb")?(this.loadTracker(),this.tracker={init:this.getTimestamp(),pageCount:this.getPageCount()+(e?0:1),hasFired:this.hasFired()}):this.tracker={init:(new Date).getTime()/1e3,pageCount:1,hasFired:!1},this.updateTracker(),this.checkForSchedule()},loadTracker:function(){CoFund.Store.isset("cb")&&(this.tracker=CoFund.Store.get("cb"))},updateTracker:function(){CoFund.Store.set("cb",this.tracker)},getTimestamp:function(){return this.tracker?this.tracker.init:(new Date).getTime()/1e3},getPageCount:function(){return this.tracker?this.tracker.pageCount:0},hasFired:function(){return this.tracker?this.tracker.hasFired:!1},getActions:function(){if(this.fireOnActions)return this.fireOnActions;var e=CoFund.Store.get("cashback");return e&&e.hasOwnProperty("action")?(this.fireOnActions=e.action,this.fireOnActions):null},hasAction:function(e){var t=this.getActions();return t?(t&e)===e:void 0},checkForSchedule:function(){if(!this.hasFired()&&(this.hasAction(this.FIRE_ON_30)||this.hasAction(this.FIRE_ON_120)||this.hasAction(this.FIRE_ON_180))){var e=this.hasAction(this.FIRE_ON_30)?30:this.hasAction(this.FIRE_ON_120)?120:180,t=(new Date).getTime()/1e3,o=t-parseInt(this.getTimestamp()),s=this.getPageCount(),n=this;s>=2&&(e>o?setTimeout(function(){n.fire(n["FIRE_ON_"+e])},1e3*(e-o)):n.fire(n["FIRE_ON_"+e]))}},fire:function(e,t,o){if(!this.hasFired()){var s=this;this.tracker.hasFired=!0,this.updateTracker();var n,i,r=CoFund.Store.get("cashback"),a=CoFund.Store.get("codeDetails"),u=null,c=null;if("function"==typeof chrome.runtime.getManifest&&(i=chrome.runtime.getManifest()),i||(i={version:0}),r.hasOwnProperty("s")&&(u=r.s),t&&a&&a.hasOwnProperty(t)&&a[t].hasOwnProperty("o")&&(c=a[t].o),r.hasOwnProperty("firethru")&&null!==r.firethru&&(n=r.firethru),"3a2"===Config.testType){setTimeout(function(){chrome.runtime.sendMessage({action:"tab"==n?"openTab":"firePixel",url:Config.server+"/int?direct=1&s="+(u?u:"")+"&o="+(c?c:"")+"&ref1="+s.refCodes[e]+"&ref3=cof&v="+i.version+(CoFund.Cashback.isButtonABTest?"&ref4="+CoFund.Cashback.buttonABRef:"")+(CoFund.Info.getExtId()?"&app_uid="+CoFund.Info.getExtId():"")})},1e3);var C={};C[CoFund.Session.TR_CASHBACK_FIRE]=!0,C[CoFund.Session.TR_CASHBACK_FIRE_TRIG]=s.refCodes[e]+(o?o:""),CoFund.Session.update(C)}else{setTimeout(function(){$.ajax({type:"GET",url:Config.server+"/toolbar/cashback?s="+(u?u:"")+"&o="+(c?c:"")+"&ref1="+s.refCodes[e]+"&ref3=cof&v="+i.version+(CoFund.Cashback.isButtonABTest?"&ref4="+CoFund.Cashback.buttonABRef:"")+(CoFund.Info.getExtId()?"&app_uid="+CoFund.Info.getExtId():""),cache:!1,dataType:"json",success:function(e,t,o){e.hasOwnProperty("url")&&e.url?chrome.runtime.sendMessage({action:"firePixel",url:e.url}):CoFund.Events.logCashbackFireFailed(e.url?"Invalid response from /toolbar/cashback for store "+(u?u:""):"No url for store "+(u?u:""))},error:function(e,t,o){CoFund.Events.logCashbackFireFailed("tcb:"+e.status+" ("+e.responseText+")")}})},1e3);var C={};C[CoFund.Session.TR_CASHBACK_FIRE]=!0,C[CoFund.Session.TR_CASHBACK_FIRE_TRIG]=s.refCodes[e]+(o?o:""),CoFund.Session.update(C)}}},formatForDisplay:function(e,t){return e.pay?e.payType&&1===Number(e.payType)?t?'<span style="display: block">$'+parseFloat(e.pay).toFixed(2)+'</span><sub style="left: 0">cashback</sub>':"$"+parseFloat(e.pay).toFixed(2):(parseFloat(e.pay)>9.9?parseFloat(e.pay).toFixed(0):parseFloat(e.pay).toFixed(1))+(t?"<sup>%</sup><sub>cashback</sub>":"%"):void 0}},CoFund.Events={TYPE_CODES_PRESENTED:1,TYPE_CODE_SUCCESS:2,TYPE_CODE_FAILURE:3,TYPE_NO_CODES:4,TYPE_CASHBACK_FIRED:5,TYPE_CASHBACK_FIRE_FAILED:6,TYPE_NO_CODES_NO_CASHBACK:7,TYPE_PROVIDER_ERROR:8,TYPE_CASHBACK_BUTTON_DISMISSED:9,TYPE_DRAWER_CLOSED:10,log:function(e,t){var o;"function"==typeof chrome.runtime.getManifest&&(o=chrome.runtime.getManifest()),o||(o={version:0}),$.ajax({type:"POST",url:Config.server+"/toolbar/events?app_uid="+CoFund.Info.getExtId(),data:{v:o.version,type:e,currentState:CoFund.State.get(),message:t}})},logCodesPresented:function(e){this.log(this.TYPE_CODES_PRESENTED,e)},logCodeSuccess:function(e){this.log(this.TYPE_CODE_SUCCESS,e)},logCodeFailure:function(e){this.log(this.TYPE_CODE_FAILURE,e)},logNoCodes:function(e){this.log(this.TYPE_NO_CODES,e)},logCashbackFired:function(e){this.log(this.TYPE_CASHBACK_FIRED,e)},logCashbackFireFailed:function(e){this.log(this.TYPE_CASHBACK_FIRE_FAILED,e)},logNoCodesNoCashback:function(e){this.log(this.TYPE_NO_CODES_NO_CASHBACK,e)},logProviderError:function(e){this.log(this.TYPE_PROVIDER_ERROR,e)},logCashbackButtonDismissed:function(e){this.log(this.TYPE_CASHBACK_BUTTON_DISMISSED,e)},logDrawerClosed:function(e){this.log(this.TYPE_DRAWER_CLOSED,e)}},CoFund.Session={TR_CHECKOUT_MATCHED:"cm",TR_DRAWER_SHOWN:"ds",TR_DRAWER_MSG:"dm",TR_COUNT_CODES:"cp",TR_DRAWER_CLOSED:"dc",TR_DRAWER_MAN_OPEN:"do",TR_US_TRIED_CODES:"tc",TR_US_COPIED_CODES:"cc",TR_US_VIEWED_CODES:"vc",TR_US_VIEWED_AUTOLOAD_MANUAL:"va",TR_CODE_SUCCESS:"cs",TR_CODE_FAILED:"cf",TR_CASHBACK_FIRE:"ch",TR_CASHBACK_FIRE_TRIG:"ct",TR_TEST_NAME:"tn",TR_TEST_RESULT:"tr",firstSendComplete:!1,update:function(e){var t;"function"==typeof chrome.runtime.getManifest&&(t=chrome.runtime.getManifest()),t||(t={version:0});var o=CoFund.Store.get("cashback");if(o&&o.hasOwnProperty("s")){var s=Config.server+"/toolbar/session?app_uid="+(CoFund.Info.getExtId()?CoFund.Info.getExtId():"")+"&s="+o.s+"&v="+t.version;for(var n in e)s+="&"+n+"="+e[n];var i=this;this.firstSendComplete?setTimeout(function(){i.firstSendComplete=!0,$.ajax({type:"GET",url:s})},5e3):(i.firstSendComplete=!0,$.ajax({type:"GET",url:s}))}},updateOne:function(e,t){var o={};o[e]=t,this.update(o)},tested:function(e,t){var o={};o[this.TR_TEST_NAME]=e,o[this.TR_TEST_RESULT]=t,this.update(o)}},CoFund.Flags={hideDrawer:1,hideCouponTab:2,hideSlideInPGW:4,hasFlag:function(e){var t=CoFund.Store.get("ruleset");return(t&&t.flags&e)===e}};
//# sourceMappingURL=chrome-minified/src/common/cofund.js.map